WinJS.Utilities._writeProfilerMark("WinJS.2.1 2.0.1.WinJS.2014.6.21 ui.js,StartTM"),function(a,b){"function"==typeof define&&define.amd?define(["./base"],b):b()}(this,function(){var a=WinJS.Utilities._require,b=WinJS.Utilities._define;return b("require-style",["require"],function(b){var c,d={},e=[],f={};return d.load=function(a,b,d,f){if(!f.isBuild)return void d();var g=b.toUrl(a);return 0===g.indexOf("empty:")?void d():(c=f,e.push('@import "'+g+'";'),void d())},d.normalize=function(a){var c=a;c.match(/\.less$/)||(c+=".less");var d=b.toUrl(c);return f[d]||(f[d]=a),d},d.write=function(a,b,c){var d=f[b];c.asModule(a+"!"+d,"define(function(){})")},d.onLayerEnd=function(b,d){if(c){var f=a.nodeRequire("less"),g=a.nodeRequire("fs"),h=a.nodeRequire("mkpath"),i=d.path.substr(0,d.path.lastIndexOf("/"));i=i.substr(0,i.lastIndexOf("/")),i+="/css/",h.sync(i);for(var j=["dark","light"],k=0;k<j.length;++k){var l=["@platform: "+c.platform+";","@theme: "+j[k]+";","@inverseTheme: "+j[(k+1)%2]+";"].join("\n"),m=[".Colors(@theme);",".win-ui-@{inverseTheme} {","   .Colors(@inverseTheme);","}"].join("\n"),n="/* Copyright (c) Microsoft Open Technologies, Inc.  All Rights Reserved. Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information. */",o=n+"\n"+l+"\n"+e.join("\n")+"\n"+m,p=c.less||{};p.async=!1,p.syncImport=!0;var q=new f.Parser(p);q.parse(o,function(a,b){if(a)return void console.error(a+" in "+a.filename+"\nline number: "+a.line);var c=b.toCSS(p);g.writeFileSync(i+"ui-"+j[k]+".css",c,"utf8")})}}},d}),b("require-style!less/animation-library",[],function(){}),b("require-style!less/typography",[],function(){}),b("require-style!less/desktop/styles-intrinsic",[],function(){}),b("require-style!less/desktop/colors-intrinsic",[],function(){}),b("WinJS/VirtualizedDataSource/_GroupDataSource",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_GroupDataSource:WinJS.Namespace._lazy(function(){function a(){return new WinJS.ErrorFromName(c.FetchError.doesNotExist)}function b(a){return a&&a.firstReached&&a.lastReached}var c=WinJS.UI,d=WinJS.Promise,e=WinJS.Utilities.Scheduler,f=101,g=WinJS.Class.define(function(a){this._groupDataAdapter=a},{beginNotifications:function(){},inserted:function(a,b,c){this._groupDataAdapter._inserted(a,b,c)},changed:function(a,b){this._groupDataAdapter._changed(a,b)},moved:function(a,b,c){this._groupDataAdapter._moved(a,b,c)},removed:function(a,b){this._groupDataAdapter._removed(a,b)},countChanged:function(a,b){0===a&&0!==b&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(a,b,c){this._groupDataAdapter._indexChanged(a,b,c)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),h=WinJS.Class.define(function(a,b,c,d){this._listBinding=a.createListBinding(new g(this)),this._groupKey=b,this._groupData=c,this._initializeState(),this._batchSize=f,this._count=null,d&&("number"==typeof d.groupCountEstimate&&(this._count=d.groupCountEstimate<0?null:Math.max(d.groupCountEstimate,1)),"number"==typeof d.batchSize&&(this._batchSize=d.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(a){var b=this;return this._fetchItems(function(){return b._lastGroup},function(a){if(a)return!1;var c=b._count;return+c!==c?!0:c>0?!0:void 0},function(){b._fetchBatch(b._listBinding.last(),b._batchSize-1,0)},a-1,0)})},{setNotificationHandler:function(a){this._listDataNotificationHandler=a},compareByIdentity:!0,itemsFromKey:function(a,b,c,d){var e=this;return this._fetchItems(function(){return e._keyMap[a]},function(){var a=e._lastGroup;return a?+a.index!==a.index?!0:void 0:!0},function(){d=d||{};var a="string"==typeof d.groupMemberKey&&e._listBinding.fromKey?e._listBinding.fromKey(d.groupMemberKey):"number"==typeof d.groupMemberIndex&&e._listBinding.fromIndex?e._listBinding.fromIndex(d.groupMemberIndex):void 0!==d.groupMemberDescription&&e._listBinding.fromDescription?e._listBinding.fromDescription(d.groupMemberDescription):e._listBinding.first(),b=Math.floor(.5*(e._batchSize-1));e._fetchBatch(a,b,e._batchSize-1-b)},b,c)},itemsFromIndex:function(a,b,c){var d=this;return this._fetchItems(function(){return d._indexMap[a]},function(){var b=d._lastGroup;return b?+b.index!==b.index?!0:a<=b.index?!0:void 0:!0},function(){d._fetchNextIndex()},b,c)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return d.wrap(this._count);var a=this,b=new d(function(b){var c={initialBatch:function(){a._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(c){c&&(a._count=0);var d=a._count;return"number"==typeof d?(b(d),!0):!1}};a._fetchQueue.push(c),a._itemBatch||a._continueFetch(c)});return"number"==typeof this._count?d.wrap(this._count):b},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(a){delete this._handleMap[a.handle],this._listBinding.releaseItem(a)},_processBatch:function(){for(var a=null,b=null,c=null,d=0,f=!0,g=0;g<this._batchSize;g++){var h=this._itemBatch[g],i=h?this._groupKey(h):null;if(h&&(f=!1),b&&null!==i&&i===b.key)d++,b.lastItem===a?(b.lastItem.handle!==b.firstItem.handle&&this._releaseItem(b.lastItem),b.lastItem=h,this._handleMap[h.handle]=b,b.size++):b.firstItem===h&&(b.firstItem.handle!==b.lastItem.handle&&this._releaseItem(b.firstItem),b.firstItem=c,this._handleMap[c.handle]=b,b.size+=d);else{var j=null;if(b&&(b.lastReached=!0,"number"==typeof b.index&&(j=b.index+1)),h){var k=this._keyMap[i];if(k||(k={key:i,data:this._groupData(h),firstItem:h,lastItem:h,size:1},this._keyMap[k.key]=k,this._handleMap[h.handle]=k),g>0&&(k.firstReached=!0,b||(j=0)),"number"!=typeof k.index&&"number"==typeof j){for(var l=k;l;l=this._nextGroup(l))l.index=j,this._indexMap[j]=l,j++;this._indexMax=j,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}c=h,d=0,b=k}else b&&(this._lastGroup=b,"number"==typeof b.index&&(this._count=b.index+1),this._listDataNotificationHandler.invalidateAll(),b=null)}a=h}var m;for(m=this._fetchQueue[0];m&&m.complete(f);m=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(m){var n=this;e.schedule(function(){n._continueFetch(m)},e.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(a,b){a.retain(),this._itemBatch[b]=a;var c=this;a.then(function(a){c._itemBatch[b]=a,0===--c._itemsToFetch&&c._processBatch()})},_fetchBatch:function(a,b){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(a,b);var c;for(this._listBinding.jumpToItem(a),c=b-1;c>=0;c--)this._processPromise(this._listBinding.previous(),c);for(this._listBinding.jumpToItem(a),c=b+1;c<this._batchSize;c++)this._processPromise(this._listBinding.next(),c)},_fetchAdjacent:function(a,b){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(a.key):this._listBinding.fromIndex(a.index),b?0:this._batchSize-1,b?this._batchSize-1:0)},_fetchNextIndex:function(){var a=this._indexMap[this._indexMax-1];a?this._fetchAdjacent(a.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(a){if(a.initialBatch)a.initialBatch(),a.initialBatch=null;else{var c=a.getGroup();if(c){var d,e;c.firstReached?c.lastReached?a.countBefore>0&&0!==c.index&&!b(d=this._previousGroup(c))?this._fetchAdjacent(d&&d.lastReached?d.firstItem:c.firstItem,!1):(e=this._nextGroup(c),this._fetchAdjacent(e&&e.firstReached?e.lastItem:c.lastItem,!0)):this._fetchAdjacent(c.lastItem,!0):this._fetchAdjacent(c.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(a,d,e,f,g){if(b(a)){var h=this._previousGroup(a);if(f||b(h)||0===a.index||0===d){var i=this._nextGroup(a);if(f||b(i)||this._lastGroup===a||0===e){for(var j=0,k=a;d>j&&(h=this._previousGroup(k),b(h));)k=h,j++;for(var l=0,m=a;e>l&&(i=this._nextGroup(m),b(i));)m=i,l++;for(var n=j+1+l,o=new Array(n),p=0;n>p;p++){var q={key:k.key,data:k.data,firstItemKey:k.firstItem.key,groupSize:k.size},r=k.firstItem.index;"number"==typeof r&&(q.firstItemIndexHint=r),o[p]=q,k=this._nextGroup(k)}var s={items:o,offset:j};return s.totalCount="number"==typeof this._count?this._count:c.CountResult.unknown,"number"==typeof a.index&&(s.absoluteIndex=a.index),m===this._lastGroup&&(s.atEnd=!0),g(s),!0}}}return!1},_fetchItems:function(b,c,e,f,g){var h=this;return new d(function(d,i){function j(e){var j=b();return j?h._fetchComplete(j,f,g,l,d,i):l&&!c(e)?(i(a()),!0):m>2?(i(a()),!0):(e?m++:m=0,!1)}var k=b(),l=!k,m=0;if(!j()){var n={initialBatch:l?e:null,getGroup:b,countBefore:f,countAfter:g,complete:j};h._fetchQueue.push(n),h._itemBatch||h._continueFetch(n)}})},_previousGroup:function(a){return a&&a.firstReached?(this._listBinding.jumpToItem(a.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(a){return a&&a.lastReached?(this._listBinding.jumpToItem(a.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(a){this._count=null,this._lastGroup=null,"number"==typeof a.index&&(this._indexMax=a.index>0?a.index:null);for(var b=a;b&&"number"==typeof b.index;b=this._nextGroup(b))delete this._indexMap[b.index],b.index=null},_releaseGroup:function(a){this._invalidateIndices(a),delete this._keyMap[a.key],this._lastGroup===a&&(this._lastGroup=null),a.firstItem!==a.lastItem&&this._releaseItem(a.firstItem),this._releaseItem(a.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var a=0;a<this._batchSize;a++){var b=this._itemBatch[a];b&&(b.cancel&&b.cancel(),this._listBinding.releaseItem(b))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(a,b,c){var d=this._handleMap[b],e=this._handleMap[c],f=null;d&&(d.lastReached&&b===d.lastItem.handle&&(f=this._groupKey(a))!==d.key?this._lastGroup===d&&(this._lastGroup=null,this._count=null):this._releaseGroup(d),this._beginRefresh()),e&&e!==d&&(this._invalidateIndices(e),e.firstReached&&c===e.firstItem.handle&&(null!==f?f:this._groupKey(a))!==e.key||this._releaseGroup(e),this._beginRefresh())},_processRemoval:function(a){var b=this._handleMap[a];if(!b||a!==b.firstItem.handle&&a!==b.lastItem.handle){if(this._itemBatch)for(var c=0;c<this._batchSize;c++){var d=this._itemBatch[c];if(d&&d.handle===a){this._beginRefresh();break}}}else this._releaseGroup(b),this._beginRefresh()},_inserted:function(a,b,c){var d=this;a.then(function(a){d._processInsertion(a,b,c)})},_changed:function(a,b){var c=this._handleMap[a.handle];if(c&&a.handle===c.firstItem.handle&&(this._releaseGroup(c),this._beginRefresh()),this._groupKey(a)!==this._groupKey(b)){this._listBinding.jumpToItem(a);var d=this._listBinding.previous().handle;this._listBinding.jumpToItem(a);var e=this._listBinding.next().handle;this._processRemoval(a.handle),this._processInsertion(a,d,e)}},_moved:function(a,b,c){this._processRemoval(a.handle);var d=this;a.then(function(a){d._processInsertion(a,b,c)})},_removed:function(a,b){b||this._processRemoval(a)},_indexChanged:function(a,b,c){"number"==typeof c&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var a in this._keyMap){var b=this._keyMap[a];if(b.firstReached&&b.lastReached){var c=b.lastItem.index+1-b.firstItem.index;isNaN(c)||(b.size=c)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return WinJS.Class.derive(c.VirtualizedDataSource,function(a,b,c,d){var e=new h(a,b,c,d);this._baseDataSourceConstructor(e),this.extensions={invalidateGroups:function(){e.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}),b("WinJS/VirtualizedDataSource/_GroupedItemDataSource",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(a,b,c,d){function e(a){if(a){var d=Object.create(a);return d.groupKey=b(a),c&&(d.groupData=c(a)),d}return null}function f(a){var b=Object.create(a);return b.then=function(b,c,d){return a.then(function(a){return b(e(a))},c,d)},b}var g=Object.create(a);g.createListBinding=function(b){var c;b?(c=Object.create(b),c.inserted=function(a,c,d){return b.inserted(f(a),c,d)},c.changed=function(a,c){return b.changed(e(a),e(c))},c.moved=function(a,c,d){return b.moved(f(a),c,d)}):c=null;for(var d=a.createListBinding(c),g=Object.create(d),h=["first","last","fromDescription","jumpToItem","current"],i=0,j=h.length;j>i;i++)!function(a){d[a]&&(g[a]=function(){return f(d[a].apply(d,arguments))})}(h[i]);return d.fromKey&&(g.fromKey=function(a){return f(d.fromKey(a))}),d.fromIndex&&(g.fromIndex=function(a){return f(d.fromIndex(a))}),g.prev=function(){return f(d.prev())},g.next=function(){return f(d.next())},g};for(var h=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],i=0,j=h.length;j>i;i++)!function(b){a[b]&&(g[b]=function(){return f(a[b].apply(a,arguments))})}(h[i]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(b){a[b]&&(g[b]=function(){return a[b].apply(a,arguments)})});var k=null;return Object.defineProperty(g,"groups",{get:function(){return k||(k=new WinJS.UI._GroupDataSource(a,b,c,d)),k},enumerable:!0,configurable:!0}),g}})}),b("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{VirtualizedDataSource:WinJS.Namespace._lazy(function(){function e(e,n){function o(a){var b="WinJS.UI.VirtualizedDataSource:"+ke+":"+a+",StartTM";WinJS.Utilities._writeProfilerMark(b),WinJS.log&&WinJS.log(b,"winjs vds","perf")}function p(a){var b="WinJS.UI.VirtualizedDataSource:"+ke+":"+a+",StopTM";WinJS.Utilities._writeProfilerMark(b),WinJS.log&&WinJS.log(b,"winjs vds","perf")}function q(a){return"number"==typeof a&&a>=0}function r(a){return q(a)&&a===Math.floor(a)}function s(a){if(null===a)a=void 0;else if(void 0!==a&&!r(a))throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidIndexReturned",l.invalidIndexReturned);return a}function t(a){if(null===a)a=void 0;else if(void 0!==a&&!r(a)&&a!==b.unknown)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidCountReturned",l.invalidCountReturned);return a}function u(){var a=(id++).toString(),b={handle:a,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return Id[a]=b,b}function v(){return u()}function w(a,b){a.prev=b.prev,a.next=b,a.prev.next=a,b.prev=a}function x(a){a.lastInSequence&&(delete a.lastInSequence,a.prev.lastInSequence=!0),a.firstInSequence&&(delete a.firstInSequence,a.next.firstInSequence=!0),a.prev.next=a.next,a.next.prev=a.prev}function y(a){for(;!a.firstInSequence;)a=a.prev;return a}function z(a){for(;!a.lastInSequence;)a=a.next;return a}function A(a,b,c){return b.prev.next=c.next,c.next.prev=b.prev,b.prev=a.prev,c.next=a,b.prev.next=b,a.prev=c,!0}function B(a,b,c){return b.prev.next=c.next,c.next.prev=b.prev,b.prev=a,c.next=a.next,a.next=b,c.next.prev=c,!0}function C(a){delete a.lastInSequence,delete a.next.firstInSequence}function D(a){var b=a.next;a.lastInSequence=!0,b.firstInSequence=!0,b===Gd&&ib(Gd,void 0)}function E(a,b,c,d){w(a,b);var e=a.prev;e.lastInSequence&&(c?delete e.lastInSequence:a.firstInSequence=!0,d?delete b.firstInSequence:a.lastInSequence=!0)}function F(a,b){a.key=b,Jd[a.key]=a}function G(a,b,c){+b===b&&(a.index=b,c[b]=a,vd||(a.firstInSequence&&a.prev&&a.prev.index===b-1&&C(a.prev),a.lastInSequence&&a.next&&a.next.index===b+1&&C(a)))}function H(a,b){var c=b===Kd?v():u();return w(c,a),c}function I(a,b,c){var d=H(a,c);return d.firstInSequence=!0,d.lastInSequence=!0,G(d,b,c),d}function J(a,b){return I(a,b,Kd)}function K(a,b){var c=H(a,b);return delete a.firstInSequence,c.prev.index===c.index-1?delete c.prev.lastInSequence:c.firstInSequence=!0,G(c,a.index-1,b),c}function L(a,b){var c=H(a.next,b);return delete a.lastInSequence,c.next.index===c.index+1?delete c.next.firstInSequence:c.lastInSequence=!0,G(c,a.index+1,b),c}function M(a,b,c,d){E(a,b,c,d),Jd[a.key]=a;a.index;void 0!==a.index&&(Kd[a.index]=a)}function N(a){x(a),a.key&&delete Jd[a.key],void 0!==a.index&&Kd[a.index]===a&&delete Kd[a.index];var b=a.bindingMap;for(var c in b){var d=b[c].handle;d&&Id[d]===a&&delete Id[d]}Id[a.handle]===a&&delete Id[a.handle]}function O(a){return!Id[a.handle]}function P(a,b,c,d,e){var f=e?null:b[a-1];if(f&&(f.next!==d||d.firstInSequence))f=f.next;else if(f=b[a+1],!f){f=c.next;for(var g;;){if(f.firstInSequence&&(g=f),!(a>=f.index)||f===d)break;f=f.next}f!==d||d.firstInSequence||(f=g&&void 0===g.index?g:void 0)}return f}function Q(a){return!a.item&&!a.itemNew&&a!==Gd}function R(a,b){Object.defineProperty(a,"handle",{value:b,writable:!1,enumerable:!1,configurable:!0})}function S(a,b,c){R(a,c),Object.defineProperty(a,"index",{get:function(){for(;b.slotMergedWith;)b=b.slotMergedWith;return b.index},enumerable:!1,configurable:!0})}function T(a){if(void 0===a)return a;var b=JSON.stringify(a);if(void 0===b)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.ObjectIsNotValidJson",l.objectIsNotValidJson);return b}function U(a){return e.itemSignature?e.itemSignature(a.data):T(a.data)}function V(a){var b=a.itemNew;a.itemNew=null,b&&(b=Object.create(b),S(b,a,a.handle),e.compareByIdentity||(a.signature=U(b))),a.item=b,delete a.indexRequested,delete a.keyRequested}function W(a){return a.bindingMap||a.cursorCount>0}function X(a){return W(a)||a.fetchListeners||a.directFetchListeners}function Y(a){return X(a)||!a.firstInSequence&&W(a.prev)||!a.lastInSequence&&W(a.next)||!de&&(!a.firstInSequence&&a.prev!==Fd&&!(a.prev.item||a.prev.itemNew))|(!a.lastInSequence&&a.next!==Gd&&!(a.next.item||a.next.itemNew))}function Z(a){D(a),N(a)}function $(){if(!qd){(!Md||O(Md))&&(Md=Gd.prev);for(var a=Md.prev,b=Md.next,c=0,d=function(a){a===Gd||Y(a)||(cd>=c?c++:Z(a))};a||b;){if(a){var e=a;a=e.prev,e!==Fd&&d(e)}if(b){var f=b;b=f.next,f!==Hd&&d(f)}}Ld=0}}function _(a){if(!X(a)){if(k._PerfMeasurement_leakSlots)return;Ld++,qd||Pd||(Md=a,Ld>cd&&!Nd&&(Nd=!0,j.schedule(function(){Nd=!1,$()},j.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested")))}}function ab(a){for(var b in gd)a(gd[b])}function bb(a,b){for(var c in a.bindingMap)b(a.bindingMap[c].bindingRecord,c)}function cb(a){return a.notificationsSent||(a.notificationsSent=!0,a.notificationHandler.beginNotifications&&a.notificationHandler.beginNotifications()),a.notificationHandler}function db(){nd||td||ab(function(a){a.notificationsSent&&(a.notificationsSent=!1,a.notificationHandler.endNotifications&&a.notificationHandler.endNotifications())})}function eb(a,b){var c=a.bindingMap;if(c){var d=c[b];if(d){var e=d.handle;if(e)return e}}return a.handle}function fb(a,b){return a&&a.handle!==b&&(a=Object.create(a),R(a,b)),a}function gb(a){var b=Ed;Ed=a,ab(function(a){a.notificationHandler&&a.notificationHandler.countChanged&&cb(a).countChanged(Ed,b)})}function hb(a,b){bb(a,function(c,d){c.notificationHandler.indexChanged&&cb(c).indexChanged(eb(a,d),a.index,b)})}function ib(a,b){var c=a.index;if(void 0!==c&&Kd[c]===a&&delete Kd[c],+b===b)G(a,b,Kd);else{if(+c!==c)return;delete a.index}hb(a,c)}function jb(a,b,c,d,e){var f={};if(!(!d&&b.lastInSequence||!e&&c.firstInSequence))if(b===Fd)if(c===Gd)for(var g in gd)f[g]=gd[g];else for(var g in c.bindingMap)f[g]=gd[g];else if(c===Gd||c.bindingMap)for(var g in b.bindingMap)(c===Gd||c.bindingMap[g])&&(f[g]=gd[g]);for(var g in a.bindingMap)f[g]=gd[g];return f}function kb(a){var b,c=a.prev,d=a.next,e=jb(a,c,d);for(b in e){var f=e[b];f.notificationHandler&&cb(f).inserted(f.itemPromiseFromKnownSlot(a),c.lastInSequence||c===Fd?null:eb(c,b),d.firstInSequence||d===Gd?null:eb(d,b))}}function lb(a){var b=a.item;V(a),bb(a,function(c,d){var e=eb(a,d);cb(c).changed(fb(a.item,e),fb(b,e))})}function mb(a,b,c,d,e){var f,g=b.prev;if(b===a){if(!a.firstInSequence||!c)return;b=a.next}else if(g===a){if(!a.lastInSequence||!d)return;g=a.prev}if(!e){var h=jb(a,g,b,c,d);for(f in h){var i=h[f];cb(i).moved(i.itemPromiseFromKnownSlot(a),(g.lastInSequence||g===a.prev)&&!c||g===Fd?null:eb(g,f),(b.firstInSequence||b===a.next)&&!d||b===Gd?null:eb(b,f))}ab(function(b){b.adjustCurrentSlot(a)})}x(a),E(a,b,c,d)}function nb(a,b){wb(a,!0),bb(a,function(c,d){cb(c).removed(eb(a,d),b)}),ab(function(b){b.adjustCurrentSlot(a)}),N(a)}function ob(a){for(;!a.firstInSequence;)a=a.prev;var b;do{b=a.lastInSequence;var c=a.next;nb(a,!0),a=c}while(!b)}function pb(a){var b;if(!a)return b;for(var c=0;!a.firstInSequence;)c++,a=a.prev;return"number"==typeof a.indexNew?a.indexNew+c:"number"==typeof a.index?a.index+c:b}function qb(a,b){for(a=a.next;a;a=a.next)if(a.firstInSequence){var c=void 0!==a.indexNew?a.indexNew:a.index;void 0!==c&&(a.indexNew=c+b)}ud+=b,vd=!0,Pd?rc():xd++}function rb(a,b){if(a.firstInSequence){var c;if(0>b)c=a.indexNew,void 0!==c?delete a.indexNew:c=a.index,a.lastInSequence||(a=a.next,void 0!==c&&(a.indexNew=c));else if(!a.lastInSequence){var d=a.next;c=d.indexNew,void 0!==c?delete d.indexNew:c=d.index,void 0!==c&&(a.indexNew=c)}}qb(a,b)}function sb(a,b){for(var c=Fd;c!==Gd;c=c.next){var d=c.indexNew;if(void 0!==d&&d>=a){qb(c,b);break}}}function tb(){var a,b,c;for(a=Fd;;a=a.next){if(a.firstInSequence){if(b=a,void 0!==a.indexNew){if(c=a.indexNew,delete a.indexNew,isNaN(c))break}else c=a.index;a!==Fd&&a.prev.index===c-1&&C(a.prev)}if(a.lastInSequence)for(var d=c,e=b;e!==a.next;e=e.next)d!==e.index&&ib(e,d),+d===d&&d++;if(a===Gd)break}for(;a!==Hd;a=a.next)void 0!==a.index&&a!==Gd&&ib(a,void 0);vd=!1,ud&&+Ed===Ed&&(kd?kd.reset():gb(Ed+ud),ud=0)}function ub(a,b,c,d,e){if(a.item)return new h(function(b){e?e(b,a.item):b(a.item)});var f={listBindingID:d,retained:!1};return a[b]||(a[b]={}),a[b][c]=f,f.promise=new h(function(a,b){f.complete=e?function(b){e(a,b)}:a,f.error=b},function(){for(;a.slotMergedWith;)a=a.slotMergedWith;var d=a[b];if(d){delete d[c];for(var e in d)return;delete a[b]}_(a)}),f.promise}function vb(a,b){for(var c in b)b[c].complete(a)}function wb(a,b){var c=a.fetchListeners,d=a.directFetchListeners;if(c||d){V(a);var e=a.item,f=function(a){b?vb(e,a):Bd.push(function(){vb(e,a)})};d&&(a.directFetchListeners=null,f(d)),c&&(a.fetchListeners=null,f(c)),_(a)}}function xb(){var a=Bd;Bd=[];for(var b=0,c=a.length;c>b;b++)a[b]()}function yb(a,b){var c=a.directFetchListeners;if(c){a.directFetchListeners=null;for(var d in c)c[d].error(b);_(a)}}function zb(a){return a.firstInSequence&&K(a,Kd),a.lastInSequence&&L(a,Kd),a.itemNew&&V(a),Xb(),a}function Ab(a){if(!a.firstInSequence){var b=a.prev;return b===Fd?null:zb(b)}return zb(K(a,Kd))}function Bb(a){if(!a.lastInSequence){var b=a.next;return b===Gd?null:zb(b)}return zb(L(a,Kd))}function Cb(a){return a?ub(a,"directFetchListeners",(jd++).toString()):h.wrap(null)}function Db(a){if("string"!=typeof a||!a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.KeyIsInvalid",l.keyIsInvalid)}function Eb(a){var b=J(Hd);return F(b,a),b.keyRequested=!0,b}function Fb(a,b){Db(a);var c=Jd[a];return c||(c=Eb(a),c.hints=b),zb(c)}function Gb(a){if("number"!=typeof a||0>a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.IndexIsInvalid",l.indexIsInvalid);if(Gd.index<=a)return null;var b=Kd[a];if(!b){var c=P(a,Kd,Fd,Gd);if(!c)return null;c===Gd&&a>=Gd&&ib(Gd,void 0),b=c.prev.index===a-1?L(c.prev,Kd):c.index===a+1?K(c,Kd):J(c,a)}return b.item||(b.indexRequested=!0),zb(b)}function Hb(a){var b=J(Hd);return b.description=a,zb(b)}function Ib(a){if(ed=a,dd!==ed){var b=function(){fd=!1,dd!==ed&&(dd=ed,le.dispatchEvent(m,dd))};ed===WinJS.UI.DataSourceStatus.failure?b():fd||(fd=!0,setTimeout(b,40))}}function Jb(a){var b=a.fetchID;return b&&Ad[b]}function Kb(a,b){a.fetchID=b}function Lb(){var a=zd;return zd++,Ad[a]=!0,a}function Mb(a,b,c){var d=Lb();Kb(a,d);for(var e=a;!e.firstInSequence&&b>0;)e=e.prev,b--,Kb(e,d);for(var f=a;!f.lastInSequence&&c>0;)f=f.next,c--,Kb(f,d);return d}function Nb(a){var b=a.items,c=a.offset,d=a.totalCount,e=a.absoluteIndex,f=a.atStart,g=a.atEnd;if(q(e)){if(q(d)){var h=b.length;e-c+h===d&&(g=!0)}c===e&&(f=!0)}f&&(b.unshift(Cd),a.offset++),g&&b.push(Dd)}function Ob(a,b,c){return delete Ad[c],b!==xd||O(a)?(Xb(),!1):!0}function Pb(a,b,d,e){var f=xd;d.then(function(d){if(!d.items||!d.items.length)return h.wrapError(new WinJS.ErrorFromName(c.doesNotExist));var g="itemsFetched id="+b+" count="+d.items.length;o(g),Ob(a,f,b)&&(+e===e&&(d.absoluteIndex=e),Nb(d),lc(a,d.items,d.offset,d.totalCount,d.absoluteIndex)),p(g)}).then(null,function(c){Ob(a,f,b)&&mc(a,c)})}function Qb(a,b,d,e){var f=xd;e.then(function(e){if(!e.items||!e.items.length)return h.wrapError(new WinJS.ErrorFromName(c.doesNotExist));var g="itemsFetched id="+d+" count="+e.items.length;o(g),Ob(b,f,d)&&(e.absoluteIndex=a,Nb(e),nc(a,b,e.items,e.offset,e.totalCount,e.absoluteIndex)),p(g)}).then(null,function(){Ob(b,f,d)&&oc(a,b,f,name)})}function Rb(a,b){var c=Mb(a,0,b-1);ee?Pb(a,c,ee(c,b),0):Pb(a,c,de(c,0,0,b-1),0)}function Sb(a,b){var c=Mb(a,b-1,0);Pb(a,c,fe(c,b))}function Tb(a,b,c){var d=Mb(a,b,c);Pb(a,d,ce(d,a.key,b,c,a.hints))}function Ub(a,b,c){var d=a.index;if(b>d&&(b=d),de){var e=Mb(a,b,c);Pb(a,e,de(e,d,b,c),d)}else if(a.key)Tb(a,b,c);else{var f,g,h=Fd,i=d+1;for(f=a.prev;f!==Fd;f=f.prev)if(void 0!==f.index&&f.key){g=d-f.index,i>g&&(i=g,h=f);break}for(f=a.next;f!==Gd;f=f.next)if(void 0!==f.index&&f.key){g=f.index-d,i>g&&(i=g,h=f);break}if(h===Fd){var e=Mb(a,0,d+1);Qb(0,a,e,ee(e,d+1))}else{var j=Math.max(h.index-d,0),k=Math.max(d-h.index,0),e=Mb(h,j,k);Qb(h.index,a,e,ce(e,h.key,j,k,a.hints))}}}function Vb(a,b,c){var d=Mb(a,b,c);Pb(a,d,ge(d,a.description,b,c))}function Wb(){if(!Pd){for(var b,c,d,e,f,g,h,i,j=!1,k=!1,l=Fd.next;l!==Hd;){var m=l.next;if(l!==Gd&&Q(l)&&(k=!0,b?c++:(b=l,c=1),Jb(l)&&(j=!0),l.keyRequested&&!d&&(d=l,e=c-1),void 0===l.description||f||(f=l,g=c-1),l.indexRequested&&!h&&(h=l,i=c-1),l.lastInSequence||m===Hd||!Q(m))){if(j)j=!1;else{if(ld=!1,!b.firstInSequence&&b.prev.key&&ce?Tb(b.prev,0,c):!l.lastInSequence&&m.key&&ce?Tb(m,c,0):b.prev!==Fd||b.firstInSequence||!ee&&!de?m===Gd&&!l.lastInSequence&&fe?Sb(l,c):d?Tb(d,e,c-1-e):f?Vb(f,g,c-1-g):h?Ub(h,i,c-1-i):"number"==typeof b.index?Ub(b,c-1,0):ob(b):Rb(b,c),ld)return void Xb();if(Pd)return}b=h=d=null}l=m}Ib(k?a.waiting:a.ready)}}function Xb(){yd||(yd=!0,j.schedule(function(){yd=!1,Wb(),db()},j.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function Yb(a){var b=a.itemNew;if(!b)return!1;var c=a.item;for(var d in c)switch(d){case"data":break;default:if(c[d]!==b[d])return!0}return e.compareByIdentity?c.data!==b.data:a.signature!==U(b)}function Zb(a){X(a)?Yb(a)?lb(a):a.itemNew=null:a.item=null}function $b(a){a.item?Zb(a):wb(a)}function _b(a,b){a.key||F(a,b.key),a.itemNew=b,$b(a)}function ac(a,b,c){var d=b.bindingMap;if(d)for(var e in c)if(d[e]){var f=b.fetchListeners;for(var g in f){var h=f[g];h.listBindingID===e&&h.retained&&(delete f[g],h.complete(null))}var i=d[e].bindingRecord;cb(i).removed(eb(b,e),!0,eb(a,e)),b.bindingMap&&delete b.bindingMap[e]}}function bc(a,b){if(a.index!==b.index){var c=b.index;b.index=a.index,hb(b,c)}b.slotMergedWith=a;var d=b.bindingMap;for(var e in d){a.bindingMap||(a.bindingMap={});var f=d[e];f.handle||(f.handle=b.handle),Id[f.handle]=a,a.bindingMap[e]=f}ab(function(c){c.adjustCurrentSlot(b,a)});var g=b.itemNew||b.item;if(g&&(g=Object.create(g),S(g,a,a.handle),_b(a,g)),a.item)b.directFetchListeners&&Bd.push(function(){vb(a.item,b.directFetchListeners)}),b.fetchListeners&&Bd.push(function(){vb(a.item,b.fetchListeners)});else{var h;for(h in b.directFetchListeners)a.directFetchListeners||(a.directFetchListeners={}),a.directFetchListeners[h]=b.directFetchListeners[h];for(h in b.fetchListeners)a.fetchListeners||(a.fetchListeners={}),a.fetchListeners[h]=b.fetchListeners[h]}a.itemNew&&wb(a),b.handle=(id++).toString(),D(b),N(b)}function cc(a,b,c){b&&b.key&&(c||(c=b.itemNew||b.item),delete b.key,delete Jd[c.key],b.itemNew=null,b.item=null),c&&_b(a,c),b&&bc(a,b)}function dc(a){if("object"!=typeof a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",l.invalidItemReturned);if(a===Cd)return Fd;if(a===Dd)return Gd;if(a.key)return WinJS.validation&&Db(a.key),Jd[a.key];throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",l.invalidKeyReturned)}function ec(a,b){var c=dc(b);c===a&&(c=null),c&&ac(a,c,a.bindingMap),cc(a,c,b)}function fc(a,b,c,d){if(b&&a.key&&a.key!==b.key)return rc(),!1;var e=Kd[c];if(e)if(e===a)e=null;else{if(e.key&&(a.key||b&&e.key!==b.key))return rc(),!1;if(!a.key&&e.bindingMap)return!1}var f;if(b)if(f=Jd[b.key],f===a)f=null;else if(f&&f.bindingMap)return!1;return e?(ac(a,e,a.bindingMap),delete Kd[c],ib(a,c),a.prev.index===c-1&&C(a.prev),a.next.index===c+1&&C(a),d.slotNext=e.slotNext,b||(b=e.itemNew||e.item,b&&(f=Jd[b.key]))):ib(a,c),f&&e!==f&&ac(a,f,a.bindingMap),cc(a,f,b),e&&e!==f&&bc(a,e),!0}function gc(a,b,c){if(b.key&&a.key&&b.key!==a.key)return rc(),!1;for(var d in a.bindingMap)c[d]=!0;return ac(a,b,c),cc(a,b),!0}function hc(a,b){for(var c={};a;){var d=a.firstInSequence?null:a.prev;if(b.firstInSequence||b.prev!==Fd){if(b=b.firstInSequence?K(b,Kd):b.prev,!gc(b,a,c))return}else nb(a,!0);a=d}}function ic(a,b){for(var c={};a;){var d=a.lastInSequence?null:a.next;if(b.lastInSequence||b.next!==Gd){if(b=b.lastInSequence?L(b,Kd):b.next,!gc(b,a,c))return}else nb(a,!0);a=d}}function jc(a){for(var b=0;b<a.length;b++){var c=a[b];hc(c.slotBeforeSequence,c.slotFirstInSequence),ic(c.slotAfterSequence,c.slotLastInSequence)}}function kc(a,b){function c(b){for(var c=Gd.prev;!(c.index<a)&&c!==b;){var e=c.prev;void 0!==c.index&&nb(c,!0),c=e}d=0}for(var d=0,e=Gd.prev;!(e.index<a)||d>0;){var f=e.prev;if(e===Fd){c(Fd);break}if(e.key){if(e.index>=a)return rc(),!1;if(!(e.index>=b))return ce?Tb(e,0,d):Ub(e,0,d),!1;c(e)}else e.indexRequested||e.firstInSequence?c(f):d++;e=f}return!0}function lc(a,c,d,e,f){var g="WinJS.UI.ListDataSource.processResults";return o(g),f=s(f),e=t(e),qd?void p(g):(vd&&tb(),!q(e)&&e!==b.unknown||e===Ed||Gd.firstInSequence?(ld=!0,function(){var b,g,h,i,j=c.length;if("number"!=typeof f)for(b=0;j>b;b++)if(h=dc(c[b]),h&&void 0!==h.index){f=h.index+d-b;break}"number"==typeof f&&c[j-1]===Dd?e=f-d+j-1:!q(e)||void 0!==f&&null!==f||(f=e-(j-1)+d),q(e)&&!kc(e,f-d)&&(e=void 0);var k=new Array(j);for(b=0;j>b;b++){var l=null;if(h=dc(c[b])){if(b>0&&!h.firstInSequence&&h.prev.key&&h.prev.key!==c[b-1].key||"number"==typeof f&&void 0!==h.index&&h.index!==f-d+b)return void rc();(h===Fd||h===Gd||h.bindingMap)&&(l=h)}if("number"==typeof f&&(h=Kd[f-d+b])){if(h.key&&h.key!==c[b].key)return void rc();!l&&h.bindingMap&&(l=h)}if(b===d){if(a.key&&a.key!==c[b].key||"number"==typeof a.index&&"number"==typeof f&&a.index!==f)return void rc();l||(l=a)}k[b]=l}for(b=0;j>b;b++)h=k[b],h&&void 0!==h.index&&h!==Fd&&h!==Gd&&ec(h,c[b]);var m=[],n=!0;for(b=0;j>b;b++)if(h=k[b],h&&h!==Gd){var o=b;if(void 0===h.index){var p={};fc(h,c[b],f-d+b,p);var r,s=h,t=h;for(g=b-1;!s.firstInSequence&&(r=c[g],r!==Cd);g--){var u=f-d+g;if(0>u)break;if(!fc(s.prev,r,u,p))break;s=s.prev,g>=0&&(k[g]=s)}for(g=b+1;!t.lastInSequence&&(r=c[g],r!==Dd&&g!==e||t.next===Gd)&&(t.next===Gd||fc(t.next,r,f-d+g,p))&&(t=t.next,j>g&&(k[g]=t),o=g,t!==Gd);g++);var v=s.firstInSequence?null:s.prev,w=t.lastInSequence?null:t.next;if(v&&D(v),w&&D(t),"number"==typeof f){if(t===Gd)v&&B(Gd,y(v),v);else{var x=p.slotNext;x||(x=P(t.index,Kd,Fd,Gd,!0)),A(x,s,t)}s.prev.index===s.index-1&&C(s.prev),t.next.index===t.index+1&&C(t)}else n||(i=k[b-1],i&&(s.prev!==i&&(t===Gd?(v&&B(Gd,y(v),v),A(s,y(i),i)):B(i,s,t)),C(i)));if(n=!1,Od)return;m.push({slotBeforeSequence:v,slotFirstInSequence:s,slotLastInSequence:t,slotAfterSequence:w})
}b!==d||h===a||O(a)||(v=a.firstInSequence?null:a.prev,w=a.lastInSequence?null:a.next,ac(h,a,h.bindingMap),bc(h,a),m.push({slotBeforeSequence:v,slotFirstInSequence:h,slotLastInSequence:h,slotAfterSequence:w})),b=o}for(q(e)&&Gd.index!==e&&ib(Gd,e),jc(m),b=0;j>b;b++)if(h=k[b]){for(g=b-1;g>=0;g--){var E=k[g+1];ec(k[g]=E.firstInSequence?K(k[g+1],Kd):E.prev,c[g])}for(g=b+1;j>g;g++)i=k[g-1],h=k[g],h?h.firstInSequence&&(h.prev!==i&&B(i,h,z(h)),C(i)):ec(k[g]=i.lastInSequence?L(i,Kd):i.next,c[g]);break}delete a.description}(),Od||(void 0!==e&&e!==Ed&&gb(e),Xb()),db(),xb(),void p(g)):(rc(),void p(g)))}function mc(b,d){switch(d.name){case c.noResponse:Ib(a.failure),yb(b,d);break;case c.doesNotExist:b.indexRequested?kc(b.index):(b.keyRequested||b.description)&&ob(b),db(),rc()}}function nc(a,b,c,d,e,f){f=s(f),e=t(e);var g=a-d,h=c.length;if(b.index>=g&&b.index<g+h)lc(b,c,b.index-g,e,b.index);else if(d===h-1&&a<b.index||q(e)&&e<=b.index)mc(b,new WinJS.ErrorFromName(k.FetchError.doesNotExist));else if(b.index<g){var i=Mb(b,0,g-b.index);Qb(g,b,i,ce(i,c[0].key,g-b.index,0))}else{var j=g+h-1,i=Mb(b,b.index-j,0);Qb(j,b,i,ce(i,c[h-1].key,0,b.index-j))}}function oc(a,b,d){switch(d.name){case c.doesNotExist:a===Fd.index?(kc(0),mc(b,d)):rc();break;default:mc(b,d)}}function pc(){for(var a=0;a<ie.length&&"beginRefresh"!==ie[a].kind;a++);for(var b=a;b<ie.length&&"beginRefresh"!==ie[b].kind;b++);if(b>a&&b+(b-a)<ie.length){for(var c=!0,d=b-a,e=0;d>e;e++)if(ie[a+e].kind!==ie[b+e].kind){c=!1;break}if(c&&WinJS.log){WinJS.log(l.refreshCycleIdentified,"winjs vds","error");for(var e=a;b>e;e++)WinJS.log(""+(e-a)+": "+JSON.stringify(ie[e]),"winjs vds","error")}return c}}function qc(){return++he>f&&pc()?void setState(a.failure):(ie[++je%ie.length]={kind:"beginRefresh"},Ud={firstInSequence:!0,lastInSequence:!0,index:-1},Vd={firstInSequence:!0,lastInSequence:!0},Ud.next=Vd,Vd.prev=Ud,Sd=!1,Td=void 0,Wd={},Xd={},Yd={},Yd[-1]=Ud,void(Zd={}))}function rc(){if(!Od){if(Od=!0,Ib(a.waiting),sd)return sd=!1,void Uc();if(!qd){var b=++xd;Pd=!0,Rd=0,j.schedule(function(){if(xd===b){Od=!1,qc();for(var a=Fd.next;a!==Hd;){var c=a.next;Y(a)||a===Gd||Z(a),a=c}zc()}},j.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function sc(){return Qd=Qd||new i,rc(),Qd.promise}function tc(a,b){return delete Ad[b],a!==xd?!1:(Rd--,!0)}function uc(a,b,d,e,f){var g=xd;Rd++,e.then(function(b){if(!b.items||!b.items.length)return h.wrapError(new WinJS.ErrorFromName(c.doesNotExist));var e="itemsFetched id="+d+" count="+b.items.length;o(e),tc(g,d)&&(Nb(b),Fc(a,b.items,b.offset,b.totalCount,"number"==typeof f?f:b.absoluteIndex)),p(e)}).then(null,function(c){tc(g,d)&&Gc(a,b,c)})}function vc(a,b,c,d){if(ce)uc(a.key,!1,b,ce(b,a.key,c,d,a.hints));else{var e=10,f=a.index;Yd[f]&&Yd[f].firstInSequence?uc(a.key,!1,b,de(b,f-1,Math.min(c+e,f)-1,d+1+e),f-1):Yd[f]&&Yd[f].lastInSequence?uc(a.key,!1,b,de(b,f+1,Math.min(c+e,f)+1,d-1+e),f+1):uc(a.key,!1,b,de(b,f,Math.min(c+e,f),d+e),f)}}function wc(a){ee?uc(null,!0,a,ee(a,1),0):de&&uc(null,!0,a,de(a,0,0,0),0)}function xc(a){return Ad[Wd[a]]}function yc(a,b){for(var c,d,e,f=3,g=xd,h=0,i=a;i!==Hd;i=i.next){if(!c&&i.key&&!Zd[i.key]&&!xc(i.key)){var j=Xd[i.key];(!j||j.firstInSequence||j.lastInSequence)&&(c=i,d=j,e=Lb())}if(c){var k=xc(i.key);if(Zd[i.key]||Xd[i.key]||k||(i.key&&(Wd[i.key]=e),h++),i.lastInSequence||i.next===Gd||k){if(vc(c,e,!d||d.firstInSequence?f:0,h-1+f),!b)break;c=null,h=0}}else i.key&&Q(i)&&!Zd[i.key]&&(Xd[i.key]||(e=Lb(),uc(i.key,!1,e,ce(e,i.key,1,1,i.hints))))}0!==Rd||Sd||xd!==g||wc(Lb())}function zc(){var a=xd;do $d=!1,_d=!0,yc(Fd.next,!0),_d=!1;while(0===Rd&&$d&&xd===a&&Pd);0===Rd&&xd===a&&Pc()}function Ac(a){var b=xd;if(a){var c=Jd[a];c||(c=Fd.next);do ae=!1,be=!0,yc(c,!1),be=!1;while(ae&&xd===b&&Pd)}_d?$d=!0:0===Rd&&xd===b&&zc()}function Bc(a){if("object"==typeof a&&a){if(a===Cd)return Ud;if(a===Dd)return Vd;if(a.key)return Xd[a.key];throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",l.invalidKeyReturned)}throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",l.invalidItemReturned)}function Cc(a,b){for(;void 0===a.index;){if(G(a,b,Yd),a.firstInSequence)return!0;a=a.prev,b--}return a.index!==b?(rc(),!1):!0}function Dc(a,b){a.key=b.key,Xd[a.key]=a,a.item=b}function Ec(){for(var a=Vd;!a.firstInSequence;)if(a=a.prev,a===Ud)return null;return a}function Fc(a,c,d,e,f){f=s(f),e=t(e);var g=!1;Sd=!0;var h=f-d,i=c[0];i.key===a&&(g=!0);var j=Bc(i);if(j){if(+h===h&&!Cc(j,h))return}else{if(Yd[h])return void rc();var k;if(void 0!==f&&(k=Yd[h-1])){if(!k.lastInSequence)return void rc();j=L(k,Yd)}else{var l=+h===h?P(h,Yd,Ud,Vd):Ec(Ud,Vd);if(!l)return void rc();j=I(l,h,Yd)}Dc(j,c[0])}for(var m=c.length,n=1;m>n;n++){i=c[n],i.key===a&&(g=!0);var o=Bc(i);if(o){if(void 0!==j.index&&!Cc(o,j.index+1))return;if(o!==j.next){if(!j.lastInSequence||!o.firstInSequence)return void rc();var p=z(o);if(p!==Vd)B(j,o,p);else{var r=y(j);if(r===Ud)return void rc();A(o,r,j)}C(j)}else j.lastInSequence&&C(j)}else{if(!j.lastInSequence)return void rc();o=L(j,Yd),Dc(o,i)}j=o}if(g||(Zd[a]=!0),!q(e)&&!Vd.firstInSequence){var u=Vd.prev.index;void 0!==u&&(e=u+1)}if(q(e)||e===b.unknown){if(q(Td)){if(e!==Td)return void rc()}else Td=e;q(Td)&&!Yd[Td]&&G(Vd,Td,Yd)}be?ae=!0:Ac(a)}function Gc(b,d,e){switch(e.name){case c.noResponse:Ib(a.failure);break;case c.doesNotExist:d?(G(Vd,0,Yd),Td=0,Pc()):(Zd[b]=!0,be?ae=!0:Ac(b))}}function Hc(a){return a===Ud?Fd:a===Vd?Gd:Jd[a.key]}function Ic(a){return a===Fd?Ud:a===Gd?Vd:Xd[a.key]}function Jc(a){C(a),a.next.mergedForRefresh=!0}function Kc(a,b){F(b,a.key),b.itemNew=a.item}function Lc(a,b,c){var d=v();Kc(a,d),E(d,b,c,!c);var e=a.index;return+e!==e&&(e=c?d.prev.index+1:b.next.index-1),G(d,e,Kd),d}function Mc(a,b,c){a?(ac(a,b,a.bindingMap),cc(a,b,c.item)):(Kc(c,b),b.indexRequested&&$b(b))}function Nc(a,b,c){return b.key?!1:(a?(c.mergeWithPrev=!b.firstInSequence,c.mergeWithNext=!b.lastInSequence):c.stationary=!0,Mc(a,b,c),!0)}function Oc(a){var b;if(a.indexRequested)b=a.index;else{var c=Ic(a);c&&(b=c.index)}return b}function Pc(){he=0,ie=new Array(100),je=-1,vd=!0,Wd={};var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=[],t=[];for(o=0,h=Ud;h;h=h.next)h.sequenceNumber=o,h.firstInSequence&&(j=h),h.lastInSequence&&(t[o]={first:j,last:h,matchingItems:0},o++);for(Md=null,Ld=0,c=Fd.next;c!==Hd;)h=Xd[c.key],e=c.next,c!==Gd&&(Y(c)?c.key&&!h?nb(c,!1):0===Td||c.indexRequested&&c.index>=Td?nb(c,!0):c.item||c.keyRequested?c.itemNew=h.item:c.key&&(c.keyRequested||(delete Jd[c.key],delete c.key),c.itemNew=null):Z(c)),c=e;for(c=Fd.next;c!==Gd;)e=c.next,c.indexRequested&&(h=Yd[c.index],h&&Mc(Hc(h),c,h)),c=e;var u,v,w,x,y,z=0,E=[];for(k=0,c=Fd;c!==Hd;c=c.next){if(c.firstInSequence)for(j=c,w=null,a=0;o>a;a++)E[a]=0;if(c.indexRequested&&(w=c),h=Ic(c),h&&E[h.sequenceNumber]++,c.lastInSequence){for(v=0,a=z;o>a;a++)v<E[a]&&(v=E[a],u=a);l={first:j,last:c,sequenceNew:v>0?t[u]:void 0,matchingItems:v},w&&(l.indexRequested=!0,l.stationarySlot=w),s[k]=l,c===Gd&&(x=k,y=l),k++,void 0!==t[u].first.index&&(z=u)}}s[0].sequenceNew!==t[0]&&(D(Fd),s[0].first=Fd.next,s.unshift({first:Fd,last:Fd,sequenceNew:t[0],matchingItems:1}),x++,k++);var F=!Gd.firstInSequence;for(y.sequenceNew!==t[o-1]&&(D(Gd.prev),y.last=Gd.prev,x++,s.splice(x,0,{first:Gd,last:Gd,sequenceNew:t[o-1],matchingItems:1}),k++,y=s[x]),a=0;k>a;a++)p=s[a].sequenceNew,p&&p.matchingItems<s[a].matchingItems&&(p.matchingItems=s[a].matchingItems,p.sequenceOld=s[a]);for(t[o-1].sequenceOld=y,y.stationarySlot=Gd,t[0].sequenceOld=s[0],s[0].stationarySlot=Fd,a=0;x>=a;a++)l=s[a],l.sequenceNew&&(n=l.sequenceNew.sequenceOld)===m&&m.last!==Gd?(Jc(n.last),n.last=l.last,delete s[a]):m=l;for(m=null,a=x;a>=0;a--)l=s[a],l&&(l.sequenceNew&&(n=l.sequenceNew.sequenceOld)===m&&l.last!==Gd?(Jc(l.last),n.first=l.first,delete s[a]):m=l);F&&delete Gd.mergedForRefresh;var G=[];for(a=x+1;k>a;a++)if(l=s[a],l&&(!l.sequenceNew||l.sequenceNew.sequenceOld!==l)){var H=!0,I=null,J=null,K=0;for(h=Ic(l.first),h&&(I=J=h,K=1),c=l.first;c!=l.last;c=c.next){var L=Ic(c.next);if(h&&L&&(h.lastInSequence||h.next!==L)){H=!1;break}h&&!I&&(I=J=h),L&&I&&(J=L,K++),h=L}if(H&&I&&void 0!==I.index){var M;I.firstInSequence||(f=Hc(I.prev),f&&(M=f.index));var N;if(J.lastInSequence||(g=Hc(J.next),g&&(N=g.index)),(!g||g.lastInSequence||g.mergedForRefresh)&&(void 0===M||void 0===N||N-M-1>=K)){for(l.locationJustDetermined=!0,h=I;h.locationJustDetermined=!0,h!==J;h=h.next);var j=Hc(I),O=Hc(J);G.push({slotBeforeSequence:j.firstInSequence?null:j.prev,slotFirstInSequence:j,slotLastInSequence:O,slotAfterSequence:O.lastInSequence?null:O.next})}}}for(a=0;k>a;a++)if(l=s[a],!(!l||l.indexRequested||l.locationJustDetermined||l.sequenceNew&&l.sequenceNew.sequenceOld===l)){l.sequenceNew=null,c=l.first;var P;do{if(P=c===l.last,e=c.next,c!==Fd&&c!==Gd&&c!==Hd&&!c.item&&!c.keyRequested)if(nb(c,!0),l.first===c){if(l.last===c){delete s[a];break}l.first=c.next}else l.last===c&&(l.last=c.prev);c=e}while(!P)}for(a=0;o>a;a++){for(p=t[a],h=p.first;!Hc(h)&&!h.lastInSequence;h=h.next);if(h.lastInSequence&&!Hc(h))p.firstInner=p.lastInner=null;else{for(p.firstInner=h,h=p.last;!Hc(h);h=h.prev);p.lastInner=h}}for(a=0;o>a;a++)if(p=t[a],p&&p.firstInner&&(l=p.sequenceOld)){var R=0;for(c=l.first;!0&&(h=Ic(c),h&&h.sequenceNumber===p.firstInner.sequenceNumber&&(h.ordinal=R),!c.lastInSequence);c=c.next,R++);var S=[];for(h=p.firstInner;!0;h=h.next){if(R=h.ordinal,void 0!==R){for(var T=0,U=S.length-1;U>=T;){var W=Math.floor(.5*(T+U));S[W].ordinal<R?T=W+1:U=W-1}S[T]=h,T>0&&(h.predecessor=S[T-1])}if(h===p.lastInner)break}var X=[],$=S.length;for(h=S[$-1],b=$;b--;)h.stationary=!0,X[b]=h,h=h.predecessor;l.stationarySlot=Hc(X[0]),h=X[0],c=Hc(h),d=c.prev;for(var _=c.firstInSequence;!h.firstInSequence;)if(h=h.prev,i=Hc(h),!i||h.locationJustDetermined)for(;!_&&d!==Fd&&(c=d,d=c.prev,_=c.firstInSequence,!Nc(i,c,h)););for(b=0;$-1>b;b++){h=X[b],c=Hc(h);var i,ab=X[b+1],bb=null,cb=Hc(ab);for(e=c.next,h=h.next;h!==ab&&!bb&&c!==cb;h=h.next)if(i=Hc(h),!i||h.locationJustDetermined)for(;e!==cb;){if(e.mergedForRefresh){bb=h.prev;break}if(c=e,e=c.next,Nc(i,c,h))break}if(bb)for(d=cb.prev,h=ab.prev;h!==bb&&cb!==c;h=h.prev)if(i=Hc(h),!i||h.locationJustDetermined)for(;d!==c&&(cb=d,d=cb.prev,!Nc(i,cb,h)););for(;e!==cb;)c=e,e=c.next,c!==Fd&&Q(c)&&!c.keyRequested&&nb(c)}for(h=X[$-1],c=Hc(h),e=c.next,_=c.lastInSequence;!h.lastInSequence;)if(h=h.next,i=Hc(h),!i||h.locationJustDetermined)for(;!_&&e!==Gd&&(c=e,e=c.next,_=c.lastInSequence,!Nc(i,c,h)););}for(a=0;o>a;a++)if(p=t[a],p.firstInner)for(d=null,h=p.firstInner;!0;h=h.next){if(c=Hc(h)){if(!h.stationary){var eb,fb=!1,hb=!1;if(d)eb=d.next,fb=!0;else{var jb;for(jb=p.firstInner;!jb.stationary&&jb!==p.lastInner;jb=jb.next);if(jb.stationary)eb=Hc(jb),hb=!0;else if(q=h.index,0===q)eb=Fd.next,fb=!0;else if(void 0===q)eb=Hd;else{eb=Fd.next;for(var lb=null;;){if(eb.firstInSequence&&(lb=eb),q<eb.index&&lb||eb===Gd)break;eb=eb.next}!eb.firstInSequence&&lb&&(eb=lb)}}c.mergedForRefresh&&(delete c.mergedForRefresh,c.lastInSequence||(c.next.mergedForRefresh=!0)),fb=fb||h.mergeWithPrev,hb=hb||h.mergeWithNext;var ob=h.locationJustDetermined;mb(c,eb,fb,hb,ob),ob&&hb&&(eb.mergedForRefresh=!0)}d=c}if(h===p.lastInner)break}for(a=0;o>a;a++)if(p=t[a],p.firstInner)for(d=null,h=p.firstInner;!0;h=h.next){if(c=Hc(h),!c){var pb;if(d)pb=d.next;else{var qb;for(qb=p.firstInner;!Hc(qb);qb=qb.next);pb=Hc(qb)}c=Lc(h,pb,!!d);var L=Ic(pb);pb.mergedForRefresh||L&&L.locationJustDetermined||(V(c),kb(c))}if(d=c,h===p.lastInner)break}Kd=[];var rb=-1;for(c=Fd,r=0;c!==Hd;r++){var e=c.next;if(c.firstInSequence&&(j=c,r=0),void 0===rb){var sb=Oc(c);void 0!==sb&&(rb=sb-r)}if(void 0!==rb&&!c.lastInSequence){var tb=Oc(c.next);if(void 0!==tb&&tb!==rb+r+1){D(c);for(var ub=!0,vb=c.next,wb=!1;!wb&&vb!==Gd;){var yb=vb.next;wb=vb.lastInSequence,mb(vb,yb,!ub,!1),ub=!1,vb=yb}}}if(c.lastInSequence){q=rb;for(var zb=j;zb!==e;){var Ab=zb.next;if(q>=Td&&zb!==Gd)nb(zb,!0);else{var Bb=Kd[q];q!==zb.index?(delete Kd[q],ib(zb,q)):+q===q&&Kd[q]!==zb&&(Kd[q]=zb),zb.itemNew&&$b(zb),Bb&&(zb.key?(ac(zb,Bb,zb.bindingMap),bc(zb,Bb),+q===q&&(Kd[q]=zb)):(ac(Bb,zb,Bb.bindingMap),bc(Bb,zb),+q===q&&(Kd[q]=Bb))),+q===q&&q++}zb=Ab}rb=void 0}c=e}var Cb,Db=-2;for(c=Fd,r=0;c!==Hd;r++){var e=c.next;if(c.firstInSequence&&(j=c,r=0),delete c.mergedForRefresh,c.lastInSequence)if(void 0===j.index){f=j.prev;var Eb;f&&(Eb=Ic(f))&&!Eb.lastInSequence&&(h=Ic(c))&&h.prev===Eb?(B(f,j,c),C(f)):c===Gd||Cb||A(Hd,j,c)}else{if(Db<c.index&&!Cb)Db=c.index;else{for(g=Fd.next;g.index<c.index;g=g.next);for(var vb=j;vb!==e;){var yb=vb.next;h=Ic(vb),mb(vb,g,g.prev.index===vb.index-1,g.index===vb.index+1,h&&h.locationJustDetermined),vb=yb}}f=j.prev,f&&f.index===j.index-1&&C(f)}c===Gd&&(Cb=!0),c=e}vd=!1,jc(G),void 0!==Td&&Td!==Ed&&gb(Td),db();var Fb=[];for(a=0;o>a;a++){p=t[a];var Gb=[];c=null,r=0;var Hb;for(h=p.first;!0&&(h===Ud?Gb.push(Cd):h===Vd?Gb.push(Dd):(Gb.push(h.item),c||(c=Hc(h),Hb=r)),!h.lastInSequence);h=h.next,r++);c&&Fb.push({slot:c,results:Gb,offset:Hb})}for(qc(),Pd=!1,xb(),a=0;a<Fb.length;a++){var Ib=Fb[a];lc(Ib.slot,Ib.results,Ib.offset,Ed,Ib.slot.index)}if(Qd){var Jb=Qd;Qd=null,Jb.complete()}Xb()}function Qc(a,b,c,d,e,f,g){var h=pd.prev,i={prev:h,next:pd,applyEdit:a,editType:b,complete:c,error:d,keyUpdate:e};h.next=i,pd.prev=i,qd=!0,(Od||Pd)&&(xd++,Pd=!1,Od=!0),pd.next===i&&Uc(),i.failed||(f(),i.undo=g),nd||Vc()}function Rc(){od=!1;var a=pd.next.next;pd.next=a,a.prev=pd}function Sc(){for(;pd.prev!==pd;){var a=pd.prev;a.error&&a.error(new WinJS.ErrorFromName(k.EditError.canceled)),a.undo&&!Od&&a.undo(),pd.prev=a.prev}pd.next=pd,nd=!1,Vc()}function Tc(b){function c(){sd||(h?rd=!0:Uc())}function f(a){if(a)if(i&&i.key!==a.key){var d=a.key;if(b.undo){var e=i.slot;if(e){var f=e.key;f&&delete Jd[f],F(e,d),e.itemNew=a,e.item?(lb(e),db()):wb(e)}}else i.key=d}else b.editType===me.change&&(e.itemNew=a,h||Zb(e));Rc(),b.complete&&b.complete(a),c()}function g(e){switch(e.Name){case d.noResponse:return Ib(a.failure),sd=!0,void(od=!1);case d.notPermitted:break;case d.noLongerMeaningful:rc()}b.failed=!0,Rc(),Sc(),b.error&&b.error(e),c()}if(!od){var h=!0,i=b.keyUpdate;e.beginEdits&&!md&&(md=!0,e.beginEdits()),od=!0,b.applyEdit().then(f,g),h=!1}}function Uc(){for(;pd.next!==pd;)if(rd=!1,Tc(pd.next),!rd)return;Wc()}function Vc(){tb(),db(),xb(),pd.next===pd&&Wc()}function Wc(){qd=!1,e.endEdits&&md&&!nd&&(md=!1,e.endEdits()),Od?(Od=!1,rc()):Xb()}function Xc(a){return Db(a),Jd[a]||Eb(a)}function Yc(a,b,c,d,e){var f=v();return E(f,c,d,e),a&&F(f,a),f.itemNew=b,rb(f,1),nd||td||(f.firstInSequence||"number"!=typeof f.prev.index?f.lastInSequence||"number"!=typeof f.next.index||G(f,f.next.index-1,Kd):G(f,f.prev.index+1,Kd)),V(f),kb(f),f}function Zc(a,b,c,d,e){var f={key:a};return new h(function(a,g){Qc(e,me.insert,a,g,f,function(){if(c){var a={key:f.key,data:b};f.slot=Yc(f.key,a,c,d,!d)}},function(){var a=f.slot;a&&(rb(a,-1),nb(a,!1))})})}function $c(a,b,c,d){return new h(function(e,f){var g,h,i,j;Qc(d,me.move,e,f,null,function(){h=a.next,i=a.firstInSequence,j=a.lastInSequence;var d=a.prev;g=!("number"==typeof a.index||!i&&d.item||!j&&h.item),rb(a,-1),mb(a,b,c,!c),rb(a,1),g&&(D(d),i||hc(d,a),j||ic(h,a))},function(){g?rc():(rb(a,-1),mb(a,h,!i,!j),rb(a,1))})})}function _c(){function a(){td||(tb(),db(),xb())}this.invalidateAll=function(){return 0===Ed?(this.reload(),h.wrap()):sc()},this.reload=function(){kd&&kd.cancel(),Qd&&Qd.cancel();for(var a=Fd.next;a!==Hd;a=a.next){var b=a.fetchListeners;for(var c in b)b[c].promise.cancel();var d=a.directFetchListeners;for(var c in d)d[c].promise.cancel()}ad(),ab(function(a){a.notificationHandler&&a.notificationHandler.reload()})},this.beginNotifications=function(){td=!0},this.inserted=function(b,c,d,e){if(qd)rc();else{var f=b.key,g=Jd[c],h=Jd[d],i="string"==typeof c,j="string"==typeof d;if(i?h&&!h.firstInSequence&&(g=h.prev):j&&g&&!g.lastInSequence&&(h=g.next),(i||j)&&!g&&!h&&Fd.next===Gd)return void rc();if(Jd[f])return void rc();if(g&&h&&(g.next!==h||g.lastInSequence||h.firstInSequence))return void rc();if(g&&(g.keyRequested||g.indexRequested)||h&&(h.keyRequested||h.indexRequested))return void rc();if(g||h)Yc(f,b,h?h:g.next,!!g,!!h);else if(Fd.next===Gd)Yc(f,b,Fd.next,!0,!0);else{if(void 0===e)return void rc();sb(e,1)}a()}},this.changed=function(b){if(qd)rc();else{var c=b.key,d=Jd[c];d&&(d.keyRequested?rc():(d.itemNew=b,d.item&&(lb(d),a())))}},this.moved=function(b,c,d,e,f){if(qd)rc();else{var g=b.key,h=Jd[g],i=Jd[c],j=Jd[d];h&&h.keyRequested||i&&i.keyRequested||j&&j.keyRequested?rc():h?i&&j&&(i.next!==j||i.lastInSequence||j.firstInSequence)?rc():i||j?(rb(h,-1),mb(h,j?j:i.next,!!i,!!j),rb(h,1),a()):(rb(h,-1),nb(h,!1),void 0!==e&&(f>e&&f--,sb(f,1)),a()):i||j?(void 0!==e&&(sb(e,-1),f>e&&f--),this.inserted(b,c,d,f)):void 0!==e&&(sb(e,-1),f>e&&f--,sb(f,1),a())}},this.removed=function(b,c){if(qd)rc();else{var d;d="string"==typeof b?Jd[b]:Kd[c],d?d.keyRequested?rc():(rb(d,-1),nb(d,!1),a()):void 0!==c&&(sb(c,-1),a())}},this.endNotifications=function(){td=!1,a()}}function ad(){Ib(a.ready),kd=null,md=!1,nd=!1,od=!1,pd={},pd.next=pd,pd.prev=pd,qd=!1,sd=!1,ud=0,vd=!1,wd=0,Ad={},Bd=[],Ed=b.unknown,Fd={firstInSequence:!0,lastInSequence:!0,index:-1},Gd={firstInSequence:!0,lastInSequence:!0},Hd={firstInSequence:!0,lastInSequence:!0},Fd.next=Gd,Gd.prev=Fd,Gd.next=Hd,Hd.prev=Gd,Id={},Jd={},Kd={},Kd[-1]=Fd,Ld=0,Md=null,Nd=!1,Od=!1,Pd=!1,Qd=null}var bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,Md,Nd,Od,Pd,Qd,Rd,Sd,Td,Ud,Vd,Wd,Xd,Yd,Zd,$d,_d,ae,be,ce,de,ee,fe,ge,he=0,ie=new Array(100),je=-1;e.itemsFromKey&&(ce=function(a,b,c,d,f){var g="fetchItemsFromKey id="+a+" key="+b+" countBefore="+c+" countAfter="+d;o(g),ie[++je%ie.length]={kind:"itemsFromKey",key:b,countBefore:c,countAfter:d};var h=e.itemsFromKey(b,c,d,f);return p(g),h}),e.itemsFromIndex&&(de=function(a,b,c,d){var f="fetchItemsFromIndex id="+a+" index="+b+" countBefore="+c+" countAfter="+d;o(f),ie[++je%ie.length]={kind:"itemsFromIndex",index:b,countBefore:c,countAfter:d};var g=e.itemsFromIndex(b,c,d);return p(f),g}),e.itemsFromStart&&(ee=function(a,b){var c="fetchItemsFromStart id="+a+" count="+b;o(c),ie[++je%ie.length]={kind:"itemsFromStart",count:b};var d=e.itemsFromStart(b);return p(c),d}),e.itemsFromEnd&&(fe=function(a,b){var c="fetchItemsFromEnd id="+a+" count="+b;o(c),ie[++je%ie.length]={kind:"itemsFromEnd",count:b};var d=e.itemsFromEnd(b);return p(c),d}),e.itemsFromDescription&&(ge=function(a,b,c,d){var f="fetchItemsFromDescription id="+a+" desc="+b+" countBefore="+c+" countAfter="+d;o(f),ie[++je%ie.length]={kind:"itemsFromDescription",description:b,countBefore:c,countAfter:d};var g=e.itemsFromDescription(b,c,d);return p(f),g});var ke=++g,le=this,me={insert:"insert",change:"change",move:"move",remove:"remove"};if(!e)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",l.listDataAdapterIsInvalid);cd=e.compareByIdentity?0:200,n&&"number"==typeof n.cacheSize&&(cd=n.cacheSize),e.setNotificationHandler&&(bd=new _c,e.setNotificationHandler(bd)),dd=a.ready,fd=!1,gd={},hd=0,id=1,jd=0,xd=0,yd=!1,zd=1,Cd={},Dd={},ad(),this.createListBinding=function(a){function b(a){a&&a.cursorCount++}function c(a){a&&0===--a.cursorCount&&_(a)}function d(a){b(a),c(m),m=a}function e(a,b){a===m&&(b||(b=!m||m.lastInSequence||m.next===Gd?null:m.next),d(b))}function f(a){var b=a.bindingMap,c=b[l].handle;delete a.bindingMap[l];var d=!0,e=!0;for(var f in b)if(d=!1,c&&b[f].handle===c){e=!1;break}c&&e&&delete Id[c],d&&(a.bindingMap=null,_(a))}function g(a,b){a.bindingMap||(a.bindingMap={});var c=a.bindingMap[l];if(c?c.count++:a.bindingMap[l]={bindingRecord:gd[l],count:1},a.fetchListeners){var d=a.fetchListeners[b];d&&(d.retained=!0)}}function i(a){var b=Id[a];if(b){var c=b.bindingMap[l];if(0===--c.count){var d=b.fetchListeners;for(var e in d){var g=d[e];g.listBindingID===l&&(g.retained=!1)}f(b)}}}function j(b){var c=eb(b,l),d=(jd++).toString(),e=ub(b,"fetchListeners",d,l,function(a,b){a(fb(b,c))});return S(e,b,c),a&&(e.retain=function(){return o._retainItem(b,d),e},e.release=function(){o._releaseItem(c)}),e}function k(b){var c;return!n&&b?c=j(b):(n?(c=new h(function(){}),c.cancel()):c=h.wrap(null),R(c,null),a&&(c.retain=function(){return c},c.release=function(){})),d(b),c}var l=(hd++).toString(),m=null,n=!1;gd[l]={notificationHandler:a,notificationsSent:!1,adjustCurrentSlot:e,itemPromiseFromKnownSlot:j};var o={_retainItem:function(a,b){g(a,b)},_releaseItem:function(a){i(a)},jumpToItem:function(a){return k(a?Id[a.handle]:null)},current:function(){return k(m)},previous:function(){return k(m?Ab(m):null)},next:function(){return k(m?Bb(m):null)},releaseItem:function(a){this._releaseItem(a.handle)},release:function(){n=!0,c(m),m=null;for(var a=Fd.next;a!==Hd;){var b=a.next,d=a.fetchListeners;for(var e in d){var g=d[e];g.listBindingID===l&&(g.promise.cancel(),delete d[e])}a.bindingMap&&a.bindingMap[l]&&f(a),a=b}delete gd[l]}};return(ee||de)&&(o.first=function(){return k(Bb(Fd))}),fe&&(o.last=function(){return k(Ab(Gd))}),ce&&(o.fromKey=function(a,b){return k(Fb(a,b))}),(de||ee&&ce)&&(o.fromIndex=function(a){return k(Gb(a))}),ge&&(o.fromDescription=function(a){return k(Hb(a))}),o},this.invalidateAll=function(){return sc()};var ne=function(a,b){var c=new WinJS._Signal;a.then(function(a){c.complete(a)},function(a){c.error(a)});var d=c.promise.then(null,function(c){return"WinJS.UI.VirtualizedDataSource.resetCount"===c.name?(kd=null,a=b.getCount()):h.wrapError(c)}),e=0,f={get:function(){return e++,new h(function(a,b){d.then(a,b)},function(){0===--e&&(c.promise.cancel(),a.cancel(),f===kd&&(kd=null))})},reset:function(){c.error(new WinJS.ErrorFromName("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){c.promise.cancel(),a.cancel(),f===kd&&(kd=null)}};return f};this.getCount=function(){if(e.getCount){var c=this;return h.wrap().then(function(){if(nd||qd)return Ed;var a;if(!kd){var b;a=e.getCount();var d;a.then(function(){kd===b&&(kd=null),d=!0},function(){kd===b&&(kd=null),d=!0}),ud=0,d||(b=kd=ne(a,c))}return kd?kd.get():a}).then(function(a){if(!r(a)&&void 0!==a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",l.invalidRequestedCountReturned);return a!==Ed&&(Ed===b.unknown?Ed=a:(gb(a),db())),0===a&&(Fd.next!==Gd||Gd.next!==Hd?rc():Fd.lastInSequence&&(C(Fd),Gd.index=0)),a}).then(null,function(b){return b.name===k.CountError.noResponse?(Ib(a.failure),Ed):WinJS.Promise.wrapError(b)})}return h.wrap(Ed)},ce&&(this.itemFromKey=function(a,b){return Cb(Fb(a,b))}),(de||ee&&ce)&&(this.itemFromIndex=function(a){return Cb(Gb(a))}),ge&&(this.itemFromDescription=function(a){return Cb(Hb(a))}),this.beginEdits=function(){nd=!0},e.insertAtStart&&(this.insertAtStart=function(a,b){return Zc(a,b,Fd.lastInSequence?null:Fd.next,!0,function(){return e.insertAtStart(a,b)})}),e.insertBefore&&(this.insertBefore=function(a,b,c){var d=Xc(c);return Zc(a,b,d,!1,function(){return e.insertBefore(a,b,c,pb(d))})}),e.insertAfter&&(this.insertAfter=function(a,b,c){var d=Xc(c);return Zc(a,b,d?d.next:null,!0,function(){return e.insertAfter(a,b,c,pb(d))})}),e.insertAtEnd&&(this.insertAtEnd=function(a,b){return Zc(a,b,Gd.firstInSequence?null:Gd,!1,function(){return e.insertAtEnd(a,b)})}),e.change&&(this.change=function(a,b){var c=Xc(a);return new h(function(d,f){var g;Qc(function(){return e.change(a,b,pb(c))},me.change,d,f,null,function(){g=c.item,c.itemNew={key:a,data:b},g?lb(c):wb(c)},function(){g?(c.itemNew=g,lb(c)):rc()})})}),e.moveToStart&&(this.moveToStart=function(a){var b=Xc(a);return $c(b,Fd.next,!0,function(){return e.moveToStart(a,pb(b))})}),e.moveBefore&&(this.moveBefore=function(a,b){var c=Xc(a),d=Xc(b);return $c(c,d,!1,function(){return e.moveBefore(a,b,pb(c),pb(d))})}),e.moveAfter&&(this.moveAfter=function(a,b){var c=Xc(a),d=Xc(b);return $c(c,d.next,!0,function(){return e.moveAfter(a,b,pb(c),pb(d))})}),e.moveToEnd&&(this.moveToEnd=function(a){var b=Xc(a);return $c(b,Gd,!1,function(){return e.moveToEnd(a,pb(b))})}),e.remove&&(this.remove=function(a){Db(a);var b=Jd[a];return new h(function(c,d){var f,g,h;Qc(function(){return e.remove(a,pb(b))},me.remove,c,d,null,function(){b&&(f=b.next,g=b.firstInSequence,h=b.lastInSequence,rb(b,-1),nb(b,!1))},function(){b&&(M(b,f,!g,!h),rb(b,1),kb(b))})})}),this.endEdits=function(){nd=!1,Vc()}}var f=100,g=1,h=WinJS.Promise,i=WinJS._Signal,j=WinJS.Utilities.Scheduler,k=WinJS.UI,l={get listDataAdapterIsInvalid(){return WinJS.Resources._getWinJSString("ui/listDataAdapterIsInvalid").value},get indexIsInvalid(){return WinJS.Resources._getWinJSString("ui/indexIsInvalid").value},get keyIsInvalid(){return WinJS.Resources._getWinJSString("ui/keyIsInvalid").value},get invalidItemReturned(){return WinJS.Resources._getWinJSString("ui/undefinedItemReturned").value},get invalidKeyReturned(){return WinJS.Resources._getWinJSString("ui/invalidKeyReturned").value},get invalidIndexReturned(){return WinJS.Resources._getWinJSString("ui/invalidIndexReturned").value},get invalidCountReturned(){return WinJS.Resources._getWinJSString("ui/invalidCountReturned").value},get invalidRequestedCountReturned(){return WinJS.Resources._getWinJSString("ui/invalidRequestedCountReturned").value},get refreshCycleIdentified(){return WinJS.Resources._getWinJSString("ui/refreshCycleIdentified").value}},m="statuschanged",n=WinJS.Class.define(function(){},{_baseDataSourceConstructor:e},{supportedForProcessing:!1});return WinJS.Class.mix(n,WinJS.Utilities.eventMixin),n})});var a=WinJS.UI.DataSourceStatus,b=WinJS.UI.CountResult,c=WinJS.UI.FetchError,d=WinJS.UI.EditError}),b("WinJS/Controls/ListView/_BrowseMode",[],function(){"use strict";var a=WinJS.Utilities._browserStyleEquivalents.transform.scriptName;WinJS.Namespace.define("WinJS.UI",{_SelectionMode:WinJS.Namespace._lazy(function(){function b(a,b,c){return Math.max(a,Math.min(b,c))}function c(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:b.index,oldFocusType:b.type,newFocus:c.index,newFocusType:c.type}),a.dispatchEvent(d)}var d=WinJS.Utilities,e=WinJS.Promise,f=(WinJS.UI.Animation,function(a){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX},this._pressedPosition=null,this.initialize(a)});return f.prototype={_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(a){function b(b,c){var d=function(c){return a._view.getAdjacent(c,b)};return d.clampToBounds=c,d}this.site=a,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var c=this.site,e=this;this._itemEventsHandler=new WinJS.UI._ItemEventsHandler(Object.create({containerFromElement:function(a){return c._view.items.containerFrom(a)},indexForItemElement:function(a){return c._view.items.index(a)},indexForHeaderElement:function(a){return c._groups.index(a)},itemBoxAtIndex:function(a){return c._view.items.itemBoxAt(a)},itemAtIndex:function(a){return c._view.items.itemAt(a)},headerAtIndex:function(a){return c._groups.group(a).header},headerFromElement:function(a){return c._groups.headerFrom(a)},containerAtIndex:function(a){return c._view.items.containerAt(a)},isZombie:function(){return c._isZombie()},getItemPosition:function(a){return c._getItemPosition(a)},rtl:function(){return c._rtl()},fireInvokeEvent:function(a,b){return e._fireInvokeEvent(a,b)},verifySelectionAllowed:function(a){return e._verifySelectionAllowed(a)},changeFocus:function(a,b,d,e,f){return c._changeFocus(a,b,d,e,f)},selectRange:function(a,b,c){return e._selectRange(a,b,c)}},{pressedEntity:{enumerable:!0,get:function(){return e._pressedEntity},set:function(a){e._pressedEntity=a}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return e._pressedContainerScaleTransform},set:function(a){e._pressedContainerScaleTransform=a}},pressedContainer:{enumerable:!0,get:function(){return e._pressedContainer},set:function(a){e._pressedContainer=a}},pressedItemBox:{enumerable:!0,get:function(){return e._pressedItemBox},set:function(a){e._pressedItemBox=a}},pressedHeader:{enumerable:!0,get:function(){return e._pressedHeader},set:function(a){return e._pressedHeader=a}},pressedPosition:{enumerable:!0,get:function(){return e._pressedPosition},set:function(a){e._pressedPosition=a}},pressedElement:{enumerable:!0,set:function(a){e._pressedElement=a}},swipeBehavior:{enumerable:!0,get:function(){return c._swipeBehavior}},eventHandlerRoot:{enumerable:!0,get:function(){return c._viewport}},selectionMode:{enumerable:!0,get:function(){return c._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return WinJS.UI._itemClass}},canvasProxy:{enumerable:!0,get:function(){return c._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return c._tap}},headerTapBehavior:{enumerable:!0,get:function(){return c._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return c.itemsDraggable||c.itemsReorderable}},selection:{enumerable:!0,get:function(){return c._selection}},horizontal:{enumerable:!0,get:function(){return c._horizontal()}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var f=d.Key;this._keyboardNavigationHandlers[f.upArrow]=b(f.upArrow),this._keyboardNavigationHandlers[f.downArrow]=b(f.downArrow),this._keyboardNavigationHandlers[f.leftArrow]=b(f.leftArrow),this._keyboardNavigationHandlers[f.rightArrow]=b(f.rightArrow),this._keyboardNavigationHandlers[f.pageUp]=b(f.pageUp,!0),this._keyboardNavigationHandlers[f.pageDown]=b(f.pageDown,!0),this._keyboardNavigationHandlers[f.home]=function(a){return WinJS.Promise.wrap({type:a.type,index:0})},this._keyboardNavigationHandlers[f.end]=function(a){return a.type===WinJS.UI.ObjectType.groupHeader?WinJS.Promise.wrap({type:a.type,index:c._groups.length()-1}):e.site._view.finalItem().then(function(b){return{type:a.type,index:b}},function(a){return WinJS.Promise.wrapError(a)})},this._keyboardAcceleratorHandlers[f.a]=function(){e.site._multiSelection()&&e._selectAll()}},staticMode:function(){return this.site._tap===WinJS.UI.TapBehavior.none&&this.site._selectionMode===WinJS.UI.SelectionMode.none},itemUnrealized:function(a,b){if(this._pressedEntity.type!==WinJS.UI.ObjectType.groupHeader&&(this._pressedEntity.index===a&&this._resetPointerDownState(),this._itemBeingDragged(a)))for(var c=this._draggedItemBoxes.length-1;c>=0;c--)this._draggedItemBoxes[c]===b&&(d.removeClass(b,WinJS.UI._dragSourceClass),this._draggedItemBoxes.splice(c,1))},_fireInvokeEvent:function(a,b){function c(c,e){var f=c.createListBinding(),g=f.fromIndex(a.index),h=e?"groupheaderinvoked":"iteminvoked";g.done(function(){f.release()});var i=document.createEvent("CustomEvent");i.initCustomEvent(h,!0,!0,e?{groupHeaderPromise:g,groupHeaderIndex:a.index}:{itemPromise:g,itemIndex:a.index}),b.dispatchEvent(i)&&d.site._defaultInvoke(a)}if(b){var d=this;a.type===WinJS.UI.ObjectType.groupHeader?this.site._groupHeaderTap===WinJS.UI.GroupHeaderTapBehavior.invoke&&a.index!==WinJS.UI._INVALID_INDEX&&c(this.site.groupDataSource,!0):this.site._tap!==WinJS.UI.TapBehavior.none&&a.index!==WinJS.UI._INVALID_INDEX&&c(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(a){if(a.type===WinJS.UI.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var b=a.index,c=this.site,f=this.site._view.items.itemAt(b);if(!c._selectionAllowed()||!c._selectOnTap()&&c._swipeBehavior!==WinJS.UI.SwipeBehavior.select||f&&d.hasClass(f,WinJS.UI._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var g=c._selection._isIncluded(b),h=!c._multiSelection(),i=c._selection._cloneSelection();g?h?i.clear():i.remove(b):h?i.set(b):i.add(b);var j,k=document.createEvent("CustomEvent"),l=e.wrap(),m=!1,n=!1;k.initCustomEvent("selectionchanging",!0,!0,{newSelection:i,preventTapBehavior:function(){n=!0},setPromise:function(a){l=a}});var o=c._element.dispatchEvent(k);l.then(function(){m=!0,j=i._isIncluded(b),i.clear()
});var p=o&&m&&(g||j);return{canSelect:p,canTapSelect:p&&!n}},_containedInElementWithClass:function(a,b){if(a.parentNode)for(var c=a.parentNode.querySelectorAll("."+b+", ."+b+" *"),d=0,e=c.length;e>d;d++)if(c[d]===a)return!0;return!1},_isDraggable:function(a){return!this._containedInElementWithClass(a,WinJS.UI._nonDraggableClass)},_isInteractive:function(a){return this._containedInElementWithClass(a,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onMSManipulationStateChanged:function(a){this._itemEventsHandler.onMSManipulationStateChanged(a)},onPointerDown:function(a){this._itemEventsHandler.onPointerDown(a)},onclick:function(a){this._itemEventsHandler.onClick(a)},onPointerUp:function(a){this._itemEventsHandler.onPointerUp(a)},onPointerCancel:function(a){this._itemEventsHandler.onPointerCancel(a)},onLostPointerCapture:function(a){this._itemEventsHandler.onLostPointerCapture(a)},onContextMenu:function(a){this._itemEventsHandler.onContextMenu(a)},onMSHoldVisual:function(a){this._itemEventsHandler.onMSHoldVisual(a)},onDataChanged:function(a){this._itemEventsHandler.onDataChanged(a)},_removeTransform:function(b,c){c&&-1!==b.style[a].indexOf(c)&&(b.style[a]=b.style[a].replace(c,""))},_selectAll:function(){var a=[];this.site._view.items.each(function(b,c){c&&d.hasClass(c,WinJS.UI._nonSelectableClass)&&a.push(b)}),this.site._selection.selectAll(),a.length>0&&this.site._selection.remove(a)},_selectRange:function(a,b,c){for(var e=[],f=-1,g=a;b>=g;g++){var h=this.site._view.items.itemAt(g);h&&d.hasClass(h,WinJS.UI._nonSelectableClass)?-1!==f&&(e.push({firstIndex:f,lastIndex:g-1}),f=-1):-1===f&&(f=g)}-1!==f&&e.push({firstIndex:f,lastIndex:b}),e.length>0&&this.site._selection[c?"add":"set"](e)},onDragStart:function(a){if(this._pressedEntity={type:WinJS.UI.ObjectType.item,index:this.site._view.items.index(a.target)},this.site._selection._pivot=WinJS.UI._INVALID_INDEX,this._pressedEntity.index===WinJS.UI._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(a.target)||this._pressedElement&&this._isInteractive(this._pressedElement))a.preventDefault();else{this._dragging=!0,this._dragDataTransfer=a.dataTransfer,this._pressedPosition=WinJS.Utilities._getCursorPos(a),this._dragInfo=null,this._lastEnteredElement=a.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new WinJS.UI._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var b=this.site.itemsReorderable,c=document.createEvent("CustomEvent");if(c.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:a.dataTransfer,dragInfo:this._dragInfo}),a.dataTransfer.setData("text",""),a.dataTransfer.setDragImage){var e=this.site._view.items.itemDataAt(this._pressedEntity.index);if(e&&e.container){var f=e.container.getBoundingClientRect();a.dataTransfer.setDragImage(e.container,a.clientX-f.left,a.clientY-f.top)}}this.site.element.dispatchEvent(c),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(a.dataTransfer)&&(b=!0,this._dragUnderstood=!0)),b&&(this._addedDragOverClass=!0,d.addClass(this.site._element,WinJS.UI._dragOverClass)),this._draggedItemBoxes=[];var g=this,h=a.target;h.addEventListener("dragend",function i(a){h.removeEventListener("dragend",i),g.onDragEnd(a)}),WinJS.Utilities._yieldForDomModification(function(){if(g._dragging)for(var a=g._dragInfo.getIndices(),b=0,c=a.length;c>b;b++){var d=g.site._view.items.itemDataAt(a[b]);d&&d.itemBox&&g._addDragSourceClass(d.itemBox)}})}},onDragEnter:function(a){var b=this._dragUnderstood;this._lastEnteredElement=a.target,this._exitEventTimer&&(clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(a.dataTransfer)&&(b=!0),(b||this._dragging&&this.site.itemsReorderable)&&(a.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,d.addClass(this.site._element,WinJS.UI._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(a){a.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(a)},_fireDragEnterEvent:function(a){var b=document.createEvent("CustomEvent");b.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:a});var c=!this.site.element.dispatchEvent(b);return this._firedDragEnter=!0,c},_fireDragBetweenEvent:function(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("itemdragbetween",!0,!0,{index:a,insertAfterIndex:b,dataTransfer:c}),this.site.element.dispatchEvent(d)},_fireDropEvent:function(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("itemdragdrop",!0,!0,{index:a,insertAfterIndex:b,dataTransfer:c}),this.site.element.dispatchEvent(d)},_handleExitEvent:function(){this._exitEventTimer&&(clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var a=this;this._exitEventTimer=setTimeout(function(){if(a._pointerLeftRegion){if(a.site._layout.dragLeave&&a.site._layout.dragLeave(),a._pointerLeftRegion=!1,a._dragUnderstood=!1,a._lastEnteredElement=null,a._lastInsertPoint=null,a._dragBetweenDisabled=!1,a._firedDragEnter){var b=document.createEvent("CustomEvent");b.initCustomEvent("itemdragleave",!0,!1,{}),a.site.element.dispatchEvent(b),a._firedDragEnter=!1}a._addedDragOverClass&&(a._addedDragOverClass=!1,d.removeClass(a.site._element,WinJS.UI._dragOverClass)),a._exitEventTimer=0,a._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(a,b){var c={left:0,top:0};try{c=a.getBoundingClientRect()}catch(d){}var e=window.getComputedStyle(a,null),f=parseInt(e.paddingLeft),g=parseInt(e.paddingTop),h=parseInt(e.borderLeftWidth),i=parseInt(e.borderTopWidth),j=b.clientX,k=b.clientY,l={x:+j===j?j-c.left-f-h:0,y:+k===k?k-c.top-g-i:0};return this.site._rtl()&&(l.x=c.right-c.left-l.x),l},_getPositionInCanvasSpace:function(a){var b=this.site._horizontal()?this.site.scrollPosition:0,c=this.site._horizontal()?0:this.site.scrollPosition,d=this._getEventPositionInElementSpace(this.site.element,a);return{x:d.x+b,y:d.y+c}},_itemBeingDragged:function(a){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(a)||!this._draggingUnselectedItem&&this.site._isSelected(a):!1},_addDragSourceClass:function(a){this._draggedItemBoxes.push(a),d.addClass(a,WinJS.UI._dragSourceClass),a.parentNode&&d.addClass(a.parentNode,WinJS.UI._footprintClass)},renderDragSourceOnRealizedItem:function(a,b){this._itemBeingDragged(a)&&this._addDragSourceClass(b)},onDragOver:function(a){if(this._dragUnderstood){this._pointerLeftRegion=!1,a.preventDefault();var c=this._getPositionInCanvasSpace(a),d=this._getEventPositionInElementSpace(this.site.element,a);if(this._checkAutoScroll(d.x,d.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var e=this.site._view.hitTest(c.x,c.y);e.insertAfterIndex=b(-1,this.site._cachedCount-1,e.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===e.insertAfterIndex&&this._lastInsertPoint.index===e.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(e.index,e.insertAfterIndex,a.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(c.x,c.y,this._dragInfo)),this._lastInsertPoint=e}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,d.removeClass(this.site._element,WinJS.UI._dragOverClass)),this._draggedItemBoxes){for(var a=0,b=this._draggedItemBoxes.length;b>a;a++)d.removeClass(this._draggedItemBoxes[a],WinJS.UI._dragSourceClass),this._draggedItemBoxes[a].parentNode&&d.removeClass(this._draggedItemBoxes[a].parentNode,WinJS.UI._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(a),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(a,b,c){for(var d=a.getIndices(),e=-1,f=this.site._cachedCount,g=d.length,h=-1,i=b,j=0;g>j;j++)if(d[j]===i){e=j,h=j;break}for(;e>=0&&i>=0;)c?(i++,g>e&&d[e+1]===i&&f>i?e++:i>=f?(c=!1,i=b,e=h):e=-1):(i--,e>0&&d[e-1]===i?e--:e=-1);return i},_reorderItems:function(a,b,c,d,e){var f=this.site,g=function(a){c?f._selection.remove({key:a[0].key}):f._selection.set({firstKey:a[0].key,lastKey:a[a.length-1].key}),e&&f.ensureVisible(f._selection._getFocused())};b.getItems().then(function(b){var c=f.itemDataSource;if(-1===a){c.beginEdits();for(var e=b.length-1;e>=0;e--)c.moveToStart(b[e].key);c.endEdits(),g(b)}else{var h=c.createListBinding();h.fromIndex(a).then(function(a){if(h.release(),c.beginEdits(),d)for(var e=0,f=b.length;f>e;e++)c.moveBefore(b[e].key,a.key);else for(var e=b.length-1;e>=0;e--)c.moveAfter(b[e].key,a.key);c.endEdits(),g(b)})}})},onDrop:function(a){if(this._draggedItemBoxes)for(var c=0,e=this._draggedItemBoxes.length;e>c;c++)this._draggedItemBoxes[c].parentNode&&d.removeClass(this._draggedItemBoxes[c].parentNode,WinJS.UI._footprintClass);if(!this._dragBetweenDisabled){var f=this._getPositionInCanvasSpace(a),g=this.site._view.hitTest(f.x,f.y),h=b(-1,this.site._cachedCount-1,g.insertAfterIndex),i=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===h&&this._lastInsertPoint.index===g.index||(i=this._fireDragBetweenEvent(g.index,h,a.dataTransfer)),i&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(g.index,h,a.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;h=this._findFirstAvailableInsertPoint(this._dragInfo,h,!1),this._reorderItems(h,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),a.preventDefault()},_checkAutoScroll:function(a,b){var c=this.site._getViewportLength(),d=this.site._horizontal(),e=d?a:b,f=this.site._rtl(),g=this.site._getCanvasMargins(),h=this.site._canvas[d?"offsetWidth":"offsetHeight"]+g[d?f?"right":"left":"top"],i=Math.floor(this.site.scrollPosition),j=0;if(e<WinJS.UI._AUTOSCROLL_THRESHOLD?j=e-WinJS.UI._AUTOSCROLL_THRESHOLD:e>c-WinJS.UI._AUTOSCROLL_THRESHOLD&&(j=e-(c-WinJS.UI._AUTOSCROLL_THRESHOLD)),j=Math.round(j/WinJS.UI._AUTOSCROLL_THRESHOLD*(WinJS.UI._MAX_AUTOSCROLL_RATE-WinJS.UI._MIN_AUTOSCROLL_RATE)),(0===i&&0>j||i>=h-c&&j>0)&&(j=0),0===j)this._autoScrollDelay&&(clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var k=this;this._autoScrollDelay=setTimeout(function(){if(k._autoScrollRate){k._lastDragTimeout=WinJS.Utilities._now();var a=function(){if(!k._autoScrollRate&&k._autoScrollFrame||k.site._disposed)k._stopAutoScroll();else{var b=WinJS.Utilities._now(),c=k._autoScrollRate*((b-k._lastDragTimeout)/1e3);c=0>c?Math.min(-1,c):Math.max(1,c);var d={};d[k.site._scrollProperty]=k.site._viewportScrollPosition+c,WinJS.Utilities.setScrollPosition(k.site._viewport,d),k._lastDragTimeout=b,k._autoScrollFrame=requestAnimationFrame(a)}};k._autoScrollFrame=requestAnimationFrame(a)}},WinJS.UI._AUTOSCROLL_DELAY)}this._autoScrollRate=j},_stopAutoScroll:function(){this._autoScrollDelay&&(clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(a){function b(a,b,d){function h(h){var i=!0,k=!1;if(d?a.index=Math.max(0,Math.min(h,a.index)):(a.index<0||a.index>h)&&(k=!0),!k&&(j.index!==a.index||j.type!==a.type)){var m=c(g._element,j,a);m&&(i=!1,f._setNewFocusItemOffsetPromise&&f._setNewFocusItemOffsetPromise.cancel(),g._batchViewUpdates(WinJS.UI._ViewChange.realize,WinJS.UI._ScrollToPriority.high,function(){return f._setNewFocusItemOffsetPromise=g._getItemOffset(j,!0).then(function(c){c=g._convertFromCanvasCoordinates(c);var d=c.end<=g.scrollPosition||c.begin>=g.scrollPosition+g._getViewportLength()-1;return f._setNewFocusItemOffsetPromise=g._getItemOffset(a).then(function(c){f._setNewFocusItemOffsetPromise=null;var h={position:g.scrollPosition,direction:"right"};return d&&(g._selection._setFocused(a,!0),c=g._convertFromCanvasCoordinates(c),a.index>j.index?(h.direction="right",h.position=c.end-g._getViewportLength()):(h.direction="left",h.position=c.begin)),g._changeFocus(a,b,l,d,!0),d?h:e.cancel},function(c){return g._changeFocus(a,b,l,!0,!0),e.wrapError(c)}),f._setNewFocusItemOffsetPromise},function(c){return g._changeFocus(a,b,l,!0,!0),e.wrapError(c)}),f._setNewFocusItemOffsetPromise},!0))}return i&&(g._selection._setFocused(j,!0),g.ensureVisible(j)),k?{type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX}:a}return a.type!==WinJS.UI.ObjectType.groupHeader?i.finalItem().then(h):e.wrap(g._groups.length()-1).then(h)}var f=this,g=this.site,h=g._swipeBehavior===WinJS.UI.SwipeBehavior.select,i=g._view,j=g._selection._getFocused(),k=!0,l=a.ctrlKey,m=d.Key,n=a.keyCode,o=g._rtl();if(!this._isInteractive(a.target)){if(a.ctrlKey&&!a.altKey&&!a.shiftKey&&this._keyboardAcceleratorHandlers[n]&&this._keyboardAcceleratorHandlers[n](),g.itemsReorderable&&!a.ctrlKey&&a.altKey&&a.shiftKey&&j.type===WinJS.UI.ObjectType.item&&(n===m.leftArrow||n===m.rightArrow||n===m.upArrow||n===m.downArrow)){var p=g._selection,q=j.index,r=!1,s=!0;if(!p.isEverything()){if(!p._isIncluded(q)){var t=g._view.items.itemAt(q);t&&d.hasClass(t,WinJS.UI._nonDraggableClass)?s=!1:(r=!0,p=new WinJS.UI._Selection(this.site,[{firstIndex:q,lastIndex:q}]))}if(s){var u=q;n===m.rightArrow?u+=o?-1:1:n===m.leftArrow?u+=o?1:-1:n===m.upArrow?u--:u++;var v=u>q,w=v;v&&u>=this.site._cachedCount&&(w=!1,u=this.site._cachedCount-1),u=this._findFirstAvailableInsertPoint(p,u,w),u=Math.min(Math.max(-1,u),this.site._cachedCount-1);var x=u-(v||-1===u?0:1),y=u,z=this.site._groupsEnabled();if(z){var A=this.site._groups,B=u>-1?A.groupFromItem(u):0;v?A.group(B).startIndex===u&&x--:B<A.length()-1&&u===A.group(B+1).startIndex-1&&x++}if(this._fireDragBetweenEvent(y,x,null)&&this._fireDropEvent(y,x,null)){if(z)return;this._reorderItems(u,p,r,!v,!0)}}}}else if(a.altKey)k=!1;else if(this._keyboardNavigationHandlers[n])this._keyboardNavigationHandlers[n](j).then(function(c){var d=f._keyboardNavigationHandlers[n].clampToBounds;c.type!==WinJS.UI.ObjectType.groupHeader&&a.shiftKey&&g._selectionAllowed()&&g._multiSelection()?(g._selection._pivot===WinJS.UI._INVALID_INDEX&&(g._selection._pivot=j.index),b(c,!0,d).then(function(b){if(b.index!==WinJS.UI._INVALID_INDEX){var c=Math.min(b.index,g._selection._pivot),d=Math.max(b.index,g._selection._pivot),e=a.ctrlKey||g._tap===WinJS.UI.TapBehavior.toggleSelect;f._selectRange(c,d,e)}})):(g._selection._pivot=WinJS.UI._INVALID_INDEX,b(c,!1,d))});else if(a.ctrlKey||n!==m.enter)j.type!==WinJS.UI.ObjectType.groupHeader&&(a.ctrlKey&&n===m.enter||h&&a.shiftKey&&n===m.F10||h&&n===m.menu||n===m.space)?(this._itemEventsHandler.handleSwipeBehavior(j.index),g._changeFocus(j,!0,l,!1,!0)):n===m.escape&&g._selection.count()>0?(g._selection._pivot=WinJS.UI._INVALID_INDEX,g._selection.clear()):k=!1;else{var C=j.type===WinJS.UI.ObjectType.groupHeader?g._groups.group(j.index).header:g._view.items.itemBoxAt(j.index);if(C){j.type===WinJS.UI.ObjectType.groupHeader?(this._pressedHeader=C,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=C,this._pressedContainer=g._view.items.containerAt(j.index),this._pressedHeader=null);var D=this._verifySelectionAllowed(j);D.canTapSelect&&this._itemEventsHandler.handleTap(j),this._fireInvokeEvent(j,C)}}this._keyDownHandled=k,k&&(a.stopPropagation(),a.preventDefault())}n===m.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(a){this._keyDownHandled&&(a.stopPropagation(),a.preventDefault())},onTabEntered:function(a){if(0!==this.site._groups.length()){var b=this.site,d=b._selection._getFocused(),e=a.detail,f=!b._hasKeyboardFocus||a.target===b._viewport;if(f)if(this.inboundFocusHandled=!0,d.index=d.index===WinJS.UI._INVALID_INDEX?0:d.index,e||!this.site._supportsGroupHeaderKeyboarding){var g={type:WinJS.UI.ObjectType.item};d.type===WinJS.UI.ObjectType.groupHeader?(g.index=b._groupFocusCache.getIndexForGroup(d.index),c(b._element,d,g)?b._changeFocus(g,!0,!1,!1,!0):b._changeFocus(d,!0,!1,!1,!0)):(g.index=d.index,b._changeFocus(g,!0,!1,!1,!0)),a.preventDefault()}else{var g={type:WinJS.UI.ObjectType.groupHeader};d.type!==WinJS.UI.ObjectType.groupHeader?(g.index=b._groups.groupFromItem(d.index),c(b._element,d,g)?b._changeFocus(g,!0,!1,!1,!0):b._changeFocus(d,!0,!1,!1,!0)):(g.index=d.index,b._changeFocus(g,!0,!1,!1,!0)),a.preventDefault()}}},onTabExiting:function(a){if(this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var b=this.site,d=b._selection._getFocused(),e=a.detail;if(e&&d.type!==WinJS.UI.ObjectType.groupHeader){var f={type:WinJS.UI.ObjectType.groupHeader,index:b._groups.groupFromItem(d.index)};c(b._element,d,f)&&(b._changeFocus(f,!0,!1,!1,!0),a.preventDefault())}else if(!e&&d.type===WinJS.UI.ObjectType.groupHeader){var f={type:WinJS.UI.ObjectType.item,index:b._groupFocusCache.getIndexForGroup(d.index)};c(b._element,d,f)&&(b._changeFocus(f,!0,!1,!1,!0),a.preventDefault())}}}},f})})}),b("WinJS/Controls/ItemContainer/_Constants",["../../Core/_Base"],function(a){"use strict";var b={};return b._listViewClass="win-listview",b._viewportClass="win-viewport",b._rtlListViewClass="win-rtl",b._horizontalClass="win-horizontal",b._verticalClass="win-vertical",b._scrollableClass="win-surface",b._itemsContainerClass="win-itemscontainer",b._padderClass="win-itemscontainer-padder",b._proxyClass="_win-proxy",b._itemClass="win-item",b._itemBoxClass="win-itembox",b._itemsBlockClass="win-itemsblock",b._containerClass="win-container",b._backdropClass="win-backdrop",b._footprintClass="win-footprint",b._groupsClass="win-groups",b._selectedClass="win-selected",b._swipeableClass="win-swipeable",b._swipeClass="win-swipe",b._selectionBorderClass="win-selectionborder",b._selectionBackgroundClass="win-selectionbackground",b._selectionCheckmarkClass="win-selectioncheckmark",b._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",b._pressedClass="win-pressed",b._headerClass="win-groupheader",b._headerContainerClass="win-groupheadercontainer",b._groupLeaderClass="win-groupleader",b._progressClass="win-progress",b._selectionHintClass="win-selectionhint",b._revealedClass="win-revealed",b._itemFocusClass="win-focused",b._itemFocusOutlineClass="win-focusedoutline",b._zoomingXClass="win-zooming-x",b._zoomingYClass="win-zooming-y",b._listLayoutClass="win-listlayout",b._gridLayoutClass="win-gridlayout",b._headerPositionTopClass="win-headerpositiontop",b._headerPositionLeftClass="win-headerpositionleft",b._structuralNodesClass="win-structuralnodes",b._uniformGridLayoutClass="win-uniformgridlayout",b._uniformListLayoutClass="win-uniformlistlayout",b._cellSpanningGridLayoutClass="win-cellspanninggridlayout",b._laidOutClass="win-laidout",b._nonDraggableClass="win-nondraggable",b._nonSelectableClass="win-nonselectable",b._nonSwipeableClass="win-nonswipeable",b._dragOverClass="win-dragover",b._dragSourceClass="win-dragsource",b._clipClass="win-clip",b._selectionModeClass="win-selectionmode",b._noCSSGrid="win-nocssgrid",b._INVALID_INDEX=-1,b._UNINITIALIZED=-1,b._LEFT_MSPOINTER_BUTTON=0,b._RIGHT_MSPOINTER_BUTTON=2,b._TAP_END_THRESHOLD=10,b._DEFAULT_PAGES_TO_LOAD=5,b._DEFAULT_PAGE_LOAD_THRESHOLD=2,b._MIN_AUTOSCROLL_RATE=150,b._MAX_AUTOSCROLL_RATE=1500,b._AUTOSCROLL_THRESHOLD=100,b._AUTOSCROLL_DELAY=50,b._DEFERRED_ACTION=250,b._DEFERRED_SCROLL_END=250,b._VERTICAL_SWIPE_SELECTION_THRESHOLD=39,b._VERTICAL_SWIPE_SPEED_BUMP_START=0,b._VERTICAL_SWIPE_SPEED_BUMP_END=127,b._VERTICAL_SWIPE_SELF_REVEAL_GESTURE=15,b._HORIZONTAL_SWIPE_SELECTION_THRESHOLD=27,b._HORIZONTAL_SWIPE_SPEED_BUMP_START=0,b._HORIZONTAL_SWIPE_SPEED_BUMP_END=150,b._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE=23,b._SELECTION_CHECKMARK="",b._LISTVIEW_PROGRESS_DELAY=2e3,a.Namespace.define("WinJS.UI",b),a.Namespace.defineWithParent(null,null,b)}),b("WinJS/Controls/ListView/_ErrorMessages",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI._strings",{modeIsInvalid:{get:function(){return WinJS.Resources._getWinJSString("ui/modeIsInvalid").value}},loadingBehaviorIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/loadingBehaviorIsDeprecated").value}},pagesToLoadIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/pagesToLoadIsDeprecated").value}},pagesToLoadThresholdIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/pagesToLoadThresholdIsDeprecated").value}},automaticallyLoadPagesIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/automaticallyLoadPagesIsDeprecated").value}},invalidTemplate:{get:function(){return WinJS.Resources._getWinJSString("ui/invalidTemplate").value}},loadMorePagesIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/loadMorePagesIsDeprecated").value}},disableBackdropIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/disableBackdropIsDeprecated").value}},backdropColorIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/backdropColorIsDeprecated").value}},itemInfoIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/itemInfoIsDeprecated").value}},groupInfoIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/groupInfoIsDeprecated").value}},resetItemIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/resetItemIsDeprecated").value}},resetGroupHeaderIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/resetGroupHeaderIsDeprecated").value}},maxRowsIsDeprecated:{get:function(){return WinJS.Resources._getWinJSString("ui/maxRowsIsDeprecated").value}}})}),b("WinJS/Controls/ListView/_GroupFocusCache",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_GroupFocusCache:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a){this._listView=a,this.clear()},{updateCache:function(a,b,c){c=""+c,this._itemToIndex[b]=c,this._groupToItem[a]=b},deleteItem:function(a){if(this._itemToIndex[a])for(var b=this,c=Object.keys(this._groupToItem),d=0,e=c.length;e>d;d++){var f=c[d];if(b._groupToItem[f]===a){b.deleteGroup(f);break}}},deleteGroup:function(a){var b=this._groupToItem[a];b&&delete this._itemToIndex[b],delete this._groupToItem[a]},updateItemIndex:function(a,b){this._itemToIndex[a]&&(this._itemToIndex[a]=""+b)},getIndexForGroup:function(a){var b=this._listView._groups.group(a).key,c=this._groupToItem[b];return c&&this._itemToIndex[c]?+this._itemToIndex[c]:this._listView._groups.fromKey(b).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={}}})}),_UnsupportedGroupFocusCache:WinJS.Namespace._lazy(function(){return WinJS.Class.define(null,{updateCache:function(){},deleteItem:function(){},deleteGroup:function(){},updateItemIndex:function(){},getIndexForGroup:function(){return 0},clear:function(){}})})})}),b("WinJS/Controls/ListView/_GroupsContainer",[],function(){"use strict";var a=WinJS.Utilities,b=WinJS.Promise;WinJS.Namespace.define("WinJS.UI",{_GroupsContainerBase:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(){},{index:function(a){var b=this.headerFrom(a);if(b)for(var c=0,d=this.groups.length;d>c;c++)if(b===this.groups[c].header)return c;return WinJS.UI._INVALID_INDEX},headerFrom:function(b){for(;b&&!a.hasClass(b,WinJS.UI._headerClass);)b=b.parentNode;return b},requestHeader:function(a){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[a]||(this._waitingHeaderRequests[a]=[]);var c=this;return new b(function(b){var d=c.groups[a];d&&d.header?b(d.header):c._waitingHeaderRequests[a].push(b)})},notify:function(a,b){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[a]){for(var c=this._waitingHeaderRequests[a],d=0,e=c.length;e>d;d++)c[d](b);this._waitingHeaderRequests[a]=[]}},groupFromImpl:function(a,b,c){if(a>b)return null;var d=a+Math.floor((b-a)/2),e=this.groups[d];return c(e,d)?this.groupFromImpl(a,d-1,c):b>d&&!c(this.groups[d+1],d+1)?this.groupFromImpl(d+1,b,c):d},groupFrom:function(a){if(this.groups.length>0){var b=this.groups.length-1,c=this.groups[b];return a(c,b)?this.groupFromImpl(0,this.groups.length-1,a):b}return null},groupFromItem:function(a){return this.groupFrom(function(b){return a<b.startIndex})},groupFromOffset:function(a){return this.groupFrom(function(b){return a<b.offset})},group:function(a){return this.groups[a]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var a=0,b=this.groups.length;b>a;a++){var c=this.groups[a];c.userData&&this.listBinding.releaseItem(c.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var a=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return b.join(a.pendingChanges)}).then(function(){return a._listView._ifZombieDispose()?WinJS.Promise.cancel:void 0}).then(function(){a.ignoreChanges=!1},function(b){return a.ignoreChanges=!1,WinJS.Promise.wrapError(b)})},fromKey:function(a){for(var b=0,c=this.groups.length;c>b;b++){var d=this.groups[b];if(d.key===a)return{group:d,index:b}}return null},fromHandle:function(a){for(var b=0,c=this.groups.length;c>b;b++){var d=this.groups[b];if(d.handle===a)return{group:d,index:b}}return null}})}),_UnvirtualizedGroupsContainer:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._GroupsContainerBase,function(a,b){this._listView=a,this.groupDataSource=b,this.groups=[],this.pendingChanges=[],this.dirty=!0;var c=this,d={beginNotifications:function(){c._listView._versionManager.beginNotifications()},endNotifications:function(){c._listView._versionManager.endNotifications(),c._listView._ifZombieDispose()||!c.ignoreChanges&&c._listView._groupsChanged&&c._listView._scheduleUpdate()},indexChanged:function(){c._listView._versionManager.receivedNotification(),c._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(a){c._listView._versionManager.receivedNotification(),c._listView._writeProfilerMark("groupCountChanged("+a+"),info"),c._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(a){if(c._listView._versionManager.receivedNotification(),!c._listView._ifZombieDispose()){var b=c.fromKey(a.key);b&&(c._listView._writeProfilerMark("groupChanged("+b.index+"),info"),b.group.userData=a,b.group.startIndex=a.firstItemIndexHint,this.markToRemove(b.group)),this.scheduleUpdate()}},removed:function(a){if(c._listView._versionManager.receivedNotification(),c._listView._groupRemoved(a),!c._listView._ifZombieDispose()){var b=c.fromHandle(a);if(b){c._listView._writeProfilerMark("groupRemoved("+b.index+"),info"),c.groups.splice(b.index,1);var d=c.groups.indexOf(b.group,b.index);d>-1&&c.groups.splice(d,1),this.markToRemove(b.group)}this.scheduleUpdate()}},inserted:function(a,b,d){if(c._listView._versionManager.receivedNotification(),!c._listView._ifZombieDispose()){c._listView._writeProfilerMark("groupInserted,info");var e=this;a.retain().then(function(f){var g;if(g=b||d||c.groups.length?e.findIndex(b,d):0,-1!==g){var h={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:a.handle};c.groups.splice(g,0,h)}e.scheduleUpdate()}),c.pendingChanges.push(a)}},moved:function(a,b,d){if(c._listView._versionManager.receivedNotification(),!c._listView._ifZombieDispose()){c._listView._writeProfilerMark("groupMoved,info");var e=this;a.then(function(f){var g=e.findIndex(b,d),h=c.fromKey(f.key);if(h)c.groups.splice(h.index,1),-1!==g&&(h.index<g&&g--,h.group.key=f.key,h.group.userData=f,h.group.startIndex=f.firstItemIndexHint,c.groups.splice(g,0,h.group));else if(-1!==g){var i={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:a.handle};c.groups.splice(g,0,i),a.retain()}e.scheduleUpdate()}),c.pendingChanges.push(a)}},reload:function(){c._listView._versionManager.receivedNotification(),c._listView._ifZombieDispose()||c._listView._processReload()},markToRemove:function(a){if(a.header){var b=a.header;a.header=null,a.left=-1,a.width=-1,a.decorator=null,a.tabIndex=-1,b.tabIndex=-1,c._listView._groupsToRemove[WinJS.Utilities._uniqueID(b)]={group:a,header:b}}},scheduleUpdate:function(){c.dirty=!0,c.ignoreChanges||(c._listView._groupsChanged=!0)},findIndex:function(a,b){var d,e=-1;return a&&(d=c.fromHandle(a),d&&(e=d.index+1)),-1===e&&b&&(d=c.fromHandle(b),d&&(e=d.index)),e},removeElements:function(a){if(a.header){var b=a.header.parentNode;b&&(WinJS.Utilities.disposeSubTree(a.header),b.removeChild(a.header)),a.header=null,a.left=-1,a.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(d)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var a=this;return this.initializePromise=this.groupDataSource.getCount().then(function(c){for(var d=[],e=0;c>e;e++)d.push(a.listBinding.fromIndex(e).retain());return b.join(d)}).then(function(b){a.groups=[];for(var c=0,d=b.length;d>c;c++){var e=b[c];a.groups.push({key:e.key,startIndex:e.firstItemIndexHint,handle:e.handle,userData:e})}a._listView._writeProfilerMark("GroupsContainer_initialize groups("+b.length+"),info"),a._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(b){return a._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),WinJS.Promise.wrapError(b)}),this.initializePromise},renderGroup:function(a){if(this._listView.groupHeaderTemplate){var c=this.groups[a];return b.wrap(this._listView._groupHeaderRenderer(b.wrap(c.userData))).then(WinJS.UI._normalizeRendererReturn)}return b.wrap(null)},setDomElement:function(a,b){this.groups[a].header=b,this.notify(a,b)},removeElements:function(){for(var a=this._listView._groupsToRemove||{},b=Object.keys(a),c=!1,d=this._listView._selection._getFocused(),e=0,f=b.length;f>e;e++){var g=a[b[e]],h=g.header,i=g.group;if(c||d.type!==WinJS.UI.ObjectType.groupHeader||i.userData.index!==d.index||(this._listView._unsetFocusOnItem(),c=!0),h){var j=h.parentNode;j&&(WinJS.Utilities._disposeElement(h),j.removeChild(h))}}c&&this._listView._setFocusOnItem(d),this._listView._groupsToRemove={}},resetGroups:function(){for(var a=this.groups.slice(0),b=0,c=a.length;c>b;b++){var d=a[b];this.listBinding&&d.userData&&this.listBinding.releaseItem(d.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._GroupsContainerBase,function(a){this._listView=a,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return WinJS.Promise.wrap()},addItem:function(){return WinJS.Promise.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return WinJS.Promise.wrap(null)},ensureFirstGroup:function(){return WinJS.Promise.wrap(this.groups[0])},groupOf:function(){return WinJS.Promise.wrap(this.groups[0])},removeElements:function(){}})})})}),b("WinJS/Controls/ListView/_ItemsContainer",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_ItemsContainer:WinJS.Namespace._lazy(function(){var a=WinJS.Utilities,b=WinJS.Promise,c=function(a){this.site=a,this._itemData={},this.waitingItemRequests={}};return c.prototype={requestItem:function(a){this.waitingItemRequests[a]||(this.waitingItemRequests[a]=[]);
var c=this,d=new b(function(b){var d=c._itemData[a];d&&!d.detached&&d.element?b(d.element):c.waitingItemRequests[a].push(b)});return d},removeItem:function(a){delete this._itemData[a]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(a,b){this._itemData[a]=b,b.detached||this.notify(a,b)},notify:function(a,b){if(this.waitingItemRequests[a]){for(var c=this.waitingItemRequests[a],d=0;d<c.length;d++)c[d](b.element);this.waitingItemRequests[a]=[]}},elementAvailable:function(a){var b=this._itemData[a];b.detached=!1,this.notify(a,b)},itemAt:function(a){var b=this._itemData[a];return b?b.element:null},itemDataAt:function(a){return this._itemData[a]},containerAt:function(a){var b=this._itemData[a];return b?b.container:null},itemBoxAt:function(a){var b=this._itemData[a];return b?b.itemBox:null},itemBoxFrom:function(b){for(;b&&!a.hasClass(b,WinJS.UI._itemBoxClass);)b=b.parentNode;return b},containerFrom:function(b){for(;b&&!a.hasClass(b,WinJS.UI._containerClass);)b=b.parentNode;return b},index:function(a){var b=this.containerFrom(a);if(b)for(var c in this._itemData)if(this._itemData[c].container===b)return parseInt(c,10);return WinJS.UI._INVALID_INDEX},each:function(a){for(var b in this._itemData)if(this._itemData.hasOwnProperty(b)){var c=this._itemData[b];a(parseInt(b,10),c.element,c)}},eachIndex:function(a){for(var b in this._itemData)if(a(parseInt(b,10)))break},count:function(){return Object.keys(this._itemData).length}},c})})}),b("WinJS/Controls/ListView/_ItemsManager",[],function(){"use strict";function a(a,b){var c=!1,d=!1;return a.isOnScreen().then(function(a){c=a}),b.isOnScreen().then(function(a){d=a}),(c?0:1)-(d?0:1)}function b(a){if(!/^blob:/i.test(a)&&(p[a]=!0,q.push(a),q.length>s)){var b=q;p={},q=[];for(var c=0,d=b.length-1;d>=0&&r>c;d--){var e=b[d];p[e]||(p[e]=!0,c++)}}}function c(c,d,e){var f=o++;return g=g||new WinJS.UI._ParallelWorkQueue(6),g.queue(function(){return new WinJS.Promise(function(e,h){j.schedule(function(f){d||(d=document.createElement("img"));var i=p[c];i?(b(c),d.src=c,e(d)):f.setPromise(new WinJS.Promise(function(f){var i=document.createElement("img"),j=function(){i.removeEventListener("load",k,!1),i.removeEventListener("error",l,!1),d.src=c;var b=new Date;b-m>n&&(m=b,g.sort(a))},k=function(){f(o)},l=function(){f(p)},o=function(){b(c),j(),e(d)},p=function(){j(),h(d)};i.addEventListener("load",k,!1),i.addEventListener("error",l,!1),i.src=c}))},j.Priority.normal,null,"WinJS.UI._ImageLoader._image"+f)})},e)}function d(a){return p[a]}function e(){return document.createElement("div")}var f=WinJS.Utilities.markSupportedForProcessing;WinJS.Namespace.define("WinJS.UI",{_normalizeRendererReturn:function(a){if(a){if("object"==typeof a&&a.element){var b=WinJS.Promise.as(a.element);return b.then(function(b){return{element:b,renderComplete:WinJS.Promise.as(a.renderComplete)}})}var b=WinJS.Promise.as(a);return b.then(function(a){return{element:a,renderComplete:WinJS.Promise.as()}})}return{element:null,renderComplete:WinJS.Promise.as()}},simpleItemRenderer:function(a){return f(function(b,c){return b.then(function(b){return b?a(b,c):null})})}});var g,h=WinJS.Promise,i=WinJS._Signal,j=WinJS.Utilities.Scheduler,k=WinJS.Utilities._uniqueID,l=(WinJS.UI,{get listDataSourceIsInvalid(){return WinJS.Resources._getWinJSString("ui/listDataSourceIsInvalid").value},get itemRendererIsInvalid(){return WinJS.Resources._getWinJSString("ui/itemRendererIsInvalid").value},get itemIsInvalid(){return WinJS.Resources._getWinJSString("ui/itemIsInvalid").value},get invalidItemsManagerCallback(){return WinJS.Resources._getWinJSString("ui/invalidItemsManagerCallback").value}}),m=new Date,n=64,o=0,p={},q=[],r=250,s=1e3;WinJS.Namespace.define("WinJS.UI",{_seenUrl:b,_getSeenUrls:function(){return p},_getSeenUrlsMRU:function(){return q},_seenUrlsMaxSize:r,_seenUrlsMRUMaxSize:s}),WinJS.Namespace.define("WinJS.UI",{_createItemsManager:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(a){this._itemsManager=a},{beginNotifications:function(){this._itemsManager._versionManager.beginNotifications(),this._itemsManager._beginNotifications()},inserted:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._inserted(a,b,c)},changed:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._changed(a,b)},moved:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._moved(a,b,c)},removed:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._removed(a,b)},countChanged:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._countChanged(a,b)},indexChanged:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._indexChanged(a,b,c)},affectedRange:function(a){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._affectedRange(a)},endNotifications:function(){this._itemsManager._versionManager.endNotifications(),this._itemsManager._endNotifications()},reload:function(){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._reload()}},{supportedForProcessing:!1}),b=WinJS.Class.define(function(b,c,d,e){if(!b)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ListDataSourceIsInvalid",l.listDataSourceIsInvalid);if(!c)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemRendererIsInvalid",l.itemRendererIsInvalid);this.$pipeline_callbacksMap={},this._listDataSource=b,this.dataSource=this._listDataSource,this._elementNotificationHandler=d,this._listBinding=this._listDataSource.createListBinding(new a(this)),e&&(e.ownerElement&&(this._ownerElement=e.ownerElement),this._profilerId=e.profilerId,this._versionManager=e.versionManager||new WinJS.UI._VersionManager),this._indexInView=e&&e.indexInView,this._itemRenderer=c,this._viewCallsReady=e&&e.viewCallsReady,this._elementMap={},this._handleMap={},this._jobOwner=j.createOwnerToken(),this._notificationsSent=!1,this._listBinding.last&&(this.lastItem=function(){return this._elementForItem(this._listBinding.last())})},{_itemFromItemPromise:function(a){return this._waitForElement(this._elementForItem(a))},_itemFromItemPromiseThrottled:function(a){return this._waitForElement(this._elementForItem(a,!0))},_itemAtIndex:function(a){var b=this._itemPromiseAtIndex(a);this._itemFromItemPromise(b).then(null,function(a){return b.cancel(),WinJS.Promise.wrapError(a)})},_itemPromiseAtIndex:function(a){return this._listBinding.fromIndex(a)},_waitForElement:function(a){var b=this;return new WinJS.Promise(function(c){if(a)if(b.isPlaceholder(a)){var d=k(a),e=b.$pipeline_callbacksMap[d];e?e.push(c):b.$pipeline_callbacksMap[d]=[c]}else c(a);else c(a)})},_updateElement:function(a,b){var c=k(b),d=this.$pipeline_callbacksMap[c];d&&(delete this.$pipeline_callbacksMap[c],d.forEach(function(b){b(a)}))},_firstItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.first()))},_lastItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.last()))},_previousItem:function(a){return this._listBinding.jumpToItem(this._itemFromElement(a)),this._waitForElement(this._elementForItem(this._listBinding.previous()))},_nextItem:function(a){return this._listBinding.jumpToItem(this._itemFromElement(a)),this._waitForElement(this._elementForItem(this._listBinding.next()))},_itemFromPromise:function(a){return this._waitForElement(this._elementForItem(a))},isPlaceholder:function(a){return!!this._recordFromElement(a).elementIsPlaceholder},itemObject:function(a){return this._itemFromElement(a)},release:function(){this._listBinding.release(),this._elementNotificationHandler=null,this._listBinding=null,this._jobOwner.cancelAll(),this._released=!0},releaseItemPromise:function(a){var b=a.handle,c=this._handleMap[b];c?this._releaseRecord(c):a.cancel()},releaseItem:function(a){var b=this._elementMap[k(a)];this._releaseRecord(b)},_releaseRecord:function(a){a&&(a.renderPromise&&a.renderPromise.cancel(),a.itemPromise&&a.itemPromise.cancel(),a.imagePromises&&a.imagePromises.forEach(function(a){a.cancel()}),a.itemReadyPromise&&a.itemReadyPromise.cancel(),a.renderComplete&&a.renderComplete.cancel(),this._removeEntryFromElementMap(a.element),this._removeEntryFromHandleMap(a.itemPromise.handle,a),a.item&&this._listBinding.releaseItem(a.item))},refresh:function(){return this._listDataSource.invalidateAll()},_handlerToNotifyCaresAboutItemAvailable:function(){return!(!this._elementNotificationHandler||!this._elementNotificationHandler.itemAvailable)},_handlerToNotify:function(){return this._notificationsSent||(this._notificationsSent=!0,this._elementNotificationHandler&&this._elementNotificationHandler.beginNotifications&&this._elementNotificationHandler.beginNotifications()),this._elementNotificationHandler},_defineIndexProperty:function(a,b,c){c.indexObserved=!1,Object.defineProperty(a,"index",{get:function(){return c.indexObserved=!0,b.index}})},_renderPlaceholder:function(a){var b={},c=e(b);return a.elementIsPlaceholder=!0,c},_renderItem:function(a,b,e){function f(){a.then(function(a){g._writeProfilerMark(n+",StartTM"),l.complete(a),g._writeProfilerMark(n+",StopTM")})}var g=this,k=g._indexInView||function(){return!0},l=new i,m=new i,n="_renderItem("+b.item.index+"):itemPromise",o=!0,p=!1;a.then(function(a){p=!0,o&&l.complete(a)}),o=!1;var q=l.promise.then(function(a){if(a){var e=Object.create(a);return g._defineIndexProperty(e,a,b),e.ready=m.promise,e.isOnScreen=function(){return h.wrap(k(a.index))},e.loadImage=function(a,d){var f=c(a,d,e);return b.imagePromises?b.imagePromises.push(f):b.imagePromises=[f],f},e.isImageCached=d,e}return WinJS.Promise.cancel});p||(e?(b.stage0=a,b.startStage1=function(){b.startStage1=null,f()}):f()),q.handle=a.handle,b.itemPromise=q,b.itemReadyPromise=m.promise,b.readyComplete=!1;var r="_renderItem("+b.item.index+(p?"):syncItemPromise":"):placeholder"),s="_renderItem("+b.item.index+"):itemReady";this._writeProfilerMark(r+",StartTM");var t=WinJS.Promise.as(g._itemRenderer(q,b.element)).then(WinJS.UI._normalizeRendererReturn).then(function(a){return g._released?WinJS.Promise.cancel:(q.then(function(a){if(b.pendingReady=function(){b.pendingReady&&(b.pendingReady=null,b.readyComplete=!0,g._writeProfilerMark(s+",StartTM"),m.complete(a),g._writeProfilerMark(s+",StopTM"))},!g._viewCallsReady){var c=j.schedule(b.pendingReady,j.Priority.normal,b,"WinJS.UI._ItemsManager._pendingReady");c.owner=g._jobOwner}}),a)});return this._writeProfilerMark(r+",StopTM"),t},_replaceElement:function(a,b){this._removeEntryFromElementMap(a.element),a.element=b,this._addEntryToElementMap(b,a)},_changeElement:function(a,b,c){a.renderPromise=null;var d=a.element,e=a.item;a.newItem&&(a.item=a.newItem,a.newItem=null),this._replaceElement(a,b),a.item&&a.elementIsPlaceholder&&!c?(a.elementDelayed=null,a.elementIsPlaceholder=!1,this._updateElement(a.element,d),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(a.element,d)):this._handlerToNotify().changed(b,d,e)},_elementForItem:function(a,b){var c,d=a.handle,e=this._recordFromHandle(d,!0);if(!d)return null;if(e)c=e.element;else{e={item:a,itemPromise:a},this._addEntryToHandleMap(d,e);var f=this,g=!1,h=!1,i=f._renderItem(a,e,b).then(function(b){var d=b.element;e.renderComplete=b.renderComplete,a.then(function(a){e.item=a,a||(g=!0,c=null)}),h=!0,e.renderPromise=null,d&&(c?f._presentElements(e,d):c=d)});g||(h||(e.renderPromise=i),c||(c=this._renderPlaceholder(e)),e.element=c,this._addEntryToElementMap(c,e),a.retain())}return c},_addEntryToElementMap:function(a,b){this._elementMap[k(a)]=b},_removeEntryFromElementMap:function(a){delete this._elementMap[k(a)]},_recordFromElement:function(a){var b=this._elementMap[k(a)];if(!b)throw this._writeProfilerMark("_recordFromElement:ItemIsInvalidError,info"),new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",l.itemIsInvalid);return b},_addEntryToHandleMap:function(a,b){this._handleMap[a]=b},_removeEntryFromHandleMap:function(a){delete this._handleMap[a]},_handleInHandleMap:function(a){return!!this._handleMap[a]},_recordFromHandle:function(a,b){var c=this._handleMap[a];if(!c&&!b)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",l.itemIsInvalid);return c},_foreachRecord:function(a){var b=this._handleMap;for(var c in b){var d=b[c];a(d)}},_itemFromElement:function(a){return this._recordFromElement(a).item},_elementFromHandle:function(a){if(a){var b=this._recordFromHandle(a,!0);if(b&&b.element)return b.element}return null},_inserted:function(a,b,c){this._handlerToNotify().inserted(a,b,c)},_changed:function(a,b){if(this._handleInHandleMap(b.handle)){var c=this._recordFromHandle(b.handle);c.renderPromise&&c.renderPromise.cancel(),c.itemPromise&&c.itemPromise.cancel(),c.imagePromises&&c.imagePromises.forEach(function(a){a.cancel()}),c.itemReadyPromise&&c.itemReadyPromise.cancel(),c.renderComplete&&c.renderComplete.cancel(),c.newItem=a;var d=this,e=WinJS.Promise.as(a);e.handle=c.itemPromise.handle,c.renderPromise=this._renderItem(e,c).then(function(a){c.renderComplete=a.renderComplete,d._changeElement(c,a.element,!1),d._presentElements(c)})}},_moved:function(a,b,c){var d=this._elementFromHandle(a.handle),e=this._elementFromHandle(b),f=this._elementFromHandle(c);this._handlerToNotify().moved(d,e,f,a),this._presentAllElements()},_removed:function(a,b){if(this._handleInHandleMap(a)){var c=this._elementFromHandle(a);this._handlerToNotify().removed(c,b,a),this.releaseItem(c),this._presentAllElements()}else this._handlerToNotify().removed(null,b,a)},_countChanged:function(a,b){this._elementNotificationHandler&&this._elementNotificationHandler.countChanged&&this._handlerToNotify().countChanged(a,b)},_indexChanged:function(a,b,c){var d;if(this._handleInHandleMap(a)){var e=this._recordFromHandle(a);if(e.indexObserved)if(e.elementIsPlaceholder)this._changeElement(e,this._renderPlaceholder(e),!0);else if(e.item.index!==b){e.renderPromise&&e.renderPromise.cancel(),e.renderComplete&&e.renderComplete.cancel();var f=e.newItem||e.item;f.index=b;var g=WinJS.Promise.as(f);g.handle=e.itemPromise.handle;var h=this;e.renderPromise=this._renderItem(g,e).then(function(a){e.renderComplete=a.renderComplete,h._changeElement(e,a.element,!1),h._presentElements(e)})}d=e.element}this._elementNotificationHandler&&this._elementNotificationHandler.indexChanged&&this._handlerToNotify().indexChanged(d,b,c)},_affectedRange:function(a){this._elementNotificationHandler&&this._elementNotificationHandler.updateAffectedRange&&this._handlerToNotify().updateAffectedRange(a)},_beginNotifications:function(){this._externalBegin=!0;this._handlerToNotify()},_endNotifications:function(){this._notificationsSent&&(this._notificationsSent=!1,this._externalBegin=!1,this._elementNotificationHandler&&this._elementNotificationHandler.endNotifications&&this._elementNotificationHandler.endNotifications())},_reload:function(){this._elementNotificationHandler&&this._elementNotificationHandler.reload&&this._elementNotificationHandler.reload()},_postEndNotifications:function(){if(this._notificationsSent&&!this._externalBegin&&!this._endNotificationsPosted){this._endNotificationsPosted=!0;var a=this;j.schedule(function(){a._endNotificationsPosted=!1,a._endNotifications()},j.Priority.high,null,"WinJS.UI._ItemsManager._postEndNotifications")}},_presentElement:function(a){var b=a.element;this._replaceElement(a,a.elementDelayed),a.elementDelayed=null,a.elementIsPlaceholder=!1,this._updateElement(a.element,b),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(a.element,b)},_presentElements:function(a,b){b&&(a.elementDelayed=b),this._listBinding.jumpToItem(a.item),a.elementDelayed&&this._presentElement(a),this._postEndNotifications()},_presentAllElements:function(){var a=this;this._foreachRecord(function(b){b.elementDelayed&&a._presentElement(b)})},_writeProfilerMark:function(a){var b="WinJS.UI._ItemsManager:"+(this._profilerId?this._profilerId+":":":")+a;WinJS.Utilities._writeProfilerMark(b)}},{supportedForProcessing:!1});return function(a,c,d,e){return new b(a,c,d,e)}})})}),b("WinJS/Controls/ListView/_Layouts",[],function(){"use strict";function a(a){return"_win-dynamic-"+a+"-"+w++}function b(){var a,b,c,d=v.sheet.cssRules,e=x.length;for(a=0;e>a;a++)for(c="."+x[a]+" ",b=d.length-1;b>=0;b--)-1!==d[b].selectorText.indexOf(c)&&v.sheet.deleteRule(b);x=[]}function c(a,c,d,e){b();var f="."+WinJS.UI._listViewClass+" ."+a+" "+d+" { "+e+"}",g="_addDynamicCssRule:"+a+",info";c?c._writeProfilerMark(g):WinJS.Utilities._writeProfilerMark("WinJS.UI.ListView:Layout"+g),v.sheet.insertRule(f,0)}function d(a){x.push(a)}function e(a,b,c){return Math.max(a,Math.min(b,c))}function f(a,b){return WinJS.Utilities.convertToPixels(a,window.getComputedStyle(a,null)[b])}function g(a,b){return f(b,"margin"+a)+f(b,"border"+a+"Width")+f(b,"padding"+a)}function h(a){return g("Top",a)+g("Bottom",a)}function i(a){return g("Left",a)+g("Right",a)}function j(a,b){if(a.items)for(var c=0,d=a.items.length;d>c;c++)b(a.items[c],c);else for(var e=0,f=0;e<a.itemsBlocks.length;e++)for(var g=a.itemsBlocks[e],c=0,d=g.items.length;d>c;c++)b(g.items[c],f++)}function k(a,b){if(0>b)return null;if(a.items)return b<a.items.length?a.items[b]:null;var c=a.itemsBlocks[0].items.length,d=Math.floor(b/c),e=b%c;return d<a.itemsBlocks.length&&e<a.itemsBlocks[d].items.length?a.itemsBlocks[d].items[e]:null}function l(a,b){for(var c,d=0,e=b.length;e>d;d++)if(b[d].itemsContainer.element===a){c=b[d].itemsContainer;break}return c}function m(a){var b,c;return a.itemsBlocks?(b=a.itemsBlocks.length,c=b>0?a.itemsBlocks[0].items.length*(b-1)+a.itemsBlocks[b-1].items.length:0):c=a.items.length,c}function n(a){if(!D){var b=document.createElement("div");b.style.width="500px",b.style.visibility="hidden";var c=document.createElement("div");c.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",q.setInnerHTMLUnsafe(c,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>"),b.appendChild(c),a.viewport.insertBefore(b,a.viewport.firstChild);var d=b.offsetWidth>0,e=200;d&&(D={supportsCSSGrid:!!(y["grid-row"]&&y["grid-rows"]&&y["grid-row-span"]&&y["grid-column"]&&y["grid-columns"]&&y["grid-column-span"]),nestedFlexTooLarge:c.firstElementChild.offsetWidth>e,nestedFlexTooSmall:c.firstElementChild.offsetWidth<e}),a.viewport.removeChild(b)}return D}function o(a){return WinJS.Promise.is(a)?{realizedRangeComplete:a,layoutComplete:a}:"object"==typeof a&&a&&a.layoutComplete?a:{realizedRangeComplete:WinJS.Promise.wrap(),layoutComplete:WinJS.Promise.wrap()}}function p(a){return{left:f(a,"marginLeft"),right:f(a,"marginRight"),top:f(a,"marginTop"),bottom:f(a,"marginBottom")}}var q=WinJS.Utilities,r=q.Key,s=q.Scheduler,t=WinJS.Utilities._uniqueID,u={get itemInfoIsInvalid(){return WinJS.Resources._getWinJSString("ui/itemInfoIsInvalid").value},get groupInfoResultIsInvalid(){return WinJS.Resources._getWinJSString("ui/groupInfoResultIsInvalid").value}},v=document.createElement("style");document.head.appendChild(v);var w=0,x=[],y=WinJS.Utilities._browserStyleEquivalents,z=y.transform,A=WinJS.Utilities._browserStyleEquivalents.transition.scriptName,B=z.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",C=12,D=null;WinJS.Namespace.define("WinJS.UI",{Layout:WinJS.Class.define(function(){}),_LayoutCommon:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(a){this._groupHeaderPosition=a,this._invalidateLayout()}},initialize:function(a,b){a._writeProfilerMark("Layout:initialize,info"),this._inListMode||q.addClass(a.surface,WinJS.UI._gridLayoutClass),this._envInfo=n(a)||{},this._envInfo.supportsCSSGrid||q.addClass(a.surface,WinJS.UI._noCSSGrid),this._backdropColorClassName&&q.addClass(a.surface,this._backdropColorClassName),this._disableBackdropClassName&&q.addClass(a.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=a,this._groupsEnabled=b,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(a){this._orientation=a,this._horizontal="horizontal"===a,this._invalidateLayout()}},uninitialize:function(){function a(a){var b,c=a.length;for(b=0;c>b;b++)a[b].cleanUp(!0)}var b="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(b),q.removeClass(this._site.surface,WinJS.UI._gridLayoutClass),q.removeClass(this._site.surface,WinJS.UI._headerPositionTopClass),q.removeClass(this._site.surface,WinJS.UI._headerPositionLeftClass),WinJS.Utilities.removeClass(this._site.surface,WinJS.UI._structuralNodesClass),this._site.surface.style.cssText="",this._groups&&(a(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=null,this._backdropColorClassName&&(q.removeClass(this._site.surface,this._backdropColorClassName),d(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(q.removeClass(this._site.surface,this._disableBackdropClassName),d(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):WinJS.Utilities._writeProfilerMark("WinJS.UI.ListView:"+b)},numberOfItemsPerItemsBlock:{get:function(){function a(){var a,c=b._site.groupCount;for(a=0;c>a;a++)if(b._isCellSpanning(a))return!1;return!0}var b=this;return b._measureItem(0).then(function(){return b._sizes.viewportContentSize!==b._getViewportCrossSize()&&b._viewportSizeChanged(b._getViewportCrossSize()),b._envInfo.nestedFlexTooLarge||b._envInfo.nestedFlexTooSmall||!a()?(b._usingStructuralNodes=!1,null):(b._usingStructuralNodes=WinJS.UI._LayoutCommon._barsPerItemsBlock>0,WinJS.UI._LayoutCommon._barsPerItemsBlock*b._itemsPerBar)})}},layout:function(a,b,c,d){function e(a){function b(a){if(k._usingStructuralNodes){var b=[];return a.itemsBlocks.forEach(function(a){b=b.concat(a.items.slice(0))}),b}return a.items.slice(0)}return{element:a.element,items:b(a)}}function f(){function c(a,b){var c=a.enableCellSpanning?E.CellSpanningGroup:E.UniformGroup;return new c(k,b)}var d,f=k._groups.length>0?k._getRealizationRange():null,g=[],h=[],i={},j={},l=0,n=a.length;for(d=0;n>d;d++){var o=null,p=k._getGroupInfo(d),q=k._site.groupFromIndex(d).key,r=k._groupMap[q],s=r instanceof E.CellSpanningGroup,t=p.enableCellSpanning;if(r)if(s!==t)i[q]=!0;else{var u=Math.max(0,b.firstIndex-r.startIndex),v=k._rangeForGroup(r,f);v&&u<=v.lastIndex&&(o={firstIndex:Math.max(u,v.firstIndex),lastIndex:v.lastIndex})}var w,x=c(p,a[d].itemsContainer.element);w=x.prepareLayoutWithCopyOfTree?x.prepareLayoutWithCopyOfTree(e(a[d].itemsContainer),o,r,{groupInfo:p,startIndex:l}):x.prepareLayout(m(a[d].itemsContainer),o,r,{groupInfo:p,startIndex:l}),h.push(w),l+=x.count,g.push(x),j[q]=x}return WinJS.Promise.join(h).then(function(){for(var a=0,b=0,c=g.length;c>b;b++){var d=g[b];d.offset=a,a+=k._getGroupSize(d)}Object.keys(k._groupMap).forEach(function(a){var b=!i[a];k._groupMap[a].cleanUp(b)}),k._groups=g,k._groupMap=j})}function g(a,c,d){var e,f=k._groups[a],g=Math.max(0,b.firstIndex-f.startIndex),h=k._rangeForGroup(f,c);return d?void f.layoutRealizedRange(g,h):(h||(e=f.startIndex+f.count-1<c.firstIndex),f.layoutUnrealizedRange(g,h,e))}function h(){if(0!==k._groups.length){var c,d=k._getRealizationRange(),e=a.length,f=l.groupIndexFromItemIndex(b.firstIndex);for(c=f;e>c;c++)g(c,d,!0),k._layoutGroup(c)}}function i(){if(0===k._groups.length)return WinJS.Promise.wrap();var a=k._getRealizationRange(),c=l.groupIndexFromItemIndex(a.firstIndex-1),d=l.groupIndexFromItemIndex(a.lastIndex+1),e=l.groupIndexFromItemIndex(b.firstIndex),f=[],h=k._groups.length,i=!1,j=c,m=Math.max(e,d);for(m=Math.max(j+1,m);!i;)i=!0,j>=e&&(f.push(g(j,a,!1)),i=!1,j--),h>m&&(f.push(g(m,a,!1)),i=!1,m++);return WinJS.Promise.join(f)}var j,k=this,l=k._site,n="Layout.layout",o=n+":realizedRange";return k._site._writeProfilerMark(n+",StartTM"),k._site._writeProfilerMark(o+",StartTM"),j=k._measureItem(0).then(function(){return WinJS.Utilities[k._usingStructuralNodes?"addClass":"removeClass"](k._site.surface,WinJS.UI._structuralNodesClass),k._sizes.viewportContentSize!==k._getViewportCrossSize()&&k._viewportSizeChanged(k._getViewportCrossSize()),k._cacheRemovedElements(c,k._cachedItemRecords,k._cachedInsertedItemRecords,k._cachedRemovedItems,!1),k._cacheRemovedElements(d,k._cachedHeaderRecords,k._cachedInsertedHeaderRecords,k._cachedRemovedHeaders,!0),f()}).then(function(){k._syncDomWithGroupHeaderPosition(a),k._horizontal?k._groupsEnabled&&k._groupHeaderPosition===WinJS.UI.HeaderPosition.left?l.surface.style.cssText+=";height:"+k._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+k._sizes.headerContainerWidth+"px auto)["+a.length+"]":l.surface.style.height=k._sizes.surfaceContentSize+"px":k._groupsEnabled&&k._groupHeaderPosition===WinJS.UI.HeaderPosition.top?l.surface.style.cssText+=";width:"+k._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+k._sizes.headerContainerHeight+"px auto)["+a.length+"]":l.surface.style.width=k._sizes.surfaceContentSize+"px",h(),k._layoutAnimations(c,d),k._site._writeProfilerMark(o+":complete,info"),k._site._writeProfilerMark(o+",StopTM")},function(a){return k._site._writeProfilerMark(o+":canceled,info"),k._site._writeProfilerMark(o+",StopTM"),WinJS.Promise.wrapError(a)}),k._layoutPromise=j.then(function(){return i().then(function(){k._site._writeProfilerMark(n+":complete,info"),k._site._writeProfilerMark(n+",StopTM")},function(a){return k._site._writeProfilerMark(n+":canceled,info"),k._site._writeProfilerMark(n+",StopTM"),WinJS.Promise.wrapError(a)})}),{realizedRangeComplete:j,layoutComplete:k._layoutPromise}},itemsFromRange:function(a,b){return this._rangeContainsItems(a,b)?{firstIndex:this._firstItemFromRange(a),lastIndex:this._lastItemFromRange(b)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(a,b){function c(){var b={type:a.type,index:a.index-f.startIndex},c=f.getAdjacent(b,g);if("boundary"===c){var h=d._groups[e-1],i=d._groups[e+1],j=d._groups.length-1;if(g===r.leftArrow){if(0===e)return a;if(h instanceof E.UniformGroup&&f instanceof E.UniformGroup){var k=d._indexToCoordinate(b.index),l=d._horizontal?k.row:k.column,m=Math.floor((h.count-1)/d._itemsPerBar),n=m*d._itemsPerBar;return{type:WinJS.UI.ObjectType.item,index:h.startIndex+Math.min(h.count-1,n+l)}}return{type:WinJS.UI.ObjectType.item,index:f.startIndex-1}}if(g===r.rightArrow){if(e===j)return a;if(f instanceof E.UniformGroup&&i instanceof E.UniformGroup){var k=d._indexToCoordinate(b.index),l=d._horizontal?k.row:k.column;return{type:WinJS.UI.ObjectType.item,index:i.startIndex+Math.min(i.count-1,l)}}return{type:WinJS.UI.ObjectType.item,index:i.startIndex}}return a}return c.index+=f.startIndex,c}var d=this,e=d._site.groupIndexFromItemIndex(a.index),f=d._groups[e],g=d._adjustedKeyForOrientationAndBars(d._adjustedKeyForRTL(b),f instanceof E.CellSpanningGroup);if(a.type===WinJS.UI.ObjectType.groupHeader){if(b!==r.pageUp&&b!==r.pageDown){switch(g){case r.leftArrow:return{type:WinJS.UI.ObjectType.groupHeader,index:Math.max(0,a.index-1)};case r.rightArrow:return{type:WinJS.UI.ObjectType.groupHeader,index:Math.min(d._groups.length-1,a.index+1)}}return a}a={type:WinJS.UI.ObjectType.item,index:this._groups[a.index].startIndex}}switch(d._adjustedKeyForRTL(b)){case r.upArrow:case r.leftArrow:case r.downArrow:case r.rightArrow:return c();default:return WinJS.UI._LayoutCommon.prototype._getAdjacentForPageKeys.call(d,a,b)}},hitTest:function(a,b){var c,d=this._sizes;a-=d.layoutOriginX,b-=d.layoutOriginY;var e=this._groupFromOffset(this._horizontal?a:b),f=this._groups[e];return this._horizontal?a-=f.offset:b-=f.offset,this._groupsEnabled&&(this._groupHeaderPosition===WinJS.UI.HeaderPosition.left?a-=d.headerContainerWidth:b-=d.headerContainerHeight),c=f.hitTest(a,b),c.index+=f.startIndex,c.insertAfterIndex+=f.startIndex,c},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var a=this._getRealizationRange(),b=this._site.tree,c=0,d="horizontal"===this.orientation,e=0,f=b.length;f>e;e++){var g=b[e],h=!1,i=this._groups[e],k=i instanceof E.CellSpanningGroup,l=i?i.offset:0;if(j(g.itemsContainer,function(b,d){if(a.firstIndex<=c&&a.lastIndex>=c&&(h=!0,!this._cachedItemRecords[c])){var f=this._getItemPositionForAnimations(c,e,d),g=f.row,i=f.column,j=f.left,l=f.top;this._cachedItemRecords[c]={oldRow:g,oldColumn:i,oldLeft:j,oldTop:l,width:f.width,height:f.height,element:b,inCellSpanningGroup:k}}c++}.bind(this)),h){var m=e;if(!this._cachedHeaderRecords[m]){var n=this._getHeaderPositionForAnimations(m);this._cachedHeaderRecords[m]={oldLeft:n.left,oldTop:n.top,width:n.width,height:n.height,element:g.header}}this._cachedGroupRecords[t(g.itemsContainer.element)]||(this._cachedGroupRecords[t(g.itemsContainer.element)]={oldLeft:d?l:0,left:d?l:0,oldTop:d?0:l,top:d?0:l,element:g.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(a,b){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(a,b);for(var c=this._getRealizationRange(),d=this._site.tree,e=0,f="horizontal"===this.orientation,g=0,h=d.length;h>g;g++){var i=d[g],k=this._groups[g],l=k instanceof E.CellSpanningGroup,m=k?k.offset:0,n=0,o=0,p=this._cachedGroupRecords[t(i.itemsContainer.element)];p&&(f?n=p.oldLeft-m:o=p.oldTop-m),j(i.itemsContainer,function(a,b){if(c.firstIndex<=e&&c.lastIndex>=e){var d=this._cachedItemRecords[e];if(d){var f=this._getItemPositionForAnimations(e,g,b),h=f.row,i=f.column,j=f.left,k=f.top;if(d.inCellSpanningGroup=d.inCellSpanningGroup||l,d.oldRow!==h||d.oldColumn!==i||d.oldTop!==k||d.oldLeft!==j){d.row=h,d.column=i,d.left=j,d.top=k;var m=d.oldLeft-d.left-n,p=d.oldTop-d.top-o;if(m=(this._site.rtl?-1:1)*m,d.xOffset=m,d.yOffset=p,0!==m||0!==p){var q=d.element;d.needsToResetTransform=!0,q.style[A]="",q.style[z.scriptName]="translate("+m+"px,"+p+"px)"}var r=a.parentNode;WinJS.Utilities.hasClass(r,WinJS.UI._itemsBlockClass)&&(this._animatingItemsBlocks[t(r)]=r)}}else this._cachedInsertedItemRecords[e]=a,a.style[A]="",a.style.opacity=0}e++}.bind(this));var q=g,r=this._cachedHeaderRecords[q];if(r){var s=this._getHeaderPositionForAnimations(q);if(r.height=s.height,r.width=s.width,r.oldLeft!==s.left||r.oldTop!==s.top){r.left=s.left,r.top=s.top;var u=r.oldLeft-r.left,v=r.oldTop-r.top;if(u=(this._site.rtl?-1:1)*u,0!==u||0!==v){r.needsToResetTransform=!0;var w=r.element;w.style[A]="",w.style[z.scriptName]="translate("+u+"px,"+v+"px)"}}}if(p&&(f&&p.left!==m||!f&&p.top!==m)){var x=p.element;if(0===n&&0===o)p.needsToResetTransform&&(p.needsToResetTransform=!1,x.style[z.scriptName]="");else{var y=(this._site.rtl?-1:1)*n,B=o;p.needsToResetTransform=!0,x.style[A]="",x.style[z.scriptName]="translate("+y+"px, "+B+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var C=Object.keys(this._animatingItemsBlocks),D=0,F=C.length;F>D;D++)this._animatingItemsBlocks[C[D]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function a(){if(c(),C)d();
else{if(V._itemsPerBar>1)for(var a=V._itemsPerBar*V._sizes.containerCrossSize+V._getHeaderSizeContentAdjustment()+V._sizes.containerMargins[M?"top":p.rtl?"right":"left"]+(M?V._sizes.layoutOriginY:V._sizes.layoutOriginX),b=0,e=s.length;e>b;b++){var g=s[b];g[N]>g[O]?(H=Math.max(H,g[P]+g[M?"height":"width"]),J=Math.max(J,a-g[Q]),D=!0,L.push(g)):g[N]<g[O]&&(I=Math.max(I,a-g[P]),K=Math.max(K,g[Q]+g[M?"height":"width"]),L.push(g),D=!0)}p.rtl&&!M&&(H*=-1,J*=-1,I*=-1,K*=-1),D?f(V._itemsPerBar):i()}}function b(a){y=WinJS.Promise.join(B),y.done(function(){B=[],n&&(WinJS.UI.Layout._debugAnimations?requestAnimationFrame(function(){a()}):a())})}function c(){if(r.length){p._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),w+=60,x+=60;var a=120;o&&(a*=10),B.push(WinJS.UI.executeTransition(r,[{property:"opacity",delay:v,duration:a,timing:"linear",to:0,skipStylesReset:!0}])),p._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function d(){p._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var a=[],c=0,d=s.length;d>c;c++){var f=s[c],g=f.element;a.push(g)}for(var c=0,d=u.length;d>c;c++){var f=u[c],g=f.element;a.push(g)}var h=120;o&&(h*=10),B.push(WinJS.UI.executeTransition(a,{property:"opacity",delay:v,duration:h,timing:"linear",to:0})),b(e),p._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function e(){p._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),x=0;for(var a=[],b=0,c=s.length;c>b;b++){var d=s[b],e=d.element;e.style[z.scriptName]="",a.push(e)}for(var b=0,c=u.length;c>b;b++){var d=u[b],e=d.element;e.style[z.scriptName]="",a.push(e)}var f=120;o&&(f*=10),B.push(WinJS.UI.executeTransition(a,{property:"opacity",delay:x,duration:f,timing:"linear",to:1})),p._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),j()}function f(a){p._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var c={},d=0,e=L.length;e>d;d++){var f=L[d],g=f.xOffset,i=f.yOffset;f[N]>f[O]?M?i-=H:g-=H:f[N]<f[O]&&(M?i+=I:g+=I);var j=f.element;E=Math.min(E,M?g:i),F=Math.max(F,M?g:i);var k=j.parentNode;WinJS.Utilities.hasClass(k,"win-itemscontainer")||(k=k.parentNode);var n=c[t(k)];if(!n){var q=m(l(k,p.tree));c[t(k)]=n=Math.ceil(q/a)-1}L[d][M?"column":"row"]===n&&(G[t(k)]=k);var r=80;o&&(r*=10),B.push(WinJS.UI.executeTransition(j,{property:z.cssName,delay:w,duration:r,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+g+"px,"+i+"px)"}))}for(var s=Object.keys(G),d=0,e=s.length;e>d;d++){var u=G[s[d]];p.rtl&&M?(u.style.paddingLeft=-1*E+"px",u.style.marginLeft=E+"px"):(u.style[M?"paddingRight":"paddingBottom"]=F+"px",u.style[M?"marginRight":"marginBottom"]="-"+F+"px")}for(var v=Object.keys(R),d=0,e=v.length;e>d;d++)R[v[d]].classList.add(WinJS.UI._clipClass);b(h),p._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function g(){for(var a=Object.keys(G),b=0,c=a.length;c>b;b++){var d=G[a[b]];p.rtl&&M?(d.style.paddingLeft="",d.style.marginLeft=""):(d.style[M?"paddingRight":"paddingBottom"]="",d.style[M?"marginRight":"marginBottom"]="")}G={};for(var e=Object.keys(R),b=0,c=e.length;c>b;b++){var f=R[e[b]];f.style.overflow="",f.classList.remove(WinJS.UI._clipClass)}}function h(){p._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var a=0,b=L.length;b>a;a++){var c=L[a],d=0,e=0;c[N]>c[O]?M?e=J:d=J:c[N]<c[O]&&(M?e=-1*K:d=-1*K),c.element.style[A]="",c.element.style[z.scriptName]="translate("+d+"px,"+e+"px)"}p._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),WinJS.UI.Layout._debugAnimations?requestAnimationFrame(function(){i(!0)}):i(!0)}function i(a){var b=200;if(a&&(b=150,w=0,x=0),o&&(b*=10),s.length>0||u.length>0){p._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var c=[],d=0,e=u.length;e>d;d++){var f=u[d].element;c.push(f)}for(var d=0,e=s.length;e>d;d++){var f=s[d].element;c.push(f)}B.push(WinJS.UI.executeTransition(c,{property:z.cssName,delay:w,duration:b,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),x+=80,p._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}j()}function j(){if(q.length>0){p._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var a=120;o&&(a*=10),B.push(WinJS.UI.executeTransition(q,[{property:"opacity",delay:x,duration:a,timing:"linear",to:1}])),p._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}b(k)}function k(){p._writeProfilerMark("Animation:cleanupAnimations,StartTM"),g();for(var a=0,b=r.length;b>a;a++){var c=r[a];c.parentNode&&(WinJS.Utilities._disposeElement(c),c.parentNode.removeChild(c))}p._writeProfilerMark("Animation:cleanupAnimations,StopTM"),V._animationsRunning=null,n.complete()}var n=new WinJS._Signal;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),n.complete(),n.promise;this._animationsRunning=n.promise;for(var o=WinJS.UI.Layout._debugAnimations||WinJS.UI.Layout._slowAnimations,p=this._site,q=this._insertedElements,r=this._removedElements,s=this._itemMoveRecords,u=this._moveRecords,v=0,w=0,x=0,y=null,B=[],C=(this._site.surface,!1),D=!1,E=0,F=0,G={},H=0,I=0,J=0,K=0,L=[],M="horizontal"===this.orientation,N=M?"oldColumn":"oldRow",O=M?"column":"row",P=M?"oldTop":"oldLeft",Q=M?"top":"left",R=this._animatingItemsBlocks,S=0,T=s.length;T>S;S++){var U=s[S];if(U.inCellSpanningGroup){C=!0;break}}var V=this;return WinJS.UI.Layout._debugAnimations?requestAnimationFrame(function(){a()}):a(),this._resetAnimationCaches(!0),n.promise.then(null,function(){g();for(var a=0,b=u.length;b>a;a++){var c=u[a].element;c.style[z.scriptName]="",c.style.opacity=1}for(var a=0,b=s.length;b>a;a++){var c=s[a].element;c.style[z.scriptName]="",c.style.opacity=1}for(var a=0,b=q.length;b>a;a++)q[a].style.opacity=1;for(var a=0,b=r.length;b>a;a++){var c=r[a];c.parentNode&&(WinJS.Utilities._disposeElement(c),c.parentNode.removeChild(c))}this._animationsRunning=null,n=null,y&&y.cancel()}.bind(this)),n.promise},dragOver:function(a,b,c){var d=this.hitTest(a,b),e=this._groups?this._site.groupIndexFromItemIndex(d.index):0,f=this._site.tree[e].itemsContainer,g=m(f),h=this._groups?this._groups[e].startIndex:0,i=this._getVisibleRange();d.index-=h,d.insertAfterIndex-=h,i.firstIndex=Math.max(i.firstIndex-h-1,0),i.lastIndex=Math.min(i.lastIndex-h+1,g);var j=Math.max(Math.min(g-1,d.insertAfterIndex),-1),l=Math.min(j+1,g);if(c){for(var n=j;n>=i.firstIndex;n--){if(!c._isIncluded(n+h)){j=n;break}n===i.firstIndex&&(j=-1)}for(var n=l;n<i.lastIndex;n++){if(!c._isIncluded(n+h)){l=n;break}n===i.lastIndex-1&&(l=g)}}var o=k(f,l),p=k(f,j);if(this._animatedDragItems)for(var n=0,q=this._animatedDragItems.length;q>n;n++){var r=this._animatedDragItems[n];r&&(r.style[A]=this._site.animationsDisabled?"":B,r.style[z.scriptName]="")}this._animatedDragItems=[];var s="horizontal"===this.orientation,t=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[e]instanceof E.CellSpanningGroup&&(t=1===this._groups[e]._slotsPerColumn);var u=0,v=0;!s&&!t||s&&t?u=this._site.rtl?-C:C:v=C,o&&(o.style[A]=this._site.animationsDisabled?"":B,o.style[z.scriptName]="translate("+u+"px, "+v+"px)",this._animatedDragItems.push(o)),p&&(p.style[A]=this._site.animationsDisabled?"":B,p.style[z.scriptName]="translate("+-u+"px, -"+v+"px)",this._animatedDragItems.push(p))},dragLeave:function(){if(this._animatedDragItems)for(var a=0,b=this._animatedDragItems.length;b>a;a++)this._animatedDragItems[a].style[A]=this._site.animationsDisabled?"":B,this._animatedDragItems[a].style[z.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(a){a===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),a&&(this._itemsPerBar=Math.min(this._itemsPerBar,a)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=a,this._invalidateLayout())},_getItemPosition:function(a){if(this._groupsEnabled){var b=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(a)),c=this._groups[b],d=a-c.startIndex;return this._getItemPositionForAnimations(a,b,d)}return this._getItemPositionForAnimations(a,0,a)},_getRealizationRange:function(){var a=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(a.firstPixel),lastIndex:this._lastItemFromRange(a.lastPixel)}},_getVisibleRange:function(){var a=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(a.firstPixel),lastIndex:this._lastItemFromRange(a.lastPixel)}},_resetAnimationCaches:function(a){if(!a){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var b=Object.keys(this._animatingItemsBlocks),c=0,d=b.length;d>c;c++){var e=this._animatingItemsBlocks[b[c]];e.style.overflow="",e.classList.remove(WinJS.UI._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(a,b,c,d,e){var f=(this._sizes.containerMargins,"left");this._site.rtl&&(f="right");var g,h;e?(g=this._sizes.headerContainerOuterX,h=this._sizes.headerContainerOuterY):(g=this._sizes.containerMargins[f],h=this._sizes.containerMargins.top);for(var i=0,j=a.length;j>i;i++){var k=a[i];if(-1===k.newIndex){var l=k.element,m=b[k.oldIndex];m&&(m.element=l,delete b[k.oldIndex],l.style.position="absolute",l.style[A]="",l.style.top=m.oldTop-h+"px",l.style[f]=m.oldLeft-g+"px",l.style.width=m.width+"px",l.style.height=m.height+"px",l.style[z.scriptName]="",this._site.surface.appendChild(l),d.push(m)),c[k.oldIndex]&&delete c[k.oldIndex]}}},_cacheInsertedElements:function(a,b,c){for(var d={},e=0,f=a.length;f>e;e++){var g=a[e],h=b[g.oldIndex];if(h&&delete b[g.oldIndex],h||-1===g.oldIndex||g.moved){var i=c[g.newIndex];i&&delete c[g.newIndex];var j=g.element;d[g.newIndex]=j,j.style[A]="",j.style[z.scriptName]="",j.style.opacity=0}}for(var k=Object.keys(b),e=0,f=k.length;f>e;e++)d[k[e]]=b[k[e]];return d},_resetStylesForRecords:function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++){var e=a[b[c]];e.needsToResetTransform&&(e.element.style[z.scriptName]="",e.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++){var e=a[b[c]];e.style.opacity=1}},_resetStylesForRemovedRecords:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b].element;d.parentNode&&(WinJS.Utilities._disposeElement(d),d.parentNode.removeChild(d))}},_updateAnimationCache:function(a,b){function c(a,b){for(var c={},e=0,f=a.length;f>e;e++){var g=a[e],h=b[g.oldIndex];h&&(c[g.newIndex]=h,h.element=g.element,delete b[g.oldIndex])}for(var i=Object.keys(b),e=0,f=i.length;f>e;e++){var j=i[e],k=b[j];(!k.element||d[t(k.element)])&&(c[j]=k)}return c}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var d={},e=this._getRealizationRange(),f=this._site.tree,g=0,h=0,i=f.length;i>g;g++)j(f[g].itemsContainer,function(a){e.firstIndex<=h&&e.lastIndex>=h&&(d[t(a)]=!0),h++});this._cachedItemRecords=c(a,this._cachedItemRecords),this._cachedHeaderRecords=c(b,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(a,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(b,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function a(a,g){for(var h=0,i=a.length;i>h;h++){var j=a[h],k=j.element;j[c]+j[d]-1<e||j[c]>f||!b._site.viewport.contains(k)?k.parentNode&&(WinJS.Utilities._disposeElement(k),k.parentNode.removeChild(k)):g.push(k)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var b=this,c="horizontal"===this.orientation?"oldLeft":"oldTop",d="horizontal"===this.orientation?"width":"height",e=this._site.scrollbarPos,f=e+this._site.viewportSize[d]-1;a(this._cachedRemovedItems,this._removedElements),a(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function a(a,d){for(var e=Object.keys(a),f=0,g=e.length;g>f;f++){var h=e[f],i=a[h];h<c.firstIndex||h>c.lastIndex||b._site.viewport.contains(i.element)?i.style.opacity=1:d.push(i)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var b=this,c=this._getVisibleRange();a(this._cachedInsertedItemRecords,this._insertedElements),a(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var a=this,b="horizontal"===this.orientation?"oldLeft":"oldTop",c="horizontal"===this.orientation?"left":"top",d="horizontal"===this.orientation?"width":"height",e=this._getRealizationRange(),f=this._site.scrollbarPos,g=f+this._site.viewportSize[d]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var h=this._site.tree,i=0,k=0,l=h.length;l>k;k++){var m=h[k],n=!1;j(m.itemsContainer,function(){if(e.firstIndex<=i&&e.lastIndex>=i){var h=this._cachedItemRecords[i];if(h){var j=(h[b]+h[d]-1>=f&&h[b]<=g||h[c]+h[d]-1>=f&&h[c]<=g)&&a._site.viewport.contains(h.element);j&&(n=!0,h.needsToResetTransform&&(this._itemMoveRecords.push(h),delete this._cachedItemRecords[i]))}}i++}.bind(this));var o=k,p=this._cachedHeaderRecords[o];p&&n&&p.needsToResetTransform&&(this._moveRecords.push(p),delete this._cachedHeaderRecords[o]);var q=this._cachedGroupRecords[t(m.itemsContainer.element)];q&&n&&q.needsToResetTransform&&(this._moveRecords.push(q),delete this._cachedGroupRecords[t(m.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(a,b,c){var d=this._groups[b],e=d.getItemPositionForAnimations(c),f=this._groups[b]?this._groups[b].offset:0,g=this._groupsEnabled&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.left?this._sizes.headerContainerWidth:0,h=this._groupsEnabled&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.top?this._sizes.headerContainerHeight:0;return e.left+=this._sizes.layoutOriginX+g+this._sizes.itemsContainerOuterX,e.top+=this._sizes.layoutOriginY+h+this._sizes.itemsContainerOuterY,e[this._horizontal?"left":"top"]+=f,e},_getHeaderPositionForAnimations:function(a){var b;if(this._groupsEnabled){var c=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,d=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==WinJS.UI.HeaderPosition.left||this._horizontal?this._groupHeaderPosition===WinJS.UI.HeaderPosition.top&&this._horizontal&&(c=this._groups[a].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):d=this._groups[a].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var e=this._horizontal?this._groups[a].offset:0,f=this._horizontal?0:this._groups[a].offset;b={top:this._sizes.layoutOriginY+f+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+e+this._sizes.headerContainerOuterX,height:d,width:c}}else b={top:0,left:0,height:0,width:0};return b},_rangeContainsItems:function(a,b){if(0===this._groups.length)return!1;var c=this._groups[this._groups.length-1],d=this._sizes.layoutOrigin+c.offset+this._getGroupSize(c)-1;return b>=0&&d>=a},_itemFromOffset:function(a,b){function c(a){if(!b.wholeItem){var c=e._horizontal?e._site.rtl?"right":"left":"top",d=e._horizontal?e._site.rtl?"left":"right":"bottom";return b.last?a-e._sizes.containerMargins[c]:a+e._sizes.containerMargins[d]}return a}function d(a){return b.last?a-e._getHeaderSizeGroupAdjustment()-e._sizes.itemsContainerOuterStart:a}var e=this;if(0===this._groups.length)return 0;b=b||{},a-=this._sizes.layoutOrigin,a=c(a);var f=this._groupFromOffset(d(a)),g=this._groups[f];return a-=g.offset,a-=this._getHeaderSizeGroupAdjustment(),g.startIndex+g.itemFromOffset(a,b)},_firstItemFromRange:function(a,b){return b=b||{},b.last=0,this._itemFromOffset(a,b)},_lastItemFromRange:function(a,b){return b=b||{},b.last=1,this._itemFromOffset(a,b)},_adjustedKeyForRTL:function(a){return this._site.rtl&&(a===r.leftArrow?a=r.rightArrow:a===r.rightArrow&&(a=r.leftArrow)),a},_adjustedKeyForOrientationAndBars:function(a,b){var c=a;if(b)return a;if(!this._horizontal)switch(c){case r.leftArrow:c=r.upArrow;break;case r.rightArrow:c=r.downArrow;break;case r.upArrow:c=r.leftArrow;break;case r.downArrow:c=r.rightArrow}return 1===this._itemsPerBar&&(c===r.upArrow?c=r.leftArrow:c===r.downArrow&&(c=r.rightArrow)),c},_getAdjacentForPageKeys:function(a,b){var c,d=this._sizes.containerMargins,e="horizontal"===this.orientation?d.left+d.right:d.top+d.bottom,f=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],g=this._site.scrollbarPos,h=g+f-1-d["horizontal"===this.orientation?"right":"bottom"],i=this._firstItemFromRange(g,{wholeItem:!0}),j=this._lastItemFromRange(h,{wholeItem:!1}),k=this._getItemPosition(a.index),l=!1;if((a.index<i||a.index>j)&&(l=!0,g="horizontal"===this.orientation?k.left-e:k.top-e,h=g+f-1,i=this._firstItemFromRange(g,{wholeItem:!0}),j=this._lastItemFromRange(h,{wholeItem:!1})),b===r.pageUp){if(!l&&i!==a.index)return{type:WinJS.UI.ObjectType.item,index:i};var m;m="horizontal"===this.orientation?k.left+k.width+e+d.left:k.top+k.height+e+d.bottom;var n=this._firstItemFromRange(m-f,{wholeItem:!0});c=a.index===n?Math.max(0,a.index-this._itemsPerBar):n}else{if(!l&&j!==a.index)return{type:WinJS.UI.ObjectType.item,index:j};var o;o="horizontal"===this.orientation?k.left-e-d.right:k.top-e-d.bottom;var p=Math.max(0,this._lastItemFromRange(o+f-1,{wholeItem:!0}));c=a.index===p?a.index+this._itemsPerBar:p}return{type:WinJS.UI.ObjectType.item,index:c}},_isCellSpanning:function(a){var b=this._site.groupFromIndex(a),c=this._groupInfo;return c?!!("function"==typeof c?c(b):c).enableCellSpanning:!1},_getGroupInfo:function(a){var b=this._site.groupFromIndex(a),c=this._groupInfo,d=this._sizes.containerMargins,e={enableCellSpanning:!1};if(c="function"==typeof c?c(b):c){if(c.enableCellSpanning&&(+c.cellWidth!==c.cellWidth||+c.cellHeight!==c.cellHeight))throw new WinJS.ErrorFromName("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",u.groupInfoResultIsInvalid);e={enableCellSpanning:!!c.enableCellSpanning,cellWidth:c.cellWidth+d.left+d.right,cellHeight:c.cellHeight+d.top+d.bottom}}return e},_getItemInfo:function(a){var b;if(this._itemInfo&&"function"==typeof this._itemInfo)b=this._itemInfo(a);else{if(!this._useDefaultItemInfo)throw new WinJS.ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",u.itemInfoIsInvalid);b=this._defaultItemInfo(a)}return WinJS.Promise.as(b).then(function(a){if(!a||+a.width!==a.width||+a.height!==a.height)throw new WinJS.ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",u.itemInfoIsInvalid);return a})},_defaultItemInfo:function(a){var b=this;return this._site.renderItem(this._site.itemFromIndex(a)).then(function(c){return b._elementsToMeasure[a]={element:c},b._measureElements()}).then(function(){var c=b._elementsToMeasure[a],d={width:c.width,height:c.height};return delete b._elementsToMeasure[a],d},function(c){return delete b._elementsToMeasure[a],WinJS.Promise.wrapError(c)})},_getGroupSize:function(a){var b=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.top?b=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==WinJS.UI.HeaderPosition.left||(b=this._sizes.headerContainerMinHeight)),Math.max(b,a.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(a){return a<this._groups[0].offset?0:this._groupFrom(function(b){return a<b.offset})},_groupFromImpl:function(a,b,c){if(a>b)return null;var d=a+Math.floor((b-a)/2),e=this._groups[d];return c(e,d)?this._groupFromImpl(a,d-1,c):b>d&&!c(this._groups[d+1],d+1)?this._groupFromImpl(d+1,b,c):d},_groupFrom:function(a){if(this._groups.length>0){var b=this._groups.length-1,c=this._groups[b];return a(c,b)?this._groupFromImpl(0,this._groups.length-1,a):b}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(q.removeClass(this._site.surface,this._containerSizeClassName),d(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var a=this;a._measuringElements=s.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){a._site._writeProfilerMark("_measureElements,StartTM");var b=a._createMeasuringSurface(),c=document.createElement("div"),d=a._site,e=a._measuringElements,f=a._elementsToMeasure,g=!1;c.className=WinJS.UI._itemsContainerClass+" "+WinJS.UI._laidOutClass,c.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var h,i,j=Object.keys(f);for(i=0,h=j.length;h>i;i++){var k=f[j[i]].element;k.style["-ms-grid-column"]=i+1,k.style["-ms-grid-row"]=i+1,c.appendChild(k)}for(b.appendChild(c),d.viewport.insertBefore(b,d.viewport.firstChild),e.then(null,function(){g=!0}),i=0,h=j.length;h>i&&!g;i++){var l=f[j[i]],m=l.element.querySelector("."+WinJS.UI._itemClass);l.width=q.getTotalWidth(m),l.height=q.getTotalHeight(m)}b.parentNode&&b.parentNode.removeChild(b),e===a._measuringElements&&(a._measuringElements=null),d._writeProfilerMark("_measureElements,StopTM")},function(b){return a._measuringElements=null,WinJS.Promise.wrapError(b)})}return this._measuringElements},_createMeasuringSurface:function(){var a=document.createElement("div");return a.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto",a.className=WinJS.UI._scrollableClass+" "+(this._inListMode?WinJS.UI._listLayoutClass:WinJS.UI._gridLayoutClass),this._groupsEnabled&&(this._groupHeaderPosition===WinJS.UI.HeaderPosition.top?q.addClass(a,WinJS.UI._headerPositionTopClass):q.addClass(a,WinJS.UI._headerPositionLeftClass)),a},_measureItem:function(a){function b(a,d){{var d,k=!!d,l={},m=e.rtl?"right":"left";e.rtl?"left":"right"}return e.itemCount.then(function(b){return!b||c._groupsEnabled&&!e.groupCount?WinJS.Promise.cancel:(d=d||e.itemFromIndex(a),l.container=e.renderItem(d),c._groupsEnabled&&(l.headerContainer=e.renderHeader(c._site.groupFromIndex(e.groupIndexFromItemIndex(a)))),WinJS.Promise.join(l))}).then(function(l){function n(){var a=c._horizontal,b=c._groupsEnabled,d=!1;j.then(null,function(){d=!0});var k=WinJS.UI._getMargins(z),n=e.rtl?e.viewport.offsetWidth-(z.offsetLeft+z.offsetWidth):z.offsetLeft,o=z.offsetTop,u={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:h(p),surfaceOuterWidth:i(p),layoutOriginX:n-k[m],layoutOriginY:o-k.top,itemsContainerOuterHeight:h(r),itemsContainerOuterWidth:i(r),itemsContainerOuterX:g(e.rtl?"Right":"Left",r),itemsContainerOuterY:g("Top",r),itemsContainerMargins:WinJS.UI._getMargins(r),itemBoxOuterHeight:h(t),itemBoxOuterWidth:i(t),containerOuterHeight:h(l.container),containerOuterWidth:i(l.container),emptyContainerContentHeight:q.getContentHeight(s),emptyContainerContentWidth:q.getContentWidth(s),containerMargins:WinJS.UI._getMargins(l.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};b&&(u.headerContainerOuterX=g(e.rtl?"Right":"Left",l.headerContainer),u.headerContainerOuterY=g("Top",l.headerContainer),u.headerContainerOuterWidth=i(l.headerContainer),u.headerContainerOuterHeight=h(l.headerContainer),u.headerContainerWidth=q.getTotalWidth(l.headerContainer),u.headerContainerHeight=q.getTotalHeight(l.headerContainer),u.headerContainerMinWidth=f(l.headerContainer,"minWidth")+u.headerContainerOuterWidth,u.headerContainerMinHeight=f(l.headerContainer,"minHeight")+u.headerContainerOuterHeight);var v={sizes:u,viewportContentWidth:q.getContentWidth(e.viewport),viewportContentHeight:q.getContentHeight(e.viewport),containerContentWidth:q.getContentWidth(l.container),containerContentHeight:q.getContentHeight(l.container),containerWidth:q.getTotalWidth(l.container),containerHeight:q.getTotalHeight(l.container)};return v.viewportCrossSize=v[a?"viewportContentHeight":"viewportContentWidth"],e.readyToMeasure(),d?null:v}function o(){p.parentNode&&p.parentNode.removeChild(p)}var p=c._createMeasuringSurface(),r=document.createElement("div"),s=document.createElement("div"),t=l.container.querySelector("."+WinJS.UI._itemBoxClass),u=e.groupIndexFromItemIndex(a);s.className=WinJS.UI._containerClass,r.className=WinJS.UI._itemsContainerClass+" "+WinJS.UI._laidOutClass;var v=1,w=1,x=2,y=2,z=r;c._inListMode&&c._groupsEnabled&&(c._horizontal&&c._groupHeaderPosition===WinJS.UI.HeaderPosition.top?(v=2,y=1,x=1,z=l.headerContainer):c._horizontal||c._groupHeaderPosition!==WinJS.UI.HeaderPosition.left||(w=2,y=1,x=1,z=l.headerContainer)),r.style.cssText+=";display: "+(c._inListMode?(c._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+w+";-ms-grid-row: "+v,c._inListMode||(l.container.style.display="inline-block"),c._groupsEnabled&&(l.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+y+";-ms-grid-row: "+x,WinJS.Utilities.addClass(l.headerContainer,WinJS.UI._laidOutClass+" "+WinJS.UI._groupLeaderClass),(c._groupHeaderPosition===WinJS.UI.HeaderPosition.top&&c._horizontal||c._groupHeaderPosition===WinJS.UI.HeaderPosition.left&&!c._horizontal)&&WinJS.Utilities.addClass(r,WinJS.UI._groupLeaderClass)),r.appendChild(l.container),r.appendChild(s),p.appendChild(r),c._groupsEnabled&&p.appendChild(l.headerContainer),e.viewport.insertBefore(p,e.viewport.firstChild);var A=n();if(!A)return o(),WinJS.Promise.cancel;if(c._horizontal&&0===A.viewportContentHeight||!c._horizontal&&0===A.viewportContentWidth)return o(),WinJS.Promise.cancel;if(!(k||c._isCellSpanning(u)||0!==A.containerContentWidth&&0!==A.containerContentHeight))return o(),d.then(function(){return b(a,d)});var B=c._sizes=A.sizes;if(Object.defineProperties(B,{surfaceOuterCrossSize:{get:function(){return c._horizontal?B.surfaceOuterHeight:B.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return c._horizontal?B.layoutOriginX:B.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return c._horizontal?B.itemsContainerOuterWidth:B.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return c._horizontal?B.itemsContainerOuterHeight:B.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return c._horizontal?B.itemsContainerOuterX:B.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return c._horizontal?B.itemsContainerOuterY:B.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return c._horizontal?B.containerHeight:B.containerWidth},enumerable:!0},containerSize:{get:function(){return c._horizontal?B.containerWidth:B.containerHeight},enumerable:!0}}),!c._isCellSpanning(u)){if(c._inListMode){var C=A.viewportCrossSize-B.surfaceOuterCrossSize-c._getHeaderSizeContentAdjustment()-B.itemsContainerOuterCrossSize;c._horizontal?(B.containerHeight=C,B.containerWidth=A.containerWidth):(B.containerHeight=A.containerHeight,B.containerWidth=C)}else B.containerWidth=A.containerWidth,B.containerHeight=A.containerHeight;B.containerSizeLoaded=!0}c._createContainerStyleRule(),c._viewportSizeChanged(A.viewportCrossSize),o()})}var c=this,d="Layout:measureItem",e=c._site,j=c._measuringPromise;if(!j){e._writeProfilerMark(d+",StartTM");var k=new WinJS._Signal;c._measuringPromise=j=k.promise.then(function(){return b(a)}).then(function(){e._writeProfilerMark(d+":complete,info"),e._writeProfilerMark(d+",StopTM")},function(a){return c._measuringPromise=null,e._writeProfilerMark(d+":canceled,info"),e._writeProfilerMark(d+",StopTM"),WinJS.Promise.wrapError(a)}),k.complete()}return j},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===WinJS.UI.HeaderPosition.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(a){var b=this._sizes;b.viewportContentSize=a,b.surfaceContentSize=a-b.surfaceOuterCrossSize,b.maxItemsContainerContentSize=b.surfaceContentSize-b.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),b.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(b.maxItemsContainerContentSize/b.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(b[this._horizontal?"containerHeight":"containerWidth"]=b.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var b=this._sizes;if(!this._containerSizeClassName&&b.containerSizeLoaded&&(0===b.emptyContainerContentHeight||0===b.emptyContainerContentWidth)){var d=b.containerWidth-b.containerOuterWidth+"px",e=b.containerHeight-b.containerOuterHeight+"px";this._inListMode&&(this._horizontal?e="calc(100% - "+(b.containerMargins.top+b.containerMargins.bottom)+"px)":d="auto"),this._containerSizeClassName||(this._containerSizeClassName=a("containersize"),q.addClass(this._site.surface,this._containerSizeClassName));var f="."+WinJS.UI._containerClass,g="width:"+d+";height:"+e+";";c(this._containerSizeClassName,this._site,f,g)}},_ensureContainerSize:function(a){var b=this._sizes;if(b.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:WinJS.Promise.wrap();var c;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)c=this._getItemInfo();else{var d=b.containerMargins;c=WinJS.Promise.wrap({width:a.groupInfo.cellWidth-d.left-d.right,height:a.groupInfo.cellHeight-d.top-d.bottom})}var e=this;return this._ensuringContainerSize=c.then(function(a){b.containerSizeLoaded=!0,b.containerWidth=a.width+b.itemBoxOuterWidth+b.containerOuterWidth,b.containerHeight=a.height+b.itemBoxOuterHeight+b.containerOuterHeight,e._inListMode?e._itemsPerBar=1:(e._itemsPerBar=Math.floor(b.maxItemsContainerContentSize/b.containerCrossSize),e.maximumRowsOrColumns&&(e._itemsPerBar=Math.min(e._itemsPerBar,e.maximumRowsOrColumns)),e._itemsPerBar=Math.max(1,e._itemsPerBar)),e._createContainerStyleRule()}),c.done(function(){e._ensuringContainerSize=null},function(){e._ensuringContainerSize=null}),c},_indexToCoordinate:function(a,b){b=b||this._itemsPerBar;var c=Math.floor(a/b);return this._horizontal?{column:c,row:a-c*b}:{row:c,column:a-c*b}
},_rangeForGroup:function(a,b){var c=a.startIndex,d=c+a.count-1;return!b||b.firstIndex>d||b.lastIndex<c?null:{firstIndex:Math.max(0,b.firstIndex-c),lastIndex:Math.min(a.count-1,b.lastIndex-c)}},_syncDomWithGroupHeaderPosition:function(a){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var b,c=a.length;if(this._oldGroupHeaderPosition===WinJS.UI.HeaderPosition.top)if(q.removeClass(this._site.surface,WinJS.UI._headerPositionTopClass),this._horizontal)for(b=0;c>b;b++)a[b].header.style.maxWidth="",WinJS.Utilities.removeClass(a[b].itemsContainer.element,WinJS.UI._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===WinJS.UI.HeaderPosition.left){if(q.removeClass(this._site.surface,WinJS.UI._headerPositionLeftClass),!this._horizontal)for(b=0;c>b;b++)a[b].header.style.maxHeight="",WinJS.Utilities.removeClass(a[b].itemsContainer.element,WinJS.UI._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===WinJS.UI.HeaderPosition.top){if(q.addClass(this._site.surface,WinJS.UI._headerPositionTopClass),this._horizontal)for(b=0;c>b;b++)WinJS.Utilities.addClass(a[b].itemsContainer.element,WinJS.UI._groupLeaderClass)}else if(q.addClass(this._site.surface,WinJS.UI._headerPositionLeftClass),!this._horizontal)for(b=0;c>b;b++)WinJS.Utilities.addClass(a[b].itemsContainer.element,WinJS.UI._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(a){var b=this._groups[a],c=this._site.tree[a],d=c.header,e=c.itemsContainer.element,f=this._sizes,g=b.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===WinJS.UI.HeaderPosition.top){var h=f.headerContainerMinWidth-f.headerContainerOuterWidth,i=b.getItemsContainerSize()-f.headerContainerOuterWidth;d.style.maxWidth=Math.max(h,i)+"px",this._envInfo.supportsCSSGrid?(d.style.msGridColumn=a+1,e.style.msGridColumn=a+1):(d.style.height=f.headerContainerHeight-f.headerContainerOuterHeight+"px",e.style.height=g-f.itemsContainerOuterHeight+"px",e.style.marginBottom=f.itemsContainerMargins.bottom+(f.maxItemsContainerContentSize-g+f.itemsContainerOuterHeight)+"px"),q.addClass(e,WinJS.UI._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(d.style.msGridColumn=2*a+1,e.style.msGridColumn=2*a+2):(d.style.height=g-f.headerContainerOuterHeight+"px",e.style.height=g-f.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===WinJS.UI.HeaderPosition.left){var j=f.headerContainerMinHeight-f.headerContainerOuterHeight,k=b.getItemsContainerSize()-f.headerContainerOuterHeight;d.style.maxHeight=Math.max(j,k)+"px",this._envInfo.supportsCSSGrid?(d.style.msGridRow=a+1,e.style.msGridRow=a+1):(d.style.width=f.headerContainerWidth-f.headerContainerOuterWidth+"px",e.style.width=g-f.itemsContainerOuterWidth+"px",e.style["margin"+(this._site.rtl?"Left":"Right")]=f.itemsContainerMargins[this._site.rtl?"left":"right"]+(f.maxItemsContainerContentSize-g+f.itemsContainerOuterWidth)+"px"),q.addClass(e,WinJS.UI._groupLeaderClass)}else d.style.msGridRow=2*a+1,this._inListMode?d.style.height=f.headerContainerHeight-f.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?e.style.msGridRow=2*a+2:(d.style.width=g-f.headerContainerOuterWidth+"px",e.style.width=g-f.itemsContainerOuterWidth+"px");q.addClass(d,WinJS.UI._laidOutClass+" "+WinJS.UI._groupLeaderClass)}q.addClass(e,WinJS.UI._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(b){if(q._deprecated(WinJS.UI._strings.disableBackdropIsDeprecated),b=!!b,this._backdropDisabled!==b&&(this._backdropDisabled=b,this._disableBackdropClassName&&(d(this._disableBackdropClassName),this._site&&q.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=a("disablebackdrop"),this._site&&q.addClass(this._site.surface,this._disableBackdropClassName),b)){var e=".win-container.win-backdrop",f="background-color:transparent;";c(this._disableBackdropClassName,this._site,e,f)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(b){if(q._deprecated(WinJS.UI._strings.backdropColorIsDeprecated),b&&this._backdropColor!==b){this._backdropColor=b,this._backdropColorClassName&&(d(this._backdropColorClassName),this._site&&q.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=a("backdropcolor"),this._site&&q.addClass(this._site.surface,this._backdropColorClassName);var e=".win-container.win-backdrop",f="background-color:"+b+";";c(this._backdropColorClassName,this._site,e,f)}}}})}),GridLayout:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._LegacyLayout,function(a){a=a||{},this.itemInfo=a.itemInfo,this.groupInfo=a.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=a.groupHeaderPosition||WinJS.UI.HeaderPosition.top,this.orientation=a.orientation||"horizontal",a.maxRows&&(this.maxRows=+a.maxRows),a.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+a.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(a){this._setMaxRowsOrColumns(a)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(a){q._deprecated(WinJS.UI._strings.maxRowsIsDeprecated),this.maximumRowsOrColumns=a}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(a){a&&q._deprecated(WinJS.UI._strings.itemInfoIsDeprecated),this._itemInfo=a,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(a){a&&q._deprecated(WinJS.UI._strings.groupInfoIsDeprecated),this._groupInfo=a,this._invalidateLayout()}}})})});var E=WinJS.Namespace.defineWithParent(null,null,{UniformGroupBase:WinJS.Namespace._lazy(function(){return WinJS.Class.define(null,{cleanUp:function(){},itemFromOffset:function(a,b){b=b||{};var c=this._layout._sizes;a-=c.itemsContainerOuterStart,b.wholeItem&&(a+=(b.last?-1:1)*(c.containerSize-1));var d=this.count-1,f=Math.floor(d/this._layout._itemsPerBar),g=e(0,f,Math.floor(a/c.containerSize)),h=(g+b.last)*this._layout._itemsPerBar-b.last;return e(0,this.count-1,h)},hitTest:function(a,b){var c=this._layout._horizontal,d=this._layout._itemsPerBar,f=this._layout._inListMode||1===d,g=c?a:b,h=c?b:a,i=this._layout._sizes;g-=i.itemsContainerOuterStart,h-=i.itemsContainerOuterCrossStart;var j,k=Math.floor(g/i.containerSize),l=e(0,d-1,Math.floor(h/i.containerCrossSize)),m=Math.max(-1,k*d+l);if(j=!c&&f||c&&!f?(b-i.containerHeight/2)/i.containerHeight:(a-i.containerWidth/2)/i.containerWidth,f)return j=Math.floor(j),{index:m,insertAfterIndex:j>=0&&m>=0?j:-1};j=e(-1,d-1,j);var n;return n=0>j?k*d-1:k*d+Math.floor(j),{index:e(-1,this.count-1,m),insertAfterIndex:e(-1,this.count-1,n)}},getAdjacent:function(a,b){var c,d=a.index,e=Math.floor(d/this._layout._itemsPerBar),f=d%this._layout._itemsPerBar;switch(b){case r.upArrow:c=0===f?"boundary":d-1;break;case r.downArrow:var g=d===this.count-1,h=this._layout._itemsPerBar>1&&f===this._layout._itemsPerBar-1;c=g||h?"boundary":d+1;break;case r.leftArrow:c=0===e&&this._layout._itemsPerBar>1?"boundary":d-this._layout._itemsPerBar;break;case r.rightArrow:var i=this.count-1,j=Math.floor(i/this._layout._itemsPerBar);c=e===j?"boundary":Math.min(d+this._layout._itemsPerBar,this.count-1)}return"boundary"===c?c:{type:WinJS.UI.ObjectType.item,index:c}},getItemsContainerSize:function(){var a=this._layout._sizes,b=Math.ceil(this.count/this._layout._itemsPerBar);return b*a.containerSize+a.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var a=this._layout._sizes;return this._layout._itemsPerBar*a.containerCrossSize+a.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(a){var b=this._layout._sizes,c=this._layout._site.rtl?"right":"left",d=this._layout._sizes.containerMargins,e=this._layout._indexToCoordinate(a),f={row:e.row,column:e.column,top:d.top+e.row*b.containerHeight,left:d[c]+e.column*b.containerWidth,height:b.containerHeight-b.containerMargins.top-b.containerMargins.bottom,width:b.containerWidth-b.containerMargins.left-b.containerMargins.right};return f}})}),UniformGroup:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(E.UniformGroupBase,function(a,b){this._layout=a,this._itemsContainer=b,q.addClass(this._itemsContainer,a._inListMode?WinJS.UI._uniformListLayoutClass:WinJS.UI._uniformGridLayoutClass)},{cleanUp:function(a){a||(q.removeClass(this._itemsContainer,WinJS.UI._uniformGridLayoutClass),q.removeClass(this._itemsContainer,WinJS.UI._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(a,b,c,d){return this.groupInfo=d.groupInfo,this.startIndex=d.startIndex,this.count=a,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var a=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-a.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?a.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*a.containerCrossSize+"px"},layoutUnrealizedRange:function(){return WinJS.Promise.wrap()}})}),UniformFlowGroup:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(E.UniformGroupBase,function(a,b){this._layout=a,this._itemsContainer=b.element,q.addClass(this._itemsContainer,a._inListMode?WinJS.UI._uniformListLayoutClass:WinJS.UI._uniformGridLayoutClass)},{cleanUp:function(a){a||(q.removeClass(this._itemsContainer,WinJS.UI._uniformListLayoutClass),q.removeClass(this._itemsContainer,WinJS.UI._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a,b){this._layout=a,this._itemsContainer=b,q.addClass(this._itemsContainer,WinJS.UI._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(a){a||(this._cleanContainers(),q.removeClass(this._itemsContainer,WinJS.UI._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(a,b,c,d){var e,f=this;if(this._containersToHide={},b)for(e=b.firstIndex;e<=b.lastIndex;e++)this._containersToHide[t(c._items[e])]=c._items[e];this.groupInfo=d.groupInfo,this.startIndex=d.startIndex,this.count=a.items.length,this._items=a.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var g=new Array(this.count);for(e=0;e<this.count;e++)g[e]=this._layout._getItemInfo(this.startIndex+e);return WinJS.Promise.join(g).then(function(a){a.forEach(function(a,b){f.addItemToMap(b,a)})})},layoutRealizedRange:function(a,b){if(b){var c,d=Math.max(a,b.firstIndex);for(c=d;c<=b.lastIndex;c++)this._layoutItem(c),delete this._containersToHide[t(this._items[c])]}Object.keys(this._containersToHide).forEach(function(a){WinJS.Utilities.removeClass(this._containersToHide[a],WinJS.UI._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(a,b,c){var d,e=this;return e._layoutPromise=new WinJS.Promise(function(f){function g(){d=null,f()}function h(a){return s.schedule(a,s.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(b){var i=!1,j=b.firstIndex-1,k=Math.max(a,b.lastIndex+1);k=Math.max(j+1,k),d=h(function m(b){for(;!i;){if(b.shouldYield)return void b.setWork(m);i=!0,j>=a&&(e._layoutItem(j),j--,i=!1),k<e.count&&(e._layoutItem(k),k++,i=!1)}g()})}else if(c){var l=e.count-1;d=h(function n(b){for(;l>=a;l--){if(b.shouldYield)return void b.setWork(n);e._layoutItem(l)}g()})}else{var l=a;d=h(function o(a){for(;l<e.count;l++){if(a.shouldYield)return void a.setWork(o);e._layoutItem(l)}g()})}},function(){d&&d.cancel(),d=null}),e._layoutPromise},itemFromOffset:function(a,b){b=b||{};var c=this._layout._sizes,d=c.containerMargins;a-=c.itemsContainerOuterX,a-=(b.last?1:-1)*d[b.last?"left":"right"];var f=this.indexFromOffset(a,b.wholeItem,b.last).item;return e(0,this.count-1,f)},getAdjacent:function(a,b){var c,d;c=d=a.index;var e,f,g;g=this.lastAdjacent===c?this.lastInMapIndex:this.findItem(c);do{var h=Math.floor(g/this._slotsPerColumn),i=g-h*this._slotsPerColumn,j=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(b){case r.upArrow:if(!(i>0))return{type:WinJS.UI.ObjectType.item,index:d};g--;break;case r.downArrow:if(!(i+1<this._slotsPerColumn))return{type:WinJS.UI.ObjectType.item,index:d};g++;break;case r.leftArrow:g=h>0?g-this._slotsPerColumn:-1;break;case r.rightArrow:g=j>h?g+this._slotsPerColumn:this.occupancyMap.length}f=g>=0&&g<this.occupancyMap.length,f&&(e=this.occupancyMap[g]?this.occupancyMap[g].index:void 0)}while(f&&(c===e||void 0===e));return this.lastAdjacent=e,this.lastInMapIndex=g,f?{type:WinJS.UI.ObjectType.item,index:e}:"boundary"},hitTest:function(a,b){var c=this._layout._sizes,d=0;if(a-=c.itemsContainerOuterX,b-=c.itemsContainerOuterY,this.occupancyMap.length>0){for(var f=this.indexFromOffset(a,!1,0),g=Math.min(this._slotsPerColumn-1,Math.floor(b/this.groupInfo.cellHeight)),h=f.index,i=h;g-->0;)h++,this.occupancyMap[h]&&(i=h);this.occupancyMap[i]||i--,d=this.occupancyMap[i].index}var j=this.getItemSize(d),k=j.column*this.groupInfo.cellWidth,l=j.row*this.groupInfo.cellHeight,m=1===this._slotsPerColumn,n=d;return(m&&a<k+j.contentWidth/2||!m&&b<l+j.contentHeight/2)&&n--,{type:WinJS.UI.ObjectType.item,index:e(0,this.count-1,d),insertAfterIndex:e(-1,this.count-1,n)}},getItemsContainerSize:function(){var a=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+a.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var a=this._layout._sizes;return a.maxItemsContainerContentSize+a.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(a){var b=(this._layout._sizes,this._layout._site.rtl?"right":"left"),c=this._layout._sizes.containerMargins,d=this.getItemSize(a),e=this.groupInfo,f={row:d.row,column:d.column,top:c.top+d.row*e.cellHeight,left:c[b]+d.column*e.cellWidth,height:d.contentHeight,width:d.contentWidth};return f},_layoutItem:function(a){var b=(this.groupInfo,this._layout._sizes.containerMargins,this.getItemSize(a));return this._items[a].style.cssText+=";-ms-grid-row:"+(b.row+1)+";-ms-grid-column:"+(b.column+1)+";-ms-grid-row-span:"+b.rows+";-ms-grid-column-span:"+b.columns+";height:"+b.contentHeight+"px;width:"+b.contentWidth+"px",q.addClass(this._items[a],WinJS.UI._laidOutClass),this._items[a]},_cleanContainers:function(){var a,b=this._items,c=b.length;for(a=0;c>a;a++)b[a].style.cssText="",q.removeClass(b[a],WinJS.UI._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var a=-1;return this.occupancyMap.forEach(function(b){b.index>a&&(a=b.index)}),a+1},coordinateToIndex:function(a,b){return a*this._slotsPerColumn+b},markSlotAsFull:function(a,b){for(var c=this._layout._indexToCoordinate(a,this._slotsPerColumn),d=c.row+b.rows,e=c.row;d>e&&e<this._slotsPerColumn;e++)for(var f=c.column,g=c.column+b.columns;g>f;f++)this.occupancyMap[this.coordinateToIndex(f,e)]=b;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,d-this._slotsPerColumn)},isSlotEmpty:function(a,b,c){for(var d=b,e=b+a.rows;e>d;d++)for(var f=c,g=c+a.columns;g>f;f++)if(d>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(f,d)])return!1;return!0},findEmptySlot:function(a,b,c){var d=this._layout._indexToCoordinate(a,this._slotsPerColumn),e=d.row,f=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(c){for(var g=d.column+1;f>=g;g++)if(this.isSlotEmpty(b,0,g))return this.coordinateToIndex(g,0)}else for(var g=d.column;f>=g;g++){for(var h=e;h<this._slotsPerColumn;h++)if(this.isSlotEmpty(b,h,g))return this.coordinateToIndex(g,h);e=0}return(f+1)*this._slotsPerColumn},findItem:function(a){for(var b=a,c=this.occupancyMap.length;c>b;b++){var d=this.occupancyMap[b];if(d&&d.index===a)return b}return b},getItemSize:function(a){var b=this.findItem(a),c=this.occupancyMap[b],d=this._layout._indexToCoordinate(b,this._slotsPerColumn);return a===c.index?{row:d.row,column:d.column,contentWidth:c.contentWidth,contentHeight:c.contentHeight,columns:c.columns,rows:c.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(a,b){function c(a,b){var c=d.findEmptySlot(d.lastAdded,a,b);d.lastAdded=c,d.markSlotAsFull(c,a)}var d=this,e=d.groupInfo,f=d._layout._sizes.containerMargins,g={index:a,contentWidth:b.width,contentHeight:b.height,columns:Math.max(1,Math.ceil((b.width+f.left+f.right)/e.cellWidth)),rows:Math.max(1,Math.ceil((b.height+f.top+f.bottom)/e.cellHeight))};c(g,b.newColumn)},indexFromOffset:function(a,b,c){var d=0,e=0,f=this.groupInfo,g=0;if(this.occupancyMap.length>0){if(e=this.getOccupancyMapItemCount()-1,d=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*f.cellWidth,d>a){for(var h=this._slotsPerColumn,g=(Math.max(0,Math.floor(a/f.cellWidth))+c)*this._slotsPerColumn-c;!this.occupancyMap[g]&&h-->0;)g+=c>0?-1:1;return{index:g,item:this.occupancyMap[g].index}}g=this.occupancyMap.length-1}return{index:g,item:e+(Math.max(0,Math.floor((a-d)/f.cellWidth))+c)*this._slotsPerColumn-c}}})})});WinJS.Namespace.define("WinJS.UI",{ListLayout:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._LegacyLayout,function(a){a=a||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=a.groupHeaderPosition||WinJS.UI.HeaderPosition.top,this._inListMode=!0,this.orientation=a.orientation||"vertical"},{initialize:function(a,b){q.addClass(a.surface,WinJS.UI._listLayoutClass),WinJS.UI._LegacyLayout.prototype.initialize.call(this,a,b)},uninitialize:function(){this._site&&q.removeClass(this._site.surface,WinJS.UI._listLayoutClass),WinJS.UI._LegacyLayout.prototype.uninitialize.call(this)},layout:function(a,b,c,d){return this._groupsEnabled||this._horizontal?WinJS.UI._LegacyLayout.prototype.layout.call(this,a,b,c,d):this._layoutNonGroupedVerticalList(a,b,c,d)},_layoutNonGroupedVerticalList:function(a,b,c,d){var e=this,f="Layout:_layoutNonGroupedVerticalList";return e._site._writeProfilerMark(f+",StartTM"),this._layoutPromise=e._measureItem(0).then(function(){WinJS.Utilities[e._usingStructuralNodes?"addClass":"removeClass"](e._site.surface,WinJS.UI._structuralNodesClass),e._sizes.viewportContentSize!==e._getViewportCrossSize()&&e._viewportSizeChanged(e._getViewportCrossSize()),e._cacheRemovedElements(c,e._cachedItemRecords,e._cachedInsertedItemRecords,e._cachedRemovedItems,!1),e._cacheRemovedElements(d,e._cachedHeaderRecords,e._cachedInsertedHeaderRecords,e._cachedRemovedHeaders,!0);var b=a[0].itemsContainer,g=new E.UniformFlowGroup(e,b);e._groups=[g],g.groupInfo={enableCellSpanning:!1},g.startIndex=0,g.count=m(b),g.offset=0,g.layout(),e._site._writeProfilerMark(f+":setSurfaceWidth,info"),e._site.surface.style.width=e._sizes.surfaceContentSize+"px",e._layoutAnimations(c,d),e._site._writeProfilerMark(f+":complete,info"),e._site._writeProfilerMark(f+",StopTM")},function(a){return e._site._writeProfilerMark(f+":canceled,info"),e._site._writeProfilerMark(f+",StopTM"),WinJS.Promise.wrapError(a)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){return this._usingStructuralNodes=WinJS.UI.ListLayout._numberOfItemsPerItemsBlock>0,this._measureItem(0).then(function(){return WinJS.UI.ListLayout._numberOfItemsPerItemsBlock})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:WinJS.Namespace._lazy(function(){return WinJS.Class.derive(WinJS.UI._LayoutCommon,function(a){a=a||{},this._itemInfo=a.itemInfo,this._groupInfo=a.groupInfo,this._groupHeaderPosition=a.groupHeaderPosition||WinJS.UI.HeaderPosition.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(a){this._setMaxRowsOrColumns(a)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(a){this._itemInfo=a,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(a){this._groupInfo=a,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a){this.defaultAnimations=!0,this.initialize=function(b,c){a.initialize(b,c)},this.hitTest=function(b,c){return a.hitTest(b,c)},a.uninitialize&&(this.uninitialize=function(){a.uninitialize()}),"numberOfItemsPerItemsBlock"in a&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return a.numberOfItemsPerItemsBlock}}),a._getItemPosition&&(this._getItemPosition=function(b){return a._getItemPosition(b)}),a.itemsFromRange&&(this.itemsFromRange=function(b,c){return a.itemsFromRange(b,c)}),a.getAdjacent&&(this.getAdjacent=function(b,c){return a.getAdjacent(b,c)}),a.dragOver&&(this.dragOver=function(b,c,d){return a.dragOver(b,c,d)}),a.dragLeave&&(this.dragLeave=function(){return a.dragLeave()});var b={enumerable:!0,get:function(){return"vertical"}};if(void 0!==a.orientation&&(b.get=function(){return a.orientation},b.set=function(b){a.orientation=b}),Object.defineProperty(this,"orientation",b),(a.setupAnimations||a.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return a.setupAnimations()},this.executeAnimations=function(){return a.executeAnimations()}),a.layout)if(this.defaultAnimations){var c=this;this.layout=function(b,d,e,f){var g,h=o(a.layout(b,d,[],[]));return h.realizedRangeComplete.then(function(){g=!0}),g&&c._layoutAnimations(e,f),h}}else this.layout=function(b,c,d,e){return o(a.layout(b,c,d,e))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(a,b,c,d){return this.defaultAnimations&&this._layoutAnimations(c,d),o()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(a,b){var c=WinJS.Utilities.Key;switch(b){case c.pageUp:case c.upArrow:case c.leftArrow:return{type:a.type,index:a.index-1};case c.downArrow:case c.rightArrow:case c.pageDown:return{type:a.type,index:a.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})}),WinJS.Namespace.define("WinJS.UI",{HeaderPosition:{left:"left",top:"top"},_getMargins:p})}),b("WinJS/Controls/ListView/_ParallelWorkQueue",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_ParallelWorkQueue:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a){function b(){h--,i||WinJS.Utilities.Scheduler.schedule(c,WinJS.Utilities.Scheduler.Priority.normal,null,"WinJS._ParallelWorkQueue.runNext")}function c(){for(i++;a>h;h++){var c,d;do c=g.shift(),d=c&&f[c];while(c&&!d);if(!d)break;delete f[c];try{d().then(b,b)}catch(e){b()}}i--}function d(a,b,d){var h,i="w"+e++;return new WinJS.Promise(function(e,j,k){var l=function(){return h=a().then(e,j,k)};l.data=b,f[i]=l,d?g.unshift(i):g.push(i),c()},function(){delete f[i],h&&h.cancel()})}var e=0,f={},g=[];a=a||3;var h=0,i=0;this.sort=function(a){g.sort(function(b,c){return b=f[b],c=f[c],void 0===b&&void 0===c?0:void 0===b?1:void 0===c?-1:a(b.data,c.data)})},this.queue=d},{},{supportedForProcessing:!1})})})}),b("WinJS/Controls/ListView/_SelectionManager",[],function(){"use strict";var a=(WinJS.Utilities,WinJS.Promise);WinJS.Namespace.define("WinJS.UI",{_ItemSet:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(a,b,c){this._listView=a,this._ranges=b,this._itemsCount=c});return a.prototype={getRanges:function(){for(var a=[],b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];a.push({firstIndex:d.firstIndex,lastIndex:d.lastIndex,firstKey:d.firstKey,lastKey:d.lastKey})}return a},getItems:function(){return WinJS.UI.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var a=0,b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];a+=d.lastIndex-d.firstIndex+1}return a},getIndices:function(){for(var a=[],b=0,c=this._ranges.length;c>b;b++)for(var d=this._ranges[b],e=d.firstIndex;e<=d.lastIndex;e++)a.push(e);return a}},a}),getItemsFromRanges:function(b,c){function d(){for(var b=[],d=0,e=c.length;e>d;d++)for(var f=c[d],g=f.firstIndex;g<=f.lastIndex;g++)b.push(g);return a.wrap(b)}var e=b.createListBinding(),f=[];return d().then(function(a){for(var b=0;b<a.length;b++)f.push(e.fromIndex(a[b]));return WinJS.Promise.join(f).then(function(a){return e.release(),a})})},_Selection:WinJS.Namespace._lazy(function(){function b(a){return a&&0===a.firstIndex&&a.lastIndex===Number.MAX_VALUE}return WinJS.Class.derive(WinJS.UI._ItemSet,function(a,b){this._listView=a,this._itemsCount=-1,this._ranges=[],b&&this.set(b)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],a.wrap()},set:function(a){if(b(a))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var c=this;return this._execute("_set",a).then(function(){return c._ranges.sort(function(a,b){return a.firstIndex-b.firstIndex}),c._ensureKeys()}).then(function(){return c._ensureCount()})},add:function(a){if(b(a))return this.selectAll();var c=this;return this._execute("_add",a).then(function(){return c._ensureKeys()}).then(function(){return c._ensureCount()})},remove:function(a){var b=this;return this._execute("_remove",a).then(function(){return b._ensureKeys()})},selectAll:function(){var a=this;return a._ensureCount().then(function(){if(a._itemsCount){var b={firstIndex:0,lastIndex:a._itemsCount-1};return a._retainRange(b),a._releaseRanges(a._ranges),a._ranges=[b],a._ensureKeys()}})},_execute:function(b,c){function d(a,b,c){var d={};return d["first"+a]=b,d["last"+a]=c,d}function e(c){var d=f._getListBinding(),e=a.join([d.fromKey(c.firstKey),d.fromKey(c.lastKey)]).then(function(a){return a[0]&&a[1]&&(c.firstIndex=a[0].index,c.lastIndex=a[1].index,f[b](c)),c});i.push(e)}for(var f=this,g=!!f._getListBinding().fromKey,h=Array.isArray(c)?c:[c],i=[a.wrap()],j=0,k=h.length;k>j;j++){var l=h[j];"number"==typeof l?this[b](d("Index",l,l)):l&&(g&&void 0!==l.key?e(d("Key",l.key,l.key)):g&&void 0!==l.firstKey&&void 0!==l.lastKey?e(d("Key",l.firstKey,l.lastKey)):void 0!==l.index&&"number"==typeof l.index?this[b](d("Index",l.index,l.index)):void 0!==l.firstIndex&&void 0!==l.lastIndex&&"number"==typeof l.firstIndex&&"number"==typeof l.lastIndex&&this[b](d("Index",l.firstIndex,l.lastIndex)))}return a.join(i)},_set:function(a){this._retainRange(a),this._ranges.push(a)},_add:function(a){for(var b,c,d=this,e=null,f=function(a,b){b.lastIndex>a.lastIndex&&(a.lastIndex=b.lastIndex,a.lastKey=b.lastKey,a.lastPromise&&a.lastPromise.release(),a.lastPromise=d._getListBinding().fromIndex(a.lastIndex).retain())},g=0,h=this._ranges.length;h>g;g++){if(b=this._ranges[g],a.firstIndex<b.firstIndex){var i=e&&a.firstIndex<e.lastIndex+1;i?(c=g-1,f(e,a)):(this._insertRange(g,a),c=g);break}if(a.firstIndex===b.firstIndex){f(b,a),c=g;break}e=b}if(void 0===c){var j=this._ranges.length?this._ranges[this._ranges.length-1]:null,k=j&&a.firstIndex<j.lastIndex+1;k?f(j,a):(this._retainRange(a),this._ranges.push(a))}else{for(e=null,g=c+1,h=this._ranges.length;h>g;g++){if(b=this._ranges[g],a.lastIndex<b.firstIndex){i=e&&e.lastIndex>a.lastIndex,i&&f(this._ranges[c],e),this._removeRanges(c+1,g-c-1);break}if(a.lastIndex===b.firstIndex){f(this._ranges[c],b),this._removeRanges(c+1,g-c);break}e=b}g>=h&&(f(this._ranges[c],this._ranges[h-1]),this._removeRanges(c+1,h-c-1))}},_remove:function(a){function b(a){return c._getListBinding().fromIndex(a).retain()}for(var c=this,d=[],e=0,f=this._ranges.length;f>e;e++){var g=this._ranges[e];g.lastIndex<a.firstIndex||g.firstIndex>a.lastIndex?d.push(g):g.firstIndex<a.firstIndex&&g.lastIndex>=a.firstIndex&&g.lastIndex<=a.lastIndex?(d.push({firstIndex:g.firstIndex,firstKey:g.firstKey,firstPromise:g.firstPromise,lastIndex:a.firstIndex-1,lastPromise:b(a.firstIndex-1)}),g.lastPromise.release()):g.lastIndex>a.lastIndex&&g.firstIndex>=a.firstIndex&&g.firstIndex<=a.lastIndex?(d.push({firstIndex:a.lastIndex+1,firstPromise:b(a.lastIndex+1),lastIndex:g.lastIndex,lastKey:g.lastKey,lastPromise:g.lastPromise}),g.firstPromise.release()):g.firstIndex<a.firstIndex&&g.lastIndex>a.lastIndex?(d.push({firstIndex:g.firstIndex,firstKey:g.firstKey,firstPromise:g.firstPromise,lastIndex:a.firstIndex-1,lastPromise:b(a.firstIndex-1)}),d.push({firstIndex:a.lastIndex+1,firstPromise:b(a.lastIndex+1),lastIndex:g.lastIndex,lastKey:g.lastKey,lastPromise:g.lastPromise})):(g.firstPromise.release(),g.lastPromise.release())}this._ranges=d},_ensureKeys:function(){for(var b=[a.wrap()],c=this,d=function(b,c){var d=b+"Key";if(c[d])return a.wrap();var e=c[b+"Promise"];return e.then(function(a){a&&(c[d]=a.key)}),e},e=0,f=this._ranges.length;f>e;e++){var g=this._ranges[e];b.push(d("first",g)),b.push(d("last",g))}return a.join(b).then(function(){c._ranges=c._ranges.filter(function(a){return a.firstKey&&a.lastKey})}),a.join(b)},_mergeRanges:function(a,b){a.lastIndex=b.lastIndex,a.lastKey=b.lastKey},_isIncluded:function(a){if(this.isEverything())return!0;for(var b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];if(d.firstIndex<=a&&a<=d.lastIndex)return!0}return!1},_ensureCount:function(){var a=this;return this._listView._itemsCount().then(function(b){a._itemsCount=b})},_insertRange:function(a,b){this._retainRange(b),this._ranges.splice(a,0,b)},_removeRanges:function(a,b){for(var c=0;b>c;c++)this._releaseRange(this._ranges[a+c]);this._ranges.splice(a,b)},_retainRange:function(a){a.firstPromise||(a.firstPromise=this._getListBinding().fromIndex(a.firstIndex).retain()),a.lastPromise||(a.lastPromise=this._getListBinding().fromIndex(a.lastIndex).retain())},_retainRanges:function(){for(var a=0,b=this._ranges.length;b>a;a++)this._retainRange(this._ranges[a])},_releaseRange:function(a){a.firstPromise.release(),a.lastPromise.release()},_releaseRanges:function(a){for(var b=0,c=a.length;c>b;++b)this._releaseRange(a[b])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:WinJS.Namespace._lazy(function(){var b=function(b){this._listView=b,this._selected=new WinJS.UI._Selection(this._listView),this._pivot=WinJS.UI._INVALID_INDEX,this._focused={type:WinJS.UI.ObjectType.item,index:0},this._pendingChange=a.wrap()};return b.prototype={count:function(){return this._selected.count()
},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(a){var b=this,c=new WinJS._Signal;return this._synchronize(c).then(function(){var d=new WinJS.UI._Selection(b._listView);return d.set(a).then(function(){b._set(d),c.complete()},function(a){return d.clear(),c.complete(),WinJS.Promise.wrapError(a)})})},clear:function(){var a=this,b=new WinJS._Signal;return this._synchronize(b).then(function(){var c=new WinJS.UI._Selection(a._listView);return c.clear().then(function(){a._set(c),b.complete()},function(a){return c.clear(),b.complete(),WinJS.Promise.wrapError(a)})})},add:function(a){var b=this,c=new WinJS._Signal;return this._synchronize(c).then(function(){var d=b._cloneSelection();return d.add(a).then(function(){b._set(d),c.complete()},function(a){return d.clear(),c.complete(),WinJS.Promise.wrapError(a)})})},remove:function(a){var b=this,c=new WinJS._Signal;return this._synchronize(c).then(function(){var d=b._cloneSelection();return d.remove(a).then(function(){b._set(d),c.complete()},function(a){return d.clear(),c.complete(),WinJS.Promise.wrapError(a)})})},selectAll:function(){var a=this,b=new WinJS._Signal;return this._synchronize(b).then(function(){var c=new WinJS.UI._Selection(a._listView);return c.selectAll().then(function(){a._set(c),b.complete()},function(a){return c.clear(),b.complete(),WinJS.Promise.wrapError(a)})})},_synchronize:function(a){var b=this;return this._listView._versionManager.unlocked.then(function(){var c=b._pendingChange;return b._pendingChange=WinJS.Promise.join([c,a.promise]).then(function(){}),c})},_reset:function(){this._pivot=WinJS.UI._INVALID_INDEX,this._setFocused({type:WinJS.UI.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=a.wrap(),this._selected.clear(),this._selected=new WinJS.UI._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(a){var b=this;return this._fireSelectionChanging(a).then(function(c){return c?(b._selected.clear(),b._selected=a,b._listView._updateSelection(),b._fireSelectionChanged()):a.clear(),c})},_fireSelectionChanging:function(b){var c=document.createEvent("CustomEvent"),d=a.wrap();c.initCustomEvent("selectionchanging",!0,!0,{newSelection:b,preventTapBehavior:function(){},setPromise:function(a){d=a}});var e=this._listView._element.dispatchEvent(c);return d.then(function(){return e})},_fireSelectionChanged:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(a)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(a,b){this._focused={type:a.type,index:a.index},this._focusedByKeyboard=b},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(a){this._selected._itemsCount=a},_isIncluded:function(a){return this._selected._isIncluded(a)},_cloneSelection:function(){var a=new WinJS.UI._Selection(this._listView);return a._ranges=this._selected.getRanges(),a._itemsCount=this._selected._itemsCount,a._retainRanges(),a}},b.supportedForProcessing=!1,b})})}),b("WinJS/Controls/ListView/_StorageDataSource",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{StorageDataSource:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(a,b){WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:constructor,StartTM");var c,d=Windows.Storage.FileProperties.ThumbnailMode.singleItem,e=256,f=Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,g=!0;if("Pictures"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.picturesView,c=Windows.Storage.KnownFolders.picturesLibrary,e=190):"Music"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.musicView,c=Windows.Storage.KnownFolders.musicLibrary,e=256):"Documents"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.documentsView,c=Windows.Storage.KnownFolders.documentsLibrary,e=40):"Videos"===a&&(d=Windows.Storage.FileProperties.ThumbnailMode.videosView,c=Windows.Storage.KnownFolders.videosLibrary,e=190),c){var h=new Windows.Storage.Search.QueryOptions;h.folderDepth=Windows.Storage.Search.FolderDepth.deep,h.indexerOption=Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=c.createFileQueryWithOptions(h)}else this._query=a;if(b){if("number"==typeof b.mode&&(d=b.mode),"number"==typeof b.requestedThumbnailSize)e=Math.max(1,Math.min(b.requestedThumbnailSize,1024));else switch(d){case Windows.Storage.FileProperties.ThumbnailMode.picturesView:case Windows.Storage.FileProperties.ThumbnailMode.videosView:e=190;break;case Windows.Storage.FileProperties.ThumbnailMode.documentsView:case Windows.Storage.FileProperties.ThumbnailMode.listView:e=40;break;case Windows.Storage.FileProperties.ThumbnailMode.musicView:case Windows.Storage.FileProperties.ThumbnailMode.singleItem:e=256}"number"==typeof b.thumbnailOptions&&(f=b.thumbnailOptions),"boolean"==typeof b.waitForFileLoad&&(g=!b.waitForFileLoad)}this._loader=new Windows.Storage.BulkAccess.FileInformationFactory(this._query,d,e,f,g),this.compareByIdentity=!1,this.firstDataRequest=!0,WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(a){this._notificationHandler=a,this._query.addEventListener("contentschanged",function(){a.invalidateAll()}),this._query.addEventListener("optionschanged",function(){a.invalidateAll()})},itemsFromEnd:function(a){var b=this;return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(c){return 0===c?WinJS.Promise.wrapError(new WinJS.ErrorFromName(WinJS.UI.FetchError.doesNotExist)):b.itemsFromIndex(c-1,Math.min(c-1,a-1),1)})},itemsFromIndex:function(a,b,c){function d(a){g._notificationHandler.changed(g._item(a.target))}b+c>64&&(b=Math.min(b,32),c=64-(b+1));var e=a-b,f=b+1+c,g=this;g.firstDataRequest&&(g.firstDataRequest=!1,f=Math.max(f,32));var h="WinJS.UI.StorageDataSource:itemsFromIndex("+e+"-"+(e+f-1)+")";return WinJS.Utilities._writeProfilerMark(h+",StartTM"),this._loader.getItemsAsync(e,f).then(function(c){var i=c.size;if(b>=i)return WinJS.Promise.wrapError(new WinJS.ErrorFromName(WinJS.UI.FetchError.doesNotExist));var j=new Array(i),k=new Array(i);c.getMany(0,k);for(var l=0;i>l;l++)j[l]=g._item(k[l]),k[l].addEventListener("propertiesupdated",d);var m={items:j,offset:b,absoluteIndex:a};return f>i&&(m.totalCount=e+i),WinJS.Utilities._writeProfilerMark(h+",StopTM"),m})},itemsFromDescription:function(a,b,c){var d=this;return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(a).then(function(a){return d.itemsFromIndex(a,b,c)})},getCount:function(){return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(a){return a.folderRelativeId},_item:function(a){return{key:a.path||a.folderRelativeId,data:a}}},{supportedForProcessing:!1});return WinJS.Class.derive(WinJS.UI.VirtualizedDataSource,function(b,c){this._baseDataSourceConstructor(new a(b,c))},{},{loadThumbnail:function(a,b){var c,d,e=!1;return new WinJS.Promise(function(f){var g=b?!0:!1,h=function(h){if(h){var i=URL.createObjectURL(h,{oneTimeOnly:!0});d=d?d.then(function(b){return a.loadImage(i,b)}):a.loadImage(i,b).then(function(b){return a.isOnScreen().then(function(a){var c;return a&&g?c=WinJS.UI.Animation.fadeIn(b).then(function(){return b}):(b.style.opacity=1,c=WinJS.Promise.wrap(b)),c})}),h.type==Windows.Storage.FileProperties.ThumbnailType.icon||h.returnedSmallerCachedSize||(WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),a.data.removeEventListener("thumbnailupdated",c),e=!1,d=d.then(function(a){c=null,d=null,f(a)}))}};c=function(a){e&&h(a.target.thumbnail)},a.data.addEventListener("thumbnailupdated",c),e=!0,h(a.data.thumbnail)},function(){a.data.removeEventListener("thumbnailupdated",c),e=!1,c=null,d&&(d.cancel(),d=null)})},supportedForProcessing:!1})})})}),b("WinJS/Controls/ListView/_VersionManager",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_VersionManager:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(){this._unlocked=new WinJS._Signal,this._unlocked.complete()},{_cancelCount:0,_notificationCount:0,_updateCount:0,_version:0,locked:{get:function(){return 0!==this._notificationCount||0!==this._updateCount}},noOutstandingNotifications:{get:function(){return 0===this._notificationCount}},version:{get:function(){return this._version}},unlocked:{get:function(){return this._unlocked.promise}},_dispose:function(){this._unlocked&&(this._unlocked.cancel(),this._unlocked=null)},beginUpdating:function(){this._checkLocked(),this._updateCount++},endUpdating:function(){this._updateCount--,this._checkUnlocked()},beginNotifications:function(){this._checkLocked(),this._notificationCount++},endNotifications:function(){this._notificationCount--,this._checkUnlocked()},_checkLocked:function(){this.locked||(this._dispose(),this._unlocked=new WinJS._Signal)},_checkUnlocked:function(){this.locked||this._unlocked.complete()},receivedNotification:function(){if(this._version++,this._cancel){var a=this._cancel;this._cancel=null,a.forEach(function(a){a&&a.cancel()})}},cancelOnNotification:function(a){return this._cancel||(this._cancel=[],this._cancelCount=0),this._cancel[this._cancelCount++]=a,this._cancelCount-1},clearCancelOnNotification:function(a){this._cancel&&delete this._cancel[a]}},{supportedForProcessing:!1})})})}),b("WinJS/Controls/ListView/_VirtualizeContentsView",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_VirtualizeContentsView:WinJS.Namespace._lazy(function(){function a(b){for(var c,d=b.job._workItems;d.length&&!b.shouldYield;)(c=d.shift())();b.setWork(a),d.length||b.job.pause()}function b(b,c){var d=i.schedule(a,b,null,c);return d._workItems=[],d.addWork=function(a,b){b?this._workItems.unshift(a):this._workItems.push(a),this.resume()},d.clearWork=function(){this._workItems.length=0},d.dispose=function(){this.cancel(),this._workItems.length=0},d}function c(a){return a._zooming||a._pinching}function d(a,b){return a._isZombie()?h.wrap():c(a)?(+b!==b&&(b=WinJS.UI._VirtualizeContentsView._waitForSeZoTimeoutDuration),h.timeout(WinJS.UI._VirtualizeContentsView._waitForSeZoIntervalDuration).then(function(){return b-=WinJS.UI._VirtualizeContentsView._waitForSeZoIntervalDuration,0>=b?!0:d(a,b)})):h.wrap()}function e(a){if("number"==typeof a){var b=a;a=function(){return{position:b,direction:"right"}}}return a}function f(){}var g=WinJS.Utilities,h=WinJS.Promise,i=WinJS.Utilities.Scheduler,j=function(a){this._listView=a,this._forceRelayout=!1,this.items=new WinJS.UI._ItemsContainer(a),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=h.wrap(),this._state=new k(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=b(i.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=b(i.Priority.normal,"front off-screen items"),this._backOffscreenJob=b(i.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=e(0)};j._pagesToPrefetch=2,j._waitForSeZoIntervalDuration=100,j._waitForSeZoTimeoutDuration=500,j._chunkSize=500,j._startupChunkSize=100,j._maxTimePerCreateContainers=5,j._createContainersJobTimeslice=15,j._blocksToRelease=10,j._realizationLevel={skip:"skip",realize:"realize",normal:"normal"},j.prototype={_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(a,b,c,d){this._listView._writeProfilerMark("createItem("+a+") "+this._getBoundingRectString(a)+",info");var e=this;e._listView._itemsManager._itemFromItemPromiseThrottled(b).done(function(b){b?c(a,b,e._listView._itemsManager._recordFromElement(b)):d(a)},function(b){return d(a),WinJS.Promise.wrapError(b)})},_addItem:function(a,b,c,d){if(this._realizePass===d){var e=this._listView._itemsManager._recordFromElement(c);delete this._pendingItemPromises[e.itemPromise.handle],this.items.setItemAt(b,{itemBox:null,container:null,element:c,detached:!0,itemsManagerRecord:e})}},finalItem:function(){return this.containers?h.wrap(this.containers.length-1):h.cancel},_setSkipRealizationForChange:function(a){a?this._realizationLevel!==WinJS.UI._VirtualizeContentsView._realizationLevel.realize&&(this._realizationLevel=WinJS.UI._VirtualizeContentsView._realizationLevel.skip):this._realizationLevel=WinJS.UI._VirtualizeContentsView._realizationLevel.realize},_realizeItems:function(a,b,c,d,e,f,j,k,l,m){function n(a,b){z.push(WinJS.Promise._cancelBlocker(b.renderComplete)),r(a)}function o(a,b){function c(a,b){!a.updatedSwipeableAttribute&&(D._listView.itemsDraggable||D._listView.itemsReorderable||D._listView._swipeable)&&a.itemsManagerRecord.renderComplete.done(function(){if(D._realizePass===e){var c=g.hasClass(b,WinJS.UI._nonDraggableClass),d=g.hasClass(b,WinJS.UI._nonSelectableClass),f=D._listView.itemsDraggable||D._listView.itemsReorderable,h=D._listView._selectionAllowed()&&D._listView._swipeBehavior===WinJS.UI.SwipeBehavior.select;f&&!c&&(a.itemBox.draggable=!0),D._listView._swipeable&&(f&&!h&&c||h&&!f&&d||c&&d)&&g.addClass(a.itemBox,WinJS.UI._nonSwipeableClass),a.updatedSwipeableAttribute=!0}})}if(D._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!D._listView._isZombie()){var d,f=0,h=-1,i=-1;for(d=a;b>=d;d++){var k=D.items.itemDataAt(d);if(k){var l=k.element,m=k.itemBox;m||(m=D._listView._itemBoxTemplate.cloneNode(!0),k.itemBox=m,m.appendChild(l),g.addClass(l,WinJS.UI._itemClass),D._listView._setupAriaSelectionObserver(l),D._listView._isSelected(d)&&WinJS.UI._ItemEventsHandler.renderSelection(m,l,!0,!0),D._listView._currentMode().renderDragSourceOnRealizedItem(d,m)),c(k,l,m);var n=D.getContainer(d);m.parentNode!==n&&(D._appendAndRestoreFocus(n,m),f++,0>h&&(h=d),i=d,k.container=n,D._listView._isSelected(d)&&g.addClass(n,WinJS.UI._selectedClass),g.removeClass(n,WinJS.UI._backdropClass),D.items.elementAvailable(d))}}D._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),f>0&&(D._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+f+" ("+h+"-"+i+"),info"),D._reportElementsLevel(j))}}function p(a,b,c,d){function e(a,b){var c=D.items.itemDataAt(a);if(c){var d=c.itemBox;return d&&d.parentNode?b?(g.addClass(d.parentNode,WinJS.UI._backdropClass),d.parentNode.removeChild(d),!0):!1:!0}return!0}if(!m){for(var f=!1;a>=c;)f=e(a,f),a--;for(f=!1;d>=b;)f=e(b,f),b++}}function q(a,b,c,d,f){function g(a){var b=D.items.itemDataAt(a);if(b){var d=b.itemsManagerRecord;d.readyComplete||D._realizePass!==e||c.addWork(function(){D._listView._isZombie()||d.pendingReady&&D._realizePass===e&&(D._listView._writeProfilerMark("pendingReady("+a+"),info"),d.pendingReady())},f)}}for(var i=[],j=a;b>=j;j++){var k=D.items.itemDataAt(j);k&&i.push(k.itemsManagerRecord.itemPromise)}h.join(i).then(function(){if("right"===d)for(var c=a;b>=c;c++)g(c);else for(var c=b;c>=a;c--)g(c)})}function r(a){if(D._realizePass===e){if(a>=k&&l>=a){if(0===--w){if(o(k,l),p(k,l,b,c),D._firstLayoutPass){q(k,l,D._frontOffscreenJob,"right"===j?"left":"right",!0);var d=i.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!D._listView._isZombie()){D._listView._writeProfilerMark("entranceAnimation,StartTM");var a=D._listView._animateListEntrance(!D._firstEntranceAnimated);return D._firstEntranceAnimated=!0,a}});D._runningAnimations=h.join([D._runningAnimations,d]),D._runningAnimations.done(function(){D._listView._writeProfilerMark("entranceAnimation,StopTM"),D._realizePass===e&&(D._runningAnimations=null,A.complete())}),D._firstLayoutPass=!1,D._listView._isCurrentZoomView&&i.requestDrain(D._onscreenJob.priority)}else q(k,l,D._frontOffscreenJob,j),A.complete();D._updateHeaders(D._listView._canvas,k,l+1).done(function(){B.complete()})}}else k>a?(--y,y%v===0&&o(b,k-1),y||(D._updateHeaders(D._listView._canvas,b,k).done(function(){"right"!==j&&C.complete()}),q(b,k-1,"right"!==j?D._frontOffscreenJob:D._backOffscreenJob,"left"))):a>l&&(--x,x%v===0&&o(l+1,c-1),x||(D._updateHeaders(D._listView._canvas,l+1,c).then(function(){"right"===j&&C.complete()}),q(l+1,c-1,"right"===j?D._frontOffscreenJob:D._backOffscreenJob,"right")));u--,0===u&&(D._renderCompletePromise=h.join(z).then(null,function(a){var b=Array.isArray(a)&&a.some(function(a){return a&&!(a instanceof Error&&"Canceled"===a.name)});return b?h.wrapError(a):void 0}),(D._headerRenderPromises||h.wrap()).done(function(){i.schedule(function(){D._listView._isZombie()?I.cancel():I.complete()},Math.min(D._onscreenJob.priority,D._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function s(b,c,d){if(D._realizePass===e){var c=d.element;D._addItem(a,b,c,e),n(b,d)}}var t="_realizeItems("+b+"-"+(c-1)+") visible("+k+"-"+l+")";this._listView._writeProfilerMark(t+",StartTM"),j=j||"right";var u=c-b,v=l-k+1,w=v,x=c-l-1,y=k-b,z=[],A=new WinJS._Signal,B=new WinJS._Signal,C=new WinJS._Signal,D=this;if(u>0){var E=0,F=0,G=0;D.firstIndexDisplayed=k,D.lastIndexDisplayed=l;var H=D._listView._isCurrentZoomView;D._highPriorityRealize&&(D._firstLayoutPass||D._hasAnimationInViewportPending)?(D._highPriorityRealize=!1,D._onscreenJob.priority=i.Priority.high,D._frontOffscreenJob.priority=i.Priority.normal,D._backOffscreenJob.priority=i.Priority.belowNormal):D._highPriorityRealize?(D._highPriorityRealize=!1,D._onscreenJob.priority=i.Priority.high,D._frontOffscreenJob.priority=i.Priority.high-1,D._backOffscreenJob.priority=i.Priority.high-1):H?(D._onscreenJob.priority=i.Priority.aboveNormal,D._frontOffscreenJob.priority=i.Priority.normal,D._backOffscreenJob.priority=i.Priority.belowNormal):(D._onscreenJob.priority=i.Priority.belowNormal,D._frontOffscreenJob.priority=i.Priority.idle,D._backOffscreenJob.priority=i.Priority.idle);var I=new WinJS._Signal,J=D._listView._versionManager.cancelOnNotification(I.promise),K=function(a,b){b.startStage1&&b.stage0.then(function(){D._realizePass===e&&b.startStage1&&a.addWork(b.startStage1)})},L=function(a,b){var c=D.items.itemDataAt(b);if(!c){var d=D._listView._itemsManager._itemPromiseAtIndex(b);D._pendingItemPromises[d.handle]=d,delete D._previousRealizationPendingItemPromises[d.handle],a.addWork(function(){if(!D._listView._isZombie()&&(E++,D._createItem(b,d,s,r),!D._listView._isZombie()&&D._realizePass===e&&d.handle)){var c=D._listView._itemsManager._recordFromHandle(d.handle);K(a,c)}})}},M=function(a,b,c){for(var d=b;c>=d;d++)L(a,d)},N=function(a,b,c){for(var d=c;d>=b;d--)L(a,d)},O=function(a,b,c){for(var d=b;c>=d;d++){var e=D.items.itemDataAt(d);if(e){var f=e.itemsManagerRecord;n(d,f),F++,K(a,f)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var P;"left"===j?(N(D._onscreenJob,k,l),N(D._frontOffscreenJob,b,k-1),P=b>k-1):(M(D._onscreenJob,k,l),M(D._frontOffscreenJob,l+1,c-1),P=l+1>c-1);for(var Q=0,R=Object.keys(this._previousRealizationPendingItemPromises),S=R.length;S>Q;Q++){var T=R[Q];D._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[T])}this._previousRealizationPendingItemPromises={},O(D._onscreenJob,k,l),"left"===j?O(D._frontOffscreenJob,b,k-1):O(D._frontOffscreenJob,l+1,c-1);var U=w===l-k+1;return D._firstLayoutPass?D._listView._canvas.style.opacity=0:U?D._listView._showProgressBar(D._listView._element,"50%","50%"):D._listView._hideProgressBar(),D._frontOffscreenJob.pause(),D._backOffscreenJob.pause(),B.promise.done(function(){D._frontOffscreenJob.resume(),P&&C.complete()},function(){I.cancel()}),C.promise.done(function(){D._listView._writeProfilerMark("frontItemsRealized,info"),"left"===j?(M(D._backOffscreenJob,l+1,c-1),O(D._backOffscreenJob,l+1,c-1)):(N(D._backOffscreenJob,b,k-1),O(D._backOffscreenJob,b,k-1)),D._backOffscreenJob.resume()}),I.promise.done(function(){D._listView._versionManager.clearCancelOnNotification(J),D._listView._writeProfilerMark(t+" complete(created:"+E+" updated:"+F+"),info")},function(a){return D._listView._versionManager.clearCancelOnNotification(J),D._onscreenJob.clearWork(),D._frontOffscreenJob.clearWork(),D._backOffscreenJob.clearWork(),A.cancel(),B.cancel(),D._listView._writeProfilerMark(t+" canceled(created:"+E+" updated:"+F+" clean:"+G+"),info"),WinJS.Promise.wrapError(a)}),D._listView._writeProfilerMark(t+",StopTM"),{viewportItemsRealized:B.promise,allItemsRealized:I.promise,loadingCompleted:h.join([I.promise,A.promise]).then(function(){for(var a=[],d=b;c>d;d++){var e=D.items.itemDataAt(d);e&&a.push(e.itemsManagerRecord.itemReadyPromise)}return WinJS.Promise._cancelBlocker(h.join(a))})}}return D._listView._writeProfilerMark(t+",StopTM"),{viewportItemsRealized:h.wrap(),allItemsRealized:h.wrap(),loadingCompleted:h.wrap()}},_setAnimationInViewportState:function(a){if(this._hasAnimationInViewportPending=!1,a&&a.length>0)for(var b=this._listView._getViewportLength(),c=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+b-1),d=0,e=a.length;e>d;d++){var f=a[d];if(f.newIndex>=c.firstIndex&&f.newIndex<=c.lastIndex&&f.newIndex!==f.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(a,b){var c=this;return this._listView._groups.renderGroup(b).then(function(a){if(a){var d=c._getHeaderContainer(b);a.element.parentNode!==d&&(d.appendChild(a.element),g.addClass(a.element,WinJS.UI._headerClass)),c._listView._groups.setDomElement(b,a.element)}})},_updateHeaders:function(a,b,c){function d(b){var c=f._listView._groups.group(b);if(c&&!c.header){var d=c.headerPromise;return d||(d=c.headerPromise=f._addHeader(a,b),d.done(function(){c.headerPromise=null},function(){c.headerPromise=null})),d}return h.wrap()}function e(){f._headerRenderPromises=null}var f=this;this._listView._groups.removeElements();var g=this._listView._groups.groupFromItem(b),i=g,j=this._listView._groups.groupFromItem(c-1),k=[];if(null!==i)for(;j>=i;i++)k.push(d(i));return this._headerRenderPromises=h.join(k,this._headerRenderPromises).then(e,e),this._headerRenderPromises||h.wrap()},_unrealizeItem:function(a){var b,c=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+a+"),info");var d=c._selection._getFocused();d.type!==WinJS.UI.ObjectType.groupHeader&&d.index===a&&(c._unsetFocusOnItem(),b=!0);var e=this.items.itemDataAt(a),f=e.element,h=e.itemBox;h&&h.parentNode&&(g.removeClass(h.parentNode,WinJS.UI._selectedClass),g.removeClass(h.parentNode,WinJS.UI._footprintClass),g.addClass(h.parentNode,WinJS.UI._backdropClass),h.parentNode.removeChild(h)),e.container=null,c._currentMode().itemUnrealized&&c._currentMode().itemUnrealized(a,h),this.items.removeItem(a),e.removed||c._itemsManager.releaseItem(f),WinJS.Utilities._disposeElement(f),b&&c._setFocusOnItem(c._selection._getFocused())},_unrealizeGroup:function(a){var b,c=a.header,d=this._listView._selection._getFocused();d.type===WinJS.UI.ObjectType.groupHeader&&this._listView._groups.group(d.index)===a&&(this._listView._unsetFocusOnItem(),b=!0),c.parentNode&&c.parentNode.removeChild(c),WinJS.Utilities._disposeElement(c),a.header=null,a.left=-1,a.top=-1,b&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(a){var b=this,c=0;this.items.eachIndex(function(d){return d<b.begin||d>=b.end?(b._unrealizeItem(d),a&&++c>=a):void 0});var d=this._listView._groups,e=d.groupFromItem(this.begin);if(null!==e)for(var f=d.groupFromItem(this.end-1),g=0,h=d.length();h>g;g++){var i=d.group(g);(e>g||g>f)&&i.header&&this._unrealizeGroup(i)}},_unrealizeExcessiveItems:function(){var a=this.items.count(),b=this.end-this.begin,c=b+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+a+") approved("+c+"),info"),a>c&&this._unrealizeItems(a-c)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var a=this;return d(this._listView).then(function(){function b(){a._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(a._listView._isZombie())return void b();var e=[];a.items.eachIndex(function(b){(b<a.begin||b>=a.end)&&e.push(b)}),a._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+e.length+"),info");var f=[],g=a._listView._groups,j=g.groupFromItem(a.begin);if(null!==j)for(var k=g.groupFromItem(a.end-1),l=0,m=g.length();m>l;l++){var n=g.group(l);(j>l||l>k)&&n.header&&f.push(n)}if(e.length||f.length){var o,p=new h(function(b){function g(h){if(!a._listView._isZombie()){for(var i=-1,j=-1,k=0,l=c(a._listView);e.length&&!l&&!h.shouldYield;){var m=e.shift();a._unrealizeItem(m),k++,0>i&&(i=m),j=m}for(a._listView._writeProfilerMark("unrealizeWorker removeItems:"+k+" ("+i+"-"+j+"),info");f.length&&!l&&!h.shouldYield;)a._unrealizeGroup(f.shift());e.length||f.length?l?h.setPromise(d(a._listView).then(function(){return g})):h.setWork(g):b()}}o=i.schedule(g,i.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return p.then(b,function(b){return o.cancel(),a._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),a._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),h.wrapError(b)})}return b(),h.wrap()})},_getBoundingRectString:function(a){var b;if(a>=0&&a<this.containers.length){var c=this._listView._layout._getItemPosition(a);c&&(b="["+c.left+"; "+c.top+"; "+c.width+"; "+c.height+" ]")}return b||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(a){function b(){f._listView._writeProfilerMark("aria work,StopTM")}function e(a){var b=f._listView._groups,c=b.group(a+1);return c?Math.min(c.startIndex-1,f.end-1):f.end-1}if(!this._listView._isZombie()){var f=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(g){if(!(g>0&&-1!==f.firstIndexDisplayed&&-1!==f.lastIndexDisplayed))return h.wrap();f._listView._writeProfilerMark("aria work,StartTM");var j,k,l,m,n,o,p=f._listView._ariaStartMarker,q=f._listView._ariaEndMarker,r=f.begin,s=f.items.itemAt(f.begin);return s?(WinJS.Utilities._ensureId(s),f._listView._groupsEnabled()?(k=f._listView._groups,l=m=k.groupFromItem(f.begin),n=k.group(m),o=e(m),WinJS.Utilities._ensureId(n.header),WinJS.Utilities._setAttribute(n.header,"role",f._listView._headerRole),WinJS.Utilities._setAttribute(n.header,"x-ms-aria-flowfrom",p.id),WinJS.UI._setFlow(n.header,s),WinJS.Utilities._setAttribute(n.header,"tabindex",f._listView._tabIndex)):WinJS.Utilities._setAttribute(s,"x-ms-aria-flowfrom",p.id),new h(function(h){var p=a;j=i.schedule(function t(a){if(f._listView._isZombie())return void b();for(;r<f.end;r++){if(!p&&c(f._listView))return void a.setPromise(d(f._listView).then(function(a){return p=a,t}));if(a.shouldYield)return void a.setWork(t);s=f.items.itemAt(r);var i=f.items.itemAt(r+1);if(i&&WinJS.Utilities._ensureId(i),WinJS.Utilities._setAttribute(s,"role",f._listView._itemRole),WinJS.Utilities._setAttribute(s,"aria-setsize",g),WinJS.Utilities._setAttribute(s,"aria-posinset",r+1),WinJS.Utilities._setAttribute(s,"tabindex",f._listView._tabIndex),f._listView._groupsEnabled())if(r!==o&&i)WinJS.UI._setFlow(s,i);else{var j=k.group(m+1);j&&j.header&&i?(WinJS.Utilities._setAttribute(j.header,"tabindex",f._listView._tabIndex),WinJS.Utilities._setAttribute(j.header,"role",f._listView._headerRole),WinJS.Utilities._ensureId(j.header),WinJS.UI._setFlow(s,j.header),WinJS.UI._setFlow(j.header,i)):WinJS.Utilities._setAttribute(s,"aria-flowto",q.id),m++,n=j,o=e(m)}else i?WinJS.UI._setFlow(s,i):WinJS.Utilities._setAttribute(s,"aria-flowto",q.id);if(!i)break}f._listView._fireAccessibilityAnnotationCompleteEvent(f.begin,r,l,m-1),b(),h()},i.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){j.cancel(),b()})):void b()})}},_setupDeferredActions:function(){function a(){b._listView._isZombie()||(b.deferTimeout=null,b._listView._versionManager.clearCancelOnNotification(b.deferredActionCancelToken),b.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var b=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return WinJS.Promise.timeout(WinJS.UI._DEFERRED_ACTION)}).then(function(){return d(b._listView)}).then(function(a){return b._setupAria(a)}).then(a,function(b){return a(),h.wrapError(b)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(a,b,c){function d(){return f.items.itemAt(b)}function e(){for(var a=c;a>=b;a--)if(f.items.itemAt(a))return f.items.itemAt(a);return null}var f=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var g,h,i=this._listView._ariaStartMarker,j=this._listView._ariaEndMarker;if(-1!==b&&-1!==c&&c>=b&&(g=d(),h=e()),!a&&g&&h){if(WinJS.Utilities._ensureId(g),WinJS.Utilities._ensureId(h),this._listView._groupsEnabled()){var k=this._listView._groups,l=k.group(k.groupFromItem(b));l.header&&(WinJS.Utilities._ensureId(l.header),b===l.startIndex?WinJS.Utilities._setAttribute(i,"aria-flowto",l.header.id):WinJS.Utilities._setAttribute(i,"aria-flowto",g.id))}else WinJS.Utilities._setAttribute(i,"aria-flowto",g.id);WinJS.Utilities._setAttribute(j,"x-ms-aria-flowfrom",h.id)}else WinJS.UI._setFlow(i,j),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(a,b){var c=-1,d=WinJS.UI.ObjectType.item;WinJS.Utilities.hasClass(a,WinJS.UI._headerClass)?(c=this._listView._groups.index(a),d=WinJS.UI.ObjectType.groupHeader,WinJS.Utilities._setAttribute(a,"role",this._listView._headerRole)):(c=this.items.index(a),WinJS.Utilities._setAttribute(a,"aria-setsize",b),WinJS.Utilities._setAttribute(a,"aria-posinset",c+1),WinJS.Utilities._setAttribute(a,"role",this._listView._itemRole)),d===WinJS.UI.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,c,c):this._listView._fireAccessibilityAnnotationCompleteEvent(c,c,-1,-1)},_reportElementsLevel:function(a){function b(a,b){for(var c=0,e=a;b>=e;e++){var f=d.itemDataAt(e);f&&f.container&&c++}return c}var c,d=this.items;c=Math.floor("right"===a?100*b(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed):100*b(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+c+"),info")},_createHeaderContainer:function(a){return this._createSurfaceChild(WinJS.UI._headerContainerClass,a)},_createItemsContainer:function(a){var b=this._createSurfaceChild(WinJS.UI._itemsContainerClass,a),c=document.createElement("div");return c.className=WinJS.UI._padderClass,b.appendChild(c),b},_ensureContainerInDOM:function(a){var b=this.containers[a];return b&&!this._listView._canvas.contains(b)?(this._forceItemsBlocksInDOM(a,a+1),!0):!1},_ensureItemsBlocksInDOM:function(a,b){if(this._expandedRange){var c=this._expandedRange.first.index,d=this._expandedRange.last.index+1;c>=a&&b>c?b=Math.max(b,d):d>a&&b>=d&&(a=Math.min(a,c))}this._forceItemsBlocksInDOM(a,b)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");
var a=this;return d(this._listView).then(function(){function b(){a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(a._listView._isZombie())return void b();if(a._expandedRange&&-1!==a.begin&&-1!==a.end&&(a._expandedRange.first.index<a.begin||a._expandedRange.last.index+1>a.end)){var e,f=new h(function(b){function f(e){if(!a._listView._isZombie()){for(var g=c(a._listView);a._expandedRange.first.index<a.begin&&!g&&!e.shouldYield;){var h=Math.min(a.begin,a._expandedRange.first.index+a._blockSize*WinJS.UI._VirtualizeContentsView._blocksToRelease);a._forceItemsBlocksInDOM(h,a.end)}for(;a._expandedRange.last.index+1>a.end&&!g&&!e.shouldYield;){var i=Math.max(a.end,a._expandedRange.last.index-a._blockSize*WinJS.UI._VirtualizeContentsView._blocksToRelease);a._forceItemsBlocksInDOM(a.begin,i)}a._expandedRange.first.index<a.begin||a._expandedRange.last.index+1>a.end?g?e.setPromise(d(a._listView).then(function(){return f})):e.setWork(f):b()}}e=i.schedule(f,i.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return f.then(b,function(b){return e.cancel(),a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),h.wrapError(b)})}return b(),h.wrap()})},_forceItemsBlocksInDOM:function(a,b){function c(a,b){var c=a.element.firstElementChild;c.style[q]=b}function d(a){for(var b=0;b<n.tree.length;b++)for(var c=n.tree[b].itemsContainer,d=0,e=c.itemsBlocks.length;e>d;d++)if(a(c,c.itemsBlocks[d]))return}function e(a){n._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),n._listView._itemsBlockExtent=g[n._listView._horizontal()?"getTotalWidth":"getTotalHeight"](a.element),n._listView._writeProfilerMark("_itemsBlockExtent("+n._listView._itemsBlockExtent+"),info"),n._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function f(){return-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize&&b.element.parentNode===a.element?(e(b),!0):!1}),-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize?(a.element.appendChild(b.element),e(b),a.element.removeChild(b.element),!0):!1}),n._listView._itemsBlockExtent}function h(a,b,c){function d(b){var c=a.itemsBlocks[b];c&&c.element.parentNode===a.element&&(a.element.removeChild(c.element),p++)}if(Array.isArray(b))b.forEach(d);else for(var e=b;c>e;e++)d(e)}function i(a,b,c){for(var d=a.element.firstElementChild,e=d,f=b;c>f;f++){var g=a.itemsBlocks[f];g&&(g.element.parentNode!==a.element&&(a.element.insertBefore(g.element,e.nextElementSibling),o++),e=g.element)}}function j(a){if(a<n.tree.length){n._listView._writeProfilerMark("collapseGroup("+a+"),info");var b=n.tree[a].itemsContainer;h(b,0,b.itemsBlocks.length),c(b,"")}}function k(a){if(a<n.tree.length){n._listView._writeProfilerMark("expandGroup("+a+"),info");var b=n.tree[a].itemsContainer;i(b,0,b.itemsBlocks.length),c(b,"")}}function l(a,b){function c(a,b){for(var c=[],d=a;b>=d;d++)c.push(d);return c}var d=b[0],e=b[1],f=a[0],g=a[1];return f>e||d>g?c(f,g):d>f&&g>e?c(f,d-1).concat(c(e+1,g)):d>f?c(f,d-1):g>e?c(e+1,g):null}if(this._blockSize){var m="_forceItemsBlocksInDOM begin("+a+") end("+b+"),";this._listView._writeProfilerMark(m+"StartTM");var n=this,o=0,p=0,q="padding"+(this._listView._horizontal()?"Left":"Top"),r=this._listView._groups.groupFromItem(a),s=this._listView._groups.groupFromItem(b-1),t=this._listView._groups.group(r),u=n.tree[r].itemsContainer,v=Math.floor((a-t.startIndex)/this._blockSize),w=this._listView._groups.group(s),x=n.tree[s].itemsContainer,y=Math.floor((b-1-w.startIndex)/this._blockSize);v&&-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize&&b.element.parentNode===a.element?(e(b),!0):!1});var z=this._expandedRange?l([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[r,s]):null;if(z&&z.forEach(j),this._expandedRange&&this._expandedRange.first.groupKey===t.key){var A=l([this._expandedRange.first.block,Number.MAX_VALUE],[v,Number.MAX_VALUE]);A&&h(u,A)}else this._expandedRange&&r>=this._expandedRange.first.groupIndex&&r<=this._expandedRange.last.groupIndex&&h(u,0,v);if(r!==s?(i(u,v,u.itemsBlocks.length),i(x,0,y+1)):i(u,v,y+1),this._expandedRange&&this._expandedRange.last.groupKey===w.key){var A=l([0,this._expandedRange.last.block],[0,y]);A&&h(x,A)}else this._expandedRange&&s>=this._expandedRange.first.groupIndex&&s<=this._expandedRange.last.groupIndex&&h(x,y+1,x.itemsBlocks.length);c(u,v?v*f()+"px":""),r!==s&&c(x,"");for(var B=r+1;s>B;B++)k(B);this._expandedRange={first:{index:a,groupIndex:r,groupKey:t.key,block:v},last:{index:b-1,groupIndex:s,groupKey:w.key,block:y}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+r+"-"+s+") blocks("+v+"-"+y+") added("+o+") removed("+p+"),info"),this._listView._writeProfilerMark(m+"StopTM")}},_realizePageImpl:function(){var a=this,b="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(b+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){a._listView._isZombie()||a._listView._batchViewUpdates(WinJS.UI._ViewChange.realize,WinJS.UI._ScrollToPriority.low,a._listView.scrollPosition)}),this._listView._writeProfilerMark(b+",StopTM"),h.cancel):new h(function(c){function d(){c(),j.complete()}function e(){a._listView._hideProgressBar(),a._state.setLoadingState(a._listView._LoadingState.viewPortLoaded),a._executeAnimations&&a._setState(t,j.promise)}function f(b){a._updateAriaMarkers(0===b,a.firstIndexDisplayed,a.lastIndexDisplayed),a._state.setLoadingState&&a._state.setLoadingState(a._listView._LoadingState.itemsLoaded)}function i(b){a._listView._clearInsertedItems(),a._listView._groups.removeElements(),e(),f(b),d()}var j=new WinJS._Signal;a._state.setLoadingState(a._listView._LoadingState.itemsLoading),a._firstLayoutPass&&a._listView._showProgressBar(a._listView._element,"50%","50%");var k=a.containers.length;if(k){var l=WinJS.UI._VirtualizeContentsView._pagesToPrefetch;a._listView._zooming&&(l=0);var m=a._listView._getViewportLength(),n=Math.max(0,a._scrollbarPos-l*m),o=a._scrollbarPos+(1+l)*m,p=a._listView._layout.itemsFromRange(n,o-1);if((p.firstIndex<0||p.firstIndex>=k)&&(p.lastIndex<0||p.lastIndex>=k))a.begin=-1,a.end=-1,a.firstIndexDisplayed=-1,a.lastIndexDisplayed=-1,i(k);else{var q=g._clamp(p.firstIndex,0,k-1),r=g._clamp(p.lastIndex+1,0,k),s=a._listView._layout.itemsFromRange(a._scrollbarPos,a._scrollbarPos+m-1),u=g._clamp(s.firstIndex,0,k-1),v=g._clamp(s.lastIndex,0,k-1);if(a._realizationLevel!==WinJS.UI._VirtualizeContentsView._realizationLevel.skip||a.lastRealizePass||u!==a.firstIndexDisplayed||v!==a.lastIndexDisplayed)if((a._forceRelayout||q!==a.begin||r!==a.end||u!==a.firstIndexDisplayed||v!==a.lastIndexDisplayed)&&r>q&&o>n){a._listView._writeProfilerMark("realizePage currentInView("+u+"-"+v+") previousInView("+a.firstIndexDisplayed+"-"+a.lastIndexDisplayed+") change("+(u-a.firstIndexDisplayed)+"),info"),a._cancelRealize();var w=a._realizePass;a.begin=q,a.end=r,a.firstIndexDisplayed=u,a.lastIndexDisplayed=v,a.deletesWithoutRealize=0,a._ensureItemsBlocksInDOM(a.begin,a.end);var x=a._realizeItems(a._listView._itemCanvas,a.begin,a.end,k,w,a._scrollbarPos,a._direction,u,v,a._forceRelayout);a._forceRelayout=!1;var y=x.viewportItemsRealized.then(function(){return e(),x.allItemsRealized}).then(function(){return a._realizePass===w?a._updateHeaders(a._listView._canvas,a.begin,a.end).then(function(){f(k)}):void 0}).then(function(){return x.loadingCompleted}).then(function(){a._unrealizeExcessiveItems(),a.lastRealizePass=null,d()},function(b){return a._realizePass===w&&(a.lastRealizePass=null,a.begin=-1,a.end=-1),WinJS.Promise.wrapError(b)});a.lastRealizePass=h.join([x.viewportItemsRealized,x.allItemsRealized,x.loadingCompleted,y]),a._unrealizeExcessiveItems()}else a.lastRealizePass?a.lastRealizePass.then(d):i(k);else a.begin=q,a.end=q+Object.keys(a.items._itemData).length,a._updateHeaders(a._listView._canvas,a.begin,a.end).done(function(){a.lastRealizePass=null,i(k)})}}else a.begin=-1,a.end=-1,a.firstIndexDisplayed=-1,a.lastIndexDisplayed=-1,i(k);a._reportElementsLevel(a._direction),a._listView._writeProfilerMark(b+",StopTM")})},realizePage:function(a,b,c,d){this._scrollToFunctor=e(a),this._forceRelayout=this._forceRelayout||b,this._scrollEndPromise=c,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(d||o)},onScroll:function(a,b){this.realizePage(a,!1,b,q)},reload:function(a,b){this._listView._isZombie()||(this._scrollToFunctor=e(a),this._forceRelayout=!0,this._highPriorityRealize=!!b,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(a){this._listView._isZombie()||(this._scrollToFunctor=e(a),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(a){var b=this,c=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return a>c?b._listView._itemsCount().then(function(c){return b.containers.length<c?h._cancelBlocker(b._creatingContainersWork&&b._creatingContainersWork.promise).then(function(){return b._getLayoutCompleted()}).then(function(){return a}):a}):WinJS.Promise.wrap(a)},waitForEntityPosition:function(a){var b=this;return this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+a.type+": "+a.index+"),info"),h._cancelBlocker(this._state.waitForEntityPosition(a).then(function(){return a.type!==WinJS.UI.ObjectType.groupHeader&&a.index>=b.containers.length||a.type===WinJS.UI.ObjectType.groupHeader&&b._listView._groups.group(a.index).startIndex>=b.containers.length?b._creatingContainersWork&&b._creatingContainersWork.promise:void 0}).then(function(){return b._getLayoutCompleted()}))},stopWork:function(a){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(a),this._layoutWork&&this._layoutWork.cancel(),a&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),a&&(this._state=new k(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var a=this.lastRealizePass;a&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,a.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(a){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var b=this._listView;this._firstLayoutPass=!0,b._unsetFocusOnItem(),b._currentMode().onDataChanged&&b._currentMode().onDataChanged(),this.items.each(function(c,d){a&&d.parentNode&&d.parentNode.parentNode&&d.parentNode.parentNode.removeChild(d.parentNode),b._itemsManager.releaseItem(d),WinJS.Utilities._disposeElement(d)}),this.items.removeItems(),this._deferredReparenting=[],a&&b._groups.removeElements(),b._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new k(this),this.resetItems(),!this._listView._isZombie()){var a=this._listView;a._groups.resetGroups(),a._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var a=this._listView._itemsManager;this.items.each(function(b,c){a.releaseItem(c),WinJS.Utilities._disposeElement(c)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(a){return this.containers[a]},_getHeaderContainer:function(a){return this.tree[a].header},_getGroups:function(a){if(this._listView._groupDataSource){var b=this._listView._groups.groups,c=[];if(a)for(var d=0,e=b.length;e>d;d++){var f=b[d],g=e>d+1?b[d+1].startIndex:a;c.push({key:f.key,size:g-f.startIndex})}return c}return[{key:"-1",size:a}]},_createChunk:function(a,b,c){function d(a,b){var d=a.element.children,e=d.length,h=Math.min(b-a.items.length,c);g.insertAdjacentHTMLUnsafe(a.element,"beforeend",WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",h));for(var i=0;h>i;i++){var j=d[e+i];a.items.push(j),f.containers.push(j)}}function e(a){var b={header:f._listView._groupDataSource?f._createHeaderContainer():null,itemsContainer:{element:f._createItemsContainer(),items:[]}};f.tree.push(b),f.keyToGroupIndex[a.key]=f.tree.length-1,d(b.itemsContainer,a.size)}var f=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=a.length){var h=this.tree[this.tree.length-1],i=a[this.tree.length-1].size;if(h.itemsContainer.items.length<i)return d(h.itemsContainer,i),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<a.length&&e(a[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(a,b,c,d){function e(a,b){var e=a.itemsBlocks.length?a.itemsBlocks[a.itemsBlocks.length-1]:null;if(e&&e.items.length<c){var f=Math.min(b,c-e.items.length);g.insertAdjacentHTMLUnsafe(e.element,"beforeend",WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",f));var i=e.items.length;q=e.element.children;for(var j=0;f>j;j++){var k=q[i+j];e.items.push(k),h.containers.push(k)}b-=f}b>d&&(b=Math.min(b,Math.max(1,Math.floor(d/c))*c));var l=Math.floor(b/c),m=b%c,n="<div class='win-itemsblock'>"+WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",c)+"</div>",o=WinJS.UI._repeat(n,l);m&&(o+="<div class='win-itemsblock'>"+WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",m)+"</div>",l++);var p=document.createElement("div");g.setInnerHTMLUnsafe(p,o);for(var q=p.children,r=0;l>r;r++){var s=q[r],t={element:s,items:WinJS.UI._nodeListToArray(s.children)};a.itemsBlocks.push(t);for(var u=0;u<t.items.length;u++)h.containers.push(t.items[u])}}function f(a){var b={header:h._listView._groupDataSource?h._createHeaderContainer():null,itemsContainer:{element:h._createItemsContainer(),itemsBlocks:[]}};h.tree.push(b),h.keyToGroupIndex[a.key]=h.tree.length-1,e(b.itemsContainer,a.size)}var h=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=a.length){var i=this.tree[this.tree.length-1].itemsContainer,j=a[this.tree.length-1].size,k=0;if(i.itemsBlocks.length&&(k=(i.itemsBlocks.length-1)*c+i.itemsBlocks[i.itemsBlocks.length-1].items.length),j>k)return e(i,j-k),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<a.length&&f(a[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var a=this,b=0,e=!1;return function f(g){a._listView._versionManager.locked?g.setPromise(a._listView._versionManager.unlocked.then(function(){return f})):a._listView._itemsCount().then(function(h){var i=!e&&c(a._listView);if(i)g.setPromise(d(a._listView).then(function(a){return e=a,f}));else{if(a._listView._isZombie())return;e=!1;var k=WinJS.Utilities._now()+j._createContainersJobTimeslice,l=a._getGroups(h),m=a.containers.length,n=a.end===a.containers.length,o=WinJS.UI._VirtualizeContentsView._chunkSize;do a._blockSize?a._createChunkWithBlocks(l,h,a._blockSize,o):a._createChunk(l,h,o),b++;while(a.containers.length<h&&WinJS.Utilities._now()<k);a._listView._writeProfilerMark("createContainers yields containers("+a.containers.length+"),info"),a._listView._affectedRange.add({start:m,end:a.containers.length},h),n?(a.stopWork(),a._listView._writeProfilerMark(a._state.name+"_relayout,info"),a._state.relayout()):(a._listView._writeProfilerMark(a._state.name+"_layoutNewContainers,info"),a._state.layoutNewContainers()),a.containers.length<h?g.setWork(f):(a._listView._writeProfilerMark("createContainers completed steps("+b+"),info"),a._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return g.Scheduler.schedule(this._generateCreateContainersWorker(),g.Scheduler.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var a,b=this;return this._listView._itemsCount().then(function(c){return 0===c&&b._listView._hideProgressBar(),a=c,b._listView._writeProfilerMark("createContainers("+a+"),StartTM"),b._listView._groupDataSource?b._listView._groups.initialize():void 0}).then(function(){return b._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),a&&b._listView._groups.length()?b._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(c){b._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+c+"),info"),b._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),b._listView._resetCanvas(),b.tree=[],b.keyToGroupIndex={},b.containers=[],b._blockSize=c;var d=b._getGroups(a),e=WinJS.Utilities._now()+WinJS.UI._VirtualizeContentsView._maxTimePerCreateContainers,f=Math.min(WinJS.UI._VirtualizeContentsView._startupChunkSize,WinJS.UI._VirtualizeContentsView._chunkSize);do var g=c?b._createChunkWithBlocks(d,a,c,f):b._createChunk(d,a,f);while(WinJS.Utilities._now()<e&&b.containers.length<a&&!g);if(b._listView._writeProfilerMark("createContainers created("+b.containers.length+"),info"),b._listView._affectedRange.add({start:0,end:b.containers.length},a),b.containers.length<a){var h=b._scheduleLazyTreeCreation();b._creatingContainersWork.promise.done(null,function(){h.cancel()})}else b._listView._writeProfilerMark("createContainers completed synchronously,info"),b._creatingContainersWork.complete();b._listView._writeProfilerMark("createContainers("+a+"),StopTM")})},_updateItemsBlocks:function(a){function b(){var a=document.createElement("div");return a.className=WinJS.UI._itemsBlockClass,a}function c(c,f){function g(){c.itemsBlocks=null,c.items=[];for(var a=0;k>a;a++){var b=d.containers[f+a];c.element.appendChild(b),c.items.push(b)}}function h(){c.itemsBlocks=[{element:j.length?j.shift():b(),items:[]}];for(var e=c.itemsBlocks[0],g=0;k>g;g++){if(e.items.length===a){var h=j.length?j.shift():b();c.itemsBlocks.push({element:h,items:[]}),e=c.itemsBlocks[c.itemsBlocks.length-1]}var i=d.containers[f+g];e.element.appendChild(i),e.items.push(i)}c.items=null}var i,j=[],k=0,l=c.itemsBlocks;if(l)for(i=0;i<l.length;i++)k+=l[i].items.length,j.push(l[i].element);else k=c.items.length;for(e?h():g(),i=0;i<j.length;i++){var m=j[i];m.parentNode===c.element&&c.element.removeChild(m)}return k}for(var d=this,e=!!a,f=0,g=0;f<this.tree.length;f++)g+=c(this.tree[f].itemsContainer,g);d._blockSize=a},_layoutItems:function(){var a=this;return this._listView._itemsCount().then(function(){return h.as(a._listView._layout.numberOfItemsPerItemsBlock).then(function(b){a._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+b+"),info"),b!==a._blockSize&&(a._updateItemsBlocks(b),a._listView._itemsBlockExtent=-1);var c,d=a._listView._affectedRange.get();return d&&(c={firstIndex:Math.max(d.start-1,0),lastIndex:Math.min(a.containers.length-1,d.end)},c.firstIndex<a.containers.length||0===a.containers.length)?a._listView._layout.layout(a.tree,c,a._modifiedElements||[],a._modifiedGroups||[]):(a._listView._affectedRange.clear(),{realizedRangeComplete:h.wrap(),layoutComplete:h.wrap()})})})},updateTree:function(a,b,c){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(a,b,c)},_updateTreeImpl:function(a,b,c,d){function e(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];d.parentNode.removeChild(d)}}if(this._executeAnimations=!0,this._modifiedElements=c,!c.handled){c.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var f,h=this;d||this._unrealizeItems();for(var f=0,i=c.length;i>f;f++)c[f]._itemBox&&c[f]._itemBox.parentNode&&g.removeClass(c[f]._itemBox.parentNode,WinJS.UI._selectedClass);this.items.each(function(a,b,c){c.container&&g.removeClass(c.container,WinJS.UI._selectedClass),c.container&&g.addClass(c.container,WinJS.UI._backdropClass)});var j=this._listView._updateContainers(this._getGroups(a),a,b,c);e(j.removedHeaders),e(j.removedItemsContainers);for(var f=0,i=c.length;i>f;f++){var k=c[f];if(-1!==k.newIndex){if(k.element=this.getContainer(k.newIndex),!k.element)throw"Container missing after updateContainers."}else g.removeClass(k.element,WinJS.UI._backdropClass)}var l=document.activeElement;this._listView._canvas.contains(l)&&(this._requireFocusRestore=l),this._deferredReparenting=[],this.items.each(function(a,b,c){var d=h.getContainer(a),e=c.itemBox;e&&d&&(e.parentNode!==d&&(a>=h.firstIndexDisplayed&&a<=h.lastIndexDisplayed?h._appendAndRestoreFocus(d,e):h._deferredReparenting.push({itemBox:e,container:d})),g.removeClass(d,WinJS.UI._backdropClass),c.container=d,g[h._listView.selection._isIncluded(a)?"addClass":"removeClass"](d,WinJS.UI._selectedClass),!h._listView.selection._isIncluded(a)&&g.hasClass(e,WinJS.UI._selectedClass)&&WinJS.UI._ItemEventsHandler.renderSelection(e,c.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var a=this._deferredReparenting.length;if(a>0){var b="_completeReparenting("+a+")";this._listView._writeProfilerMark(b+",StartTM");for(var c,d=0;a>d;d++)c=this._deferredReparenting[d],this._appendAndRestoreFocus(c.container,c.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(b+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(a,b){if(b.parentNode!==a){var c;if(this._requireFocusRestore&&(c=document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===c&&(a.contains(c)||b.contains(c))&&(this._listView._unsetFocusOnItem(),c=document.activeElement),g.empty(a),a.appendChild(b),this._requireFocusRestore&&c===this._listView._keyboardEventsHelper){var d=this._listView._selection._getFocused();d.type===WinJS.UI.ObjectType.item&&this.items.itemBoxAt(d.index)===b&&(WinJS.Utilities._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var a=this;this._hasAnimationInViewportPending=!1;var b=h.as(this._listView._layout.executeAnimations()).then(function(){a._listView._writeProfilerMark("startAnimations,StopTM")});return b},_setState:function(a,b){if(!this._listView._isZombie()){var c=this._state.name;this._state=new a(this,b),this._listView._writeProfilerMark(this._state.name+"_enter from("+c+"),info"),this._state.enter()}},getAdjacent:function(a,b){var c=this;return this.waitForEntityPosition(a).then(function(){return c._listView._layout.getAdjacent(a,b)})},hitTest:function(a,b){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var c=this._listView._layout.hitTest(a,b);return c.index=g._clamp(c.index,-1,this._listView._cachedCount-1,0),c.insertAfterIndex=g._clamp(c.insertAfterIndex,-1,this._listView._cachedCount-1,0),c},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new WinJS._Signal;var a=this;this._creatingContainersWork.promise.done(function(){a._creatingContainersWork=null},function(){a._creatingContainersWork=null})}},_createLayoutSignal:function(){var a=this;this._layoutCompleted||(this._layoutCompleted=new WinJS._Signal,this._layoutCompleted.promise.done(function(){a._layoutCompleted=null},function(){a._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new WinJS._Signal,this._realizedRangeLaidOut.promise.done(function(){a._realizedRangeLaidOut=null},function(){a._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?WinJS.Promise._cancelBlocker(this._layoutCompleted.promise):h.wrap()},_createSurfaceChild:function(a,b){var c=document.createElement("div");return c.className=a,this._listView._canvas.insertBefore(c,b?b.nextElementSibling:null),c},_executeScrollToFunctor:function(){var a=this;return h.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(b){a._scrollToFunctor=null,b=b||{},+b.position===b.position&&(a._scrollbarPos=b.position),a._direction=b.direction||"right"})}};var k=WinJS.Class.define(function(a){this.view=a,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:f,realizePage:f,rebuildTree:function(){this.view._setState(l)},relayout:function(){this.view._setState(l)},layoutNewContainers:f,waitForEntityPosition:function(){return this.view._setState(l),this.view._getLayoutCompleted()},updateTree:f}),l=WinJS.Class.define(function(a){this.view=a},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var a=this,b=new WinJS._Signal;this.promise=b.promise.then(function(){return a.view._createContainers()}).then(function(){a.view._setState(m)},function(b){return a.canceling||(a.view._setState(k),a.view._listView._raiseViewComplete()),h.wrapError(b)}),b.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(k)},realizePage:f,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:f,layoutNewContainers:f,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:f}),m=WinJS.Class.define(function(a,b){this.view=a,this.nextStateType=b||o},{name:"LayingoutState",enter:function(){var a=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var b=new WinJS._Signal;this.promise=b.promise.then(function(){return a.view._layoutItems()}).then(function(b){return a.view._layoutWork=b.layoutComplete,b.realizedRangeComplete}).then(function(){a.view._listView._writeProfilerMark(a.name+"_enter_layoutItems,StopTM"),a.view._listView._clearInsertedItems(),a.view._setAnimationInViewportState(a.view._modifiedElements),a.view._modifiedElements=[],a.view._modifiedGroups=[],a.view._realizedRangeLaidOut.complete(),a.view._layoutWork.then(function(){a.view._listView._writeProfilerMark(a.name+"_enter_layoutCompleted,info"),a.view._listView._affectedRange.clear(),a.view._layoutCompleted.complete()}),a.canceling||a.view._setState(a.nextStateType)},function(b){return a.view._listView._writeProfilerMark(a.name+"_enter_layoutCanceled,info"),a.canceling||(a.view.firstIndexDisplayed=a.view.lastIndexDisplayed=-1,a.view._updateAriaMarkers(!0,a.view.firstIndexDisplayed,a.view.lastIndexDisplayed),a.view._setState(u)),h.wrapError(b)}),b.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(a){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),a&&this.view._setState(n)},stop:function(){this.cancelLayout(!0)},realizePage:f,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(l)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),n=WinJS.Class.define(function(a){this.view=a},{name:"LayoutCanceledState",enter:f,stop:f,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(l)},relayout:function(){this.view._setState(m)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),o=WinJS.Class.define(function(a){this.view=a,this.nextState=s,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var a=this,b=new WinJS._Signal;this.promise=b.promise.then(function(){return a.view._executeScrollToFunctor()}).then(function(){return a.relayoutNewContainers=!1,h._cancelBlocker(a.view._realizePageImpl())}).then(function(){a.view._state===a&&(a.view._completeUpdateTree(),a.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),a.view._setState(a.nextState))},function(b){return a.view._state!==a||a.canceling||(a.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),a.view._setState(p)),h.wrapError(b)}),b.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(p)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(l)},relayout:function(){this.stop(),this.view._setState(m)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)},setLoadingState:function(a){this.view._listView._setViewState(a)}}),p=WinJS.Class.define(function(a){this.view=a},{name:"CanceledState",enter:f,stop:function(){this.view._cancelRealize()},realizePage:function(a){this.stop(),this.view._setState(a)},rebuildTree:function(){this.stop(),this.view._setState(l)},relayout:function(a){this.stop(),this.view._setState(m,a)},layoutNewContainers:function(){this.relayout(p)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),q=WinJS.Class.derive(o,function(a){this.view=a,this.nextState=r,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),r=WinJS.Class.derive(p,function(a){this.view=a},{name:"ScrollingPausedState",enter:function(){var a=this;this.promise=h._cancelBlocker(this.view._scrollEndPromise).then(function(){a.view._setState(s)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),s=WinJS.Class.define(function(a){this.view=a},{name:"UnrealizingState",enter:function(){var a=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return a.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),a.view._renderCompletePromise}).then(function(){a.view._setState(u)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(p)},realizePage:function(a){this.promise.cancel(),this.view._setState(a)},rebuildTree:function(){this.view._setState(l)},relayout:function(){this.view._setState(m)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),t=WinJS.Class.define(function(a,b){this.view=a,this.realizePromise=b,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var a=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new WinJS._Signal,this.view._executeAnimations=!1,this.animatePromise.done(function(){a.animating=!1,a.modifiedElements?(a.view._updateTreeImpl(a.count,a.delta,a.modifiedElements),a.modifiedElements=null,a.view._setState(p)):a.animateSignal.complete()},function(b){return a.animating=!1,h.wrapError(b)}),this._waitForRealize()},_waitForRealize:function(){var a=this;this.realizing=!0,this.realizePromise.done(function(){a.realizing=!1});var b=++this.realizeId;h.join([this.realizePromise,this.animateSignal.promise]).done(function(){b===a.realizeId&&(a.view._completeUpdateTree(),a.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),a.view._setState(s))
})},stop:function(a){this.realizePromise.cancel(),this.view._cancelRealize(),a&&(this.animatePromise.cancel(),this.view._setState(p))},realizePage:function(){if(!this.modifiedElements){var a=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return h._cancelBlocker(a.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(l)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(m)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){if(this.animating){var d=this.modifiedElements;return this.count=a,this.delta=b,this.modifiedElements=c,d?WinJS.Promise.cancel:this.animatePromise}return this.view._updateTreeImpl(a,b,c)},setLoadingState:function(a){this.view._listView._setViewState(a)}}),u=WinJS.Class.derive(p,function(a){this.view=a},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=WinJS.UI._VirtualizeContentsView._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(v)},stop:function(){this._stopped=!0,p.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(v)},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c,!0)}}),v=WinJS.Class.derive(p,function(a){this.view=a},{name:"LayingoutNewContainersState",enter:function(){var a=this;this.promise=WinJS.Promise.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){a.view._relayoutInComplete=!1,a.relayout(p)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(a){this.stop(),this.view._setState(m,a)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return j})})}),b("require-style!less/desktop/controls",[],function(){}),b("require-style!less/phone/controls",[],function(){}),b("WinJS/Controls/ListView",["./ListView/_BrowseMode","./ItemContainer/_Constants","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_ItemsContainer","./ListView/_ItemsManager","./ListView/_Layouts","./ListView/_ParallelWorkQueue","./ListView/_SelectionManager","./ListView/_StorageDataSource","./ListView/_VersionManager","./ListView/_VirtualizeContentsView","require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";function a(){var a=j;j=[],a=a.filter(function(a){return a._isZombie()?(a._dispose(),!1):!0}),j=j.concat(a)}function b(b){j.push(b),g&&g.cancel(),g=WinJS.Promise.timeout(i).then(a)}function c(a,b){WinJS.Utilities._setAttribute(a,"aria-flowto",b.id),WinJS.Utilities._setAttribute(b,"x-ms-aria-flowfrom",a.id)}function d(a){return Array.prototype.slice.call(a)}function e(a,b){return new Array(b+1).join(a)}function f(a){return a.offsetParent?a.offsetParent.offsetWidth-a.offsetLeft-a.offsetWidth:0}var g,h=WinJS.Utilities._browserStyleEquivalents.transform,i=1e3,j=[],k=WinJS.Utilities._uniqueID,l=WinJS.UI.simpleItemRenderer(function(a){if(p._isDOMElement(a.data))return a.data;var b=a.data;void 0===b?b="undefined":null===b?b="null":"object"==typeof b&&(b=JSON.stringify(b));var c=document.createElement("span");return c.textContent=b.toString(),c});WinJS.Namespace.define("WinJS.UI",{_trivialHtmlRenderer:l,_disposeControls:a,_setFlow:c,_nodeListToArray:d,_repeat:e,_ListViewAnimationHelper:{fadeInElement:function(a){return WinJS.UI.Animation.fadeIn(a)},fadeOutElement:function(a){return WinJS.UI.Animation.fadeOut(a)},animateEntrance:function(a,b){return WinJS.UI.Animation.enterContent(a,[{left:b?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"})}}});var m={uninitialized:0,low:1,medium:2,high:3},n={rebuild:0,remeasure:1,relayout:2,realize:3},o=WinJS.UI,p=WinJS.Utilities,q=WinJS.Promise,r=p.Scheduler,s=WinJS.UI._ListViewAnimationHelper,t={get notCompatibleWithSemanticZoom(){return WinJS.Resources._getWinJSString("ui/notCompatibleWithSemanticZoom").value},get listViewInvalidItem(){return WinJS.Resources._getWinJSString("ui/listViewInvalidItem").value},get listViewViewportAriaLabel(){return WinJS.Resources._getWinJSString("ui/listViewViewportAriaLabel").value}},u=WinJS.Utilities.requireSupportedForProcessing;WinJS.Namespace.define("WinJS.UI",{_ScrollToPriority:m,_ViewChange:n,ListViewAnimationType:{entrance:"entrance",contentTransition:"contentTransition"},ListView:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(){this.clear()},{add:function(a,b){if(a._lastKnownSizeOfData=b,this._range){this._range.start=Math.min(this._range.start,a.start);var c=this._range._lastKnownSizeOfData-this._range.end,d=a._lastKnownSizeOfData-a.end,e=Math.min(c,d);this._range._lastKnownSizeOfData=a._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-e}else this._range=a},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),c=WinJS.Class.define(function(a){this._listView=a},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(a,b,c,d){this._listView._configureForZoom(a,b,c,d)},setCurrentItem:function(a,b){this._listView._setCurrentItem(a,b)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(a,b){return this._listView._positionItem(a,b)},endZoom:function(a){this._listView._endZoom(a)}}),d=WinJS.Class.define(function(b,c){b=b||document.createElement("div"),this._id=b.id||"",this._writeProfilerMark("constructor,StartTM"),c=c||{},b.winControl=this,WinJS.Utilities.addClass(b,"win-disposable"),this._affectedRange=new a,this._mutationObserver=new WinJS.Utilities._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=b,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=WinJS.UI._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._viewportWidth=WinJS.UI._UNINITIALIZED,this._viewportHeight=WinJS.UI._UNINITIALIZED,this._manipulationState=WinJS.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new WinJS.UI._UnsupportedGroupFocusCache,this._viewChange=n.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new WinJS.UI._VirtualizeContentsView(this),this._selection=new WinJS.UI._SelectionManager(this),this._createTemplates();if(this._groupHeaderRenderer=WinJS.UI._trivialHtmlRenderer,this._itemRenderer=WinJS.UI._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,c.itemDataSource)this._dataSource=c.itemDataSource;else{var d=new WinJS.Binding.List;this._dataSource=d.dataSource}this._selectionMode=WinJS.UI.SelectionMode.multi,this._tap=WinJS.UI.TapBehavior.invokeOnly,this._groupHeaderTap=WinJS.UI.GroupHeaderTapBehavior.invoke,this._swipeBehavior=WinJS.UI.SwipeBehavior.select,this._mode=new WinJS.UI._SelectionMode(this),this._setSwipeClass(),this._groups=new WinJS.UI._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),c.layout||this._updateLayout(new WinJS.UI.GridLayout),this._attachEvents(),this._runningInit=!0,WinJS.UI.setOptions(this,c),this._runningInit=!1,this._batchViewUpdates(n.rebuild,m.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(a){this._updateLayout(a),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(n.rebuild,m.medium,0,!0))}},pagesToLoad:{get:function(){return 2*WinJS.UI._VirtualizeContentsView._pagesToPrefetch+1},set:function(){p._deprecated(WinJS.UI._strings.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){p._deprecated(WinJS.UI._strings.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(a){function b(a){a.detail===o.DataSourceStatus.failure&&(c.itemDataSource=null,c.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var c=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",b,!1),this._groupDataSource=a,this._groupFocusCache=a&&this._supportsGroupHeaderKeyboarding?new WinJS.UI._GroupFocusCache(this):new WinJS.UI._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",b,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(n.rebuild,m.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?p.addClass(this._element,WinJS.UI._groupsClass):p.removeClass(this._element,WinJS.UI._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){p._deprecated(WinJS.UI._strings.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){p._deprecated(WinJS.UI._strings.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(a){if("string"==typeof a&&a.match(/^(none|single|multi)$/)){if(p.isPhone&&a===WinJS.UI.SelectionMode.single)return;return this._selectionMode=a,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),this._setSwipeClass(),void this._configureSelectionMode()}throw new WinJS.ErrorFromName("WinJS.UI.ListView.ModeIsInvalid",WinJS.UI._strings.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(a){p.isPhone&&a===WinJS.UI.TapBehavior.directSelect||(this._tap=a,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(a){this._groupHeaderTap=a,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(a){this._swipeBehavior=a,this._setSwipeClass()}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(a){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=a||(new WinJS.Binding.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(n.rebuild,m.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(a){this._setRenderer(a,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(n.rebuild,m.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(a){p._deprecated(WinJS.UI._strings.resetItemIsDeprecated),this._itemRelease=a}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(a){this._setRenderer(a,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(n.rebuild,m.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(a){p._deprecated(WinJS.UI._strings.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=a}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(a){if(!(0>a)){this._writeProfilerMark("set_indexOfFirstVisible("+a+"),info"),this._raiseViewLoading(!0);var b=this;this._batchViewUpdates(n.realize,m.high,function(){var c;return b._entityInRange({type:WinJS.UI.ObjectType.item,index:a}).then(function(a){return a.inRange?b._getItemOffset({type:WinJS.UI.ObjectType.item,index:a.index}).then(function(a){return c=a,b._ensureFirstColumnRange(WinJS.UI.ObjectType.item)}).then(function(){return c=b._correctRangeInFirstColumn(c,WinJS.UI.ObjectType.item),c=b._convertFromCanvasCoordinates(c),b._view.waitForValidScrollPosition(c.begin)}).then(function(a){var c=a<b._lastScrollPosition?"left":"right",d=b._viewport[b._scrollLength]-b._getViewportLength();return a=p._clamp(a,0,d),{position:a,direction:c}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var a=this._selection._getFocused(),b={index:a.index,type:a.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(a.type===WinJS.UI.ObjectType.groupHeader){var c=this._groups.group(a.index);c&&(b.key=c.key,b.showFocus=!(!c.header||!WinJS.Utilities.hasClass(c.header,WinJS.UI._itemFocusClass)))}else{var d=this._view.items.itemAt(a.index);if(d){var e=this._itemsManager._recordFromElement(d);b.key=e.item&&e.item.key,b.showFocus=!!d.parentNode.querySelector("."+o._itemFocusOutlineClass)}}return b},set:function(a){function b(b,d,e){var f=!!a.showFocus&&c._hasKeyboardFocus;c._unsetFocusOnItem(d),c._selection._setFocused(e,f),c._hasKeyboardFocus?(c._keyboardFocusInbound=f,c._setFocusOnItem(e)):c._tabManager.childFocus=d?b:null,e.type!==WinJS.UI.ObjectType.groupHeader&&(c._updateFocusCache(e.index),c._updater&&(c._updater.newSelectionPivot=e.index,c._updater.oldSelectionPivot=-1),c._selection._pivot=e.index)}this._hasKeyboardFocus=a.hasFocus||this._hasKeyboardFocus;var c=this;if(a.key&&(a.type!==WinJS.UI.ObjectType.groupHeader&&this._dataSource.itemFromKey||a.type===WinJS.UI.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var d=a.type===WinJS.UI.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=d.itemFromKey(a.key).then(function(d){if(c.oldCurrentItemKeyFetch=null,d){var e=a.type===WinJS.UI.ObjectType.groupHeader?c._groups.group(d.index).header:c._view.items.itemAt(d.index);b(e,!!e,{type:a.type||WinJS.UI.ObjectType.item,index:d.index})}})}else if(void 0!==a.index){var e;if(a.type===WinJS.UI.ObjectType.groupHeader){var f=c._groups.group(a.index);e=f&&f.header}else e=c._view.items.itemAt(a.index);b(e,!!e,{type:a.type||WinJS.UI.ObjectType.item,index:a.index})}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new c(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(a){p.isPhone||this._dragSource!==a&&(this._dragSource=a,this._setSwipeClass())}},itemsReorderable:{get:function(){return this._reorderable},set:function(a){p.isPhone||this._reorderable!==a&&(this._reorderable=a,this._setSwipeClass())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(a){this._maxDeferredItemCleanup=Math.max(0,+a||0)}},dispose:function(){this._dispose()},elementFromIndex:function(a){return this._view.items.itemAt(a)},indexOfElement:function(a){return this._view.items.index(a)},ensureVisible:function(a){var b=WinJS.UI.ObjectType.item,c=a;if(+a!==a&&(b=a.type,c=a.index),this._writeProfilerMark("ensureVisible("+b+": "+c+"),info"),!(0>c)){this._raiseViewLoading(!0);var d=this;this._batchViewUpdates(n.realize,m.high,function(){var a;return d._entityInRange({type:b,index:c}).then(function(c){return c.inRange?d._getItemOffset({type:b,index:c.index}).then(function(c){return a=c,d._ensureFirstColumnRange(b)}).then(function(){a=d._correctRangeInFirstColumn(a,b);var e=d._getViewportLength(),g=d._viewportScrollPosition,h=g+e,i=d._viewportScrollPosition,j=a.end-a.begin;a=d._convertFromCanvasCoordinates(a);var k=!1;if(b===WinJS.UI.ObjectType.groupHeader&&g<=a.begin){var l=d._groups.group(c.index).header;if(l){var m,n=WinJS.UI._getMargins(l);if(d._horizontalLayout){var o=d._rtl(),q=o?f(l)-n.right:l.offsetLeft-n.left;m=q+l.offsetWidth+(o?n.left:n.right)}else m=l.offsetTop+l.offsetHeight+n.top;k=h>=m}}k||(j>=h-g?i=a.begin:a.begin<g?i=a.begin:a.end>h&&(i=a.end-e));var r=i<d._lastScrollPosition?"left":"right",s=d._viewport[d._scrollLength]-e;return i=p._clamp(i,0,s),{position:i,direction:r}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){p._deprecated(WinJS.UI._strings.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(n.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(n.remeasure)},_entityInRange:function(a){if(a.type===WinJS.UI.ObjectType.item)return this._itemsCount().then(function(b){var c=p._clamp(a.index,0,b-1);return{inRange:c>=0&&b>c,index:c}});var b=p._clamp(a.index,0,this._groups.length()-1);return q.wrap({inRange:b>=0&&b<this._groups.length(),index:b})},_forceLayoutImpl:function(a){var b=this;this._versionManager.unlocked.then(function(){b._writeProfilerMark("_forceLayoutImpl viewChange("+a+"),info"),b._cancelAsyncViewWork(),b._pendingLayoutReset=!0,b._resizeViewport(),b._batchViewUpdates(a,m.low,function(){return{position:b._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){p.isPhone&&(this.tapBehavior===WinJS.UI.TapBehavior.toggleSelect&&this.selectionMode===WinJS.UI.SelectionMode.multi?p.addClass(this._canvas,WinJS.UI._selectionModeClass):p.removeClass(this._canvas,WinJS.UI._selectionModeClass))},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=WinJS.Utilities.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(a){var b={};b[this._scrollProperty]=a,WinJS.Utilities.setScrollPosition(this._viewport,b),this._currentScrollPosition=a}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(a){var b=this._horizontal()?this._rtl()?-a:a:0,c=this._horizontal()?0:a;this._canvas.style[h.scriptName]=0!==a?"translate( "+b+"px, "+c+"px)":"",this._canvasStartValue=a}},scrollPosition:{get:function(){return this._currentScrollPosition},set:function(a){var b=this;this._batchViewUpdates(n.realize,m.high,function(){return b._view.waitForValidScrollPosition(a).then(function(){var c=b._viewport[b._scrollLength]-b._getViewportLength();a=p._clamp(a,0,c);var d=a<b._lastScrollPosition?"left":"right";return{position:a,direction:d}})},!0)}},_setRenderer:function(a,b){var c;if(a){if("function"==typeof a)c=a;else if("object"==typeof a){if(WinJS.validation&&!a.renderItem)throw new WinJS.ErrorFromName("WinJS.UI.ListView.invalidTemplate",WinJS.UI._strings.invalidTemplate);c=a.renderItem}}else{if(WinJS.validation)throw new WinJS.ErrorFromName("WinJS.UI.ListView.invalidTemplate",WinJS.UI._strings.invalidTemplate);c=l}c&&(b?this._groupHeaderRenderer=c:this._itemRenderer=c)},_renderWithoutReuse:function(a,b){return b&&WinJS.Utilities._disposeElement(b),this._itemRenderer(a)},_isInsertedItem:function(a){return!!this._insertedItems[a.handle]},_clearInsertedItems:function(){for(var a=Object.keys(this._insertedItems),b=0,c=a.length;c>b;b++)this._insertedItems[a[b]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(a){this._view.stopWork(a)},_updateView:function(){function a(){c._itemsBlockExtent=-1,c._firstItemRange=null,c._firstHeaderRange=null,c._itemMargins=null,c._headerMargins=null,c._canvasMargins=null,c._cachedRTL=null,c._rtl()}function b(){c._scrollToPriority=m.uninitialized;var a=c._setScrollbarPosition;c._setScrollbarPosition=!1;var b="number"==typeof c._scrollToFunctor?{position:c._scrollToFunctor}:c._scrollToFunctor();return q.as(b).then(function(b){return b=b||{},a&&+b.position===b.position&&(c._lastScrollPosition=b.position,c._viewportScrollPosition=b.position),b},function(b){return c._setScrollbarPosition|=a,q.wrapError(b)})}if(!this._isZombie()){var c=this,d=this._viewChange;this._viewChange=n.realize,d===n.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),a(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(b,!0),this._setFocusOnItem(this._selection._getFocused())):d===n.remeasure?(this._view.resetItems(!0),this._resetLayout(),a(),this._view.refresh(b),this._setFocusOnItem(this._selection._getFocused())):d===n.relayout?(this._pendingLayoutReset&&(this._resetLayout(),a()),this._view.refresh(b)):this._view.onScroll(b)}},_batchViewUpdates:function(a,b,c,d,e){if(this._viewChange=Math.min(this._viewChange,a),(null===this._scrollToFunctor||b>=this._scrollToPriority)&&(this._scrollToPriority=b,this._scrollToFunctor=c),this._setScrollbarPosition|=!!d,!this._batchingViewUpdates){this._raiseViewLoading();var f=this;this._batchingViewUpdatesSignal=new WinJS._Signal,this._batchingViewUpdates=q.any([this._batchingViewUpdatesSignal.promise,r.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){return f._isZombie()?void 0:f._viewChange!==n.rebuild||f._firstTimeDisplayed||0===Object.keys(f._view.items._itemData).length||e?void 0:f._fadeOutViewport()}).then(function(){f._batchingViewUpdates=null,f._batchingViewUpdatesSignal=null,f._updateView(),f._firstTimeDisplayed=!1},function(){f._batchingViewUpdates=null,f._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var a=document.createElement("div");a.className=this._canvas.className,this._viewport.replaceChild(a,this._canvas),this._canvas=a,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){p.addClass(this._element,WinJS.UI._listViewClass),p[this._rtl()?"addClass":"removeClass"](this._element,WinJS.UI._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+WinJS.UI._viewportClass+" "+WinJS.UI._horizontalClass+'"><div class="'+WinJS.UI._scrollableClass+'"><div class="'+WinJS.UI._proxyClass+'"></div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"></div>',this._viewport=this._element.firstElementChild,this._canvas=this._viewport.firstElementChild,this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling,this._tabIndex=WinJS.Utilities.getTabIndex(this._element),this._tabIndex<0&&(this._tabIndex=0),this._tabManager=new WinJS.UI.TabContainer(this._viewport),this._tabManager.tabIndex=this._tabIndex,this._progressBar=document.createElement("progress"),p.addClass(this._progressBar,WinJS.UI._progressClass),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(a){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(a||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,WinJS.Utilities._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(a){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var b=this,c=function(c){b._isZombie()||(b._tabManager.childFocus!==c&&(b._tabManager.childFocus=c),b._focusRequest=null,b._hasKeyboardFocus&&!b._itemFocused&&(b._selection._keyboardFocused()&&b._drawFocusRectangle(c),b._view.updateAriaForAnnouncement(c,a.type===WinJS.UI.ObjectType.groupHeader?b._groups.length():b._cachedCount),b._itemFocused=!0,WinJS.Utilities._setActive(c)))};this._focusRequest=a.type!==WinJS.UI.ObjectType.groupHeader?this._view.items.requestItem(a.index):this._groups.requestHeader(a.index),this._focusRequest.then(c)}},_attachEvents:function(){function a(a,b,c){return{name:b?a:a.toLowerCase(),handler:function(b){d["_on"+a](b)},capture:c}}function b(a,b,c){return{capture:c,name:b?a:a.toLowerCase(),handler:function(b){var c=d._mode,e="on"+a;!d._disposed&&c[e]&&c[e](b)}}}function c(a,b){return{handler:function(b){d["_on"+a](b)},filter:b}}var d=this,e=[c("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,e.forEach(function(a){new WinJS.Utilities._MutationObserver(a.handler).observe(d._element,{attributes:!0,attributeFilter:a.filter})});var f=[b("PointerDown"),b("click",!1),b("PointerUp"),b("LostPointerCapture"),b("MSHoldVisual",!0),b("PointerCancel",!0),b("DragStart"),b("DragOver"),b("DragEnter"),b("DragLeave"),b("Drop"),b("ContextMenu"),b("MSManipulationStateChanged",!0,!0)];f.forEach(function(a){WinJS.Utilities._addEventListener(d._viewport,a.name,a.handler,!!a.capture)});var g=[a("FocusIn",!1,!1),a("FocusOut",!1,!1),b("KeyDown"),b("KeyUp"),a("MSElementResize",!1,!1)];g.forEach(function(a){WinJS.Utilities._addEventListener(d._element,a.name,a.handler,!!a.capture)});var h=[a("MSManipulationStateChanged",!0),a("Scroll")];h.forEach(function(a){d._viewport.addEventListener(a.name,a.handler,!1)}),this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this)),this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this)),this._viewport.addEventListener("onTabEntered",function(a){d._mode.onTabEntered(a)}),this._viewport.addEventListener("onTabExiting",function(a){d._mode.onTabExiting(a)})},_updateItemsManager:function(){function a(a){a.detail===o.DataSourceStatus.failure&&(b.itemDataSource=null,b.groupDataSource=null)}var b=this,c={beginNotifications:function(){},changed:function(a,c){if(!b._ifZombieDispose()){b._createUpdater();var d=b._updater.elements[k(c)];if(d){var e=b.selection._isIncluded(d.index);if(e&&(b._updater.updateDrag=!0),c!==a){if((b._tabManager.childFocus===c||b._updater.newFocusedItem===c)&&(b._updater.newFocusedItem=a,b._tabManager.childFocus=null),d.itemBox){p.addClass(a,WinJS.UI._itemClass),b._setupAriaSelectionObserver(a);var f=c.nextElementSibling;d.itemBox.removeChild(c),d.itemBox.insertBefore(a,f)}b._setAriaSelected(a,e),b._view.items.setItemAt(d.newIndex,{element:a,itemBox:d.itemBox,container:d.container,itemsManagerRecord:d.itemsManagerRecord}),delete b._updater.elements[k(c)],WinJS.Utilities._disposeElement(c),b._updater.elements[k(a)]={item:a,container:d.container,itemBox:d.itemBox,index:d.index,newIndex:d.newIndex,itemsManagerRecord:d.itemsManagerRecord}}else d.itemBox&&d.container&&(WinJS.UI._ItemEventsHandler.renderSelection(d.itemBox,a,e,!0),p[e?"addClass":"removeClass"](d.container,WinJS.UI._selectedClass));b._updater.changed=!0}for(var g=0,h=b._notificationHandlers.length;h>g;g++)b._notificationHandlers[g].changed(a,c);b._writeProfilerMark("changed,info")}},removed:function(a,c,d){function e(a){b._updater.updateDrag=!0,b._currentMode()._dragging&&b._currentMode()._draggingUnselectedItem&&b._currentMode()._dragInfo._isIncluded(a)&&(b._updater.newDragInfo=new WinJS.UI._Selection(b,[]));var c=b._updater.selectionFirst[a],d=b._updater.selectionLast[a],e=c||d;e&&(delete b._updater.selectionFirst[e.oldFirstIndex],delete b._updater.selectionLast[e.oldLastIndex],b._updater.selectionChanged=!0)}if(!b._ifZombieDispose()){b._createUpdater();var f=b._insertedItems[d];f&&delete b._insertedItems[d];var g;if(a){var h=b._updater.elements[k(a)],i=b._itemsManager.itemObject(a);if(i&&b._groupFocusCache.deleteItem(i.key),h){g=h.index,h.itemBox&&b._updater.removed.push({index:g,itemBox:h.itemBox}),b._updater.deletesCount++;var j=b._view.items.itemDataAt(g);j.removed=!0,delete b._updater.elements[k(a)]}else g=i&&i.index;b._updater.oldFocus.type!==WinJS.UI.ObjectType.groupHeader&&b._updater.oldFocus.index===g&&(b._updater.newFocus.index=g,b._updater.focusedItemRemoved=!0),e(g)}else g=b._updater.selectionHandles[d],g===+g&&e(g);b._writeProfilerMark("removed("+g+"),info"),b._updater.changed=!0}},updateAffectedRange:function(a){b._itemsCount().then(function(c){var d=b._view.containers?b._view.containers.length:0;a.start=Math.min(a.start,d),b._affectedRange.add(a,c)}),b._createUpdater(),b._updater.changed=!0},indexChanged:function(a,c,d){if(!b._ifZombieDispose()){if(b._createUpdater(),a){var e=b._itemsManager.itemObject(a);e&&b._groupFocusCache.updateItemIndex(e.key,c);var f=b._updater.elements[k(a)];f&&(f.newIndex=c,b._updater.changed=!0),b._updater.itemsMoved=!0}b._currentMode()._dragging&&b._currentMode()._draggingUnselectedItem&&b._currentMode()._dragInfo._isIncluded(d)&&(b._updater.newDragInfo=new WinJS.UI._Selection(b,[{firstIndex:c,lastIndex:c}]),b._updater.updateDrag=!0),b._updater.oldFocus.type!==WinJS.UI.ObjectType.groupHeader&&b._updater.oldFocus.index===d&&(b._updater.newFocus.index=c,b._updater.changed=!0),b._updater.oldSelectionPivot===d&&(b._updater.newSelectionPivot=c,b._updater.changed=!0);var g=b._updater.selectionFirst[d];g&&(g.newFirstIndex=c,b._updater.changed=!0,b._updater.updateDrag=!0),g=b._updater.selectionLast[d],g&&(g.newLastIndex=c,b._updater.changed=!0,b._updater.updateDrag=!0)}},endNotifications:function(){b._update()},inserted:function(a){b._ifZombieDispose()||(b._writeProfilerMark("inserted,info"),b._createUpdater(),b._updater.changed=!0,a.retain(),b._updater.insertsCount++,b._insertedItems[a.handle]=a)},moved:function(a,c,d,e){if(!b._ifZombieDispose()){if(b._createUpdater(),b._updater.movesCount++,a){b._updater.itemsMoved=!0;var f=b._updater.elements[k(a)];f&&(f.moved=!0)}var g=b._updater.selectionHandles[e.handle];if(g===+g){b._updater.updateDrag=!0;var h=b._updater.selectionFirst[g],i=b._updater.selectionLast[g],j=h||i;j&&j.oldFirstIndex!==j.oldLastIndex&&(delete b._updater.selectionFirst[j.oldFirstIndex],delete b._updater.selectionLast[j.oldLastIndex],b._updater.selectionChanged=!0,b._updater.changed=!0)}b._writeProfilerMark("moved("+g+"),info")}},countChanged:function(a,c){b._ifZombieDispose()||(b._writeProfilerMark("countChanged("+a+"),info"),b._cachedCount=a,b._createUpdater(),b._view.lastIndexDisplayed+1===c&&(b._updater.changed=!0),b._updater.countDifference+=a-c)},reload:function(){b._ifZombieDispose()||(b._writeProfilerMark("reload,info"),b._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new WinJS.UI._VersionManager,this._updater=null;var d=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",a,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=WinJS.UI._UNINITIALIZED,this._itemsManager=o._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),c,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(a){return a>=b.indexOfFirstVisible&&a<=b.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",a,!1),this._selection._selected.set(d)
},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(n.rebuild,m.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource instanceof WinJS.UI.VirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var a={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX},newSelectionPivot:{type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX},newFocus:{type:WinJS.UI.ObjectType.item,index:WinJS.UI._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(b,c,d){a.elements[k(c)]={item:c,container:d.container,itemBox:d.itemBox,index:b,newIndex:b,itemsManagerRecord:d.itemsManagerRecord,detached:d.detached}});for(var b=this._selection._selected._ranges,c=0,d=b.length;d>c;c++){var e=b[c],f={newFirstIndex:b[c].firstIndex,oldFirstIndex:b[c].firstIndex,newLastIndex:b[c].lastIndex,oldLastIndex:b[c].lastIndex};a.selectionFirst[f.oldFirstIndex]=f,a.selectionLast[f.oldLastIndex]=f,a.selectionHandles[e.firstPromise.handle]=f.oldFirstIndex,a.selectionHandles[e.lastPromise.handle]=f.oldLastIndex}a.oldSelectionPivot=this._selection._pivot,a.newSelectionPivot=a.oldSelectionPivot,a.oldFocus=this._selection._getFocused(),a.newFocus=this._selection._getFocused(),this._updater=a}},_synchronize:function(){var a=this._updater;this._updater=null;this._groupsChanged;if(this._groupsChanged=!1,this._countDifference=this._countDifference||0,a&&a.changed){a.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),a.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(a.removed.map(function(a){return a.itemBox})),(a.itemsMoved||a.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var b=[];for(var c in a.selectionFirst)if(a.selectionFirst.hasOwnProperty(c)){var d=a.selectionFirst[c];a.selectionChanged=a.selectionChanged||d.newLastIndex-d.newFirstIndex!=d.oldLastIndex-d.oldFirstIndex,d.newFirstIndex<=d.newLastIndex&&b.push({firstIndex:d.newFirstIndex,lastIndex:d.newLastIndex})}if(a.selectionChanged){var e=new WinJS.UI._Selection(this,b);this._selection._fireSelectionChanging(e),this._selection._selected.set(b),this._selection._fireSelectionChanged(),e.clear()}else this._selection._selected.set(b);this._selection._updateCount(this._cachedCount),a.newSelectionPivot=Math.min(this._cachedCount-1,a.newSelectionPivot),this._selection._pivot=a.newSelectionPivot>=0?a.newSelectionPivot:WinJS.UI._INVALID_INDEX,a.newFocus.type!==WinJS.UI.ObjectType.groupHeader&&(a.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,a.newFocus.index))),this._selection._setFocused(a.newFocus,this._selection._keyboardFocused());var f=this._modifiedElements||[],g={};for(this._modifiedElements=[],this._countDifference+=a.countDifference,c=0;c<f.length;c++){var h=f[c];-1===h.newIndex?this._modifiedElements.push(h):g[h.newIndex]=h}for(c=0;c<a.removed.length;c++){var i=a.removed[c],h=g[i.index];h?delete g[i.index]:h={oldIndex:i.index},h.newIndex=-1,h._removalHandled||(h._itemBox=i.itemBox),this._modifiedElements.push(h)}var j=Object.keys(this._insertedItems);for(c=0;c<j.length;c++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[j[c]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var k={};for(c in a.elements)if(a.elements.hasOwnProperty(c)){var l=a.elements[c];k[l.newIndex]={element:l.item,container:l.container,itemBox:l.itemBox,itemsManagerRecord:l.itemsManagerRecord,detached:l.detached};var h=g[l.index];h?(delete g[l.index],h.newIndex=l.newIndex):h={oldIndex:l.index,newIndex:l.newIndex},h.moved=l.moved,this._modifiedElements.push(h)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var m=Object.keys(g);for(c=0;c<m.length;c++){var n=m[c],h=g[n];-1!==h.oldIndex&&this._modifiedElements.push(h)}this._view.items._itemData=k,a.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?a.newDragInfo&&(this._currentMode()._dragInfo=a.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),a.focusedItemRemoved||this._focusRequest&&a.oldFocus.index!==a.newFocus.index||a.oldFocus.type!==a.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):a.newFocusedItem&&(this._hasKeyboardFocus=a.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var o=this;return this._groups.synchronizeGroups().then(function(){return a.newFocus.type===WinJS.UI.ObjectType.groupHeader&&(a.newFocus.index=Math.min(o._groups.length()-1,a.newFocus.index),a.newFocus.index<0&&(a.newFocus={type:WinJS.UI.ObjectType.item,index:0}),o._selection._setFocused(a.newFocus,o._selection._keyboardFocused())),o._versionManager.endUpdating(),a.deletesCount>0&&o._updateDeleteWrapperSize(),o._view.updateTree(o._cachedCount,o._countDifference,o._modifiedElements)}).then(function(){return o._lastScrollPosition})}this._countDifference+=a?a.countDifference:0;var o=this;return this._groups.synchronizeGroups().then(function(){return a&&o._versionManager.endUpdating(),o._view.updateTree(o._cachedCount,o._countDifference,o._modifiedElements)}).then(function(){return o.scrollPosition})},_updateDeleteWrapperSize:function(a){var b=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+b]=(a?0:this.scrollPosition+this._getViewportSize()[b])+"px"},_verifyRealizationNeededForChange:function(){var a=!1,b=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),c=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(c&&this._updater.elements)for(var d=Object.keys(this._updater.elements),e=0,f=d.length;f>e;e++){var g=this._updater.elements[d[e]],h=g.index-g.newIndex;if(0>h||h>this._updater.deletesCount){c=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,c&&this._view.lastIndexDisplayed<this._view.end-b&&this._updater.deletesCount+this._view.deletesWithoutRealize<b?(a=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(a)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var a=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(b){a._writeProfilerMark("update,StopTM"),a._batchViewUpdates(n.relayout,m.low,b).complete()})):this._batchViewUpdates(n.relayout,m.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var a=this;this._updateJob=r.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){a._updateJob&&a._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groups=this._groupDataSource?new WinJS.UI._UnvirtualizedGroupsContainer(this,this._groupDataSource):new WinJS.UI._NoGroups(this)},_createLayoutSite:function(){var a=this;return Object.create({invalidateLayout:function(){a._pendingLayoutReset=!0;var b="horizontal"===a._layout.orientation!==a._horizontalLayout;a._affectedRange.addAll(),a._batchViewUpdates(n.rebuild,m.low,b?0:a.scrollPosition,!1,!0)},itemFromIndex:function(b){return a._itemsManager._itemPromiseAtIndex(b)},groupFromIndex:function(b){return a._groupsEnabled()?b<a._groups.length()?a._groups.group(b).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(b){return b=Math.max(0,b),a._groups.groupFromItem(b)},renderItem:function(b){return WinJS.Promise._cancelBlocker(a._itemsManager._itemFromItemPromise(b)).then(function(b){if(b){var c=a._itemsManager._recordFromElement(b);c.pendingReady&&c.pendingReady(),b=b.cloneNode(!0),p.addClass(b,WinJS.UI._itemClass);var d=document.createElement("div");p.addClass(d,o._itemBoxClass),d.appendChild(b);var e=document.createElement("div");return p.addClass(e,o._containerClass),e.appendChild(d),e}return WinJS.Promise.cancel})},renderHeader:function(b){var c=WinJS.UI._normalizeRendererReturn(a.groupHeaderTemplate(q.wrap(b)));return c.then(function(a){p.addClass(a.element,o._headerClass);var b=document.createElement("div");return p.addClass(b,o._headerContainerClass),b.appendChild(a.element),b})},readyToMeasure:function(){a._getViewportLength(),a._getCanvasMargins()},_isZombie:function(){return a._isZombie()},_writeProfilerMark:function(b){a._writeProfilerMark(b)}},{_itemsManager:{enumerable:!0,get:function(){return a._itemsManager}},rtl:{enumerable:!0,get:function(){return a._rtl()}},surface:{enumerable:!0,get:function(){return a._canvas}},viewport:{enumerable:!0,get:function(){return a._viewport}},scrollbarPos:{enumerable:!0,get:function(){return a.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return a._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return a.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return a._animationsDisabled()}},tree:{enumerable:!0,get:function(){return a._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,a.scrollPosition-2*a._getViewportLength()),lastPixel:a.scrollPosition+3*a._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:a.scrollPosition,lastPixel:a.scrollPosition+a._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return a._itemsCount()}},groupCount:{enumerable:!0,get:function(){return a._groups.length()}}})},_initializeLayout:function(){this._affectedRange.addAll();var a=this._createLayoutSite();return this._layout.initialize(a,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(a){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",p.addClass(this._viewport,WinJS.UI._horizontalClass),p.removeClass(this._viewport,WinJS.UI._verticalClass),a&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",p.addClass(this._viewport,WinJS.UI._verticalClass),p.removeClass(this._viewport,WinJS.UI._horizontalClass),a&&WinJS.Utilities.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(a){var b=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),b=!0);var c;if(a&&"function"==typeof a.type){var d=u(a.type);c=new d(a)}else c=a&&a.initialize?a:new WinJS.UI.GridLayout(a);b&&this._resetCanvas(),this._layoutImpl=c,this._layout=new WinJS.UI._LayoutWrapper(c),b&&this._unsetFocusOnItem(),this._setFocusOnItem({type:WinJS.UI.ObjectType.item,index:0}),this._selection._setFocused({type:WinJS.UI.ObjectType.item,index:0}),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(b),b&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setSwipeClass:function(){!p.isPhone&&(this._currentMode()instanceof WinJS.UI._SelectionMode&&this._selectionAllowed()&&this._swipeBehavior===WinJS.UI.SwipeBehavior.select||this._dragSource||this._reorderable)?(this._swipeable=!0,p.addClass(this._element,WinJS.UI._swipeableClass)):(this._swipeable=!1,p.removeClass(this._element,WinJS.UI._swipeableClass));var a=this.itemsDraggable||this.itemsReorderable,b=this._selectionAllowed()&&this._swipeBehavior===WinJS.UI.SwipeBehavior.select,c=this._swipeable;this._view.items.each(function(d,e,f){if(f.itemBox){var g=p.hasClass(e,WinJS.UI._nonDraggableClass),h=p.hasClass(e,WinJS.UI._nonSelectableClass),i=p.hasClass(f.itemBox,WinJS.UI._nonSwipeableClass);if(f.itemBox.draggable=a&&!g,!c&&i)p.removeClass(f.itemBox,WinJS.UI._nonSwipeableClass);else if(c){var j=a&&!b&&g||b&&!a&&h||g&&h;j&&!i?p.addClass(f.itemBox,WinJS.UI._nonSwipeableClass):!j&&i&&p.removeClass(f.itemBox,WinJS.UI._nonSwipeableClass)}var k=p.isPhone&&h;p[k?"addClass":"removeClass"](f.itemBox,WinJS.UI._nonSelectableClass)}})},_resizeViewport:function(){this._viewportWidth=WinJS.UI._UNINITIALIZED,this._viewportHeight=WinJS.UI._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info"),r.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==WinJS.UI._UNINITIALIZED&&this._viewportHeight!==WinJS.UI._UNINITIALIZED){var a=this._element.offsetWidth,b=this._element.offsetHeight;if(this._previousWidth!==a||this._previousHeight!==b){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+a+"x"+b+"),info"),this._previousWidth=a,this._previousHeight=b,this._resizeViewport();var c=this;this._affectedRange.addAll(),this._batchViewUpdates(n.relayout,m.low,function(){return{position:c.scrollPosition,direction:"right"}})}}},r.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(a){function b(a){c._changeFocus(c._selection._getFocused(),!0,!1,!1,a)}this._hasKeyboardFocus=!0;var c=this;if(a.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?b(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(a.target===this._element)b();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var d=this._view.items,e={},f=this._groups.headerFrom(a.target),g=null;if(f?(e.type=WinJS.UI.ObjectType.groupHeader,e.index=this._groups.index(f)):(e.index=d.index(a.target),e.type=WinJS.UI.ObjectType.item,f=d.itemBoxAt(e.index),g=d.itemAt(e.index)),e.index!==WinJS.UI._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(e.type===WinJS.UI.ObjectType.groupHeader&&a.target===f||e.type===WinJS.UI.ObjectType.item&&a.target.parentNode===f)&&this._drawFocusRectangle(f),this._tabManager.childFocus!==f&&this._tabManager.childFocus!==g&&(this._selection._setFocused(e,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,f=e.type===WinJS.UI.ObjectType.groupHeader?f:d.itemAt(e.index),this._tabManager.childFocus=f,c._updater))){var h=c._updater.elements[k(f)],i=e.index;h&&h.newIndex&&(i=h.newIndex),c._updater.oldFocus={type:e.type,index:i},c._updater.newFocus={type:e.type,index:i}}}},_onFocusOut:function(a){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var b=this._view.items.itemBoxFrom(a.target)||this._groups.headerFrom(a.target);b&&this._clearFocusRectangle(b)}},_onMSManipulationStateChanged:function(a){function b(){c._manipulationEndSignal=null}var c=this;this._manipulationState=a.currentState,c._writeProfilerMark("_onMSManipulationStateChanged state("+a.currentState+"),info"),this._manipulationState===WinJS.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new WinJS._Signal,this._manipulationEndSignal.promise.done(b,b)),this._manipulationState===WinJS.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var a=this._viewportScrollPosition;if(a!==this._lastScrollPosition){this._pendingScroll=requestAnimationFrame(this._checkScroller.bind(this));var b=a<this._lastScrollPosition?"left":"right";a=Math.max(0,a),this._lastScrollPosition=a,this._raiseViewLoading(!0);var c=this;this._view.onScroll(function(){return{position:c._lastScrollPosition,direction:b}},this._manipulationEndSignal?this._manipulationEndSignal.promise:q.timeout(WinJS.UI._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(a){var b=this;a.forEach(function(a){var c=!1;if("dir"===a.attributeName?c=!0:"style"===a.attributeName&&(c=b._cachedStyleDir!=a.target.style.direction),c&&(b._cachedStyleDir=a.target.style.direction,b._cachedRTL=null,p[b._rtl()?"addClass":"removeClass"](b._element,WinJS.UI._rtlListViewClass),b._lastScrollPosition=0,b._viewportScrollPosition=0,b.forceLayout()),"tabIndex"===a.attributeName){var d=b._element.tabIndex;d>=0&&(b._view.items.each(function(a,b){b.tabIndex=d}),b._tabIndex=d,b._tabManager.tabIndex=d,b._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=WinJS.UI._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(a,b){function c(c,d){void 0!==a[c]&&(a[c]=b(a[c],d))}var d;return this._horizontal()?(d=this._getCanvasMargins()[this._rtl()?"right":"left"],c("left",d)):(d=this._getCanvasMargins().top,c("top",d)),c("begin",d),c("end",d),a},_convertFromCanvasCoordinates:function(a){return this._convertCoordinatesByCanvasMargins(a,function(a,b){return a+b})},_convertToCanvasCoordinates:function(a){return this._convertCoordinatesByCanvasMargins(a,function(a,b){return a-b})},_getViewportSize:function(){return(this._viewportWidth===WinJS.UI._UNINITIALIZED||this._viewportHeight===WinJS.UI._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,p.getContentWidth(this._element)),this._viewportHeight=Math.max(0,p.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function a(){b._itemsCountPromise=null}var b=this;if(this._cachedCount!==WinJS.UI._UNINITIALIZED)return q.wrap(this._cachedCount);var c;return this._itemsCountPromise?c=this._itemsCountPromise:(c=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(a){return a===o.CountResult.unknown&&(a=0),b._cachedCount=a,b._selection._updateCount(b._cachedCount),a},function(){return WinJS.Promise.cancel}),this._itemsCountPromise.then(a,a)),c},_isSelected:function(a){return this._selection._isIncluded(a)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(a){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!a),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_setViewState:function(a){if(a!==this._loadingState){var c=null;switch(a){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(b(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:c={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+a+",info"),this._loadingState=a;var d=document.createEvent("CustomEvent");d.initCustomEvent("loadingstatechanged",!0,!1,c),this._element.dispatchEvent(d)}},_createTemplates:function(){function a(a,b){var c=document.createElement("div");return c.className=a,b||c.setAttribute("aria-hidden",!0),c}this._itemBoxTemplate=a(WinJS.UI._itemBoxClass,!0)},_updateSelection:function(){var a=this._selection.getIndices(),b=this._selection.isEverything(),c={};if(!b)for(var d=0,e=a.length;e>d;d++){var f=a[d];c[f]=!0}this._view.items.each(function(a,d,e){if(e.itemBox&&!p.hasClass(e.itemBox,o._swipeClass)){var f=b||!!c[a];WinJS.UI._ItemEventsHandler.renderSelection(e.itemBox,d,f,!0),e.container&&p[f?"addClass":"removeClass"](e.container,WinJS.UI._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===window.getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(a,b,c){var d=this._progressBar,e=d.style;if(!d.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var f=this;this._progressIndicatorDelayTimer=q.timeout(WinJS.UI._LISTVIEW_PROGRESS_DELAY).then(function(){f._isZombie()||(a.appendChild(d),s.fadeInElement(d),f._progressIndicatorDelayTimer=null)})}e[this._rtl()?"right":"left"]=b,e.top=c},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var a=this._progressBar;if(a.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var b=this;s.fadeOutElement(a).then(function(){a.parentNode&&a.parentNode.removeChild(a),b._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(a,b,c){if(WinJS.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new WinJS.ErrorFromName("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",t.notCompatibleWithSemanticZoom);this._isZoomedOut=a,this._disableEntranceAnimation=!b,this._isCurrentZoomView=b,this._triggerZoom=c},_setCurrentItem:function(a,b){this._rtl()&&(a=this._viewportWidth-a),this._horizontal()?a+=this.scrollPosition:b+=this.scrollPosition;var c=this._view.hitTest(a,b),d={type:c.type?c.type:WinJS.UI.ObjectType.item,index:c.index};d.index>=0&&(this._hasKeyboardFocus?this._changeFocus(d,!0,!1,!0):this._changeFocusPassively(d))},_getCurrentItem:function(){var a=this._selection._getFocused();a.type===WinJS.UI.ObjectType.groupHeader&&(a={type:WinJS.UI.ObjectType.item,index:this._groups.group(a.index).startIndex}),"number"!=typeof a.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),a=this._selection._getFocused());var b=this,c=this._getItemOffsetPosition(a.index).then(function(a){var c=b._canvasStart;return a[b._startProperty]+=c,a});return q.join({item:this._dataSource.itemFromIndex(a.index),position:c})},_animateItemsForPhoneZoom:function(){function a(a,b,c){return function(d){return(b[d]-a)*c}}function b(){for(var a=0,b=c.length;b>a;a++)c[a].style[h.scriptName]=""}for(var c=[],d=[],e=[],f=Number.MAX_VALUE,g=this,i=this._view.firstIndexDisplayed,j=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);j>i;i++)e.push(this._view.waitForEntityPosition({type:WinJS.UI.ObjectType.item,index:i}).then(function(){c.push(g._view.items.containerAt(i));var a=0;if(g.layout._getItemPosition){var b=g.layout._getItemPosition(i);b.row&&(a=b.row)}d.push(a),f=Math.min(a,f)}));return WinJS.Promise.join(e).then(function(){return(0===c.length?WinJS.Promise.wrap():WinJS.UI.executeTransition(c,{property:h.cssName,delay:a(f,d,30),duration:100,timing:"ease-in-out",from:g._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:g._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(b,b)}).then(b,b)},_beginZoom:function(){this._zooming=!0;var a=null;if(WinJS.Utilities.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var b=this,c=function(){b._zoomAnimationPromise=null};this._zoomAnimationPromise=a=this._animateItemsForPhoneZoom().then(c,c)}else this._zoomAnimationPromise=new WinJS._Signal,a=this._zoomAnimationPromise.promise}else{var d=this._horizontal(),e=-this.scrollPosition;p.addClass(this._viewport,d?WinJS.UI._zoomingXClass:WinJS.UI._zoomingYClass),this._canvasStart=e,p.addClass(this._viewport,d?WinJS.UI._zoomingYClass:WinJS.UI._zoomingXClass)}return a},_positionItem:function(a,b){function c(a){return d._getItemOffsetPosition(a).then(function(c){var e,f=d._horizontal(),g=d._getCanvasMargins(),h=d._canvas[f?"offsetWidth":"offsetHeight"]+g[f?d._rtl()?"right":"left":"top"],i=f?d._viewportWidth:d._viewportHeight,j=f?"headerContainerWidth":"headerContainerHeight",k=d.layout._sizes,l=0;k&&k[j]&&(l=k[j]);var m=WinJS.Utilities.isPhone?l:b[d._startProperty],n=i-(f?c.width:c.height);m=Math.max(0,Math.min(n,m)),e=c[d._startProperty]-m;var o=Math.max(0,Math.min(h-i,e)),p=o-e;e=o;var q={type:WinJS.UI.ObjectType.item,index:a};if(d._hasKeyboardFocus?d._changeFocus(q,!0):d._changeFocusPassively(q),d._raiseViewLoading(!0),WinJS.Utilities.isPhone)d._viewportScrollPosition=e;else{var r=-e;d._canvasStart=r}if(d._view.realizePage(e,!0),WinJS.Utilities.isPhone&&d._isZoomedOut){var s=function(){d._zoomAnimationPromise&&d._zoomAnimationPromise.complete&&d._zoomAnimationPromise.complete(),d._zoomAnimationPromise=null};d._animateItemsForPhoneZoom().then(s,s)}return f?{x:p,y:0}:{x:0,y:p}})}var d=this,e=0;if(a&&(e=this._isZoomedOut?a.groupIndexHint:a.firstItemIndexHint),"number"==typeof e)return c(e);var f,g=this._isZoomedOut?a.groupKey:a.firstItemKey;if("string"==typeof g&&this._dataSource.itemFromKey)f=this._dataSource.itemFromKey(g,this._isZoomedOut?{groupMemberKey:a.key,groupMemberIndex:a.index}:null);else{var h=this._isZoomedOut?a.groupDescription:a.firstItemDescription;if(WinJS.validation&&void 0===h)throw new WinJS.ErrorFromName("WinJS.UI.ListView.InvalidItem",t.listViewInvalidItem);f=this._dataSource.itemFromDescription(h)}return f.then(function(a){return c(a.index)})},_endZoom:function(a){if(!this._isZombie()){if(!WinJS.Utilities.isPhone){var b=(this._horizontal(),this._canvasStart);p.removeClass(this._viewport,WinJS.UI._zoomingYClass),p.removeClass(this._viewport,WinJS.UI._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-b}this._disableEntranceAnimation=!a,this._isCurrentZoomView=a,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(a){var b=this;return this._getItemOffset({type:WinJS.UI.ObjectType.item,index:a}).then(function(a){return b._ensureFirstColumnRange(WinJS.UI.ObjectType.item).then(function(){return a=b._correctRangeInFirstColumn(a,WinJS.UI.ObjectType.item),a=b._convertFromCanvasCoordinates(a),b._horizontal()?(a.left=a.begin,a.width=a.end-a.begin,a.height=a.totalHeight):(a.top=a.begin,a.height=a.end-a.begin,a.width=a.totalWidth),a})})},_groupRemoved:function(a){this._groupFocusCache.deleteGroup(a)},_updateFocusCache:function(a){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var b=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(a).then(function(){b._updateFocusCacheItemRequest=null;var c=b._view.items.itemDataAt(a),d=b._groups.groupFromItem(a),e=b._groups.group(d).key;c.itemsManagerRecord.item&&b._groupFocusCache.updateCache(e,c.itemsManagerRecord.item.key,a)})},_changeFocus:function(a,b,c,d,e){if(!this._isZombie()){var f;if(a.type!==WinJS.UI.ObjectType.groupHeader)f=this._view.items.itemAt(a.index),!b&&f&&p.hasClass(f,WinJS.UI._nonSelectableClass)&&(b=!0),this._updateFocusCache(a.index);else{var g=this._groups.group(a.index);f=g&&g.header}this._unsetFocusOnItem(!!f),this._hasKeyboardFocus=!0,this._selection._setFocused(a,e),d||this.ensureVisible(a),!b&&this._selectFocused(c)&&this._selection.set(a.index),this._setFocusOnItem(a)}},_changeFocusPassively:function(a){var b;if(a.type!==WinJS.UI.ObjectType.groupHeader)b=this._view.items.itemAt(a.index),this._updateFocusCache(a.index);else{var c=this._groups.group(a.index);b=c&&c.header}this._unsetFocusOnItem(!!b),this._selection._setFocused(a),this._setFocusOnItem(a)},_drawFocusRectangle:function(a){if(WinJS.Utilities.hasClass(a,o._headerClass))WinJS.Utilities.addClass(a,o._itemFocusClass);else{var b=this._view.items.itemBoxFrom(a);if(b.querySelector("."+o._itemFocusOutlineClass))return;p.addClass(b,o._itemFocusClass);var c=document.createElement("div");c.className=o._itemFocusOutlineClass,b.appendChild(c)}},_clearFocusRectangle:function(a){if(a&&!this._isZombie()){var b=this._view.items.itemBoxFrom(a);if(b){p.removeClass(b,o._itemFocusClass);var c=b.querySelector("."+o._itemFocusOutlineClass);c&&c.parentNode.removeChild(c)}else{var d=this._groups.headerFrom(a);d&&p.removeClass(d,o._itemFocusClass)}}},_defaultInvoke:function(a){(this._isZoomedOut||WinJS.Utilities.isPhone&&this._triggerZoom&&a.type===WinJS.UI.ObjectType.groupHeader)&&(this._changeFocusPassively(a),this._triggerZoom())},_selectionAllowed:function(a){var b=void 0!==a?this.elementFromIndex(a):null,c=!(b&&p.hasClass(b,WinJS.UI._nonSelectableClass));return c&&this._selectionMode!==WinJS.UI.SelectionMode.none},_multiSelection:function(){return this._selectionMode===WinJS.UI.SelectionMode.multi},_selectOnTap:function(){return this._tap===WinJS.UI.TapBehavior.toggleSelect||this._tap===WinJS.UI.TapBehavior.directSelect},_selectFocused:function(a){return this._tap===WinJS.UI.TapBehavior.directSelect&&this._selectionMode===WinJS.UI.SelectionMode.multi&&!a},_dispose:function(){if(!this._disposed){this._disposed=!0;var a=function(a){a&&(a.textContent="")};this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),a(this._viewport),a(this._canvas),a(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var b=j.indexOf(this);b>=0&&j.splice(b,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&document.body.contains(this.element))},_ifZombieDispose:function(){var a=this._isZombie();return a&&!this._disposed&&b(this),a},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!WinJS.UI.isAnimationEnabled()},_fadeOutViewport:function(){var a=this;return new q(function(b){if(a._animationsDisabled())return void b();if(!a._fadingViewportOut){a._waitingEntranceAnimationPromise&&(a._waitingEntranceAnimationPromise.cancel(),a._waitingEntranceAnimationPromise=null);var c=a._fireAnimationEvent(WinJS.UI.ListViewAnimationType.contentTransition);a._firedAnimationEvent=!0;var d=WinJS.Utilities._browserStyleEquivalents["overflow-style"],e=d?a._viewport:a._canvas;c.prevented?(a._disableEntranceAnimation=!0,e.style.opacity=1,b()):(a._fadingViewportOut=!0,d&&(e.style[d.scriptName]="none"),s.fadeOutElement(e).then(function(){a._isZombie()||(a._fadingViewportOut=!1,e.style.opacity=1,b())}))}})},_animateListEntrance:function(a){function b(){d._canvas.style.opacity=1,e&&(f.style[e.scriptName]="")}var c={prevented:!1,animationPromise:q.wrap()},d=this,e=WinJS.Utilities._browserStyleEquivalents["overflow-style"],f=e?this._viewport:this._canvas;
return this._disableEntranceAnimation||this._animationsDisabled()?(b(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),q.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:c=this._fireAnimationEvent(WinJS.UI.ListViewAnimationType.entrance),c.prevented||WinJS.Utilities.isPhone?(b(),q.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,e&&(f.style[e.scriptName]="none"),this._waitingEntranceAnimationPromise=c.animationPromise.then(function(){return d._isZombie()?void 0:(d._canvas.style.opacity=1,s.animateEntrance(f,a).then(function(){d._isZombie()||(e&&(f.style[e.scriptName]=""),d._waitingEntranceAnimationPromise=null)}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(a){var b=document.createEvent("CustomEvent"),c=q.wrap();b.initCustomEvent("contentanimating",!0,!0,{type:a}),a===WinJS.UI.ListViewAnimationType.entrance&&(b.detail.setPromise=function(a){c=a});var d=!this._element.dispatchEvent(b);return{prevented:d,animationPromise:c}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",t.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=document.createElement("div"),this._ariaStartMarker.id=k(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=document.createElement("div"),this._ariaEndMarker.id=k(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var a,b,c=this,d=this._element.getAttribute("role");this._currentMode().staticMode()?(a="list",b="listitem"):(a="listbox",b="option"),(d!==a||this._itemRole!==b)&&(this._element.setAttribute("role",a),this._itemRole=b,this._view.items.each(function(a,b){b.setAttribute("role",c._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var a=this.groupHeaderTapBehavior===WinJS.UI.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==a){this._headerRole=a;for(var b=0,c=this._groups.length();c>b;b++){var d=this._groups.group(b).header;d&&d.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(a,b){var c="true"===a.getAttribute("aria-selected");b!==c&&a.setAttribute("aria-selected",b)},_setupAriaSelectionObserver:function(a){a._mutationObserver||(this._mutationObserver.observe(a,{attributes:!0,attributeFilter:["aria-selected"]}),a._mutationObserver=!0)},_itemPropertyChange:function(a){function b(a){a.forEach(function(a){a.item.setAttribute("aria-selected",!a.selected)})}if(!this._isZombie()){for(var c=this,d=c._selectionMode===WinJS.UI.SelectionMode.single,e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g].target,j=c._view.items.itemBoxFrom(i),k="true"===i.getAttribute("aria-selected");if(j&&k!==WinJS.Utilities._isSelectionRendered(j)){var l=c._view.items.index(j),m={index:l,item:i,selected:k};(c._selectionAllowed(l)?e:f).push(m)}}if(e.length>0){var n=new WinJS._Signal;c.selection._synchronize(n).then(function(){var a=c.selection._cloneSelection();return e.forEach(function(b){b.selected?a[d?"set":"add"](b.index):a.remove(b.index)}),c.selection._set(a)}).then(function(a){c._isZombie()||a||b(e),n.complete()})}b(f)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(a,b){var c=this;return this._view.waitForEntityPosition(a).then(function(){var d=a.type===WinJS.UI.ObjectType.groupHeader?c._view._getHeaderContainer(a.index):c._view.getContainer(a.index);if(d){if(c._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info"),c._view._expandedRange)var e=c._view._expandedRange.first.index,g=c._view._expandedRange.last.index;else b=!1;a.type===WinJS.UI.ObjectType.item?(b=!!b,b&=c._view._ensureContainerInDOM(a.index)):b=!1;var h=c._getItemMargins(a.type),i={left:c._rtl()?f(d)-h.right:d.offsetLeft-h.left,top:d.offsetTop-h.top,totalWidth:p.getTotalWidth(d),totalHeight:p.getTotalHeight(d),contentWidth:p.getContentWidth(d),contentHeight:p.getContentHeight(d)};return b&&c._view._forceItemsBlocksInDOM(e,g+1),c._zooming&&0!==c._canvasStart?i:c._convertToCanvasCoordinates(i)}return WinJS.Promise.cancel})},_getItemOffset:function(a,b){var c=this;return this._getItemPosition(a,b).then(function(b){var d=c._getItemMargins(a.type);if(c._horizontal()){var e=c._rtl();b.begin=b.left-d[e?"left":"right"],b.end=b.left+b.totalWidth+d[e?"right":"left"]}else b.begin=b.top-d.bottom,b.end=b.top+b.totalHeight+d.top;return b})},_getItemMargins:function(a){a=a||WinJS.UI.ObjectType.item;var b=this,c=function(a){var c,d=b._canvas.querySelector("."+a);d||(d=document.createElement("div"),p.addClass(d,a),b._viewport.appendChild(d),c=!0);var e=WinJS.UI._getMargins(d);return c&&b._viewport.removeChild(d),e};return a!==WinJS.UI.ObjectType.groupHeader?this._itemMargins?this._itemMargins:this._itemMargins=c(WinJS.UI._containerClass):this._headerMargins?this._headerMargins:this._headerMargins=c(WinJS.UI._headerContainerClass)},_fireAccessibilityAnnotationCompleteEvent:function(a,b,c,d){var e={firstIndex:a,lastIndex:b,firstHeaderIndex:+c||-1,lastHeaderIndex:+d||-1},f=document.createEvent("CustomEvent");f.initCustomEvent("accessibilityannotationcomplete",!0,!1,e),this._element.dispatchEvent(f)},_ensureFirstColumnRange:function(a){var b=a===WinJS.UI.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[b])return q.wrap();var c=this;return this._getItemOffset({type:a,index:0},!0).then(function(a){c[b]=a})},_correctRangeInFirstColumn:function(a,b){var c=b===WinJS.UI.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return c.begin===a.begin&&(a.begin=this._horizontal()?-this._getCanvasMargins()[this._rtl()?"right":"left"]:-this._getCanvasMargins().top),a},_updateContainers:function(a,b,c,d){function e(){var a=document.createElement("div");return a.className=WinJS.UI._containerClass,a}function f(a,b,c){b+c>m&&(c=m-b);var d,e,f=a.itemsContainer,g=f.itemsBlocks,h=g.length?g[g.length-1]:null,i=g.length?(g.length-1)*l._view._blockSize+h.items.length:0,j=c-i;if(j>0){if(h&&h.items.length<l._view._blockSize){var k=Math.min(j,l._view._blockSize-h.items.length);p.insertAdjacentHTMLUnsafe(h.element,"beforeend",WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",k)),d=h.items.length,e=h.element.children;for(var n=0;k>n;n++)h.items.push(e[d+n]);j-=k}var o=Math.floor(j/l._view._blockSize),s=j%l._view._blockSize,t="<div class='win-itemsblock'>"+WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",l._view._blockSize)+"</div>",u=WinJS.UI._repeat(t,o);s&&(u+="<div class='win-itemsblock'>"+WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",s)+"</div>",o++);var v=document.createElement("div");p.setInnerHTMLUnsafe(v,u);for(var e=v.children,n=0;o>n;n++){var w=e[n],x={element:w,items:WinJS.UI._nodeListToArray(w.children)};f.itemsBlocks.push(x)}}else if(0>j)for(var y=j;0>y;y++){var z=h.items.pop();!l._view._requireFocusRestore&&z.contains(document.activeElement)&&(l._view._requireFocusRestore=document.activeElement,l._unsetFocusOnItem()),h.element.removeChild(z),r.push(z),h.items.length||(f.element===h.element.parentNode&&f.element.removeChild(h.element),g.pop(),h=g[g.length-1])}for(var n=0,A=g.length;A>n;n++)for(var w=g[n],y=0;y<w.items.length;y++)q.push(w.items[y])}function g(a,b,c){for(var f=d.filter(function(a){return-1===a.oldIndex&&a.newIndex>=b&&a.newIndex<b+c}).sort(function(a,b){return a.newIndex-b.newIndex}),g=a.itemsContainer,h=0,i=f.length;i>h;h++){var j=f[h],k=j.newIndex-b,l=e(),m=k<g.items.length?g.items[k]:null;g.items.splice(k,0,l),g.element.insertBefore(l,m)}}function h(a,b,c){b+c>m&&(c=m-b);var d=a.itemsContainer,e=c-d.items.length;if(e>0){var f=d.element.children,g=f.length;p.insertAdjacentHTMLUnsafe(d.element,"beforeend",WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",e));for(var h=0;e>h;h++){var i=f[g+h];d.items.push(i)}}for(var h=e;0>h;h++){var i=d.items.pop();d.element.removeChild(i),r.push(i)}for(var h=0,j=d.items.length;j>h;h++)q.push(d.items[h])}function i(a,b){var c=l._view._createHeaderContainer(C),d={header:c,itemsContainer:{element:l._view._createItemsContainer(c)}};return d.itemsContainer[l._view._blockSize?"itemsBlocks":"items"]=[],l._view._blockSize?f(d,b,a.size):h(d,b,a.size),d}function j(a,c,e,f){for(var g,h,i=e+f-1,j=0,k=d.length;k>j;j++){var m=d[j];m.newIndex>=e&&m.newIndex<=i&&-1!==m.oldIndex&&(g!==+g||m.newIndex<g)&&(g=m.newIndex,h=m.newIndex-m.oldIndex)}if(g===+g){var n=0;for(j=0,k=d.length;k>j;j++){var m=d[j];m.newIndex>=e&&m.newIndex<g&&-1===m.oldIndex&&n++}var o=0,q=g-h;for(j=0,k=d.length;k>j;j++){var m=d[j];m.oldIndex>=c&&m.oldIndex<q&&-1===m.newIndex&&o++}h+=o,h-=n,h-=e-c;var r=a.itemsContainer;if(h>0){{var s=r.element.children;s.length}p.insertAdjacentHTMLUnsafe(r.element,"afterBegin",WinJS.UI._repeat("<div class='win-container win-backdrop'></div>",h));for(var t=0;h>t;t++){var u=s[t];r.items.splice(t,0,u)}}for(var t=h;0>t;t++){var u=r.items.shift();r.element.removeChild(u)}h&&l._affectedRange.add({start:e,end:e+f},b)}}function k(a){for(var b=0,c=0,d=l._view.tree.length;d>c;c++){var e=l._view.tree[c],f=e.itemsContainer.items.length,g=b+f-1;if(a>=b&&g>=a)return{group:c,item:a-b};b+=f}}var l=this,m=this._view.containers.length+(c>0?c:0),n=[],o={},q=[],r=[],s=[],t=0;if(!l._view._blockSize)for(var u=0,v=this._view.tree.length;v>u;u++)s.push(t),t+=this._view.tree[u].itemsContainer.items.length;if(!l._view._blockSize)for(var w=d.filter(function(a){return-1===a.newIndex&&!a._removalHandled}).sort(function(a,b){return b.oldIndex-a.oldIndex}),u=0,v=w.length;v>u;u++){var x=w[u];x._removalHandled=!0;var y=x._itemBox;x._itemBox=null;var z=k(x.oldIndex),A=this._view.tree[z.group],B=A.itemsContainer.items[z.item];B.parentNode.removeChild(B),p.hasClass(y,WinJS.UI._selectedClass)&&p.addClass(B,WinJS.UI._selectedClass),A.itemsContainer.items.splice(z.item,1),x.element=B}this._view._modifiedGroups=[];var C=this._canvasProxy;t=0;for(var u=0,v=a.length;v>u&&(!this._groupsEnabled()||m>t);u++){var D=a[u],E=this._view.keyToGroupIndex[D.key],F=this._view.tree[E];if(F)l._view._blockSize?f(F,t,D.size):(j(F,s[E],t,D.size),g(F,t,D.size),h(F,t,D.size)),n.push(F),o[D.key]=n.length-1,delete this._view.keyToGroupIndex[D.key],C=F.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:E,newIndex:n.length-1,element:F.header});else{var G=i(D,t);n.push(G),o[D.key]=n.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:n.length-1,element:G.header}),C=G.itemsContainer.element}t+=D.size}for(var H=[],I=[],J=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],u=0,v=J.length;v>u;u++){var z=this._view.keyToGroupIndex[J[u]],K=this._view.tree[z];if(I.push(K.header),H.push(K.itemsContainer.element),this._view._blockSize)for(var L=0;L<K.itemsContainer.itemsBlocks.length;L++)for(var M=K.itemsContainer.itemsBlocks[L],N=0;N<M.items.length;N++)r.push(M.items[N]);else for(var N=0;N<K.itemsContainer.items.length;N++)r.push(K.itemsContainer.items[N]);this._view._modifiedGroups.push({oldIndex:z,newIndex:-1,element:K.header})}for(var u=0,v=d.length;v>u;u++)if(-1===d[u].newIndex&&!d[u]._removalHandled){d[u]._removalHandled=!0;var y=d[u]._itemBox;d[u]._itemBox=null;var B;r.length?(B=r.pop(),p.empty(B)):B=e(),p.hasClass(y,WinJS.UI._selectedClass)&&p.addClass(B,WinJS.UI._selectedClass),B.appendChild(y),d[u].element=B}return this._view.tree=n,this._view.keyToGroupIndex=o,this._view.containers=q,{removedHeaders:I,removedItemsContainers:H}},_writeProfilerMark:function(a){var b="WinJS.UI.ListView:"+this._id+":"+a;WinJS.Utilities._writeProfilerMark(b),WinJS.log&&WinJS.log(b,null,"listviewprofiler")}},{triggerDispose:function(){WinJS.UI._disposeControls()}});return WinJS.Class.mix(d,WinJS.Utilities.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","accessibilityannotationcomplete")),WinJS.Class.mix(d,WinJS.UI.DOMEventMixin),d})})}),b("WinJS/Controls/FlipView/_PageManager",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_FlipPageManager:WinJS.Namespace._lazy(function(){function a(a){var b=a.winControl;return b&&b instanceof WinJS.UI.FlipView?!0:!1}function b(a){a.forEach(function(a){var b=a.target;b.winControl&&b.tabIndex>=0&&(b.winControl._pageManager._updateTabIndex(b.tabIndex),b.tabIndex=-1);var c=b.winControl;if(c&&c instanceof WinJS.UI.FlipView){var d=!1;"dir"===a.attributeName?d=!0:"style"===a.attributeName&&(d=c._cachedStyleDir!=b.style.direction),d&&(c._cachedStyleDir=b.style.direction,c._pageManager._rtl="rtl"===window.getComputedStyle(c._pageManager._flipperDiv,null).direction,c._pageManager.resized())}})}var c=WinJS.UI,d=WinJS.Utilities,e=WinJS.Utilities._uniqueID,f=d._browserStyleEquivalents,g=WinJS.Utilities.Scheduler,h=WinJS.UI.Animation,i=50,j=250,k={get badCurrentPage(){return WinJS.Resources._getWinJSString("ui/badCurrentPage").value}},l=WinJS.Class.define(function(a,e,f,g,h,i,j){this._visibleElements=[],this._flipperDiv=a,this._panningDiv=e,this._panningDivContainer=f,this._buttonVisibilityHandler=j,this._currentPage=null,this._rtl="rtl"===window.getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=g,this._itemSpacing=h,this._tabIndex=WinJS.Utilities.getTabIndex(a),this._tabIndex<0&&(this._tabIndex=0),a.tabIndex=-1,this._tabManager=new WinJS.UI.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=c._FlipPageManager.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=i;var k=this;this._panningDiv.addEventListener("keydown",function(a){k._blockTabs&&a.keyCode===d.Key.tab&&(a.stopImmediatePropagation(),a.preventDefault())},!0),WinJS.Utilities._addEventListener(this._flipperDiv,"focusin",function(a){a.target===k._flipperDiv&&k._currentPage.element&&WinJS.Utilities._setActive(k._currentPage.element)},!1),new WinJS.Utilities._MutationObserver(b).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._panningDiv.addEventListener("activate",function(){k._hasFocus=!0},!0),this._panningDiv.addEventListener("deactivate",function(){k._hasFocus=!1},!0),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(WinJS.Utilities._browserEventEquivalents.manipulationStateChanged,function(a){k._manipulationState=a.currentState,0===a.currentState&&a.target===k._panningDivContainer&&(k._itemSettledOn(),k._ensureCentered())},!0)},{initialize:function(a,b){var c=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._horizontal=b,!this._currentPage){this._bufferAriaStartMarker=document.createElement("div"),this._bufferAriaStartMarker.id=e(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),c=this._currentPage,this._panningDiv.appendChild(c.pageRoot);for(var d=2*this._bufferSize,f=0;d>f;f++)c=this._createFlipPage(c,this),this._panningDiv.appendChild(c.pageRoot);this._bufferAriaEndMarker=document.createElement("div"),this._bufferAriaEndMarker.id=e(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,a)},dispose:function(){var a=this._currentPage,b=a;do WinJS.Utilities._disposeElement(b.element),b=b.next;while(b!==a)},setOrientation:function(a){if(this._notificationsEndedSignal){var b=this;return void this._notificationsEndedSignal.promise.done(function(){b._notificationsEndedSignal=null,b.setOrientation(a)})}if(a!==this._horizontal){this._isOrientationChanging=!0,this._horizontal=a,this._forEachPage(function(a){var b=a.pageRoot.style;b.left="0px",b.top="0px"}),WinJS.Utilities.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:0});var c=this._panningDivContainer.style;c.overflowX="hidden",c.overflowY="hidden";var b=this;requestAnimationFrame(function(){b._isOrientationChanging=!1,c.overflowX=b._horizontal&&b._environmentSupportsTouch?"scroll":"hidden",c.overflowY=b._horizontal||!b._environmentSupportsTouch?"hidden":"scroll",b._ensureCentered()})}},resetState:function(a){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==a){var b=this.jumpToIndex(a,!0);if(!b&&WinJS.validation)throw new WinJS.ErrorFromName("WinJS.UI.FlipView.BadCurrentPage",k.badCurrentPage);return b}WinJS.Utilities.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var c=this,d=WinJS.Promise.wrap(!0);return this._itemsManager&&(d=c._itemsManager._firstItem().then(function(a){return c._currentPage.setElement(a),c._fetchPreviousItems(!0).then(function(){return c._fetchNextItems()}).then(function(){c._setButtonStates()})})),d.then(function(){c._tabManager.childFocus=c._currentPage.element,c._ensureCentered(),c._itemSettledOn()})},setNewItemsManager:function(a,b){this._itemsManager=a;var c=this;return this.resetState(b).then(function(){0!==b&&(c._tabManager.childFocus=c._currentPage.element,c._ensureCentered(),c._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var a=0,b=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return b&&(a=this._getElementIndex(b)),a},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var a=this._viewportStart(),b=this._lastScrollPos>a?this._getTailOfBuffer():this._getHeadOfBuffer();if(a!==this._lastScrollPos){for(;this._currentPage.element&&this._itemStart(this._currentPage)>a&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(b.prev),b=b.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=a&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(b.next),b=b.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=a,this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element),this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(a,b){var c=this;if(this._forEachPage(function(d){return d.element===b?(d===c._currentPage||d===c._currentPage.next?c._changeFlipPage(d,b,a):d.setElement(a,!0),!0):void 0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var d=this._navigationAnimationRecord.elementContainers,e=0,f=d.length;f>e;e++)d[e].element===b&&(c._changeFlipPage(d[e],b,a),d[e].element=a);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var a=this;this._forEachPage(function(b){b.pageRoot.style.width=a._panningDivContainerOffsetWidth+"px",b.pageRoot.style.height=a._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(a,b){if(!b){if(!this._itemsManager||!this._currentPage.element||0>a)return WinJS.Promise.wrap(!1);var c=this._getElementIndex(this._currentPage.element),d=Math.abs(a-c);if(0===d)return WinJS.Promise.wrap(!1)}var e=WinJS.Promise.wrap(!0),f=this;return e=e.then(function(){var c=f._itemsManager._itemPromiseAtIndex(a);return WinJS.Promise.join({element:f._itemsManager._itemFromItemPromise(c),item:c}).then(function(a){var c=a.element;return f._resetBuffer(c,b),c?(f._currentPage.setElement(c),f._fetchNextItems().then(function(){return f._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),e=e.then(function(a){return f._setButtonStates(),a})},startAnimatedNavigation:function(a,b,c){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var d=this._currentPage,f=a?this._currentPage.next:this._currentPage.prev;if(f.element){this._hasFocus&&WinJS.Utilities._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=a,this._navigationAnimationRecord.cancelAnimationCallback=b,this._navigationAnimationRecord.completionCallback=c,this._navigationAnimationRecord.oldCurrentPage=d,this._navigationAnimationRecord.newCurrentPage=f;var g=d.element,h=f.element;this._navigationAnimationRecord.newCurrentElement=h,d.setElement(null,!0),d.elementUniqueID=e(g),f.setElement(null,!0),f.elementUniqueID=e(h);var i=this._createDiscardablePage(g),j=this._createDiscardablePage(h);return i.pageRoot.itemIndex=this._getElementIndex(g),j.pageRoot.itemIndex=i.pageRoot.itemIndex+(a?1:-1),i.pageRoot.style.position="absolute",j.pageRoot.style.position="absolute",i.pageRoot.style.zIndex=1,j.pageRoot.style.zIndex=2,this._itemStart(i,0,0),this._itemStart(j,0,0),this._blockTabs=!0,this._visibleElements.push(h),this._announceElementVisible(h),this._navigationAnimationRecord.elementContainers=[i,j],{outgoing:i,incoming:j}}}return null},endAnimatedNavigation:function(a,b,c){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var d=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,b);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,c),d||this._viewportStart(this._itemStart(a?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(a,b,c){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._currentPage.element){var d=this._currentPage.element,f=this._getElementIndex(d),g=this;return g.jumpToIndex(a).then(function(h){if(!h)return null;if(g._navigationAnimationRecord={},g._navigationAnimationRecord.cancelAnimationCallback=b,g._navigationAnimationRecord.completionCallback=c,g._navigationAnimationRecord.oldCurrentPage=null,g._forEachPage(function(a){return a.element===d?(g._navigationAnimationRecord.oldCurrentPage=a,!0):void 0}),g._navigationAnimationRecord.newCurrentPage=g._currentPage,g._navigationAnimationRecord.newCurrentPage===g._navigationAnimationRecord.oldCurrentPage)return null;var i=g._currentPage.element;g._navigationAnimationRecord.newCurrentElement=i,g._currentPage.setElement(null,!0),g._currentPage.elementUniqueID=e(i),g._navigationAnimationRecord.oldCurrentPage&&g._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var j=g._createDiscardablePage(d),k=g._createDiscardablePage(i);return j.pageRoot.itemIndex=f,k.pageRoot.itemIndex=a,j.pageRoot.style.position="absolute",k.pageRoot.style.position="absolute",j.pageRoot.style.zIndex=1,k.pageRoot.style.zIndex=2,g._itemStart(j,0,0),g._itemStart(k,g._itemSize(g._currentPage),0),g._visibleElements.push(i),g._announceElementVisible(i),g._navigationAnimationRecord.elementContainers=[j,k],g._blockTabs=!0,{oldPage:j,newPage:k}})}return WinJS.Promise.wrap(null)},endAnimatedJump:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(a.element,!0):a.element.parentNode&&a.element.parentNode.removeChild(a.element),this._navigationAnimationRecord.newCurrentPage.setElement(b.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(a,b,c,d){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var f=this._prevMarker,g=!1,h=!1;if(d&&(this._createAnimationRecord(e(a),null),this._getAnimationRecord(a).inserted=!0),b){do{if(f===this._currentPage&&(g=!0),f.elementUniqueID===e(b)){h=!0;var i,j=f,k=a,l=e(a);if(g)for(;j.next!==this._prevMarker;)i=j.next.element,l=j.next.elementUniqueID,j.next.setElement(k,!0),!k&&l&&(j.next.elementUniqueID=l),k=i,j=j.next;else for(f.elementUniqueID===f.next.elementUniqueID&&f.elementUniqueID&&(j=f.next);j.next!==this._prevMarker;)i=j.element,l=j.elementUniqueID,j.setElement(k,!0),!k&&l&&(j.elementUniqueID=l),k=i,j=j.prev;if(k){var m=!1;this._forEachPage(function(a){return e(k)===a.elementUniqueID?(m=!0,!0):void 0}),m||this._releaseElementIfNotAnimated(k)}break}f=f.next}while(f!==this._prevMarker)}else if(c){for(;f.next!==this._prevMarker&&f.elementUniqueID!==e(c);)f===this._currentPage&&(g=!0),f=f.next;f.elementUniqueID===e(c)&&f!==this._prevMarker?(f.prev.setElement(a),h=!0):this._releaseElementIfNotAnimated(a)}else this._currentPage.setElement(a);this._getAnimationRecord(a).successfullyMoved=h,this._setButtonStates()},changed:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var c=(this._prevMarker,this);if(this._forEachPage(function(d){if(d.elementUniqueID===e(b)){var f=c._animationRecords[d.elementUniqueID];return f.changed=!0,f.oldElement=b,f.newElement=a,d.element=a,d.elementUniqueID=e(a),c._animationRecords[e(a)]=f,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var d=0,f=this._navigationAnimationRecord.elementContainers.length;f>d;d++){var g=this._navigationAnimationRecord.elementContainers[d];g&&g.elementUniqueID===e(b)&&(g.element=a,g.elementUniqueID=e(a))}var h=this._navigationAnimationRecord.newCurrentElement;h&&e(h)===e(b)&&(this._navigationAnimationRecord.newCurrentElement=a)}},moved:function(a,b,c){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var d=this._getAnimationRecord(a);d||(d=this._createAnimationRecord(e(a))),d.moved=!0,this.removed(a,!1,!1),b||c?this.inserted(a,b,c,!1):d.successfullyMoved=!1},removed:function(a,b,c){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var d=this,f=this._prevMarker,g=WinJS.Promise.wrap();if(b){var h=!1;return this._forEachPage(function(b){(b.elementUniqueID===e(a)||h)&&(b.setElement(null,!0),h=!0)}),void this._setButtonStates()}if(c){var i=this._getAnimationRecord(a);i&&(i.removed=!0)}if(this._currentPage.elementUniqueID===e(a))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(f.elementUniqueID===e(a))f.next.element?g=this._itemsManager._previousItem(f.next.element).then(function(b){return b===a&&(b=d._itemsManager._previousItem(b)),b}).then(function(a){f.setElement(a,!0)}):f.setElement(null,!0);else if(f.prev.elementUniqueID===e(a))f.prev.prev&&f.prev.prev.element?g=this._itemsManager._nextItem(f.prev.prev.element).then(function(b){return b===a&&(b=d._itemsManager._nextItem(b)),b}).then(function(a){f.prev.setElement(a,!0)}):f.prev.setElement(null,!0);else{for(var j=this._currentPage.prev,k=!1;j!==f&&!k;)j.elementUniqueID===e(a)&&(this._shiftRight(j),k=!0),j=j.prev;for(j=this._currentPage.next;j!==f&&!k;)j.elementUniqueID===e(a)&&(this._shiftLeft(j),k=!0),j=j.next}return g.then(function(){d._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(a){this._itemSpacing=a,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new WinJS._Signal,this._temporaryKeys=[],this._animationRecords={};var a=this;this._forEachPage(function(b){a._createAnimationRecord(b.elementUniqueID,b)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var a=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function b(b){var c=null;return a._forEachPage(function(a){return a.element===b?(c=a,!0):void 0}),c}function c(b,c){a._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var d=a._createDiscardablePage(c);a._itemStart(d,b.originalLocation),f.push(a._deleteFlipPage(d))}function d(c,d){a._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var e,g=c.originalLocation;if(c.successfullyMoved)e=b(d),g=c.newLocation;else{e=a._createDiscardablePage(d);var h=a._getElementIndex(d),i=a._currentPage.element?a._getElementIndex(a._currentPage.element):0;g+=i>h?-100*a._bufferSize:100*a._bufferSize}e&&(a._itemStart(e,c.originalLocation),f.push(a._moveFlipPage(e,function(){a._itemStart(e,g)})))}function e(){return 0===f.length&&f.push(WinJS.Promise.wrap()),WinJS.Promise.join(f)}var f=[];a._forEachPage(function(b){var c=a._getAnimationRecord(b.element);c&&(c.changed&&(c.oldElement.removedFromChange=!0,f.push(a._changeFlipPage(b,c.oldElement,c.newElement))),c.newLocation=b.location,a._itemStart(b,c.originalLocation),c.inserted&&(b.elementRoot.style.opacity=0))});var g=a._animationRecords.currentPage,h=a._getAnimationRecord(g),i=a._animationRecords.nextPage,j=a._getAnimationRecord(i);h&&h.changed&&(g=h.newElement),j&&j.changed&&(i=j.newElement),(g!==a._currentPage.element||i!==a._currentPage.next.element)&&(h&&h.removed&&c(h,g),j&&j.removed&&c(j,i)),a._blockTabs=!0,e().then(function(){f=[],h&&h.moved&&d(h,g),j&&j.moved&&d(j,i);var b=a._getAnimationRecord(a._currentPage.element),c=a._getAnimationRecord(a._currentPage.next.element);a._forEachPage(function(d){var e=a._getAnimationRecord(d.element);e&&(e.inserted?e!==b&&e!==c&&(d.elementRoot.style.opacity=1):e.originalLocation!==e.newLocation&&(e!==h&&e!==j||e===h&&!h.moved||e===j&&!j.moved)&&f.push(a._moveFlipPage(d,function(){a._itemStart(d,e.newLocation)})))}),e().then(function(){f=[],b&&b.inserted&&f.push(a._insertFlipPage(a._currentPage)),c&&c.inserted&&f.push(a._insertFlipPage(a._currentPage.next)),e().then(function(){a._checkElementVisibility(!1),a._itemSettledOn(),a._setListEnds(),a._notificationsStarted--,0===a._notificationsStarted&&a._notificationsEndedSignal.complete(),a._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),a._logBuffer(),a._endNotificationsWork=null})})})})},_timeoutPageSelection:function(){var a=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=WinJS.Promise.timeout(j).then(function(){a._itemSettledOn()})},_updateTabIndex:function(a){this._forEachPage(function(b){b.element&&(b.element.tabIndex=a)}),this._tabIndex=a,this._tabManager.tabIndex=a},_releaseElementIfNotAnimated:function(a){var b=this._getAnimationRecord(a);b&&(b.changed||b.inserted||b.moved||b.removed)||this._itemsManager.releaseItem(a)},_getAnimationRecord:function(a){return a?this._animationRecords[e(a)]:null},_createAnimationRecord:function(a,b){if(a){var c=this._animationRecords[a]={removed:!1,changed:!1,inserted:!1};return b&&(c.originalLocation=b.location),c}},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark(a),WinJS.UI.FlipView._enabledDebug&&WinJS.log&&WinJS.log(a,null,"flipviewdebug")},_getElementIndex:function(a){var b=0;try{b=this._itemsManager.itemObject(a).index}catch(c){}return b},_resetBuffer:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var c=this._currentPage,d=c;do d.element&&d.element===a||b?d.setElement(null,!0):d.setElement(null),d=d.next;while(d!==c)
},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var b=this._createFlipPage(a,this);return this._panningDiv.appendChild(b.pageRoot),b},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var a=WinJS.Promise.wrap(this._currentPage),b=this,c=0;c<this._bufferSize;c++)a=a.then(function(a){return a.next===b._prevMarker&&b._insertNewFlipPage(a),a.element?b._itemsManager._nextItem(a.element).then(function(b){return a.next.setElement(b),a.next}):(a.next.setElement(null),a.next)});return a},_fetchOneNext:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var b=a.prev.element;if(this._prevMarker===a&&(this._prevMarker=this._prevMarker.next),!b)return void a.setElement(null);var c=this;return this._itemsManager._nextItem(b).then(function(b){a.setElement(b),c._movePageAhead(a.prev,a)})},_fetchPreviousItems:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var b=this,c=WinJS.Promise.wrap(this._currentPage),d=0;d<this._bufferSize;d++)c=c.then(function(a){return a.element?b._itemsManager._previousItem(a.element).then(function(b){return a.prev.setElement(b),a.prev}):(a.prev.setElement(null),a.prev)});return c.then(function(c){a&&(b._prevMarker=c)})},_fetchOnePrevious:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var b=a.next.element;if(this._prevMarker===a.next&&(this._prevMarker=this._prevMarker.prev),!b)return a.setElement(null),WinJS.Promise.wrap();var c=this;return this._itemsManager._previousItem(b).then(function(b){a.setElement(b),c._movePageBehind(a.next,a)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._itemStart(this._currentPage,i*this._viewportSize());for(var b=this._currentPage;b!==this._prevMarker;)this._movePageBehind(b,b.prev),b=b.prev;for(b=this._currentPage;b.next!==this._prevMarker;)this._movePageAhead(b,b.next),b=b.next;var c=!1;this._lastScrollPos&&!a&&(this._setListEnds(),c=!0),this._lastScrollPos=this._itemStart(this._currentPage),this._viewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),c||this._setListEnds()},_ensureBufferConsistency:function(){var a=this,b=this._currentPage.element;if(!b)return WinJS.Promise.wrap();var c=!1,d={},e={};this._forEachPage(function(a){if(a&&a.elementUniqueID){if(d[a.elementUniqueID])return c=!0,!0;if(d[a.elementUniqueID]=!0,a.location>0){if(e[a.location])return c=!0,!0;e[a.location]=!0}}});var f=Object.keys(this._animationRecords);return f.forEach(function(b){var d=a._animationRecords[b];d&&(d.changed||d.inserted||d.moved||d.removed)&&(c=!0)}),c?(this._resetBuffer(null,!0),this._currentPage.setElement(b),this._fetchNextItems().then(function(){return a._fetchPreviousItems(!0)}).then(function(){a._ensureCentered()})):WinJS.Promise.wrap()},_shiftLeft:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var b=a,c=null;b!==this._prevMarker&&b.next!==this._prevMarker;)c=b.next.element,!c&&b.next.elementUniqueID&&(b.elementUniqueID=b.next.elementUniqueID),b.next.setElement(null,!0),b.setElement(c,!0),b=b.next;if(b!==this._prevMarker&&b.prev.element){var d=this;return this._itemsManager._nextItem(b.prev.element).then(function(a){b.setElement(a),d._createAnimationRecord(b.elementUniqueID,b)})}},_logBuffer:function(){if(WinJS.UI.FlipView._enabledDebug){WinJS.log&&WinJS.log(this._currentPage.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"	"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),WinJS.log&&WinJS.log(this._currentPage.next.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"	"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),WinJS.log&&WinJS.log("> "+this._currentPage.elementUniqueID+"	@:"+this._currentPage.location+(this._currentPage.element?"	"+this._currentPage.element.textContent:""),null,"flipviewdebug"),WinJS.log&&WinJS.log(this._currentPage.next.elementUniqueID+"	@:"+this._currentPage.next.location+(this._currentPage.next.element?"	"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),WinJS.log&&WinJS.log(this._currentPage.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"	"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var a=Object.keys(this._itemsManager._elementMap),b=[];this._forEachPage(function(a){a&&a.elementUniqueID&&b.push(a.elementUniqueID)}),WinJS.log&&WinJS.log("itemsmanager  = ["+a.join(" ")+"] flipview ["+b.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var b=a,c=null;b!==this._prevMarker;)c=b.prev.element,!c&&b.prev.elementUniqueID&&(b.elementUniqueID=b.prev.elementUniqueID),b.prev.setElement(null,!0),b.setElement(c,!0),b=b.prev;if(b.next.element){var d=this;return this._itemsManager._previousItem(b.next.element).then(function(a){b.setElement(a),d._createAnimationRecord(b.elementUniqueID,b)})}},_checkElementVisibility:function(a){var b,c;if(a){var d=this._currentPage.element;for(b=0,c=this._visibleElements.length;c>b;b++)this._visibleElements[b]!==d&&this._announceElementInvisible(this._visibleElements[b]);this._visibleElements=[],d&&(this._visibleElements.push(d),this._announceElementVisible(d))}else{for(b=0,c=this._visibleElements.length;c>b;b++)(!this._visibleElements[b].parentNode||this._visibleElements[b].removedFromChange)&&this._announceElementInvisible(this._visibleElements[b]);this._visibleElements=[];var e=this;this._forEachPage(function(a){var b=a.element;b&&(e._itemInView(a)?(e._visibleElements.push(b),e._announceElementVisible(b)):e._announceElementInvisible(b))})}},_announceElementVisible:function(a){if(a&&!a.visible){a.visible=!0;var b=document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),b.initCustomEvent(c.FlipView.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),a.dispatchEvent(b)}},_announceElementInvisible:function(a){if(a&&a.visible){a.visible=!1;var b=!1;a.parentNode||(b=!0,this._panningDivContainer.appendChild(a));var d=document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),d.initCustomEvent(c.FlipView.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),a.dispatchEvent(d),b&&this._panningDivContainer.removeChild(a)}},_createDiscardablePage:function(a){var b=this._createPageContainer(),c={pageRoot:b.root,elementRoot:b.elementContainer,discardable:!0,element:a,elementUniqueID:e(a),discard:function(){c.pageRoot.parentNode&&c.pageRoot.parentNode.removeChild(c.pageRoot),c.element.parentNode&&c.element.parentNode.removeChild(c.element)}};return c.pageRoot.style.top="0px",c.elementRoot.appendChild(a),this._panningDiv.appendChild(c.pageRoot),c},_createPageContainer:function(){var a=this._panningDivContainerOffsetWidth,b=this._panningDivContainerOffsetHeight,c=document.createElement("div"),d=c.style,e=document.createElement("div");return e.className="win-item",d.position="absolute",d.overflow="hidden",d.width=a+"px",d.height=b+"px",c.appendChild(e),{root:c,elementContainer:e}},_createFlipPage:function(b,c){var f={};f.element=null,f.elementUniqueID=null,b?(f.prev=b,f.next=b.next,f.next.prev=f,b.next=f):(f.next=f,f.prev=f);var g=this._createPageContainer();return f.elementRoot=g.elementContainer,f.elementRoot.style.msOverflowStyle="auto",f.pageRoot=g.root,f.setElement=function(b,g){if(void 0===b&&(b=null),b===f.element)return void(b||(f.elementUniqueID=null));if(f.element&&(g||(c._itemsManager.releaseItem(f.element),WinJS.Utilities._disposeElement(f.element))),f.element=b,f.elementUniqueID=b?e(b):null,d.empty(f.elementRoot),f.element){if(f===c._currentPage&&(c._tabManager.childFocus=b),!a(f.element)){f.element.tabIndex=c._tabIndex,f.element.setAttribute("role","option"),f.element.setAttribute("aria-selected",!1),f.element.id||(f.element.id=e(f.element));var h=function(a,b,c){a.setAttribute(c,b.id)},i=!f.next.element||f===c._prevMarker.prev;i&&(h(f.element,c._bufferAriaEndMarker,"aria-flowto"),h(c._bufferAriaEndMarker,f.element,"x-ms-aria-flowfrom")),f!==c._prevMarker&&f.prev.element&&(h(f.prev.element,f.element,"aria-flowto"),h(f.element,f.prev.element,"x-ms-aria-flowfrom")),f.next!==c._prevMarker&&f.next.element&&(h(f.element,f.next.element,"aria-flowto"),h(f.next.element,f.element,"x-ms-aria-flowfrom")),f.prev.element||h(f.element,c._bufferAriaStartMarker,"x-ms-aria-flowfrom")}f.elementRoot.appendChild(f.element)}},f},_itemInView:function(a){return this._itemEnd(a)>this._viewportStart()&&this._itemStart(a)<this._viewportEnd()},_viewportStart:function(a){if(this._panningDivContainer.parentNode)if(this._horizontal){if(void 0===a)return WinJS.Utilities.getScrollPosition(this._panningDivContainer).scrollLeft;WinJS.Utilities.setScrollPosition(this._panningDivContainer,{scrollLeft:a})}else{if(void 0===a)return this._panningDivContainer.scrollTop;this._panningDivContainer.scrollTop=a}},_viewportEnd:function(){var a=this._panningDivContainer;return this._horizontal?this._rtl?this._viewportStart()+this._panningDivContainerOffsetWidth:WinJS.Utilities.getScrollPosition(a).scrollLeft+this._panningDivContainerOffsetWidth:a.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._horizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_itemStart:function(a,b){return void 0===b?a.location:(this._horizontal?a.pageRoot.style.left=(this._rtl?-b:b)+"px":a.pageRoot.style.top=b+"px",void(a.location=b))},_itemEnd:function(a){return(this._horizontal?a.location+this._panningDivContainerOffsetWidth:a.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._horizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(a,b){var c=this._itemSize(a)+this._itemSpacing;this._itemStart(b,this._itemStart(a)+c)},_movePageBehind:function(a,b){var c=this._itemSize(a)+this._itemSpacing;this._itemStart(b,this._itemStart(a)-c)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var a=this._panningDivContainer.style;a[f["scroll-snap-type"].scriptName]="mandatory";var b=this._viewportSize(),c=b+this._itemSpacing,d="scroll-snap-points",e=0,g=this._itemStart(this._currentPage);e=g%(b+this._itemSpacing),a[f[this._horizontal?d+"-x":d+"-y"].scriptName]="snapInterval("+e+"px, "+c+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var a=this._panningDivContainer.style,b=0,c=0,d=this._getTailOfBuffer(),e=this._getHeadOfBuffer(),g=f["scroll-limit-"+(this._horizontal?"x-min":"y-min")].scriptName,h=f["scroll-limit-"+(this._horizontal?"x-max":"y-max")].scriptName;!e.element&&(e=e.prev,e!=this._prevMarker.prev););for(;!d.element&&(d=d.next,d!=this._prevMarker););c=this._itemStart(e),b=this._itemStart(d),a[g]=b+"px",a[h]=c+"px"}},_viewportOnItemStart:function(){return this._itemStart(this._currentPage)===this._viewportStart()},_restoreAnimatedElement:function(a,b){var c=!0;return a.elementUniqueID!==e(b.element)||a.element?this._forEachPage(function(a){a.elementUniqueID!==b.elementUniqueID||a.element||(a.setElement(b.element,!0),c=!1)}):(a.setElement(b.element,!0),c=!1),c},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var b=this;WinJS.Utilities._setImmediate(function(){b._viewportOnItemStart()&&(b._blockTabs=!1,b._currentPage.element&&(b._hasFocus&&(WinJS.Utilities._setActive(b._currentPage.element),b._tabManager.childFocus=b._currentPage.element),b._lastSelectedElement!==b._currentPage.element&&(b._lastSelectedPage&&b._lastSelectedPage.element&&!a(b._lastSelectedPage.element)&&b._lastSelectedPage.element.setAttribute("aria-selected",!1),b._lastSelectedPage=b._currentPage,b._lastSelectedElement=b._currentPage.element,a(b._currentPage.element)||b._currentPage.element.setAttribute("aria-selected",!0),g.schedule(function(){if(b._currentPage.element){var a=document.createEvent("CustomEvent");a.initCustomEvent(c.FlipView.pageSelectedEvent,!0,!1,{source:b._flipperDiv}),b._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),b._currentPage.element.dispatchEvent(a);var d=b._currentPage.element;if(d){var e=b._itemsManager._recordFromElement(d,!0);e&&e.renderComplete.then(function(){d===b._currentPage.element&&(b._currentPage.element.setAttribute("aria-setsize",b._cachedSize),b._currentPage.element.setAttribute("aria-posinset",b.currentIndex()+1),b._bufferAriaStartMarker.setAttribute("aria-flowto",b._currentPage.element.id),a=document.createEvent("CustomEvent"),a.initCustomEvent(c.FlipView.pageCompletedEvent,!0,!1,{source:b._flipperDiv}),b._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),b._currentPage.element.dispatchEvent(a))})}}},g.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent"))))})},_forEachPage:function(a){for(var b=!0,c=this._prevMarker;b&&!a(c);)c=c.next,b=c!==this._prevMarker},_changeFlipPage:function(a,b,c){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),a.element=null,a.setElement?a.setElement(c,!0):(b.parentNode.removeChild(b),a.elementRoot.appendChild(c));var d=b.style;return d.position="absolute",d.left="0px",d.top="0px",d.opacity=1,a.pageRoot.appendChild(b),b.style.left=Math.max(0,(a.pageRoot.offsetWidth-b.offsetWidth)/2)+"px",b.style.top=Math.max(0,(a.pageRoot.offsetHeight-b.offsetHeight)/2)+"px",h.fadeOut(b).then(function(){b.parentNode&&b.parentNode.removeChild(b)})},_deleteFlipPage:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:_deleteFlipPage,info"),a.elementRoot.style.opacity=0;var b=h.createDeleteFromListAnimation([a.elementRoot]),c=this;return b.execute().then(function(){a.discardable&&(a.discard(),c._itemsManager.releaseItem(a.element))})},_insertFlipPage:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:_insertFlipPage,info"),a.elementRoot.style.opacity=1;var b=h.createAddToListAnimation([a.elementRoot]);return b.execute().then(function(){a.discardable&&a.discard()})},_moveFlipPage:function(a,b){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:_moveFlipPage,info");var c=h.createRepositionAnimation(a.pageRoot);b();var d=this;return c.execute().then(function(){if(a.discardable){a.discard();var b=d._getAnimationRecord(a.element);b&&!b.successfullyMoved&&d._itemsManager.releaseItem(a.element)}})}},{supportedForProcessing:!1});return l.flipPageBufferCount=2,l})})}),b("WinJS/Controls/FlipView",["./FlipView/_PageManager","require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{FlipView:WinJS.Namespace._lazy(function(){function a(a){var b=a[0].target.winControl;b&&b instanceof WinJS.UI.FlipView&&a.some(function(a){return"dir"===a.attributeName?!0:"style"===a.attributeName?b._cachedStyleDir!=a.target.style.direction:!1})&&(b._cachedStyleDir=b._flipviewDiv.style.direction,b._rtl="rtl"===window.getComputedStyle(b._flipviewDiv,null).direction,b._setupOrientation())}function b(a){var b=a.target&&a.target.winControl;b&&b instanceof WinJS.UI.FlipView&&(WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:resize,StartTM"),b._resize())}var c=WinJS.UI,d=WinJS.Utilities,e=WinJS.Utilities.Scheduler,f=WinJS.UI.Animation,g="win-navbutton",h="win-flipview",i="win-navleft",j="win-navright",k="win-navtop",l="win-navbottom",m="Previous",n="Next",o=3e3,p=500,q="&#57570;",r="&#57571;",s="&#57572;",t="&#57573;",u=40,v={get badAxis(){return WinJS.Resources._getWinJSString("ui/badAxis").value},get badCurrentPage(){return WinJS.Resources._getWinJSString("ui/badCurrentPage").value},get noitemsManagerForCount(){return WinJS.Resources._getWinJSString("ui/noitemsManagerForCount").value},get badItemSpacingAmount(){return WinJS.Resources._getWinJSString("ui/badItemSpacingAmount").value},get navigationDuringStateChange(){return WinJS.Resources._getWinJSString("ui/flipViewNavigationDuringStateChange").value},get panningContainerAriaLabel(){return WinJS.Resources._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},w=WinJS.Class.define(function(a,b){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,a=a||document.createElement("div");var c=!0,e=null,f=WinJS.UI._trivialHtmlRenderer,g=0,h=0;if(b){if(b.orientation&&"string"==typeof b.orientation)switch(b.orientation.toLowerCase()){case"horizontal":c=!0;break;case"vertical":c=!1}b.currentPage&&(g=b.currentPage>>0,g=0>g?0:g),b.itemDataSource&&(e=b.itemDataSource),b.itemTemplate&&(f=this._getItemRenderer(b.itemTemplate)),b.itemSpacing&&(h=b.itemSpacing>>0,h=0>h?0:h)}if(!e){var i=new WinJS.Binding.List;e=i.dataSource}d.empty(a),this._flipviewDiv=a,WinJS.UI._setOptions(this,b,!0),this._initializeFlipView(a,c,e,f,g,h),a.winControl=this,WinJS.Utilities.addClass(a,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),window.addEventListener("wheel",this._windowWheelHandlerBound),WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(window.removeEventListener("wheel",this._windowWheelHandlerBound),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:next,info");var a=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,a)},previous:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:prev,info");var a=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,a)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(a){if(WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var b=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){b._pageManager._notificationsEndedSignal=null,b.currentPage=a})}if(!this._animating||this._cancelAnimation())if(a>>=0,a=0>a?0:a,this._refreshTimer)this._indexAfterRefresh=a;else{this._pageManager._cachedSize>0?a=Math.min(this._pageManager._cachedSize-1,a):0===this._pageManager._cachedSize&&(a=0);var b=this;if(this._jumpingToIndex===a)return;var c=function(){b._jumpingToIndex=null};this._jumpingToIndex=a;var d=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),e=this._jumpAnimation?null:this._cancelDefaultAnimation,f=function(){b._completeJump()};this._pageManager.startAnimatedJump(a,e,f).then(function(a){if(a){b._animationsStarted();var e=a.oldPage.pageRoot,g=a.newPage.pageRoot;b._contentDiv.appendChild(e),b._contentDiv.appendChild(g),b._completeJumpPending=!0,d(e,g).then(function(){b._completeJumpPending&&(f(),WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(c,c)}else c()},c)}}},orientation:{get:function(){return this._axisAsString()},set:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_orientation,info");var b="horizontal"===a;b!==this._horizontal&&(this._horizontal=b,this._setupOrientation(),this._pageManager.setOrientation(this._horizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=a||(new WinJS.Binding.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(a),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemSpacing,info"),a>>=0,a=0>a?0:a,this._pageManager.setItemSpacing(a)}},count:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:count,info");var a=this;return new WinJS.Promise(function(b,d){a._itemsManager?a._pageManager._cachedSize===WinJS.UI.CountResult.unknown||a._pageManager._cachedSize>=0?b(a._pageManager._cachedSize):a._dataSource.getCount().then(function(c){a._pageManager._cachedSize=c,b(c)}):d(c.FlipView.noitemsManagerForCount)})},setCustomAnimations:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==a.next&&(this._nextAnimation=a.next),void 0!==a.previous&&(this._prevAnimation=a.previous),void 0!==a.jump&&(this._jumpAnimation=a.jump)},forceLayout:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(e,f,g,i,j,k){function l(a){a.setAttribute("aria-hidden",!0),a.style.visibility="hidden",a.style.opacity=0,a.tabIndex=-1,a.style.zIndex=1e3}function o(a){if(a.pointerType!==x){if(w._touchInteraction=!1,a.screenX===w._lastMouseX&&a.screenY===w._lastMouseY)return;w._lastMouseX=a.screenX,w._lastMouseY=a.screenY,w._mouseInViewport=!0,w._fadeInButton("prev"),w._fadeInButton("next"),w._fadeOutButtons()}}this._flipviewDiv=e,d.addClass(this._flipviewDiv,h),this._contentDiv=document.createElement("div"),this._panningDivContainer=document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=document.createElement("div"),this._prevButton=document.createElement("button"),this._nextButton=document.createElement("button"),this._horizontal=f,this._dataSource=g,this._itemRenderer=i,this._itemsManager=null,this._pageManager=null;for(var p=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],q=!0,r=WinJS.Utilities._browserStyleEquivalents,s=0,t=p.length;t>s;s++)q=q&&!!r[p[s]];q=q&&!!WinJS.Utilities._browserEventEquivalents.manipulationStateChanged,this._environmentSupportsTouch=q;var u=this._flipviewDiv.getAttribute("aria-label");u||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",v.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),l(this._prevButton),l(this._nextButton),this._prevButton.setAttribute("aria-label",m),this._nextButton.setAttribute("aria-label",n),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton);var w=this;this._itemsManagerCallback={inserted:function(a,b,c){w._itemsManager._itemFromPromise(a).then(function(a){var d=w._itemsManager._elementFromHandle(b),e=w._itemsManager._elementFromHandle(c);w._pageManager.inserted(a,d,e,!0)})},countChanged:function(a,b){w._pageManager._cachedSize=a,b!==WinJS.UI.CountResult.unknown&&w._fireDatasourceCountChangedEvent()},changed:function(a,b){w._pageManager.changed(a,b)},moved:function(a,b,c,d){var e=function(a){w._pageManager.moved(a,b,c)};a?e(a):w._itemsManager._itemFromPromise(d).then(e)},removed:function(a,b){a&&w._pageManager.removed(a,b,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){w._cancelAnimation(),w._pageManager.notificationsStarted()},endNotifications:function(){w._pageManager.notificationsEnded()},itemAvailable:function(a,b){w._pageManager.itemRetrieved(a,b)},reload:function(){w._pageManager.reload()}},this._dataSource&&(this._itemsManager=c._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new c._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,k,q,{hidePreviousButton:function(){w._hasPrevContent=!1,w._fadeOutButton("prev"),w._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){w._hasPrevContent=!0,w._fadeInButton("prev"),w._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){w._hasNextContent=!1,w._fadeOutButton("next"),w._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){w._hasNextContent=!0,w._fadeInButton("next"),w._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(j,this._horizontal,this._environmentSupportsTouch),this._dataSource.getCount().then(function(a){w._pageManager._cachedSize=a}),this._prevButton.addEventListener("click",function(){w.previous()},!1),this._nextButton.addEventListener("click",function(){w.next()},!1),new WinJS.Utilities._MutationObserver(a).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._flipviewDiv.addEventListener("mselementresize",b),this._contentDiv.addEventListener("mouseleave",function(){w._mouseInViewport=!1},!1);var x=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._contentDiv.addEventListener("pointermove",o,!1),this._contentDiv.addEventListener("pointerdown",function(a){a.pointerType===x?(w._mouseInViewport=!1,w._touchInteraction=!0,w._fadeOutButtons(!0)):(w._touchInteraction=!1,w._isInteractive(a.target)||0!==(4&a.buttons)&&(a.stopPropagation(),a.preventDefault()))},!1),this._contentDiv.addEventListener("pointerup",function(a){a.pointerType!==x&&(w._touchInteraction=!1)},!1),this._panningDivContainer.addEventListener("scroll",function(){w._scrollPosChanged()},!1),this._panningDiv.addEventListener("deactivate",function(){w._touchInteraction||w._fadeOutButtons()},!0),this._flipviewDiv.addEventListener("DOMNodeInserted",function(a){a.target===w._flipviewDiv&&w._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(a){var b=!0;if(!w._isInteractive(a.target)){var c=d.Key,e=!1;if(w._horizontal)switch(a.keyCode){case c.leftArrow:w._rtl?w.next():w.previous(),e=!0;break;case c.pageUp:w.previous(),e=!0;break;case c.rightArrow:w._rtl?w.previous():w.next(),e=!0;break;case c.pageDown:w.next(),e=!0;break;case c.upArrow:case c.downArrow:e=!0,b=!1}else switch(a.keyCode){case c.upArrow:case c.pageUp:w.previous(),e=!0;break;case c.downArrow:case c.pageDown:w.next(),e=!0;break;case c.space:e=!0}switch(a.keyCode){case c.home:w.currentPage=0,e=!0;break;case c.end:w._pageManager._cachedSize>0&&(w.currentPage=w._pageManager._cachedSize-1),e=!0}if(e)return a.preventDefault(),a.cancelBubble=b,!0}},!1)},_windowWheelHandler:function(a){var b=a.target&&(this._flipviewDiv.contains(a.target)||this._flipviewDiv===a.target),c=this,d=WinJS.Utilities._now(),e=this._avoidTrappingTime>d;(!b||e)&&(this._avoidTrappingTime=d+p),b&&e&&(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",WinJS.Utilities._yieldForDomModification(function(){c._pageManager._ensureCentered(),c._horizontal?(c._panningDivContainer.style.overflowX=c._environmentSupportsTouch?"scroll":"hidden",c._panningDivContainer.style.overflowY="hidden"):(c._panningDivContainer.style.overflowY=c._environmentSupportsTouch?"scroll":"hidden",c._panningDivContainer.style.overflowX="hidden")}))},_isInteractive:function(a){if(a.parentNode)for(var b=a.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),c=0,d=b.length;d>c;c++)if(b[c]===a)return!0;return!1},_refreshHandler:function(){var a=this._dataSourceAfterRefresh||this._dataSource,b=this._itemRendererAfterRefresh||this._itemRenderer,c=this._indexAfterRefresh||0;this._setDatasource(a,b,c),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var a=this;this._refreshTimer=!0,e.schedule(function(){a._refreshTimer&&!a._disposed&&a._refreshHandler()},e.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(a){var b=null;if("function"==typeof a){var c=new WinJS.Promise(function(){}),d=a(c);b=d.element?"object"==typeof d.element&&"function"==typeof d.element.then?function(b){var c=document.createElement("div");return c.className="win-template",WinJS.Utilities.markDisposable(c),{element:c,renderComplete:a(b).element.then(function(a){c.appendChild(a)})}}:a:function(b){var c=document.createElement("div");return c.className="win-template",WinJS.Utilities.markDisposable(c),{element:c,renderComplete:b.then(function(){return WinJS.Promise.as(a(b)).then(function(a){c.appendChild(a)})})}}}else"object"==typeof a&&(b=a.renderItem);return b},_navigate:function(a,b){if(WinJS.validation&&this._refreshTimer)throw new WinJS.ErrorFromName("WinJS.UI.FlipView.NavigationDuringStateChange",v.navigationDuringStateChange);if(this._animating||(this._animatingForward=a),this._goForward=a,this._animating&&!this._cancelAnimation())return!1;var c=this,d=a?this._nextAnimation:this._prevAnimation,e=d?d:this._defaultAnimation.bind(this),f=function(a){c._completeNavigation(a)},g=this._pageManager.startAnimatedNavigation(a,b,f);if(g){this._animationsStarted();var h=g.outgoing.pageRoot,i=g.incoming.pageRoot;return this._contentDiv.appendChild(h),this._contentDiv.appendChild(i),this._completeNavigationPending=!0,e(h,i).then(function(){c._completeNavigationPending&&f(c._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(a,b){a.style.opacity=0,b.style.animationName="",b.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var a=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(a&&(a=a.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var b=this._pageManager._navigationAnimationRecord.elementContainers[0],c=this._pageManager._navigationAnimationRecord.elementContainers[1],d=b.pageRoot,e=c.pageRoot;return a&&a(d,e),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(a){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var b=this._pageManager._navigationAnimationRecord.elementContainers[0],c=this._pageManager._navigationAnimationRecord.elementContainers[1],d=b.pageRoot,e=c.pageRoot;d.parentNode&&d.parentNode.removeChild(d),e.parentNode&&e.parentNode.removeChild(e),this._pageManager.endAnimatedNavigation(a,b,c),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()
}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var a=this._pageManager._navigationAnimationRecord.elementContainers[0],b=this._pageManager._navigationAnimationRecord.elementContainers[1],c=a.pageRoot,d=b.pageRoot;c.parentNode&&c.parentNode.removeChild(c),d.parentNode&&d.parentNode.removeChild(d),this._pageManager.endAnimatedJump(a,b),this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(a){return this._pageManager.jumpToIndex(a)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(a,b,d){this._animating&&this._cancelAnimation();var e=0;void 0!==d&&(e=d),this._dataSource=a,this._itemRenderer=b;var f=this._itemsManager;this._itemsManager=c._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var g=this;this._dataSource.getCount().then(function(a){g._pageManager._cachedSize=a}),this._pageManager.setNewItemsManager(this._itemsManager,e),f&&f.release()},_fireDatasourceCountChangedEvent:function(){var a=this;e.schedule(function(){var b=document.createEvent("Event");b.initEvent(c.FlipView.datasourceCountChangedEvent,!0,!0),WinJS.Utilities._writeProfilerMark("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),a._flipviewDiv.dispatchEvent(b)},e.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._horizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._horizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var a="rtl"===window.getComputedStyle(this._flipviewDiv,null).direction;this._rtl=a,a?(this._prevButton.className=g+" "+j,this._nextButton.className=g+" "+i):(this._prevButton.className=g+" "+i,this._nextButton.className=g+" "+j),this._prevButton.innerHTML=a?r:q,this._nextButton.innerHTML=a?q:r}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=g+" "+k,this._nextButton.className=g+" "+l,this._prevButton.innerHTML=s,this._nextButton.innerHTML=t;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(a,b){(this._mouseInViewport||b||!this._environmentSupportsTouch)&&("next"===a&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===a&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(a){var b=this;return"next"===a?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=f.fadeOut(this._nextButton).then(function(){b._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=f.fadeOut(this._prevButton).then(function(){b._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(a){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var b=this;this._buttonFadePromise=(a?WinJS.Promise.wrap():WinJS.Promise.timeout(WinJS.UI._animationTimeAdjustment(o))).then(function(){b._fadeOutButton("prev"),b._fadeOutButton("next"),b._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(a,b){var c={};b.style.left="0px",b.style.top="0px",b.style.opacity=0;var d=a.itemIndex>b.itemIndex?-u:u;c.left=(this._horizontal?this._rtl?-d:d:0)+"px",c.top=(this._horizontal?0:d)+"px";var e=f.fadeOut(a),g=f.enterContent(b,[c],{mechanism:"transition"});return WinJS.Promise.join([e,g])},_fadeInFromCurrentValue:function(a){return c.executeTransition(a,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}});return w.datasourceCountChangedEvent="datasourcecountchanged",w.pageVisibilityChangedEvent="pagevisibilitychanged",w.pageSelectedEvent="pageselected",w.pageCompletedEvent="pagecompleted",WinJS.Class.mix(w,WinJS.Utilities.createEventProperties(w.datasourceCountChangedEvent,w.pageVisibilityChangedEvent,w.pageSelectedEvent,w.pageCompletedEvent)),WinJS.Class.mix(w,WinJS.UI.DOMEventMixin),w})})}),b("WinJS/Controls/ItemContainer/_ItemEventsHandler",["../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return{x:a.x/b,y:a.y/b,z:a.z/b}}function k(a,b){var c=j(b),d=Math.cos(a),e=Math.sin(a),f=[d+c.x*c.x*(1-d),c.x*c.y*(1-d)-c.z*e,c.x*c.z*(1-d)+c.y*e,0,c.y*c.x*(1-d)+c.z*e,d+c.y*c.y*(1-d),c.y*c.z*(1-d)-c.x*e,0,c.z*c.x*(1-d)-c.y*e,c.z*c.y*(1-d)+c.x*e,d+c.z*c.z*(1-d),0,0,0,0,1];return f=f.map(function(a){return a.toFixed(8)}),"matrix3d("+f.join(",")+")"}function l(a,b,c){var d=g._clamp((a-c.left)/c.width,0,1),e=g._clamp((b-c.top)/c.height,0,1),f={x:e-.5,y:-(d-.5),z:1e-4},h=Math.abs(d-.5)+Math.abs(e-.5),i=h*n,j=1-(1-h)*o,l="perspective(800px) scale("+j+", "+j+") "+k(i,f);return l}var m=b._browserStyleEquivalents.transform,n=.15,o=.025,p=g._uniqueID,q=g._MSManipulationEvent,r={_rotationTransform3d:k,_tiltTransform:l,_ItemEventsHandler:a.Namespace._lazy(function(){function j(a,b){return a.querySelector("."+b)}function k(a,b){var c=document.createElement("div");return c.className=a,b||c.setAttribute("aria-hidden",!0),c}var n=g._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",o=a.Class.define(function(a){if(this._site=a,this._work=[],this._animations={},this._selectionHintTracker={},this._swipeClassTracker={},!WinJS.Utilities.isPhone&&this._selectionAllowed()){var b=this;setTimeout(function(){b._gestureRecognizer||a.isZombie()||(b._gestureRecognizer=b._createGestureRecognizer())},500)}},{dispose:function(){this._disposed||(this._disposed=!0,this._gestureRecognizer=null,window.removeEventListener("pointerup",this._resetPointerDownStateBound),window.removeEventListener("pointercancel",this._resetPointerDownStateBound))},onMSManipulationStateChanged:function(a){var b=a.currentState;if(b===q.MS_MANIPULATION_STATE_PRESELECT&&!this._site.pressedItemBox){var c=this._site.indexForItemElement(a.target);if(this._site.pressedEntity={type:h.ObjectType.item,index:c},this._site.pressedEntity.index!==i._INVALID_INDEX){this._site.pressedItemBox=this._site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=this._site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=WinJS.Utilities.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null;var d=this._site.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=d.canSelect,this._canTapSelect=d.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._canSelect&&this._addSelectionHint()}}!this._canSelect||b!==q.MS_MANIPULATION_STATE_PRESELECT&&b!==q.MS_MANIPULATION_STATE_COMMITTED&&b!==q.MS_MANIPULATION_STATE_CANCELLED&&b!==q.MS_MANIPULATION_STATE_SELECTING&&b!==q.MS_MANIPULATION_STATE_DRAGGING||this._dispatchSwipeBehavior(b),(b===q.MS_MANIPULATION_STATE_COMMITTED||b===q.MS_MANIPULATION_STATE_CANCELLED||b===q.MS_MANIPULATION_STATE_STOPPED)&&this.resetPointerDownState()},onPointerDown:function(a){c("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var d,e,f=this._site,j=a.pointerType===n;if(f.pressedElement=a.target,b.hasWinRT){var k=this._getCurrentPoint(a),l=k.properties;j||l.isInverted||l.isEraser||l.isMiddleButtonPressed?d=e=!1:(e=l.isRightButtonPressed,d=!e&&l.isLeftButtonPressed)}else d=a.button===i._LEFT_MSPOINTER_BUTTON,e=a.button===i._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this),this._swipeBehaviorState=q.MS_MANIPULATION_STATE_STOPPED;var m=f.swipeBehavior===h.SwipeBehavior.select,o=this._isInteractive(a.target),p=f.indexForItemElement(a.target),r=f.indexForHeaderElement(a.target),s=!o&&p!==i._INVALID_INDEX;if((j||d||this._selectionAllowed()&&m&&e)&&this._site.pressedEntity.index===i._INVALID_INDEX&&!o&&(this._site.pressedEntity=r===i._INVALID_INDEX?{type:h.ObjectType.item,index:p}:{type:h.ObjectType.groupHeader,index:r},this._site.pressedEntity.index!==i._INVALID_INDEX)){this._site.pressedPosition=g._getCursorPos(a);var t=f.verifySelectionAllowed(this._site.pressedEntity);if(this._canSelect=t.canSelect,this._canTapSelect=t.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._site.pressedEntity.type!==h.ObjectType.groupHeader?(this._site.pressedItemBox=f.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=f.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=WinJS.Utilities.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,!1,a),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),j||(g._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),g._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(a.target),WinJS.Utilities.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,!1,a)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),j||(g._addEventListener(window,"pointerup",this._resetPointerDownStateBound,!1),g._addEventListener(window,"pointercancel",this._resetPointerDownStateBound,!1)),this._canSelect&&!WinJS.Utilities.isPhone&&(this._gestureRecognizer||(this._gestureRecognizer=this._createGestureRecognizer()),this._addSelectionHint()),this._pointerId=a.pointerId,this._pointerRightButton=e,this._pointerTriggeredSRG=!1,this._gestureRecognizer&&j)try{this._gestureRecognizer.addPointer(this._pointerId)}catch(u){this._gestureRecognizer.stop()}}if(s&&j)try{g._setPointerCapture(f.canvasProxy,a.pointerId)}catch(u){return void c("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type!==h.ObjectType.groupHeader&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==i._INVALID_INDEX&&f.selection._getFocused().index!==i._INVALID_INDEX&&f.selection._pivot===i._INVALID_INDEX&&(f.selection._pivot=f.selection._getFocused().index),c("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(a){this._site.pressedContainer&&this._pointerId===a.pointerId&&this._togglePressed(!0,!1,a)},onPointerLeave:function(a){this._site.pressedContainer&&this._pointerId===a.pointerId&&this._togglePressed(!1,!0,a)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),g._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),g._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(a){if(!this._skipClick){var b={type:h.ObjectType.item,index:this._site.indexForItemElement(a.target)};if(b.index===i._INVALID_INDEX&&(b.index=this._site.indexForHeaderElement(a.target),b.index!==i._INVALID_INDEX&&(b.type=h.ObjectType.groupHeader)),b.index!==i._INVALID_INDEX&&(g.hasClass(a.target,this._site.accessibleItemClass)||g.hasClass(a.target,i._headerClass))){var c=this._site.verifySelectionAllowed(b);c.canTapSelect&&this.handleTap(b),this._site.fireInvokeEvent(b,a.target)}}},onPointerUp:function(a){c("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var d=this._site;this._skipClick=!0;var e=this,f=this._site.swipeBehavior===h.SwipeBehavior.select;b._yieldForEvents(function(){e._skipClick=!1});try{g._releasePointerCapture(d.canvasProxy,a.pointerId)}catch(j){}var k=a.pointerType===n,l=this._releasedElement(a),m=d.indexForItemElement(l),o=d.indexForHeaderElement(l&&g.hasClass(l,i._headerContainerClass)?d.pressedHeader:l);if(this._pointerId===a.pointerId){var p;if(p=o===i._INVALID_INDEX?{type:h.ObjectType.item,index:m}:{type:h.ObjectType.groupHeader,index:o},this._resetPressedContainer(),this._site.pressedEntity.type!==h.ObjectType.groupHeader&&p.type!==h.ObjectType.groupHeader&&this._site.pressedContainer&&this._site.pressedEntity.index===p.index)if(a.shiftKey||(d.selection._pivot=i._INVALID_INDEX),a.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&d.selection._pivot!==i._INVALID_INDEX){var r=Math.min(this._site.pressedEntity.index,d.selection._pivot),s=Math.max(this._site.pressedEntity.index,d.selection._pivot),t=this._pointerRightButton||a.ctrlKey||d.tapBehavior===h.TapBehavior.toggleSelect;d.selectRange(r,s,t)}}else(a.ctrlKey||this._selectionAllowed()&&f&&this._pointerRightButton)&&this.handleSwipeBehavior(this._site.pressedEntity.index);if((this._site.pressedHeader||this._site.pressedContainer)&&this._swipeBehaviorState!==q.MS_MANIPULATION_STATE_COMMITTED){var u=g._getCursorPos(a),v=Math.abs(u.left-this._site.pressedPosition.left)<=i._TAP_END_THRESHOLD&&Math.abs(u.top-this._site.pressedPosition.top)<=i._TAP_END_THRESHOLD;this._endSelfRevealGesture(),this._clearItem(this._site.pressedEntity,this._isSelected(this._site.pressedEntity.index)),this._pointerRightButton||this._pointerTriggeredSRG||a.ctrlKey||a.shiftKey||!(k&&v||!k&&this._site.pressedEntity.index===p.index&&this._site.pressedEntity.type===p.type)||(p.type===h.ObjectType.groupHeader?(this._site.pressedHeader=d.headerAtIndex(p.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=d.itemBoxAtIndex(p.index),this._site.pressedContainer=d.containerAtIndex(p.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==i._INVALID_INDEX&&d.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}c("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(a){this._pointerId===a.pointerId&&this._swipeBehaviorState!==q.MS_MANIPULATION_STATE_PRESELECT&&(c("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(a){this._pointerId===a.pointerId&&this._swipeBehaviorState!==q.MS_MANIPULATION_STATE_PRESELECT&&(c("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(a){var b=this._site.containerFromElement(a.target);this._selectionAllowed()&&b&&!this._isInteractive(a.target)&&a.preventDefault()},onMSHoldVisual:function(a){this._isInteractive(a.target)||a.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},handleSwipeBehavior:function(a){this._selectionAllowed(a)&&this._toggleItemSelection(a)},handleTap:function(a){if(a.type!==h.ObjectType.groupHeader){var b=this._site,c=b.selection;this._selectionAllowed(a.index)&&this._selectOnTap()&&(b.tapBehavior===h.TapBehavior.toggleSelect?this._toggleItemSelection(a.index):b.selectionMode!==h.SelectionMode.multi&&c._isIncluded(a.index)||c.set(a.index))}},_toggleItemSelection:function(a){var b=this._site,c=b.selection,d=c._isIncluded(a);b.selectionMode===h.SelectionMode.single?d?c.clear():c.set(a):d?c.remove(a):c.add(a)},_getCurrentPoint:function(a){return Windows.UI.Input.PointerPoint.getCurrentPoint(a.pointerId)},_containedInElementWithClass:function(a,b){if(a.parentNode)for(var c=a.parentNode.querySelectorAll("."+b+", ."+b+" *"),d=0,e=c.length;e>d;d++)if(c[d]===a)return!0;return!1},_isSelected:function(a){return!this._swipeBehaviorSelectionChanged&&this._site.selection._isIncluded(a)||this._swipeBehaviorSelectionChanged&&this.swipeBehaviorSelected},_isInteractive:function(a){return this._containedInElementWithClass(a,"win-interactive")},_togglePressed:function(a,d,j){function k(a){""===o._site.animatedElement.style[m.scriptName]?(o._site.animatedElement.style[m.scriptName]=a,o._site.animatedElementScaleTransform=o._site.animatedElement.style[m.scriptName]):o._site.animatedElementScaleTransform=""}function n(a,b){c("WinJS.UI._ItemEventsHandler:removePressedUI,info"),g.removeClass(a,i._pressedClass),WinJS.Utilities.isPhone?o._containsTransform(a,b)&&e.executeTransition(a,{property:m.cssName,delay:0,duration:500,timing:"cubic-bezier(0.7025,0,0.9225,-0.115)",to:a.style[m.scriptName].replace(b,"")}):o._removeTransform(a,b)}var o=this,p=this._site.pressedEntity.type===h.ObjectType.groupHeader;if(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),!(WinJS.Utilities.isPhone&&!p&&g.hasClass(this._site.pressedItemBox,i._nonSelectableClass)||this._staticMode(p)))if(a){if(!g.hasClass(this._site.animatedElement,i._pressedClass))if(c("WinJS.UI._ItemEventsHandler:applyPressedUI,info"),g.addClass(this._site.animatedElement,i._pressedClass),j&&WinJS.Utilities.isPhone){var q=p?o._site.pressedHeader:o._site.pressedContainer,r=l(j.clientX,j.clientY,q.getBoundingClientRect());this._site.animatedDownPromise=f.timeout(50).then(function(){k(r)})}else{var s=.975,t=7;this._site.getItemPosition(this._site.pressedEntity).then(function(a){a.contentWidth>0&&(s=Math.max(s,1-t/a.contentWidth)),a.contentHeight>0&&(s=Math.max(s,1-t/a.contentHeight))},function(){}),k("scale("+s+","+s+")")}}else if(g.hasClass(this._site.animatedElement,i._pressedClass)){var u=this._site.animatedElement,v=this._site.animatedElementScaleTransform;d?n(u,v):b._setImmediate(function(){g.hasClass(u,i._pressedClass)&&n(u,v)})}},_containsTransform:function(a,b){return b&&-1!==a.style[m.scriptName].indexOf(b)},_removeTransform:function(a,b){this._containsTransform(a,b)&&(a.style[m.scriptName]=a.style[m.scriptName].replace(b,""))},_endSwipeBehavior:function(){if((this._swipeBehaviorState===q.MS_MANIPULATION_STATE_PRESELECT||this._swipeBehaviorState===q.MS_MANIPULATION_STATE_SELECTING||this._swipeBehaviorState===q.MS_MANIPULATION_STATE_DRAGGING||this._swipeBehaviorState===q.MS_MANIPULATION_STATE_COMMITTED||this._swipeBehaviorState===q.MS_MANIPULATION_STATE_CANCELLED)&&this._site.pressedEntity.type!==h.ObjectType.groupHeader){this._flushUIBatches();var a=this._selectionHint;if(this._selectionHint=null,this._site.pressedItemBox){var b=this._site.pressedEntity.index,c=this._site.selection._isIncluded(b);if(c)for(var d=g._getElementsByClasses(this._site.pressedItemBox,[i._selectionCheckmarkClass,i._selectionCheckmarkBackgroundClass]),e=0;e<d.length;e++)d[e].style.opacity=1;this._clearItem(this._site.pressedEntity,c),a&&this._removeSelectionHint(a),delete this._animations[b]}}},_createGestureRecognizer:function(){var a=this._site.eventHandlerRoot,b=g._createGestureRecognizer();b.target=a;var c=this;return a.addEventListener("MSGestureHold",function(a){-1!==c._site.pressedEntity.index&&a.detail===g._MSGestureEvent.MSGESTURE_FLAG_BEGIN&&c._startSelfRevealGesture()}),b},_dispatchSwipeBehavior:function(a){if(this._site.pressedEntity.type!==h.ObjectType.groupHeader){if(this._site.selection._pivot=i._INVALID_INDEX,this._site.pressedItemBox){var b=this._site.pressedEntity.index;if(this._swipeBehaviorState!==a)if(a===q.MS_MANIPULATION_STATE_DRAGGING&&this._canSelect)this._animateSelectionChange(this._site.selection._isIncluded(b)),this._removeSelectionHint(this._selectionHint);else if(a===q.MS_MANIPULATION_STATE_PRESELECT){c("WinJS.UI._ItemEventsHandler:crossSlidingStarted,info");var d=this._site,e=d.itemAtIndex(b),f=d.selection._isIncluded(b);this._selfRevealGesture?(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null):this._canSelect&&this._prepareItem(this._site.pressedEntity,e,f),this._swipeBehaviorState!==q.MS_MANIPULATION_STATE_SELECTING?(this._site.animatedElement&&g.hasClass(this._site.animatedElement,i._pressedClass)&&(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),g.removeClass(this._site.animatedElement,i._pressedClass),this._removeTransform(this._site.animatedElement,this._site.animatedElementScaleTransform)),this._showSelectionHintCheckmark()):this._animateSelectionChange(this._site.selection._isIncluded(b))}else if(a===q.MS_MANIPULATION_STATE_COMMITTED){c("WinJS.UI._ItemEventsHandler:crossSlidingCompleted,info");var d=this._site,j=d.selection,k=this._swipeBehaviorSelectionChanged,l=this.swipeBehaviorSelected;this._swipeBehaviorState===q.MS_MANIPULATION_STATE_SELECTING&&k&&this._selectionAllowed()&&d.swipeBehavior===h.SwipeBehavior.select&&(d.selectionMode===h.SelectionMode.single?l?j.set(b):j._isIncluded(b)&&j.remove(b):l?j.add(b):j._isIncluded(b)&&j.remove(b)),this._endSwipeBehavior()}else a===q.MS_MANIPULATION_STATE_SELECTING&&this._canSelect?this._animateSelectionChange(!this._site.selection._isIncluded(b)):this._swipeBehaviorState===q.MS_MANIPULATION_STATE_SELECTING&&this._canSelect&&this._animateSelectionChange(this._site.selection._isIncluded(b),a===q.MS_MANIPULATION_STATE_CANCELLED)}this._swipeBehaviorState=a}},_resetPointerDownStateForPointerId:function(a){this._pointerId===a.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._gestureRecognizer&&(this._endSelfRevealGesture(),this._endSwipeBehavior()),this._site.pressedElement=null,window.removeEventListener("pointerup",this._resetPointerDownStateBound),window.removeEventListener("pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._removeSelectionHint(this._selectionHint),this._selectionHint=null,this._site.pressedEntity={type:h.ObjectType.item,index:i._INVALID_INDEX},this._pointerId=null},_startSelfRevealGesture:function(){if(this._canSelect&&this._site.swipeBehavior===h.SwipeBehavior.select){c("WinJS.UI._ItemEventsHandler:playSelfRevealGesture,info");var a=this,b=this._site,e=this._site.pressedEntity.index,g=b.itemBoxAtIndex(e),j=b.selection._isIncluded(e),k=!1,l=function(){var a,c;return b.horizontal?(a=i._VERTICAL_SWIPE_SELF_REVEAL_GESTURE+"px",c="0px"):(a="0px",c=(b.rtl()?"":"-")+i._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE+"px"),d.swipeReveal(g,{top:a,left:c})},n=function(){return k?f.wrap():d.swipeReveal(g,{top:"0px",left:"0px"})},o=function(c){b.isZombie()||(c&&a._removeSelectionHint(c),a._clearItem(b.pressedEntity,b.selection._isIncluded(e)))},p=function(){a._selfRevealGesture._promise.cancel(),k=!0;var b=a._selectionHint;return a._selectionHint=null,n().then(function(){g.style[m.scriptName]="",o(b)})};this._prepareItem(this._site.pressedEntity,g,j),this._showSelectionHintCheckmark(),this._pointerTriggeredSRG=!0,this._selfRevealGesture={finishAnimation:p,_promise:l().then(n).then(function(){k||(a._hideSelectionHintCheckmark(),o(),a._selfRevealGesture=null)})}}},_endSelfRevealGesture:function(){this._selfRevealGesture&&(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null)},_prepareItem:function(a,b,c){function d(a){e._swipeClassTracker[p(a)]?e._swipeClassTracker[p(a)]++:(g.addClass(a,i._swipeClass),e._swipeClassTracker[p(a)]=1)}if(a.type!==h.ObjectType.groupHeader){var e=this,j=this._site,k=a.index;if(c){var l=j.containerAtIndex(k);d(l)}else(this._animations[k]||f.wrap()).then(function(){if(!j.isZombie()&&a.type!==h.ObjectType.groupHeader&&-1!==j.pressedEntity.index){k=j.pressedEntity.index;var b=j.itemAtIndex(k),c=j.itemBoxAtIndex(k),e=j.containerAtIndex(k);if(d(e),!g._isSelectionRendered(c)){o.renderSelection(c,b,!0,e),g.removeClass(c,i._selectedClass),g.removeClass(e,i._selectedClass);for(var f=c.querySelectorAll(g._selectionPartsSelector),l=0,m=f.length;m>l;l++)f[l].style.opacity=0}}})}},_clearItem:function(a,b){function c(a){var b=--e._swipeClassTracker[p(a)];return b?!1:(delete e._swipeClassTracker[p(a)],g.removeClass(a,i._swipeClass),!0)}function d(a){var b=a.parentNode;b&&g.hasClass(b,i._itemsBlockClass)&&c(b)}if(a.type===h.ObjectType.item){var e=this,f=this._site,j=f.containerAtIndex(a.index),k=f.itemBoxAtIndex(a.index),l=f.itemAtIndex(a.index);if(j&&k&&l){var m=c(j);d(j),m&&o.renderSelection(k,l,b,!0,j)}}},_animateSelectionChange:function(a,b){function d(){var b=a?"addClass":"removeClass";if(g[b](h,i._selectedClass),g[b](f,i._selectedClass),e._selectionHint){var c=j(e._selectionHint,i._selectionHintClass);c&&g[b](c,i._revealedClass)}}var e=this,f=this._site.pressedContainer,h=this._site.pressedItemBox;this._swipeBehaviorSelectionChanged=!0,this.swipeBehaviorSelected=a;var k=g._getElementsByClasses(this._site.pressedItemBox,[i._selectionBorderClass,i._selectionBackgroundClass]);(!a||b)&&(k=k.concat(g._getElementsByClasses(this._site.pressedItemBox,[i._selectionCheckmarkBackgroundClass,i._selectionCheckmarkClass]))),c("WinJS.UI._ItemEventsHandler:"+(a?"hitSelectThreshold":"hitUnselectThreshold")+",info"),this._applyUIInBatches(function(){c("WinJS.UI._ItemEventsHandler:"+(a?"apply":"remove")+"SelectionVisual,info");for(var b=a?1:0,e=0;e<k.length;e++)k[e].style.opacity=b;d()})},_showSelectionHintCheckmark:function(){if(this._selectionHint){var a=j(this._selectionHint,i._selectionHintClass);a&&(a.style.display="block")}},_hideSelectionHintCheckmark:function(){if(this._selectionHint){var a=j(this._selectionHint,i._selectionHintClass);a&&(a.style.display="none")}},_addSelectionHint:function(){if(this._site.pressedEntity.type!==h.ObjectType.groupHeader){var a,b=this._site;if(b.customFootprintParent){a=this._selectionHint=document.createElement("div"),a.className=i._containerClass;var c=this;b.getItemPosition(this._site.pressedEntity).then(function(d){if(!b.isZombie()&&c._selectionHint&&c._selectionHint===a){var e=a.style,f=";position:absolute;"+(b.rtl()?"right:":"left:")+d.left+"px;top:"+d.top+"px;width:"+d.contentWidth+"px;height:"+d.contentHeight+"px";e.cssText+=f,b.customFootprintParent.insertBefore(c._selectionHint,c._site.pressedItemBox)}},function(){})}else a=this._selectionHint=this._site.pressedContainer;if(this._selectionHintTracker[p(a)])this._selectionHintTracker[p(a)]++;else{if(g.addClass(a,i._footprintClass),!b.selection._isIncluded(this._site.pressedEntity.index)){var d=document.createElement("div");d.className=i._selectionHintClass,d.textContent=i._SELECTION_CHECKMARK,d.style.display="none",this._selectionHint.insertBefore(d,this._selectionHint.firstElementChild)}this._selectionHintTracker[p(a)]=1}}},_removeSelectionHint:function(a){if(a){var b=--this._selectionHintTracker[p(a)];if(!b)if(delete this._selectionHintTracker[p(a)],this._site.customFootprintParent)a.parentNode&&a.parentNode.removeChild(a);else{g.removeClass(a,i._footprintClass);var c=j(a,i._selectionHintClass);c&&c.parentNode.removeChild(c)}}},_releasedElement:function(a){return document.elementFromPoint(a.clientX,a.clientY)},_applyUIInBatches:function(a){function b(){c._work.length>0?(c._flushUIBatches(),c._paintedThisFrame=requestAnimationFrame(b.bind(c))):c._paintedThisFrame=null}var c=this;this._work.push(a),this._paintedThisFrame||b()},_flushUIBatches:function(){if(this._work.length>0){var a=this._work;this._work=[];for(var b=0;b<a.length;b++)a[b]()}},_selectionAllowed:function(a){var b=void 0!==a?this._site.itemAtIndex(a):null,c=!(b&&g.hasClass(b,i._nonSelectableClass));return c&&this._site.selectionMode!==h.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===h.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===h.TapBehavior.toggleSelect||this._site.tapBehavior===h.TapBehavior.directSelect},_staticMode:function(a){return a?this._site.headerTapBehavior===h.GroupHeaderTapBehavior.none:this._site.tapBehavior===h.TapBehavior.none&&this._site.selectionMode===h.SelectionMode.none}},{setAriaSelected:function(a,b){var c="true"===a.getAttribute("aria-selected");b!==c&&a.setAttribute("aria-selected",b)},renderSelection:function(a,b,c,d,e){if(!o._selectionTemplate){o._selectionTemplate=[],o._selectionTemplate.push(k(i._selectionBackgroundClass)),o._selectionTemplate.push(k(i._selectionBorderClass)),o._selectionTemplate.push(k(i._selectionCheckmarkBackgroundClass));var f=k(i._selectionCheckmarkClass);f.textContent=i._SELECTION_CHECKMARK,o._selectionTemplate.push(f)}if(c!==g._isSelectionRendered(a)){if(c){a.insertBefore(o._selectionTemplate[0].cloneNode(!0),a.firstElementChild);for(var h=1,j=o._selectionTemplate.length;j>h;h++)a.appendChild(o._selectionTemplate[h].cloneNode(!0))}else for(var l=a.querySelectorAll(g._selectionPartsSelector),h=0,j=l.length;j>h;h++)a.removeChild(l[h]);g[c?"addClass":"removeClass"](a,i._selectedClass),e&&g[c?"addClass":"removeClass"](e,i._selectedClass)}d&&o.setAriaSelected(b,c)}});return o})};return a.Namespace.define("WinJS.UI",r),a.Namespace.defineWithParent(null,null,r)}),b("WinJS/Controls/ItemContainer",["../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p=d._createEventProperty,q={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"},r={ItemContainer:a.Namespace._lazy(function(){var d={get duplicateConstruction(){return e._getWinJSString("ui/duplicateConstruction").value}},r=a.Class.define(function(a,b){function e(a,b,c){return{name:b?a:a.toLowerCase(),handler:function(b){f["_on"+a](b)},capture:c}}if(a=a||document.createElement("DIV"),this._id=a.id||k._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),b=b||{},a.winControl)throw new c("WinJS.UI.ItemContainer.DuplicateConstruction",d.duplicateConstruction);a.winControl=this,this._element=a,k.addClass(a,"win-disposable"),this._selectionMode=m.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:m.ObjectType.item,index:n._INVALID_INDEX},this.tapBehavior=m.TapBehavior.invokeOnly,this.swipeOrientation=m.Orientation.vertical,this.swipeBehavior=m.SwipeBehavior.select,k.addClass(this.element,r._ClassName.itemContainer+" "+n._containerClass),this._setupInternalTree(),this._selection=new s._SingleItemSelectionManager(a,this._itemBox),this._setTabIndex(),i.setOptions(this,b),this._mutationObserver=new k._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(a,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var f=this;this.selectionDisabled||h.schedule(function(){f._setDirectionClass()},h.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new o._ItemEventsHandler(Object.create({containerFromElement:function(){return f.element},indexForItemElement:function(){return 1
},indexForHeaderElement:function(){return n._INVALID_INDEX},itemBoxAtIndex:function(){return f._itemBox},itemAtIndex:function(){return f.element},headerAtIndex:function(){return null},containerAtIndex:function(){return f.element},isZombie:function(){return this._disposed},getItemPosition:function(){return f._getItemPosition()},rtl:function(){return f._rtl()},fireInvokeEvent:function(){f._fireInvokeEvent()},verifySelectionAllowed:function(){return f._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(a,b){return f._selection.set({firstIndex:a,lastIndex:b})}},{pressedEntity:{get:function(){return f._pressedEntity},set:function(a){f._pressedEntity=a}},pressedElement:{enumerable:!0,set:function(a){f._pressedElement=a}},eventHandlerRoot:{enumerable:!0,get:function(){return f.element}},swipeBehavior:{enumerable:!0,get:function(){return f._swipeBehavior}},selectionMode:{enumerable:!0,get:function(){return f._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return n._containerClass}},canvasProxy:{enumerable:!0,get:function(){return f._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return f._tapBehavior}},draggable:{enumerable:!0,get:function(){return f._draggable}},selection:{enumerable:!0,get:function(){return f._selection}},horizontal:{enumerable:!0,get:function(){return f._swipeOrientation===m.Orientation.vertical}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var g=[e("MSManipulationStateChanged",!0,!0),e("PointerDown"),e("Click"),e("PointerUp"),e("PointerCancel"),e("LostPointerCapture"),e("ContextMenu"),e("MSHoldVisual",!0),e("FocusIn"),e("FocusOut"),e("DragStart"),e("DragEnd"),e("KeyDown")];g.forEach(function(a){k._addEventListener(f.element,a.name,a.handler,!!a.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(a){WinJS.Utilities.isPhone||this._draggable!==a&&(this._draggable=a,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(a){this._selection.selected!==a&&(this._selection.selected=a)}},swipeOrientation:{get:function(){return this._swipeOrientation},set:function(a){a===m.Orientation.vertical?(k.removeClass(this.element,r._ClassName.horizontal),k.addClass(this.element,r._ClassName.vertical)):(a=m.Orientation.horizontal,k.removeClass(this.element,r._ClassName.vertical),k.addClass(this.element,r._ClassName.horizontal)),this._swipeOrientation=a}},tapBehavior:{get:function(){return this._tapBehavior},set:function(a){WinJS.Utilities.isPhone&&a===m.TapBehavior.directSelect||(this._tapBehavior=a,this._setAriaRole())}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(a){this._swipeBehavior=a,this._setSwipeClass()}},selectionDisabled:{get:function(){return this._selectionMode===m.SelectionMode.none},set:function(a){a?this._selectionMode=m.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=m.SelectionMode.single),this._setSwipeClass(),this._setAriaRole()}},oninvoked:p(q.invoked),onselectionchanging:p(q.selectionchanging),onselectionchanged:p(q.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),j.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(a){this._itemEventsHandler.onMSManipulationStateChanged(a)},_onPointerDown:function(a){this._itemEventsHandler.onPointerDown(a)},_onClick:function(a){this._itemEventsHandler.onClick(a)},_onPointerUp:function(a){k.hasClass(this._itemBox,n._itemFocusClass)&&this._onFocusOut(a),this._itemEventsHandler.onPointerUp(a)},_onPointerCancel:function(a){this._itemEventsHandler.onPointerCancel(a)},_onLostPointerCapture:function(a){this._itemEventsHandler.onLostPointerCapture(a)},_onContextMenu:function(a){this._itemEventsHandler.onContextMenu(a)},_onMSHoldVisual:function(a){this._itemEventsHandler.onMSHoldVisual(a)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+n._itemFocusOutlineClass)&&l._keyboardSeenLast){k.addClass(this._itemBox,n._itemFocusClass);var a=document.createElement("div");a.className=n._itemFocusOutlineClass,this._itemBox.appendChild(a)}},_onFocusOut:function(){k.removeClass(this._itemBox,n._itemFocusClass);var a=this._itemBox.querySelector("."+n._itemFocusOutlineClass);a&&a.parentNode.removeChild(a)},_onDragStart:function(a){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))a.preventDefault();else{this._dragging=!0;var c=this;if(a.dataTransfer.setData("text",""),a.dataTransfer.setDragImage){var d=this.element.getBoundingClientRect();a.dataTransfer.setDragImage(this.element,a.clientX-d.left,a.clientY-d.top)}b._yieldForDomModification(function(){c._dragging&&k.addClass(c._itemBox,n._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,k.removeClass(this._itemBox,n._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(a){if(!this._itemEventsHandler._isInteractive(a.target)){var b=k.Key,c=a.keyCode,d=this._swipeBehavior===m.SwipeBehavior.select,e=!1;if(a.ctrlKey||c!==b.enter)a.ctrlKey&&c===b.enter||d&&a.shiftKey&&c===b.F10||d&&c===b.menu||c===b.space?this.selectionDisabled||(this.selected=!this.selected,e=k._setActive(this.element)):c===b.escape&&this.selected&&(this.selected=!1,e=!0);else{var f=this._verifySelectionAllowed();f.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),e=!0}e&&(a.stopPropagation(),a.preventDefault())}},_setTabIndex:function(){var a=this.element.getAttribute("tabindex");a||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===window.getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){k[this._rtl()?"addClass":"removeClass"](this.element,n._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===window.getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var a=this.element;return a?g.wrap({left:this._rtl()?a.offsetParent.offsetWidth-a.offsetLeft-a.offsetWidth:a.offsetLeft,top:a.offsetTop,totalWidth:k.getTotalWidth(a),totalHeight:k.getTotalHeight(a),contentWidth:k.getContentWidth(a),contentHeight:k.getContentHeight(a)}):g.cancel},_itemPropertyChange:function(a){if(!this._disposed){var b=a[0].target,c="true"===b.getAttribute("aria-selected");c!==k._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?k._setAttribute(b,"aria-selected",!c):(this.selected=c,c!==this.selected&&k._setAttribute(b,"aria-selected",!c)))}},_setSwipeClass:function(){WinJS.Utilities.isPhone||(this._swipeBehavior===m.SwipeBehavior.select&&this._selectionMode!==m.SelectionMode.none||this._draggable?k.addClass(this._element,n._swipeableClass):k.removeClass(this._element,n._swipeableClass))},_updateDraggableAttribute:function(){this._setSwipeClass(),this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode===m.SelectionMode.none||this._tapBehavior!==m.TapBehavior.toggleSelect&&this._swipeBehavior!==m.SwipeBehavior.select)return{canSelect:!1,canTapSelect:!1};var a=this._selection.fireSelectionChanging();return{canSelect:a,canTapSelect:a&&this._tapBehavior===m.TapBehavior.toggleSelect}},_setupInternalTree:function(){var a=document.createElement("div");a.className=n._itemClass,this._captureProxy=document.createElement("div"),this._itemBox=document.createElement("div"),this._itemBox.className=n._itemBoxClass;for(var b=this.element.firstChild;b;){var c=b.nextSibling;a.appendChild(b),b=c}this.element.appendChild(this._itemBox),this._itemBox.appendChild(a),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==m.TapBehavior.none){var a=document.createEvent("CustomEvent");a.initCustomEvent(q.invoked,!0,!1,{}),this.element.dispatchEvent(a)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var a;a=this.tapBehavior===m.TapBehavior.none&&this.selectionDisabled?"listitem":"option",k._setAttribute(this.element,"role",a)}},_writeProfilerMark:function(a){var b="WinJS.UI.ItemContainer:"+this._id+":"+a;f(b),WinJS.log&&WinJS.log(b,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return a.Class.mix(r,i.DOMEventMixin),r}),_SingleItemSelectionManager:a.Namespace._lazy(function(){return a.Class.define(function(a,b){this._selected=!1,this._element=a,this._itemBox=b},{selected:{get:function(){return this._selected},set:function(a){a=!!a,this._selected!==a&&this.fireSelectionChanging()&&(this._selected=a,o._ItemEventsHandler.renderSelection(this._itemBox,this._element,a,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var a=document.createEvent("CustomEvent");return a.initCustomEvent(q.selectionchanging,!0,!0,{}),this._element.dispatchEvent(a)},fireSelectionChanged:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent(q.selectionchanged,!0,!1,{}),this._element.dispatchEvent(a)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:m.ObjectType.item,index:n._INVALID_INDEX}}})})};a.Namespace.define("WinJS.UI",r);var s=a.Namespace.defineWithParent(null,null,r)}),b("WinJS/Controls/Repeater",["../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_UIUtilities"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={Repeater:a.Namespace._lazy(function(){function m(a){var b=document.createElement("div");return b.textContent=JSON.stringify(a),b}var n="itemsloaded",o="itemchanging",p="itemchanged",q="iteminserting",r="iteminserted",s="itemmoving",t="itemmoved",u="itemremoving",v="itemremoved",w="itemsreloading",x="itemsreloaded",y=c._createEventProperty,z={get duplicateConstruction(){return d._getWinJSString("ui/duplicateConstruction").value},get asynchronousRender(){return d._getWinJSString("ui/asynchronousRender").value},get repeaterReentrancy(){return d._getWinJSString("ui/repeaterReentrancy").value}},A=a.Class.define(function(a,c){if(a&&a.winControl)throw new b("WinJS.UI.Repeater.DuplicateConstruction",z.duplicateConstruction);this._element=a||document.createElement("div"),this._id=this._element.id||k._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),c=c||{},k.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var d=this._extractInlineTemplate();this._initializing=!0,this.template=c.template||d,this.data=c.data,this._initializing=!1,i._setOptions(this,c,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(n,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(a){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=a||new f.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(n,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(a){this._writeProfilerMark("template.set,StartTM"),this._template=a||m,this._render=l._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(n,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(a){return this._repeatedDOM[a]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var a=0,b=this._repeatedDOM.length;b>a;a++)j._disposeElement(this._repeatedDOM[a])}},onitemsloaded:y(n),onitemchanging:y(o),onitemchanged:y(p),oniteminserting:y(q),oniteminserted:y(r),onitemmoving:y(s),onitemmoved:y(t),onitemremoving:y(u),onitemremoved:y(v),onitemsreloading:y(w),onitemsreloaded:y(x),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var a=document.createElement(this._element.tagName);this._element.firstElementChild;)a.appendChild(this._element.firstElementChild);return new g.Template(a,{extractChild:!0})}},_renderAllItems:function(){for(var a=document.createDocumentFragment(),c=0,d=this._data.length;d>c;c++){var e=this._render(this._data.getAt(c));if(!e)throw new b("WinJS.UI.Repeater.AsynchronousRender",z.asynchronousRender);a.appendChild(e),this._repeatedDOM.push(e)}this._element.appendChild(a)},_reloadRepeater:function(a){this._unloadRepeatedDOM(a),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(a){for(var b=0,c=this._repeatedDOM.length;c>b;b++){var d=this._repeatedDOM[b];a&&j._disposeElement(d),d.parentElement===this._element&&this._element.removeChild(d)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(a){this._data.addEventListener(a,this._dataListeners[a],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new b("WinJS.UI.Repeater.RepeaterModificationReentrancy",z.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(a){this._data.removeEventListener(a,this._dataListeners[a],!1)}.bind(this))},_dataItemChangedHandler:function(a){this._beginModification();var c,d=this._element,e=a.detail.index,f=this._render(a.detail.newValue);if(!f)throw new b("WinJS.UI.Repeater.AsynchronousRender",z.asynchronousRender);this._repeatedDOM[e]&&(a.detail.oldElement=this._repeatedDOM[e]),a.detail.newElement=f,a.detail.setPromise=function(a){c=a},this._writeProfilerMark(o+",info"),this.dispatchEvent(o,a.detail);var g=null;e<this._repeatedDOM.length?(g=this._repeatedDOM[e],d.replaceChild(f,g),this._repeatedDOM[e]=f):(d.appendChild(f),this._repeatedDOM.push(f)),this._endModification(),this._writeProfilerMark(p+",info"),this.dispatchEvent(p,a.detail),g&&h.as(c).done(function(){j._disposeElement(g)}.bind(this))},_dataItemInsertedHandler:function(a){this._beginModification();var c=a.detail.index,d=this._render(a.detail.value);if(!d)throw new b("WinJS.UI.Repeater.AsynchronousRender",z.asynchronousRender);var e=this._element;if(a.detail.affectedElement=d,this._writeProfilerMark(q+",info"),this.dispatchEvent(q,a.detail),c<this._repeatedDOM.length){var f=this._repeatedDOM[c];e.insertBefore(d,f)}else e.appendChild(d);this._repeatedDOM.splice(c,0,d),this._endModification(),this._writeProfilerMark(r+",info"),this.dispatchEvent(r,a.detail)},_dataItemMovedHandler:function(a){this._beginModification();var b=this._repeatedDOM[a.detail.oldIndex];if(a.detail.affectedElement=b,this._writeProfilerMark(s+",info"),this.dispatchEvent(s,a.detail),this._repeatedDOM.splice(a.detail.oldIndex,1)[0],b.parentNode.removeChild(b),a.detail.newIndex<this._data.length-1){var c=this._repeatedDOM[a.detail.newIndex];this._element.insertBefore(b,c),this._repeatedDOM.splice(a.detail.newIndex,0,b)}else this._repeatedDOM.push(b),this._element.appendChild(b);this._endModification(),this._writeProfilerMark(t+",info"),this.dispatchEvent(t,a.detail)},_dataItemRemovedHandler:function(a){this._beginModification();var b,c=this._repeatedDOM[a.detail.index],d={affectedElement:c,index:a.detail.index,item:a.detail.item};d.setPromise=function(a){b=a},this._writeProfilerMark(u+",info"),this.dispatchEvent(u,d),c.parentNode.removeChild(c),this._repeatedDOM.splice(a.detail.index,1),this._endModification(),this._writeProfilerMark(v+",info"),this.dispatchEvent(v,d),h.as(b).done(function(){j._disposeElement(c)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var a,b=this._repeatedDOM.slice(0),c={affectedElements:b};c.setPromise=function(b){a=b},this._writeProfilerMark(w+",info"),this.dispatchEvent(w,c),this._reloadRepeater(!1);var d=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(x+",info"),this.dispatchEvent(x,{affectedElements:d}),h.as(a).done(function(){for(var a=0,c=b.length;c>a;a++)j._disposeElement(b[a])}.bind(this))},_writeProfilerMark:function(a){e("WinJS.UI.Repeater:"+this._id+":"+a)}},{isDeclarativeControlContainer:!0});return a.Class.mix(A,i.DOMEventMixin),A})};return a.Namespace.define("WinJS.UI",m),a.Namespace.defineWithParent(null,null,m)}),b("WinJS/Controls/DatePicker",["../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Select","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g){"use strict";a.Namespace.define("WinJS.UI",{DatePicker:a.Namespace._lazy(function(){function h(a,b,c){var d=Windows.Globalization.DateTimeFormatting;a=a?a:c;var e=new d.DateTimeFormatter(a);return b?new d.DateTimeFormatter(a,e.languages,e.geographicRegion,b,e.clock):e}function i(a,b,c){var d=s[a];d||(d=s[a]={});var e=d[b];e||(e=d[b]={});var f=e[c];return f||(f=e[c]={},f.formatter=h(a,b,c),f.years={}),f}function j(a,b,c,d,e,f){var g=i(a,b,c),h=g.years[f.year+"-"+f.era];return h||(h=g.formatter.format(f.getDateTime()),g.years[f.year+"-"+f.era]=h),h}function k(a,b,c,d){var e=i(a,b,c);return e.formatter.format(d.getDateTime())}function l(a,b,c,d){var e=i(a,b,c);return e.formatter.format(d.getDateTime())}function m(a){var b=Windows.Globalization,c=new b.Calendar;return a?new b.Calendar(c.languages,a,c.getClock()):c}function n(a,b){var c=0;if(a.era==b.era)c=b.year-a.year;else for(;a.era!==b.era||a.year!==b.year;)c++,a.addYears(1);return c}var o="day",p="{month.full}",q="year.full",r={get ariaLabel(){return d._getWinJSString("ui/datePicker").value},get selectDay(){return d._getWinJSString("ui/selectDay").value},get selectMonth(){return d._getWinJSString("ui/selectMonth").value},get selectYear(){return d._getWinJSString("ui/selectYear").value}},s={},t=a.Class.define(function(a,b){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},a=a||document.createElement("div"),f.addClass(a,"win-disposable"),a.winControl=this;var c=a.getAttribute("aria-label");c||a.setAttribute("aria-label",r.ariaLabel),this._init(a),e.setOptions(this,b)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",r.selectDay),this._monthElement.setAttribute("aria-label",r.selectMonth),this._yearElement.setAttribute("aria-label",r.selectYear)},_addControlsInOrder:function(){var a=this._domElement,b=WinJS.Utilities,c=this,d=0;c._information.order.forEach(function(e){switch(e){case"month":a.appendChild(c._monthElement),b.addClass(c._monthElement,"win-order"+d++);break;case"date":a.appendChild(c._dateElement),b.addClass(c._dateElement,"win-order"+d++);break;case"year":a.appendChild(c._yearElement),b.addClass(c._yearElement,"win-order"+d++)}})},_createControlElements:function(){this._monthElement=document.createElement("select"),this._monthElement.className="win-datepicker-month",this._dateElement=document.createElement("select"),this._dateElement.className="win-datepicker-date",this._yearElement=document.createElement("select"),this._yearElement.className="win-datepicker-year"},_createControls:function(){var a=this._information,b=a.getIndex(this.current);a.forceLanguage&&(this._domElement.setAttribute("lang",a.forceLanguage),this._domElement.setAttribute("dir",a.isRTL?"rtl":"ltr")),this._yearControl=new g._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:b.year}),this._monthControl=new g._Select(this._monthElement,{dataSource:this._information.months(b.year),disabled:this.disabled,index:b.month}),this._dateControl=new g._Select(this._dateElement,{dataSource:this._information.dates(b.year,b.month),disabled:this.disabled,index:b.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(a){this._calendar=a,this._setElement(this._domElement)}},current:{get:function(){var a=this._currentDate,b=a.getFullYear();return new Date(Math.max(Math.min(this.maxYear,b),this.minYear),a.getMonth(),a.getDate(),12,0,0,0)},set:function(a){var b;"string"==typeof a?(b=new Date(Date.parse(a)),b.setHours(12,0,0,0)):b=a;var c=this._currentDate;c!=b&&(this._currentDate=b,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled!==a&&(this._disabled=a,this._yearControl&&(this._monthControl.setDisabled(a),this._dateControl.setDisabled(a),this._yearControl.setDisabled(a)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(a){this._datePatterns.date!==a&&(this._datePatterns.date=a,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(a){this._domElement=this._domElement||a,this._domElement&&(f.empty(this._domElement),f.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(a){this._minYear!==a&&(this._minYear=a,a>this._maxYear&&(this._maxYear=a),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var a={year:this._information.years.getLength()-1};return a.month=this._information.months(a.year).getLength()-1,a.date=this._information.dates(a.year,a.month).getLength()-1,this._information.getDate(a).getFullYear()},set:function(a){this._maxYear!==a&&(this._maxYear=a,a<this._minYear&&(this._minYear=a),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(a){this._datePatterns.month!==a&&(this._datePatterns.month=a,this._init())}},_updateInformation:function(){var a=new Date(this._minYear,0,1,12,0,0),b=new Date(this._maxYear,11,31,12,0,0);a.setFullYear(this._minYear),b.setFullYear(this._maxYear),this._information=t.getInformation(a,b,this._calendar,this._datePatterns)},_init:function(a){this._setElement(a)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var a=this._information.getIndex(this.current);this._yearControl.index=a.year,this._monthControl.dataSource=this._information.months(a.year),this._monthControl.index=a.month,this._dateControl.dataSource=this._information.dates(a.year,a.month),this._dateControl.index=a.date}},_wireupEvents:function(){function a(){b._currentDate=b._information.getDate({year:b._yearControl.index,month:b._monthControl.index,date:b._dateControl.index},b._currentDate);var a=b._information.getIndex(b._currentDate);b._monthControl.dataSource=b._information.months(a.year),b._monthControl.index=a.month,b._dateControl.dataSource=b._information.dates(a.year,a.month),b._dateControl.index=a.date}var b=this;this._dateElement.addEventListener("change",a,!1),this._monthElement.addEventListener("change",a,!1),this._yearElement.addEventListener("change",a,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(a){this._datePatterns.year!==a&&(this._datePatterns.year=a,this._init())}}},{_getInformationWinRT:function(a,b,c,d){function e(a){return new Date(Math.min(new Date(Math.max(r,a)),s))}d=d||{date:o,month:p,year:q};var f=m(c),g=m(c),h=m(c);f.setToMin();var r=f.getDateTime();f.setToMax();var s=f.getDateTime();f.hour=12,a=e(a),b=e(b),f.setDateTime(b);var t={year:f.year,era:f.era};f.setDateTime(a);var u=(f.year,0);u=n(f,t)+1;var v=i("day month.full year",c).formatter,w=v.patterns[0],x=8207===w.charCodeAt(0),y=["date","month","year"],z={month:w.indexOf("{month"),date:w.indexOf("{day"),year:w.indexOf("{year")};y.sort(function(a,b){return z[a]<z[b]?-1:z[a]>z[b]?1:0});var A=function(){return{getLength:function(){return u},getValue:function(b){return f.setDateTime(a),f.addYears(b),j(d.year,c,q,d,y,f)}}}(),B=function(b){return g.setDateTime(a),g.addYears(b),{getLength:function(){return g.numberOfMonthsInThisYear},getValue:function(a){return g.month=g.firstMonthInThisYear,g.addMonths(a),k(d.month,c,p,g)}}},C=function(b,e){return h.setDateTime(a),h.addYears(b),h.month=h.firstMonthInThisYear,h.addMonths(e),h.day=h.firstDayInThisMonth,{getLength:function(){return h.numberOfDaysInThisMonth},getValue:function(a){return h.day=h.firstDayInThisMonth,h.addDays(a),l(d.date,c,o,h)}}};return{isRTL:x,forceLanguage:v.resolvedLanguage,order:y,getDate:function(b,c){var d;c&&(f.setDateTime(c),d={year:f.year,month:f.month,day:f.day});var e=f;e.setDateTime(a),e.addYears(b.year);var g;e.firstMonthInThisYear>e.lastMonthInThisYear?(g=b.month+e.firstMonthInThisYear>e.numberOfMonthsInThisYear?b.month+e.firstMonthInThisYear-e.numberOfMonthsInThisYear:b.month+e.firstMonthInThisYear,d&&d.year!==e.year&&(g=Math.max(Math.min(d.month,e.numberOfMonthsInThisYear),1))):g=d&&d.year!==e.year?Math.max(Math.min(d.month,e.firstMonthInThisYear+e.numberOfMonthsInThisYear-1),e.firstMonthInThisYear):Math.max(Math.min(b.month+e.firstMonthInThisYear,e.firstMonthInThisYear+e.numberOfMonthsInThisYear-1),e.firstMonthInThisYear),e.month=g;var h=Math.max(Math.min(b.date+e.firstDayInThisMonth,e.firstDayInThisMonth+e.numberOfDaysInThisMonth-1),e.firstDayInThisMonth);return!d||d.year===e.year&&d.month===e.month||(h=Math.max(Math.min(d.day,e.firstDayInThisMonth+e.numberOfDaysInThisMonth-1),e.firstDayInThisMonth)),e.day=e.firstDayInThisMonth,e.addDays(h-e.firstDayInThisMonth),e.getDateTime()},getIndex:function(b){var c=e(b);f.setDateTime(c);var d={year:f.year,era:f.era},g=0;f.setDateTime(a),f.month=1,g=n(f,d),f.setDateTime(c);var h=f.month-f.firstMonthInThisYear;0>h&&(h=f.month-f.firstMonthInThisYear+f.numberOfMonthsInThisYear);var i=f.day-f.firstDayInThisMonth,j={year:g,month:h,date:i};return j},years:A,months:B,dates:C}},_getInformationJS:function(a,b){var c=a.getFullYear(),d=b.getFullYear(),e={getLength:function(){return Math.max(0,d-c+1)},getValue:function(a){return c+a}},f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=function(){return{getLength:function(){return f.length},getValue:function(a){return f[a]},getMonthNumber:function(a){return Math.min(a,f.length-1)}}},h=function(a,b){var c=new Date,d=e.getValue(a),f=b+1;c.setFullYear(d,f,0);var g=c.getDate();return{getLength:function(){return g},getValue:function(a){return""+(a+1)},getDateNumber:function(a){return Math.min(a+1,g)}}};return{order:["month","date","year"],getDate:function(a){return new Date(e.getValue(a.year),g(a.year).getMonthNumber(a.month),h(a.year,a.month).getDateNumber(a.date),12,0)},getIndex:function(a){var b=0,d=a.getFullYear();b=c>d?0:d>this.maxYear?e.getLength()-1:a.getFullYear()-c;var f=Math.min(a.getMonth(),g(b).getLength()),i=Math.min(a.getDate()-1,h(b,f).getLength());return{year:b,month:f,date:i}},years:e,months:g,dates:h}}});return t.getInformation=b.hasWinRT?t._getInformationWinRT:t._getInformationJS,a.Class.mix(t,c.createEventProperties("change")),a.Class.mix(t,e.DOMEventMixin),t})})}),b("WinJS/Controls/TimePicker",["../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Select","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g){"use strict";a.Namespace.define("WinJS.UI",{TimePicker:a.Namespace._lazy(function(){var h="{minute.integer(2)}",i="{hour.integer(1)}",j="{period.abbreviated(2)}",k={get ariaLabel(){return d._getWinJSString("ui/timePicker").value},get selectHour(){return d._getWinJSString("ui/selectHour").value},get selectMinute(){return d._getWinJSString("ui/selectMinute").value},get selectAMPM(){return d._getWinJSString("ui/selectAMPM").value}},l=function(a,b){return a.getHours()===b.getHours()&&a.getMinutes()===b.getMinutes()},m=a.Class.define(function(a,b){this._currentTime=m._sentinelDate(),a=a||document.createElement("div"),f.addClass(a,"win-disposable"),a.winControl=this;var c=a.getAttribute("aria-label");c||a.setAttribute("aria-label",k.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(a),e.setOptions(this,b)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",k.selectHour),this._minuteElement.setAttribute("aria-label",k.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",k.selectAMPM)},_addControlsInOrder:function(a){var b=this;a.order.forEach(function(a,c){switch(a){case"hour":b._domElement.appendChild(b._hourElement),f.addClass(b._hourElement,"win-order"+c);break;case"minute":b._domElement.appendChild(b._minuteElement),f.addClass(b._minuteElement,"win-order"+c);break;case"period":b._ampmElement&&(b._domElement.appendChild(b._ampmElement),f.addClass(b._ampmElement,"win-order"+c))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(a){this._clock!==a&&(this._clock=a,this._init())}},current:{get:function(){var a=this._currentTime;if(a){var b=m._sentinelDate();return b.setHours(a.getHours()),b.setMinutes(this._getMinutesIndex(a)*this.minuteIncrement),b.setSeconds(0),b.setMilliseconds(0),b}return a},set:function(a){var b;"string"==typeof a?(b=m._sentinelDate(),b.setTime(Date.parse(b.toDateString()+" "+a))):(b=m._sentinelDate(),b.setHours(a.getHours()),b.setMinutes(a.getMinutes()));var c=this._currentTime;l(c,b)||(this._currentTime=b,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled!==a&&(this._disabled=a,this._hourControl&&(this._hourControl.setDisabled(a),this._minuteControl.setDisabled(a)),this._ampmControl&&this._ampmControl.setDisabled(a))}},element:{get:function(){return this._domElement}},_init:function(a){this._setElement(a),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(a){this._timePatterns.hour!==a&&(this._timePatterns.hour=a,this._init())}},_getHoursAmpm:function(a){var b=a.getHours();return this._ampmElement?0===b?{hours:12,ampm:0}:12>b?{hours:b,ampm:0}:{hours:b-12,ampm:1}:{hours:b}},_getHoursIndex:function(a){return this._ampmElement&&12===a?0:a},_getMinutesIndex:function(a){return parseInt(a.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(a){this._minuteIncrement!=a&&(this._minuteIncrement=a,this._init())
}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(a){this._timePatterns.minute!==a&&(this._timePatterns.minute=a,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(a){this._timePatterns.period!==a&&(this._timePatterns.period=a,this._init())}},_setElement:function(a){if(this._domElement=this._domElement||a,this._domElement){var b=m.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=b,b.forceLanguage&&(this._domElement.setAttribute("lang",b.forceLanguage),this._domElement.setAttribute("dir",b.isRTL?"rtl":"ltr")),f.empty(this._domElement),f.addClass(this._domElement,"win-timepicker"),this._hourElement=document.createElement("select"),f.addClass(this._hourElement,"win-timepicker-hour"),this._minuteElement=document.createElement("select"),f.addClass(this._minuteElement,"win-timepicker-minute"),this._ampmElement=null,"12HourClock"===b.clock&&(this._ampmElement=document.createElement("select"),f.addClass(this._ampmElement,"win-timepicker-period")),this._addControlsInOrder(b);var c=this._getHoursAmpm(this.current);this._hourControl=new g._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(c.hours)}),this._minuteControl=new g._Select(this._minuteElement,{dataSource:b.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new g._Select(this._ampmElement,{dataSource:b.periods,disabled:this.disabled,index:c.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var a=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=a.ampm),this._hourControl.index=this._getHoursIndex(a.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var a=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=a.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(a.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var a=this,b=function(){var b=a._hourControl.index;return a._ampmElement&&1===a._ampmControl.index&&12!==b&&(b+=12),b},c=function(){var c=b();a._currentTime.setHours(c),a._currentTime.setMinutes(a._minuteControl.index*a.minuteIncrement)};this._hourElement.addEventListener("change",c,!1),this._minuteElement.addEventListener("change",c,!1),this._ampmElement&&this._ampmElement.addEventListener("change",c,!1)}},{_sentinelDate:function(){var a=new Date;return new Date(2011,6,15,a.getHours(),a.getMinutes())},_getInformationWinRT:function(a,b,c){var d=function(b,c){var d=Windows.Globalization.DateTimeFormatting;b=b?b:c;var e=new d.DateTimeFormatter(b);return a&&(e=d.DateTimeFormatter(b,e.languages,e.geographicRegion,e.calendar,a)),e},e=Windows.Globalization,f=new e.Calendar;a&&(f=new e.Calendar(f.languages,f.getCalendarSystem(),a)),f.setDateTime(m._sentinelDate());var g=f.getClock(),k=24;k=f.numberOfHoursInThisPeriod;var l=function(){var a=d(c.period,j);return{getLength:function(){return 2},getValue:function(b){var c=m._sentinelDate();if(0===b){c.setHours(1);var d=a.format(c);return d}if(1===b){c.setHours(13);var e=a.format(c);return e}return null}}}(),n=function(){var a=d(c.minute,h),e=m._sentinelDate();return{getLength:function(){return 60/b},getValue:function(c){var d=c*b;return e.setMinutes(d),a.format(e)}}}(),o=function(){var a=d(c.hour,i),b=m._sentinelDate();return{getLength:function(){return k},getValue:function(c){return b.setHours(c),a.format(b)}}}(),p=d("hour minute"),q=p.patterns[0],r=["hour","minute"],s={period:q.indexOf("{period"),hour:q.indexOf("{hour"),minute:q.indexOf("{minute")};s.period>-1&&r.push("period");var t=Windows.Globalization.DateTimeFormatting.DateTimeFormatter,u=new t("month.full",Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),v=u.patterns[0],w=8207===v.charCodeAt(0);if(w){var x=s.hour;s.hour=s.minute,s.minute=x}return r.sort(function(a,b){return s[a]<s[b]?-1:s[a]>s[b]?1:0}),{minutes:n,hours:o,clock:g,periods:l,order:r,forceLanguage:p.resolvedLanguage,isRTL:w}},_getInformationJS:function(a,b){var c=[12,1,2,3,4,5,6,7,8,9,10,11],d={};d.getLength=function(){return 60/b},d.getValue=function(a){var c=a*b;return 10>c?"0"+c.toString():c.toString()};var e=["hour","minute","period"];return"24HourClock"===a&&(c=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],e=["hour","minute"]),{minutes:d,hours:c,clock:a||"12HourClock",periods:["AM","PM"],order:e}}});return m.getInformation=b.hasWinRT?m._getInformationWinRT:m._getInformationJS,a.Class.mix(m,c.createEventProperties("change")),a.Class.mix(m,e.DOMEventMixin),m})})}),b("WinJS/Controls/BackButton",["../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f){"use strict";var g=f.Key,h="win-navigation-backbutton",i="win-back",j=3,k=function(){function a(){window.addEventListener("keyup",c,!1),window.addEventListener("pointerup",e,!1)}function b(){window.removeEventListener("keyup",c,!1),window.removeEventListener("pointerup",e,!1)}function c(a){(a.keyCode===g.leftArrow&&a.altKey&&!a.shiftKey&&!a.ctrlKey||a.keyCode===g.browserBack)&&d.back()}function e(a){a.button===j&&d.back()}var f=0;return{addRef:function(){0===f&&a(),f++},release:function(){f>0&&(f--,0===f&&b())},getCount:function(){return f}}}();a.Namespace.define("WinJS.UI",{BackButton:a.Namespace._lazy(function(){var g={get ariaLabel(){return c._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return c._getWinJSString("ui/duplicateConstruction").value},get badButtonElement(){return c._getWinJSString("ui/badButtonElement").value}},j=a.Class.define(function(a,c){if(a&&a.winControl)throw new b("WinJS.UI.BackButton.DuplicateConstruction",g.duplicateConstruction);this._element=a||document.createElement("button"),c=c||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,e.setOptions(this,c),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),d.addEventListener("navigated",this._navigatedHandler,!1),k.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,d.removeEventListener("navigated",this._navigatedHandler,!1),k.release())},refresh:function(){this._element.disabled=d.canGoBack?!1:!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new b("WinJS.UI.BackButton.BadButtonElement",g.badButtonElement);f.addClass(this._element,h),f.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+i+'"></span>',this.refresh(),this._element.setAttribute("aria-label",g.ariaLabel),this._element.setAttribute("title",g.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){d.back()}});return j._getReferenceCount=function(){return k.getCount()},a.Class.mix(j,e.DOMEventMixin),j})})}),b("WinJS/Controls/Tooltip",["../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g){"use strict";var h={Tooltip:a.Namespace._lazy(function(){var h=0,i=g.Key,j="top",k=WinJS.UI._animationTimeAdjustment(400),l=WinJS.UI._animationTimeAdjustment(1200),m=WinJS.UI._animationTimeAdjustment(400),n=WinJS.UI._animationTimeAdjustment(5e3),o=WinJS.UI._animationTimeAdjustment(0),p=WinJS.UI._animationTimeAdjustment(600),q=WinJS.UI._animationTimeAdjustment(400),r=WinJS.UI._animationTimeAdjustment(600),s=WinJS.UI._animationTimeAdjustment(200),t=WinJS.UI._animationTimeAdjustment(3e5),u=12,v=20,w=45,x=20,y=12,z=1,A=g._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",B={keyup:"",pointerover:""},C={pointermove:""},D={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},E={pointerover:"",pointerout:""},F="win-tooltip",G="win-tooltip-phantom",H=m,I=2*H,J=2.5*H,K=n,L=!1,M=!1,N=c._createEventProperty;return a.Class.define(function(a,c){a=a||document.createElement("div");var d=g.data(a).tooltip;if(d)return d;if(!M&&b.hasWinRT){var f=new Windows.UI.ViewManagement.UISettings;H=f.mouseHoverTime,I=2*H,J=2.5*H,K=1e3*f.messageDuration;var h=f.handPreference;L=h==Windows.UI.ViewManagement.HandPreference.leftHanded}M=!0,this._disposed=!1,this._placement=j,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=a,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,a.winControl=this,g.addClass(a,"win-disposable"),a.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),e.setOptions(this,c),this._events(),g.data(a).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(a){if(this._innerHTML=a,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=a,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(a){if(this._contentElement=a,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(a){"top"!==a&&"bottom"!==a&&"left"!==a&&"right"!==a&&(a=j),this._placement=a,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(a){this._infotip=!!a}},extraClass:{get:function(){return this._extraClass},set:function(a){this._extraClass=a}},onbeforeopen:N("beforeopen"),onopened:N("opened"),onbeforeclose:N("beforeclose"),onclosed:N("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,f.disposeSubTree(this.element);for(var a=0,b=this._eventListenerRemoveStack.length;b>a;a++)this._eventListenerRemoveStack[a]();this._onDismiss();var c=g.data(this._anchorElement);c&&delete c.tooltip}},addEventListener:function(a,b,c){if(this._anchorElement){this._anchorElement.addEventListener(a,b,c);var d=this;this._eventListenerRemoveStack.push(function(){d._anchorElement.removeEventListener(a,b,c)})}},removeEventListener:function(a,b,c){this._anchorElement&&this._anchorElement.removeEventListener(a,b,c)},open:function(a){switch(this._triggerByOpen=!0,"touch"!==a&&"mouseover"!==a&&"mousedown"!==a&&"keyboard"!==a&&(a="default"),a){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(f.disposeSubTree(this._domElement),document.body.removeChild(this._domElement),this._domElement=null,document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=document.createElement("div");var a=g._uniqueID(this._domElement);this._domElement.setAttribute("id",a);var b=document.defaultView.getComputedStyle(this._anchorElement,null),c=this._domElement.style;c.direction=b.direction,c.writingMode=b["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",a),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,document.body.appendChild(this._domElement),g.addClass(this._domElement,F),this._extraClass&&g.addClass(this._domElement,this._extraClass),this._phantomDiv=document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),document.body.appendChild(this._phantomDiv),g.addClass(this._phantomDiv,G);var d=document.defaultView.getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=d},_raiseEvent:function(a,b){if(this._anchorElement){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!1,!1,b),this._anchorElement.dispatchEvent(c)}},_captureLastKeyBlurOrPointerOverEvent:function(a,b){switch(b._lastKeyOrBlurEvent=b._currentKeyOrBlurEvent,a.type){case"keyup":b._currentKeyOrBlurEvent=a.keyCode===i.shift?null:"keyboard";break;case"focusout":b._currentKeyOrBlurEvent=null}},_registerEventToListener:function(a,b,c){var d=function(a){c._captureLastKeyBlurOrPointerOverEvent(a,c),c._handleEvent(a)};g._addEventListener(a,b,d,!1),this._eventListenerRemoveStack.push(function(){g._removeEventListener(a,b,d,!1)})},_events:function(){for(var a in B)this._registerEventToListener(this._anchorElement,a,this);for(var a in C)this._registerEventToListener(this._anchorElement,a,this);for(a in D)this._registerEventToListener(this._anchorElement,a,this)},_handleEvent:function(a){var b=a._normalizedType||a.type;if(!this._triggerByOpen){if(b in E){for(var c=a.relatedTarget;c&&c!==this._anchorElement&&c!==document.body;)try{c=c.parentNode}catch(d){if(d instanceof Error&&"Permission denied"===d.message)return;throw d}if(c===this._anchorElement)return}if(b in B)if(a.pointerType==A)this._onInvoke("touch","never",a),this._showTrigger="touch";else{var e="key"===b.substring(0,3)?"keyboard":"mouse";this._onInvoke(e,"auto",a),this._showTrigger=e}else if(b in C)this._contactPoint={x:a.clientX,y:a.clientY};else if(b in D){var f;if(a.pointerType==A){if("pointerdown"==b)return;f="touch"}else f="key"===b.substring(0,3)?"keyboard":"mouse";if("focusout"!=b&&f!=this._showTrigger)return;this._onDismiss()}}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var a=this,b=this._infotip?Math.min(3*K,t):K;this._hideDelayTimer=setTimeout(function(){a._onDismiss()},b)}},_onHideAnimationEnd:function(){document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),h=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(a){var b;if(this._useAnimation=!0,"nodelay"==a)b=0,this._useAnimation=!1;else{var c=(new Date).getTime();s>=c-h?(b="touch"==a?this._infotip?q:o:this._infotip?r:p,this._useAnimation=!1):b="touch"==a?this._infotip?l:k:this._infotip?J:I}return b},_getAnchorPositionFromElementWindowCoord:function(){var a=this._anchorElement.getBoundingClientRect();return{x:a.left,y:a.top,width:a.width,height:a.height}},_getAnchorPositionFromPointerWindowCoord:function(a){return{x:a.x,y:a.y,width:1,height:1}},_canPositionOnSide:function(a,b,c,d){var e=0,f=0;switch(a){case"top":e=d.width+this._offset,f=c.y;break;case"bottom":e=d.width+this._offset,f=b.height-c.y-c.height;break;case"left":e=c.x,f=d.height+this._offset;break;case"right":e=b.width-c.x-c.width,f=d.height+this._offset}return e>=d.width+this._offset&&f>=d.height+this._offset},_positionOnSide:function(a,b,c,d){var e=0,f=0;switch(a){case"top":case"bottom":e=c.x+c.width/2-d.width/2,e=Math.min(Math.max(e,0),b.width-d.width-z),f="top"==a?c.y-d.height-this._offset:c.y+c.height+this._offset;break;case"left":case"right":f=c.y+c.height/2-d.height/2,f=Math.min(Math.max(f,0),b.height-d.height-z),e="left"==a?c.x-d.width-this._offset:c.x+c.width+this._offset}this._domElement.style.left=e+"px",this._domElement.style.top=f+"px",this._phantomDiv.style.left=e+"px",this._phantomDiv.style.top=f+"px",this._phantomDiv.style.width=d.width+"px",this._phantomDiv.style.height=d.height+"px"},_position:function(a){var b={width:0,height:0},c={x:0,y:0,width:0,height:0},d={width:0,height:0};b.width=document.documentElement.clientWidth,b.height=document.documentElement.clientHeight,"tb-rl"===document.defaultView.getComputedStyle(document.body,null)["writing-mode"]&&(b.width=document.documentElement.clientHeight,b.height=document.documentElement.clientWidth),c=!this._contactPoint||"touch"!==a&&"mouse"!==a?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),d.width=this._domElement.offsetWidth,d.height=this._domElement.offsetHeight;var e={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};L&&(e.top[2]="right",e.top[3]="left",e.bottom[2]="right",e.bottom[3]="left");for(var f=e[this._placement],g=f.length,h=0;g>h;h++)if(h==g-1||this._canPositionOnSide(f[h],b,c,d)){this._positionOnSide(f[h],b,c,d);break}return f[h]},_showTooltip:function(a){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var b=this;this._removeTooltip=function(a){for(var c=b._anchorElement;c;){if(a.target==c){document.body.removeEventListener("DOMNodeRemoved",b._removeTooltip,!1),b._cleanUpDOM();break}c=c.parentNode}},document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM();{this._position(a)}this._useAnimation?d.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(a,b,c){if(this._shouldDismiss=!1,!this._isShown&&(!c||"keyup"!==c.type||"keyboard"!=this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||c.keyCode===i.tab))){this._hideDelay=b,this._contactPoint=null,c?(this._contactPoint={x:c.clientX,y:c.clientY},this._offset="touch"==a?w:"keyboard"===a?u:v):this._offset="touch"==a?x:y,clearTimeout(this._delayTimer),clearTimeout(this._hideDelayTimer);var d=this._decideOnDelay(a);if(d>0){var e=this;this._delayTimer=setTimeout(function(){e._showTooltip(a)},d)}else this._showTooltip(a)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?d.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return k}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return l}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return m}},_DEFAULT_MESSAGE_DURATION:{get:function(){return n}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return o}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return p}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return q}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return r}},_RESHOW_THRESHOLD:{get:function(){return s}},_HIDE_DELAY_MAX:{get:function(){return t}}})})};return a.Namespace.define("WinJS.UI",h),a.Namespace.defineWithParent(null,null,h)}),b("WinJS/Controls/Rating",["../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","./Tooltip","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g){"use strict";a.Namespace.define("WinJS.UI",{Rating:a.Namespace._lazy(function(){var h=c._createEventProperty,i={get averageRating(){return d._getWinJSString("ui/averageRating").value},get clearYourRating(){return d._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return d._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return d._getWinJSString("ui/tooltipStringsIsInvalid").value},get unrated(){return d._getWinJSString("ui/unrated").value},get userRating(){return d._getWinJSString("ui/userRating").value}},j=5,k=!1,l="cancel",m="change",n="previewchange",o=0,p=f._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",q=f._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",r=f._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",s="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",t="win-rating",u="win-star win-empty",v="win-star win-average win-empty",w="win-star win-average win-full",x="win-star win-user win-empty",y="win-star win-user win-full",z="win-star win-tentative win-empty",A="win-star win-tentative win-full",B="win-disabled",C="win-average",D="win-user";return a.Class.define(function(a,b){this._disposed=!1,a=a||document.createElement("div"),b=b||{},this._element=a,f.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=k,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(b.maxRating),b.tooltipStrings||this._updateTooltips(null),e.setOptions(this,b),this._controlUpdateNeeded=!0,this._forceLayout(),a.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(a){this._setControlSize(a),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(a){this._userRating=Math.max(0,Math.min(Number(a)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(a){this._averageRating=Number(a)<1?0:Math.min(Number(a)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled=!!a,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(a){this._enableClear=!!a,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(a){if("object"!=typeof a)throw new b("WinJS.UI.Rating.TooltipStringsIsInvalid",i.tooltipStringsIsInvalid);this._updateTooltips(a),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:h(l),onchange:h(m),onpreviewchange:h(n),dispose:function(){if(!this._disposed){this._disposed=!0;for(var a=0;a<this._toolTips.length;a++)this._toolTips[a].dispose();this._toolTips=null}},addEventListener:function(a,b,c){this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_forceLayout:function(){if(this._controlUpdateNeeded){var a=!1;this._updateControl=function(){a=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,a&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=s)},_createControl:function(){f.addClass(this._element,t);var a="";this._averageRatingHidden=!0;for(var b=0;b<=this._maxRating;b++)a=b===this._maxRating?a+"<div class='"+w+"' style='"+s+"'></div>":a+"<div class='"+x+"'></div>";this._element.innerHTML=a;for(var c=this._element.firstElementChild,b=0;c;)this._elements[b]=c,b<this._maxRating&&(f.data(c).msStarRating=b+1),c=c.nextElementSibling,b++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()},_getText:function(a){var b=this._tooltipStrings[a];if(b){var c=document.createElement("div");return c.innerHTML=b,c.textContent}return a===this._maxRating?i.clearYourRating:a+1},_updateAccessibilityRestState:function(){var a=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),a.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(a.setAttribute("aria-valuenow",this._userRating),a.setAttribute("aria-label",i.userRating),a.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(a.setAttribute("aria-valuenow",this._averageRating),a.setAttribute("aria-label",i.averageRating),a.setAttribute("aria-valuetext",this._averageRating)):(a.setAttribute("aria-valuenow",i.unrated),a.setAttribute("aria-label",i.userRating),a.setAttribute("aria-valuetext",i.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var a=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),a.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(a.setAttribute("aria-label",i.tentativeRating),a.setAttribute("aria-valuenow",this._tentativeRating),a.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(a.setAttribute("aria-valuenow",i.unrated),a.setAttribute("aria-label",i.tentativeRating),a.setAttribute("aria-valuetext",this._getText(this._maxRating))):(a.setAttribute("aria-valuenow",i.unrated),a.setAttribute("aria-label",i.tentativeRating),a.setAttribute("aria-valuetext",i.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var a=0;a<this._maxRating;a++)this._toolTips[a]=new g.Tooltip(this._elements[a])},_decrementRating:function(){this._closeTooltip();var a=!0;0===this._tentativeRating||-1===this._tentativeRating&&0===this._userRating?a=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(this._tentativeRating=0!==this._userRating&&this._userRating>0?this._userRating-1:0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,a=!1)),this._showTentativeRating(a,"keyboard")},_events:function(){function a(a){return{name:a,lowerCaseName:a.toLowerCase(),handler:function(b){var d=c["_on"+a];d&&d.apply(c,[b])}}}var b,c=this,d=[a("KeyDown"),a("FocusOut"),a("FocusIn"),a("PointerCancel"),a("PointerDown"),a("PointerMove"),a("PointerOver"),a("PointerUp"),a("PointerOut")],e=[a("DOMNodeInserted")];for(b=0;b<d.length;++b)f._addEventListener(this._element,d[b].lowerCaseName,d[b].handler,!1);for(b=0;b<e.length;++b)this._element.addEventListener(e[b].name,e[b].handler,!1);this._ariaValueNowMutationObserver=new f._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onDOMNodeInserted:function(a){a.target===this._element&&(this._recalculateStarProperties(),this._updateControl())},_recalculateStarProperties:function(){var a=0;1===this._averageRating&&(a=1);var b=getComputedStyle(this._elements[a]);this._elementWidth=b.width,"rtl"===getComputedStyle(this._element).direction?(this._elementPadding=b.paddingRight,this._elementBorder=b.borderRight):(this._elementPadding=b.paddingLeft,this._elementBorder=b.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var a=!0;(this._tentativeRating===this._maxRating||-1===this._tentativeRating&&this._userRating===this._maxRating)&&(a=!1),-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:this._tentativeRating=0!==this._userRating?this._userRating<this._maxRating?this._userRating+1:this._maxRating:1,this._showTentativeRating(a,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var a=this._element.getAttributeNode("aria-valuenow");if(null!==a){var b=Number(a.nodeValue);this.userRating!==b&&(this.userRating=b,this._tentativeRating=this._userRating,this._raiseEvent(m,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(l,null),this._captured=!1},_onPointerDown:function(a){(a.pointerType!==r||a.button===o)&&(this._captured||(this._pointerDownAt={x:a.clientX,y:a.clientY},this._pointerDownFocus=!0,this._disabled||(f._setPointerCapture(this._element,a.pointerId),this._captured=!0,a.pointerType===p?(this._tentativeRating=f.data(a.target).msStarRating||0,this._setStarClasses(A,this._tentativeRating,z),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(n,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(a,b){var c,d=this._pointerDownAt||{x:a.clientX,y:a.clientY},e=f._elementsFromPoint(a.clientX,d.y);if(e)for(var g=0,h=e.length;h>g;g++){var i=e[g];if("tooltip"===i.getAttribute("role"))return;if(f.hasClass(i,"win-star")){c=i;break}}var j;if(c&&c.parentElement===this._element)j=f.data(c).msStarRating||0;else{var k=0,l=this.maxRating;"rtl"===getComputedStyle(this._element).direction&&(k=l,l=0),j=a.clientX<d.x?k:l}var m=!1,n=Math.min(Math.ceil(j),this._maxRating);0!==n||this._enableClear||(n=1),n!==this._tentativeRating&&(this._closeTooltip(),m=!0),this._tentativeRating=n,this._showTentativeRating(m,b),a.preventDefault()},_onPointerMove:function(a){this._captured&&(a.pointerType===p?this._onCapturedPointerMove(a,"touch"):this._onCapturedPointerMove(a,"mousedown"))},_onPointerOver:function(a){this._disabled||a.pointerType!==q&&a.pointerType!==r||this._onCapturedPointerMove(a,"mouseover")},_onPointerUp:function(a){this._captured&&(f._releasePointerCapture(this._element,a.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(l,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var a=0;a<this._maxRating;a++)this._elements[a].className=z;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(n,this._userRating):this._raiseEvent(n,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(a){var b=f.Key,c=a.keyCode,d=getComputedStyle(this._element).direction,e=!0;switch(c){case b.enter:this._onUserRatingChanged();break;case b.tab:this._onUserRatingChanged(),e=!1;break;case b.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(l,null);break;case b.leftArrow:"rtl"===d?this._incrementRating():this._decrementRating();break;case b.upArrow:this._incrementRating();break;case b.rightArrow:"rtl"===d?this._decrementRating():this._incrementRating();break;case b.downArrow:this._decrementRating();break;default:var g=0;if(c>=b.num0&&c<=b.num9?g=b.num0:c>=b.numPad0&&c<=b.numPad9&&(g=b.numPad0),g>0){var h=!1,i=Math.min(c-g,this._maxRating);0!==i||this._enableClear||(i=1),i!==this._tentativeRating&&(this._closeTooltip(),h=!0),this._tentativeRating=i,this._showTentativeRating(h,"keyboard")}else e=!1}e&&(a.stopPropagation(),a.preventDefault())
},_onPointerOut:function(a){this._captured||f.eventWithinElement(this._element,a)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(l,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(m,this._userRating)))},_raiseEvent:function(a,b){if(!this._disabled&&(this._lastEventWasChange=a===m,this._lastEventWasCancel=a===l,document.createEvent)){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!1,!1,{tentativeRating:b}),this._element.dispatchEvent(c)}},_resetNextElement:function(a){if(null!==this._averageRatingElement.nextSibling){f._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var b=this._averageRatingElement.nextSibling.style,c=getComputedStyle(this._element).direction;a&&(c="rtl"===c?"ltr":"rtl"),"rtl"===c?(b.paddingRight=this._elementPadding,b.borderRight=this._elementBorder,b.direction="rtl"):(b.paddingLeft=this._elementPadding,b.borderLeft=this._elementBorder,b.direction="ltr"),b.backgroundPosition="left",b.backgroundSize="100% 100%",b.width=this._resizeStringValue(this._elementWidth,1,b.width)}},_resetAverageStar:function(a){this._resetNextElement(a),this._hideAverageRating()},_resizeStringValue:function(a,b,c){var d=parseFloat(a);if(isNaN(d))return null!==c?c:a;var e=a.substring(d.toString(10).length);return d*=b,d+e},_setControlSize:function(a){var b=(Number(a)||j)>>0;this._maxRating=b>0?b:j},_updateTooltips:function(a){var b,c=0;if(null!==a)for(c=a.length<=this._maxRating+1?a.length:this._maxRating+1,b=0;c>b;b++)this._tooltipStrings[b]=a[b];else{for(b=0;b<this._maxRating;b++)this._tooltipStrings[b]=b+1;this._tooltipStrings[this._maxRating]=i.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(a,b,c){for(var d=0;d<this._maxRating;d++)this._elements[d].className=b>d?a:c},_updateAverageStar:function(){var a=this._averageRatingElement.style,b=this._averageRatingElement.nextSibling.style;"rtl"==getComputedStyle(this._element).direction?(a.backgroundPosition="right",a.paddingRight=this._elementPadding,a.borderRight=this._elementBorder,b.paddingRight="0px",b.borderRight="0px",b.direction="ltr"):(a.backgroundPosition="left",b.backgroundPosition="right",a.paddingLeft=this._elementPadding,a.borderLeft=this._elementBorder,b.paddingLeft="0px",b.borderLeft="0px",b.direction="rtl"),f._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue}),a.width=this._resizeStringValue(this._elementWidth,this._floatingValue,a.width),a.backgroundSize=100/this._floatingValue+"% 100%",a.display=getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,f._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue}),b.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,b.width),b.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(a,b){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(A,this._tentativeRating,z),this._hideAverageStar()),this._updateAccessibilityHoverState(),a&&(this._openTooltip(b),this._raiseEvent(n,this._tentativeRating))},_openTooltip:function(a){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(a);else if(0===this._tentativeRating){this._clearElement=document.createElement("div");var b=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===getComputedStyle(this._element).direction&&(b*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+b+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new g.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(a)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var a=0;a<this._maxRating;a++)this._toolTips[a].innerHTML=null},_appendClass:function(a){for(var b=0;b<=this._maxRating;b++)f.addClass(this._elements[b],a)},_setClasses:function(a,b,c){for(var d=0;d<this._maxRating;d++)this._elements[d].className=b>d?a:c},_ensureAverageMSStarRating:function(){f.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(w,this._averageRating-1,v),this._averageRatingElement.className=w;for(var a=0;a<this._maxRating;a++)if(a<this._averageRating&&a+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[a]),this._floatingValue=this._averageRating-a;var b=getComputedStyle(this._elements[a]);this._elementWidth=b.width,"rtl"==getComputedStyle(this._element).direction?(this._elementPadding=b.paddingRight,this._elementBorder=b.borderRight):(this._elementPadding=b.paddingLeft,this._elementBorder=b.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(y,this._userRating,x),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(u,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(B),this._appendClass(0!==this._averageRating&&0===this._userRating?C:D),this._updateAccessibilityRestState()}}})})})}),b("WinJS/Controls/ToggleSwitch",["../Core/_Base","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e){"use strict";a.Namespace.define("WinJS.UI",{ToggleSwitch:a.Namespace._lazy(function(){function f(a){var b=a[0].target.winControl;b.checked=b._switchElement.valueAsNumber}var g=0,h={get on(){return c._getWinJSString("ui/on").value},get off(){return c._getWinJSString("ui/off").value}},i="win-toggleswitch",j="win-switch",k="win-title",l="win-label",m="win-on",n="win-off",o="win-disabled",p="win-hidden",q="win-focus-hide",r=a.Class.define(null,{raiseEvent:function(a,b){this.dispatchEvent(a,b)}});return a.Class.mix(r,d.DOMEventMixin),a.Class.derive(r,function(a,b){a=a||document.createElement("div");var c=e.data(a).toggle;return c?c:(this._domElement=null,this._switchElement=null,this._titleElement=null,this._labelGridElement=null,this._labelOnElement=null,this._labelOffElement=null,this._labelOn=h.on,this._labelOff=h.off,this._disposed=!1,this._spaceKeyDown=!1,this._shouldHideFocus=!1,this._pointerId=0,this._hasCapture=!1,this._setElement(a),this._setDefaultOptions(),d.setOptions(this,b),a.winControl=this,e.addClass(a,"win-disposable"),void(e.data(a).toggle=this))},{checked:{get:function(){return this._checked},set:function(a){this._setChecked(a)}},disabled:{get:function(){return this._switchElement.disabled},set:function(a){var b=!!a;this._switchElement.disabled=b,b?(e.addClass(this._labelOnElement,o),e.addClass(this._labelOffElement,o),e.addClass(this._titleElement,o)):(e.removeClass(this._labelOnElement,o),e.removeClass(this._labelOffElement,o),e.removeClass(this._titleElement,o)),this._switchElement.setAttribute("aria-disabled",b)}},element:{get:function(){return this._domElement}},labelOn:{get:function(){return this._labelOn},set:function(a){this._labelOn=a,this._labelOnElement.innerHTML=this._labelOn}},labelOff:{get:function(){return this._labelOff},set:function(a){this._labelOff=a,this._labelOffElement.innerHTML=this._labelOff}},title:{get:function(){return this._titleElement.innerHTML},set:function(a){this._titleElement.innerHTML=a}},onchange:b._createEventProperty("change"),_addControlsInOrder:function(){this._domElement.appendChild(this._titleElement),this._labelGridElement.appendChild(this._labelOnElement),this._labelGridElement.appendChild(this._labelOffElement),this._labelGridElement.appendChild(this._switchElement),this._domElement.appendChild(this._labelGridElement)},_setChecked:function(a){a=!!a,a!==this._checked&&(this._checked=a,this._checked?(e.removeClass(this._domElement,n),e.addClass(this._domElement,m),e.addClass(this._labelOffElement,p),e.removeClass(this._labelOnElement,p),this._switchElement.valueAsNumber=1):(e.removeClass(this._domElement,m),e.addClass(this._domElement,n),e.addClass(this._labelOnElement,p),e.removeClass(this._labelOffElement,p),this._switchElement.valueAsNumber=0),this._switchElement.setAttribute("aria-checked",this._checked))},_setDefaultOptions:function(){this.labelOn=h.on,this.labelOff=h.off,this.title="",this.checked=!1,this.disabled=!1},_setElement:function(a){this._domElement=a,e.addClass(this._domElement,i),e.addClass(this._domElement,n),this._titleElement=document.createElement("div"),this._titleElement.setAttribute("id",e._uniqueID(this._titleElement)),this._titleElement.setAttribute("role","note"),e.addClass(this._titleElement,k),this._switchElement=document.createElement("input"),this._switchElement.type="range",this._switchElement.max=1,this._switchElement.step=1,this._switchElement.setAttribute("role","checkbox"),this._switchElement.setAttribute("aria-labelledby",this._titleElement.id),e.addClass(this._switchElement,j),this._labelGridElement=document.createElement("div"),this._labelGridElement.style.display="-ms-grid",WinJS.Utilities.isPhone&&(this._labelGridElement.style.msGridColumns="1fr auto"),this._labelOnElement=document.createElement("div"),e.addClass(this._labelOnElement,l),this._labelOffElement=document.createElement("div"),e.addClass(this._labelOffElement,l),this._addControlsInOrder(),this._wireupEvents()},_valueHandler:function(a){var b=this._checked;this.checked=a?!this.checked:this._switchElement.valueAsNumber,b!==this._checked&&this.raiseEvent("change")},_wireupEvents:function(){var a=this,b=function(b){b.keyCode===e.Key.space&&(a._spaceKeyDown||(a._switchElement.valueAsNumber=(a._switchElement.valueAsNumber+1)%2,a._spaceKeyDown=!0),b.preventDefault())},c=function(b){(b.keyCode===e.Key.space||b.keyCode>=e.Key.end&&b.keyCode<=e.Key.downArrow)&&(a._valueHandler(!1),b.keyCode===e.Key.space&&(a._spaceKeyDown=!1))},d=function(){a._switchElement.valueAsNumber=a.checked,a._spaceKeyDown=!1},h=function(b){if("aria-checked"===b.attrName){var c=a._switchElement.getAttributeNode("aria-checked");if(null!==c){var d=a._checked;a._setChecked("true"===c.nodeValue?!0:!1),d!==a._checked&&a.raiseEvent("change")}}},i=function(){a._switchElement.focus(),a._shouldHideFocus=!1},j=function(){e.addClass(a._switchElement,q),a._shouldHideFocus=!0},k=function(){a._shouldHideFocus||e.removeClass(a._switchElement,q)},l=function(b){a._switchElement.disabled||"button"in b&&b.button!==g||(a._tapping=!0,a._pointerDown=!0,setTimeout(function(){a._tapping=!1},200),a._switchElement.setPointerCapture&&b.preventDefault(),i())},m=function(){a._switchElement.disabled||(a._pointerDown=!1,a._valueHandler(a._tapping),a._hasCapture=!1)},n=function(b){a._switchElement.disabled||a._pointerDown&&!a._hasCapture&&(e._setPointerCapture(a._switchElement,b.pointerId),a._hasCapture=!0)};e._addEventListener(this._domElement,"pointerdown",j,!0),e._addEventListener(this._domElement,"focusin",i,!1),this._switchElement.addEventListener("lostpointercapture",d,!1),this._switchElement.addEventListener("DOMAttrModified",h,!1),this._switchElement.addEventListener("change",function(a){a.stopPropagation()},!0),this._switchElement.addEventListener("keydown",b,!1),this._switchElement.addEventListener("keyup",c,!1),e._addEventListener(this._switchElement,"pointercancel",d,!1),e._addEventListener(this._switchElement,"pointerdown",l,!1),e._addEventListener(this._switchElement,"pointerup",m,!1),e._addEventListener(this._switchElement,"pointermove",n,!1),e._addEventListener(this._switchElement,"focusout",function(){k(),d()},!1),new e._MutationObserver(f).observe(this._switchElement,{attributes:!0,attributeFilter:["value"]})},dispose:function(){this._disposed||(this._disposed=!0)},addEventListener:function(a,b,c){"change"==a&&(c=!1),this._domElement.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return"change"==a&&(c=!1),this._domElement.removeEventListener(a,b,c)}})})})}),b("WinJS/Controls/SemanticZoom",["../Core/_Global","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a){"use strict";WinJS.Namespace.define("WinJS.UI",{SemanticZoom:WinJS.Namespace._lazy(function(){function b(a){return a}function c(a,b,c){return a+" "+WinJS.UI._animationTimeAdjustment(b)+"s "+c+" "+WinJS.UI._libraryDelay+"ms"}function d(){return c(L.cssName,E,"ease-in-out")+", "+c("opacity",C,"ease-in-out")}function e(){return c(L.cssName,F,"ease-in-out")+", "+c("opacity",D,"ease-in-out")}function f(){return c(L.cssName,I,K)}function g(){return c(L.cssName,J,K)}function h(a,b){return WinJS.Utilities.convertToPixels(a,b)}function i(a,b){WinJS.UI.isAnimationEnabled()&&(a.style[L.scriptName]="scale("+b+")")}function j(a){var b=a.target&&a.target.winControl;b&&!b._resizing&&b._onResize()}function k(a){var b=a[0].target&&a[0].target.winControl;b&&b instanceof WinJS.UI.SemanticZoom&&b._onPropertyChanged()}var l=WinJS.Utilities,m=WinJS.UI,n=WinJS.Utilities._browserStyleEquivalents,o={get invalidZoomFactor(){return WinJS.Resources._getWinJSString("ui/invalidZoomFactor").value}},p="win-semanticzoom-button",q="win-semanticzoom-button-location",r=3e3,s=8,t="win-semanticzoom",u="win-semanticzoom-zoomedinview",v="win-semanticzoom-zoomedoutview",w="zoomchanged",x=1.05,y=.65,z=.8,A=.2,B=4096,C=.333,D=.333,E=.333,F=.333,G=1e3*C,H=50,I=.333,J=.333,K="cubic-bezier(0.1,0.9,0.2,1)",L=n.transform,M=n.transition.scriptName,N=2,O=.2,P=.45,Q=1e3,R=50,S={none:0,zoomedIn:1,zoomedOut:2},T=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",U=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",V=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",W={x:0,y:0},X=WinJS.Class.define(function(b,c){this._disposed=!1;var d=this,e=WinJS.Utilities.isPhone;this._element=b,this._element.winControl=this,l.addClass(this._element,"win-disposable"),l.addClass(this._element,t),this._element.setAttribute("role","ms-semanticzoomcontainer");var f=this._element.getAttribute("aria-label");if(f||this._element.setAttribute("aria-label",""),c=c||{},this._zoomedOut=!!c.zoomedOut||!!c.initiallyZoomedOut||!1,this._enableButton=!e,e||void 0===c.enableButton||(this._enableButton=!!c.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=l._clamp(c.zoomFactor,A,z,y),this.zoomedInItem=c.zoomedInItem,this.zoomedOutItem=c.zoomedOutItem,WinJS.validation&&c._zoomFactor&&c._zoomFactor!==this._zoomFactor)throw new WinJS.ErrorFromName("WinJS.UI.SemanticZoom.InvalidZoomFactor",o.invalidZoomFactor);this._locked=!!c.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in a,this._initialize(),this._configure(),this._element.addEventListener("mselementresize",j),new WinJS.Utilities._MutationObserver(k).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),e||(this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),l._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),l._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),l._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),l._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),l._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(WinJS.Utilities._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(WinJS.Utilities._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),WinJS.UI._setOptions(this,c,!0),d._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(a){var b=!!a;this._enableButton===b||WinJS.Utilities.isPhone||(this._enableButton=b,b?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(a){this._zoom(!!a,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&WinJS.Utilities.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(a){var b=this._zoomFactor,c=l._clamp(a,A,z,y);b!==c&&(this._zoomFactor=c,this._onResize())}},locked:{get:function(){return this._locked},set:function(a){this._locked=!!a,a?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(a){this._zoomedInItem=a||b}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(a){this._zoomedOutItem=a||b}},dispose:function(){this._disposed||(this._disposed=!0,WinJS.Utilities._disposeElement(this._elementIn),WinJS.Utilities._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var a=l.children(this._element);this._elementIn=a[0],this._elementOut=a[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",m.processAll(this._elementIn),m.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._elementInIsListView=this._elementIn.winControl instanceof WinJS.UI.ListView,this._elementOutIsListView=this._elementOut.winControl instanceof WinJS.UI.ListView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=document.createElement("div"),this._element.appendChild(this._cropViewport),this._viewportIn=document.createElement("div"),this._opticalViewportIn=document.createElement("div"),this._viewportOut=document.createElement("div"),this._opticalViewportOut=document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=document.createElement("div"),this._canvasOut=document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),l.addClass(this._elementIn,u),l.addClass(this._elementOut,v),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=document.createElement("button"),this._sezoButton.className=p+" "+q,this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),this._element.addEventListener("pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var a=this._viewIn.getPanAxis(),b=this._viewOut.getPanAxis(),c=WinJS.Utilities.isPhone;if(this._pansHorizontallyIn="horizontal"===a||"both"===a,this._pansVerticallyIn="vertical"===a||"both"===a,this._pansHorizontallyOut="horizontal"===b||"both"===b,this._pansVerticallyOut="vertical"===b||"both"===b,!this._zoomInProgress){var d=1/this._zoomFactor-1,e=x-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),d),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),e),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,c||(this._zoomedOut?i(this._canvasIn,this._zoomFactor):i(this._canvasOut,1/this._zoomFactor));var f=this._opticalViewportIn.style,g=this._opticalViewportOut.style,h=this._canvasIn.style,j=this._canvasOut.style;h.opacity=this._zoomedOut&&!c?0:1,j.opacity=this._zoomedOut?1:0,c&&(h.zIndex=1,j.zIndex=2),WinJS.UI.isAnimationEnabled()&&!c&&(f[n["transition-property"].scriptName]=L.cssName,f[n["transition-duration"].scriptName]="0s",f[n["transition-timing-function"].scriptName]="linear",g[n["transition-property"].scriptName]=L.cssName,g[n["transition-duration"].scriptName]="0s",g[n["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var a=this._element.getAttribute("aria-checked"),b="true"===a;this._zoomedOut!==b&&(this.zoomedOut=b)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var a=function(a,b,c,d,e){var f=a.style;f.left=b+"px",f.top=c+"px",f.width=d+"px",f.height=e+"px"},b=window.getComputedStyle(this._element,null),c=parseFloat(b.width),d=parseFloat(b.height),e=h(this._element,b.paddingLeft),f=h(this._element,b.paddingRight),g=h(this._element,b.paddingTop),i=h(this._element,b.paddingBottom),j=c-e-f,k=d-g-i,l=1/this._zoomFactor;if(this._viewportWidth===j&&this._viewportHeight===k)return;this._sezoClientHeight=d,this._sezoClientWidth=c,this._viewportWidth=j,this._viewportHeight=k,this._configure();var m=2*l-1,n=Math.min(B,(this._pansHorizontallyIn?m:1)*j),o=Math.min(B,(this._pansVerticallyIn?m:1)*k);this._canvasLeftIn=.5*(n-j),this._canvasTopIn=.5*(o-k),a(this._cropViewport,e,g,j,k),a(this._viewportIn,0,0,j,k),a(this._opticalViewportIn,0,0,j,k),a(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,n,o),a(this._elementIn,this._canvasLeftIn,this._canvasTopIn,j,k);var p=2*x-1,q=(this._pansHorizontallyOut?p:1)*j,r=(this._pansVerticallyOut?p:1)*k;this._canvasLeftOut=.5*(q-j),this._canvasTopOut=.5*(r-k),a(this._viewportOut,0,0,j,k),a(this._opticalViewportOut,0,0,j,k),a(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,q,r),a(this._elementOut,this._canvasLeftOut,this._canvasTopOut,j,k)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(a){return this._zooming||!this._lastMouseX&&!this._lastMouseY||a.screenX===this._lastMouseX&&a.screenY===this._lastMouseY?(this._lastMouseX=a.screenX,void(this._lastMouseY=a.screenY)):void(Math.abs(a.screenX-this._lastMouseX)<=s&&Math.abs(a.screenY-this._lastMouseY)<=s||(this._lastMouseX=a.screenX,this._lastMouseY=a.screenY,this._displayButton()))},_displayButton:function(){clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var a=this;this._dismissButtonTimer=setTimeout(function(){a._hideSemanticZoomButton()},WinJS.UI._animationTimeAdjustment(r))},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(WinJS.UI.Animation.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(a){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(a)this._sezoButton.style.visibility="hidden";else{var b=this;WinJS.UI.Animation.fadeOut(this._sezoButton).then(function(){b._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(a){a.target!==this.element&&this._hideSemanticZoomButton(!0)},_onMouseWheel:function(a){a.ctrlKey&&(this._zoom(a.wheelDelta<0,this._getPointerLocation(a)),a.stopPropagation(),a.preventDefault())},_onPenHover:function(a){a.pointerType===U&&0===a.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(a){var b=!1;if(a.ctrlKey){var c=l.Key;switch(a.keyCode){case c.add:case c.equal:this._zoom(!1),b=!0;break;case c.subtract:case c.dash:this._zoom(!0),b=!0}}b&&(a.stopPropagation(),a.preventDefault())},_createPointerRecord:function(a,b){var c=this._getPointerLocation(a),d={};return d.startX=d.currentX=c.x,d.startY=d.currentY=c.y,d.fireCancelOnPinch=b,this._pointerRecords[a.pointerId]=d,this._pointerCount=Object.keys(this._pointerRecords).length,d},_deletePointerRecord:function(a){var b=this._pointerRecords[a];return delete this._pointerRecords[a],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),b},_fakeCancelOnPointer:function(a){var b=document.createEvent("UIEvent");b.initUIEvent("touchcancel",!0,!0,window,0),b.touches=a.touches,b.targetTouches=a.targetTouches,b.changedTouches=[a._currentTouch],b._fakedBySemanticZoom=!0,a.target.dispatchEvent(b)},_handlePointerDown:function(a){this._createPointerRecord(a,!1);for(var b=(this._element,Object.keys(this._pointerRecords)),c=0,d=b.length;d>c;c++)try{WinJS.Utilities._setPointerCapture(this._hiddenElement,b[c]||0)}catch(e){return void this._resetPointerRecords()}a.stopImmediatePropagation(),a.cancelBubble=!0,a.preventDefault()},_handleFirstPointerDown:function(a){this._resetPointerRecords(),this._createPointerRecord(a,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(a){a.target!==this._element&&this._isBouncing&&a.stopImmediatePropagation()},_onPointerDown:function(a){a.pointerType===T&&(0===this._pointerCount?this._handleFirstPointerDown(a):this._handlePointerDown(a))},_onPointerMove:function(a){function b(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))}function c(a,b){return{x:.5*(a.currentX+b.currentX)|0,y:.5*(a.currentY+b.currentY)|0}}if(a.pointerType===V||a.pointerType===U)return void this._onMouseMove(a);if(a.pointerType===T){var d=this._pointerRecords[a.pointerId],e=this._getPointerLocation(a);if(d){if(d.currentX=e.x,d.currentY=e.y,2===this._pointerCount){this._pinching=!0;var f=Object.keys(this._pointerRecords),g=this._pointerRecords[f[0]],h=this._pointerRecords[f[1]];this._currentMidPoint=c(g,h);var i=b(g.currentX,g.currentY,h.currentX,h.currentY),j=this,k=function(a){var b=a?S.zoomedOut:S.zoomedIn,d=a?j._pinchedDirection===S.zoomedIn&&!j._zoomingOut:j._pinchedDirection===S.zoomedOut&&j._zoomingOut,e=a?!j._zoomedOut:j._zoomedOut;if(j._pinchedDirection===S.none)e?(j._isBouncingIn=!1,j._zoom(a,c(g,h),!0),j._pinchedDirection=b):j._isBouncingIn||j._playBounce(!0,c(g,h));else if(d){var f=j._lastPinchDistance/j._lastPinchStartDistance,i=j._lastLastPinchDistance/j._lastPinchDistance;(a&&f>O||!a&&i>P)&&(j._zoom(a,c(g,h),!0),j._pinchedDirection=b)}};this._updatePinchDistanceRecords(i),this._pinchDistanceCount>=N&&(this._zooming||this._isBouncing||(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:EndPinchDetection,info"),k(this._lastPinchDirection===S.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(d.fireCancelOnPinch&&(this._fakeCancelOnPointer(a,d),d.fireCancelOnPinch=!1),a.stopImmediatePropagation(),a.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(a){a.pointerType===T&&a.target===this._element&&this._completePointerUp(a,!1)},_onPointerUp:function(a){this._releasePointerCapture(a),this._completePointerUp(a,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(a){a._fakedBySemanticZoom||(this._releasePointerCapture(a),this._completePointerUp(a,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(a){var b=this._pointerRecords[a.pointerId];b&&(b.dirty=!1)},_onLostPointerCapture:function(a){var b=this._pointerRecords[a.pointerId];if(b){b.dirty=!0;var c=this;WinJS.Promise.timeout(R).then(function(){b.dirty&&c._completePointerUp(a,!1)})}},_onMSContentZoom:function(a){var b=a.target;if(b===this._opticalViewportIn||b===this._opticalViewportOut){var c=b.msContentZoomFactor<.995,d=b.msContentZoomFactor>1.005;!c||this._zoomedOut||this._zoomingOut?d&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(a){function b(b){c._lastPinchDirection===b?c._pinchDistanceCount++:(c._pinchGesture++,c._pinchDistanceCount=0,c._lastPinchStartDistance=a),c._lastPinchDirection=b,c._lastPinchDistance=a,c._lastLastPinchDistance=c._lastPinchDistance}var c=this;-1===this._lastPinchDistance?(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=a):this._lastPinchDistance!==a&&b(this._lastPinchDistance>a?S.zoomedOut:S.zoomedIn)},_zoomFromCurrent:function(a){this._zoom(a,null,!1,!0)},_zoom:function(a,b,c,d,e){if(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+a+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!c)return;a!==this._zoomingOut&&this._startAnimations(a)}else if(a!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!c,b&&(a?this._viewIn:this._viewOut).setCurrentItem(b.x,b.y),this._zoomInProgress=!0,(a?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",a&&WinJS.Utilities.isPhone&&(this._canvasOut.style.opacity=1);var f=this._viewIn.beginZoom(),g=this._viewOut.beginZoom(),h=null;if((f||g)&&WinJS.Utilities.isPhone&&(h=WinJS.Promise.join([f,g])),d&&!e){var i=this;(a?this._viewIn:this._viewOut).getCurrentItem().then(function(b){var c=b.position;i._prepareForZoom(a,{x:i._rtl()?i._sezoClientWidth-c.left-.5*c.width:c.left+.5*c.width,y:c.top+.5*c.height},WinJS.Promise.wrap(b),h)
})}else this._prepareForZoom(a,b||{},null,h,e)}},_prepareForZoom:function(a,b,c,d,e){function f(a,b){g._canvasIn.style[n["transform-origin"].scriptName]=g._canvasLeftIn+h-a.x+"px "+(g._canvasTopIn+i-a.y)+"px",g._canvasOut.style[n["transform-origin"].scriptName]=g._canvasLeftOut+h-b.x+"px "+(g._canvasTopOut+i-b.y)+"px"}WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var g=this,h=b.x,i=b.y;"number"==typeof h&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(h=.5*this._sezoClientWidth),"number"==typeof i&&this._pansVerticallyIn&&this._pansVerticallyOut||(i=.5*this._sezoClientHeight),f(W,W),e?this._aligning=!1:this._alignViewsPromise=this._alignViews(a,h,i,c).then(function(){g._aligning=!1,g._gestureEnding=!1,g._alignViewsPromise=null,g._zooming||g._gesturing||g._completeZoom()}),this._zoomingOut=a,getComputedStyle(this._canvasIn).opacity,getComputedStyle(this._canvasOut).opacity,WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(a,d)},_alignViews:function(a,b,c,d){var e=1-this._zoomFactor,f=this._rtl(),g=e*(f?this._viewportWidth-b:b),h=e*c,i=this;if(a){var j=d||this._viewIn.getCurrentItem();if(j)return j.then(function(a){var b=a.position,c={left:b.left*i._zoomFactor+g,top:b.top*i._zoomFactor+h,width:b.width*i._zoomFactor,height:b.height*i._zoomFactor};return i._viewOut.positionItem(i._zoomedOutItem(a.item),c)})}else{var k=d||this._viewOut.getCurrentItem();if(k)return k.then(function(a){var b=a.position,c={left:(b.left-g)/i._zoomFactor,top:(b.top-h)/i._zoomFactor,width:b.width/i._zoomFactor,height:b.height/i._zoomFactor};return i._viewIn.positionItem(i._zoomedInItem(a.item),c)})}return new WinJS.Promise(function(a){a({x:0,y:0})})},_startAnimations:function(a,b){this._zoomingOut=a;var c=WinJS.Utilities.isPhone;if(WinJS.UI.isAnimationEnabled()&&!c&&(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[M]=a?d():e(),this._canvasOut.style[M]=a?e():d()),c||(i(this._canvasIn,a?this._zoomFactor:1),i(this._canvasOut,a?1:1/this._zoomFactor)),this._canvasIn.style.opacity=a&&!c?0:1,(!c||a)&&(this._canvasOut.style.opacity=a?1:0),WinJS.UI.isAnimationEnabled())if(b){var f=this,g=function(){f._canvasIn.style[L.scriptName]="",f._canvasOut.style[L.scriptName]="",f._onZoomAnimationComplete()};b.then(g,g)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),WinJS.UI._animationTimeAdjustment(G));else this._zooming=!1,this._canvasIn.style[L.scriptName]="",this._canvasOut.style[L.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(a){return this._disposed?void 0:a.target!==this._canvasOut&&a.target!==this._canvasIn||!this._isBouncing?void(a.target===this._canvasIn&&a.propertyName===L.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(a){a&&clearTimeout(a)},_completePointerUp:function(a,b){if(!this._disposed){var c=a.pointerId,d=this._pointerRecords[c];if(d&&(this._deletePointerRecord(c),this._isBouncingIn&&this._playBounce(!1),b&&this._pinchedDirection!==S.none&&(a.stopImmediatePropagation(),a.cancelBubble=!0),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==S.none&&this._pinchDistanceCount<N)return this._zoom(this._lastPinchDirection===S.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==S.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(a,b){var c=this;c._TTFFTimer=setTimeout(function(){this._disposed||(c._TTFFTimer=setTimeout(a,b))},H)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var a=this;(this._zoomInProgress||this._isBouncing)&&(a._completeZoomTimer=setTimeout(function(){a._completeZoom()},WinJS.UI._animationTimeAdjustment(Q)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!WinJS.Utilities.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var a=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),a=!0),this._setVisibility(),a){var b=document.createEvent("CustomEvent");b.initCustomEvent(w,!0,!0,this._zoomedOut),this._element.dispatchEvent(b),this._isActive&&WinJS.Utilities._setActive(this._zoomedOut?this._elementOut:this._elementIn)}WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var a=document.activeElement;return this._element===a||this._element.contains(a)},_setLayout:function(a,b,c){var d=a.style;d.position=b,d.overflow=c},_setupOpticalViewport:function(a){a.style["-ms-overflow-style"]="none",WinJS.Utilities.isPhone||(a.style["-ms-content-zooming"]="zoom",a.style["-ms-content-zoom-limit-min"]="99%",a.style["-ms-content-zoom-limit-max"]="101%",a.style["-ms-content-zoom-snap-points"]="snapList(100%)",a.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function a(a,b){a.style.visibility=b?"visible":"hidden"}a(this._opticalViewportIn,!this._zoomedOut||WinJS.Utilities.isPhone),a(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=S.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(a){var b=a.pointerId;try{WinJS.Utilities._releasePointerCapture(this._hiddenElement,b)}catch(c){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var a=this;this._recordResetPromise=WinJS.Promise.timeout(R).then(function(){0===a._pointerCount&&(a._resetPointerRecords(),a._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=S.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(a){var b={left:0,top:0};try{b=this._element.getBoundingClientRect()}catch(c){}var d=window.getComputedStyle(this._element,null),e=h(this._element,d.paddingLeft),f=h(this._element,d.paddingTop),g=h(this._element,d.borderLeftWidth);return{x:+a.clientX===a.clientX?a.clientX-b.left-e-g:0,y:+a.clientY===a.clientY?a.clientY-b.top-f-f:0}},_playBounce:function(a,b){if(WinJS.UI.isAnimationEnabled()&&this._isBouncingIn!==a){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=a,a?this._bounceCenter=b:this._aligned=!0;var c=this._zoomedOut?this._canvasOut:this._canvasIn,d=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,e=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;c.style[n["transform-origin"].scriptName]=d+this._bounceCenter.x+"px "+(e+this._bounceCenter.y)+"px",c.style[M]=a?f():g(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var h=a?this._zoomedOut?2-x:x:1;i(c,h),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),WinJS.UI._animationTimeAdjustment(G))}},_rtl:function(){return"rtl"===window.getComputedStyle(this._element,null).direction},_pinching:{set:function(a){this._elementInIsListView&&(this._elementIn.winControl._pinching=a),this._elementOutIsListView&&(this._elementOut.winControl._pinching=a)}}});return WinJS.Class.mix(X,WinJS.Utilities.createEventProperties("zoomchanged")),WinJS.Class.mix(X,WinJS.UI.DOMEventMixin),X})})}),b("WinJS/Controls/Pivot/_Constants",["../../Core/_Base"],function(a){"use strict";var b={_ClassName:{pivot:"win-pivot",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch"}};return a.Namespace.defineWithParent(null,null,b)}),b("WinJS/Controls/Pivot/_Item",["../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={PivotItem:a.Namespace._lazy(function(){var l={get duplicateConstruction(){return d._getWinJSString("ui/duplicateConstruction").value}},m=a.Class.define(function(a,b){if(a=a||document.createElement("DIV"),b=b||{},a.winControl)throw new c("WinJS.UI.PivotItem.DuplicateConstruction",l.duplicateConstruction);a.winControl=this,this._element=a,j.addClass(this.element,m._ClassName.pivotItem),j.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=document.createElement("DIV"),this._contentElement.className=m._ClassName.pivotItemContent,a.appendChild(this._contentElement);for(var d=this.element.firstChild;d!==this._contentElement;){var f=d.nextSibling;this._contentElement.appendChild(d),d=f}this._processors=[e.processAll],h.setOptions(this,b)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(a){this._header=a,this._parentPivot&&this._parentPivot._renderHeaders()}},_parentPivot:{get:function(){for(var a=this._element;a&&!j.hasClass(a,k._ClassName.pivot);)a=a.parentNode;return a&&a.winControl}},_process:function(){var a=this;return this._processors&&this._processors.push(function(){return g.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(b,c){return b.then(function(){return c(a.contentElement)})},this._processed||f.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,i.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:b.markSupportedForProcessing(function(a,b){b!==e.processAll&&(a._processors=a._processors||[],a._processors.push(b),a._processed&&a._process())})});return m})};return a.Namespace.define("WinJS.UI",l),a.Namespace.defineWithParent(null,null,l)}),b("WinJS/Controls/Pivot",["../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_TabContainer","../Utilities/_UIUtilities","./Pivot/_Constants","./Pivot/_Item","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.Namespace.define("WinJS.UI",{Pivot:a.Namespace._lazy(function(){function t(a){var b=document.createTextNode("object"==typeof a.header?JSON.stringify(a.header):""+a.header);return b}var u=p._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",v=p._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",w=p.Key,x=d._createEventProperty,y={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},z=p._MSManipulationEvent,A=a.Class.define(function(a,d){if(a=a||document.createElement("DIV"),d=d||{},a.winControl)throw new c("WinJS.UI.Pivot.DuplicateConstruction",B.duplicateConstruction);this._handleItemChangedBound=this._handleItemChanged.bind(this),this._handleItemInsertedBound=this._handleItemInserted.bind(this),this._handleItemMovedBound=this._handleItemMoved.bind(this),this._handleItemRemovedBound=this._handleItemRemoved.bind(this),this._handleItemReloadBound=this._handleItemReload.bind(this),this._id=a.id||p._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),p._supportsSnapPoints||p.addClass(a,A._ClassName.pivotNoSnap),a.winControl=this,this._element=a,this._element.setAttribute("role","tablist"),this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",B.pivotAriaLabel),p.addClass(this.element,A._ClassName.pivot),p.addClass(this.element,"win-disposable"),p._addEventListener(this.element,"pointerenter",this._updatePointerType.bind(this)),p._addEventListener(this.element,"pointerout",this._updatePointerType.bind(this)),this._pointerType=u,this._titleElement=document.createElement("DIV"),this._titleElement.style.display="none",p.addClass(this._titleElement,A._ClassName.pivotTitle),this._element.appendChild(this._titleElement),this._headersContainerElement=document.createElement("DIV"),p.addClass(this._headersContainerElement,A._ClassName.pivotHeaders),this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this)),this._element.appendChild(this._headersContainerElement),this._element.addEventListener("click",this._elementClickedHandler.bind(this)),p._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this)),p._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this)),p._addEventListener(this._headersContainerElement,"pointerdown",this._headersPointerDownHandler.bind(this)),p._addEventListener(this._headersContainerElement,"pointerup",this._headersPointerUpHandler.bind(this)),this._tabContainer=new q.TabContainer(this._headersContainerElement),this._viewportElement=document.createElement("DIV"),this._viewportElement.className=A._ClassName.pivotViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",B.pivotViewportAriaLabel),this.element.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportWidth=null,this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),p._addEventListener(this._viewportElement,"pointerdown",this._pointerDownHandler.bind(this)),this._surfaceElement=document.createElement("DIV"),this._surfaceElement.className=A._ClassName.pivotSurface,this._viewportElement.appendChild(this._surfaceElement),this._offsetFromCenter=0,this._currentIndexOnScreen=0,this._loadId=0,this._navMode=A._NavigationModes.none,this._currentManipulationState=z.MS_MANIPULATION_STATE_STOPPED,this._parse(),d=b._shallowCopy(d),d.items&&(this.items=d.items,delete d.items),n.setOptions(this,d),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},locked:{get:function(){return p.hasClass(this.element,A._ClassName.pivotLocked)},set:function(a){p[a?"addClass":"removeClass"](this.element,A._ClassName.pivotLocked),a&&this._hideNavButtons()}},items:{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(a){var b=!this._pendingItems;this._pendingItems=a,this._refresh(),b&&(this._pendingIndexOnScreen=0)}},title:{get:function(){return this._titleElement.textContent},set:function(a){a?(this._titleElement.style.display="block",this._titleElement.textContent=a):(this._titleElement.style.display="none",this._titleElement.textContent="")}},selectedIndex:{get:function(){return 0===this.items.length?-1:+this._pendingIndexOnScreen===this._pendingIndexOnScreen?this._pendingIndexOnScreen:this._currentIndexOnScreen},set:function(a){a>=0&&a<this.items.length&&(this._pendingRefresh?this._pendingIndexOnScreen=a:(this._navMode=this._navMode||A._NavigationModes.api,this._loadItem(a)))}},selectedItem:{get:function(){return this.items.getAt(this.selectedIndex)},set:function(a){var b=this.items.indexOf(a);-1!==b&&(this.selectedIndex=b)}},dispose:function(){if(!this._disposed){this._disposed=!0,this._updateEvents(this._items),o._disposeElement(this._headersContainerElement);for(var a=0,b=this.items.length;b>a;a++)this.items.getAt(a).dispose()}},onselectionchanged:x(y.selectionChanged),onitemanimationstart:x(y.itemAnimationStart),onitemanimationend:x(y.itemAnimationEnd),_currentScrollTargetLocation:{get:function(){return this._viewportWidth===A._invalidViewportWidth?0:(50+this._offsetFromCenter)*Math.ceil(this._viewportWidth)}},_pointerType:{get:function(){return this._pointerTypeValue},set:function(a){this._pointerTypeValue!==a&&(this._pointerTypeValue=a,a===v?(p.removeClass(this.element,A._ClassName.pivotInputTypeMouse),p.addClass(this.element,A._ClassName.pivotInputTypeTouch),this._hideNavButtons()):(p.removeClass(this.element,A._ClassName.pivotInputTypeTouch),p.addClass(this.element,A._ClassName.pivotInputTypeMouse)))}},_rtl:{get:function(){return this._cachedRTL}},_viewportWidth:{get:function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(getComputedStyle(this._viewportElement).width),p._supportsSnapPoints&&(this._viewportElement.style[b._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||A._invalidViewportWidth},set:function(a){this._viewportElWidth=a}},_applyProperties:function(){if(!this._disposed){if(this._pendingRefresh=!1,this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;){var a=this.element.firstElementChild;a.parentNode.removeChild(a)}p.empty(this._surfaceElement)}this._attachItems();var b=this._pendingIndexOnScreen;this._pendingIndexOnScreen=null,this._currentIndexOnScreen=0,this._skipHeaderSlide=!0,this.selectedIndex=Math.min(b,this.items.length-1),this._skipHeaderSlide=!1,this._recenterUI()}},_attachItems:function(){this._measured=!1;for(var a=0,b=this.items.length;b>a;a++){var d=this._items.getAt(a);if(d.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Pivot.DuplicateItem",B.duplicateItem);d.element.style.visibility="hidden",d.element.style.opacity=0,this._surfaceElement.appendChild(d.element)}},_parse:function(){for(var a=[],b=this.element.firstElementChild;b!==this._titleElement;){j.processAll(b);var d=b.winControl;if(!d)throw new c("WinJS.UI.Pivot.InvalidContent",B.invalidContent);a.push(d);var e=b.nextElementSibling;b=e}this.items=new i.List(a)},_refresh:function(){this._pendingRefresh||(this._pendingRefresh=!0,l.schedule(this._applyProperties.bind(this),l.Priority.high))},_renderHeaders:function(a){function c(a){function b(){j._disposed||j._headersContainerElement.contains(d)&&a!==j.selectedIndex&&"true"===d.getAttribute("aria-selected")&&(j.selectedIndex=a)}var c=j._items.getAt(a),d=document.createElement("BUTTON");d.style.maxWidth=.8*i+"px",a===j.selectedIndex?(p.addClass(d,A._ClassName.pivotHeaderSelected),d.setAttribute("aria-selected",!0)):d.setAttribute("aria-selected",!1),p.addClass(d,A._ClassName.pivotHeader),d._item=c,e(c,d),d.setAttribute("role","tab"),j._headersContainerElement.appendChild(d),new p._MutationObserver(b).observe(d,{attributes:!0,attributeFilter:["aria-selected"]})}if(!this._pendingRefresh&&this._items){var d=this._headersContainerElement.contains(document.activeElement),e=r._syncRenderer(t);o._disposeElement(this._headersContainerElement),p.empty(this._headersContainerElement);var f=getComputedStyle(this._headersContainerElement),g=parseFloat(f.marginLeft);g=g>0?0:g;var h=parseFloat(f.marginRight);h=h>0?0:h;var i=parseFloat(f.width)+g+h,j=this;if(1===this._items.length)c(0),this._viewportElement.style.overflow="hidden",this._headersContainerElement.style.marginLeft="0px",this._headersContainerElement.style.marginRight="0px";else if(this._items.length>1){var k=this._items.length+(a?2:1),l=this.selectedIndex-1;this._viewportElement.style.overflow&&(this._viewportElement.style.overflow="");for(var m=0;k>m;m++)-1===l?l=this._items.length-1:l===this._items.length&&(l=0),c(l),l++;if(!this._skipHeaderSlide){var n,q;a?(n="",q="0"):(n="0",q="");var s=this._headersContainerElement.children[k-1];s.style.opacity=n;var u=.167;s.style[b._browserStyleEquivalents.transition.scriptName]="opacity "+WinJS.UI._animationTimeAdjustment(u)+"s",getComputedStyle(s).opacity,s.style.opacity=q}this._headersContainerElement.children[0].setAttribute("aria-hidden","true"),this._headersContainerElement.style.marginLeft="0px",this._headersContainerElement.style.marginRight="0px";var v=this._rtl?"marginRight":"marginLeft",w=this._rtl?"paddingLeft":"paddingRight",x=this._headersContainerElement.children[0],y=x.offsetWidth+parseFloat(getComputedStyle(x)[v])-parseFloat(getComputedStyle(x)[w]);if(x!==this._headersContainerElement.children[0])return;this._headersContainerElement.style[v]=-1*y+"px",this._prevButton=document.createElement("button"),p.addClass(this._prevButton,A._ClassName.pivotNavButton),p.addClass(this._prevButton,A._ClassName.pivotNavButtonPrev),this._prevButton.addEventListener("click",function(){j.locked||(j._rtl?j._goNext():j._goPrevious())}),this._headersContainerElement.appendChild(this._prevButton),this._prevButton.style.left=this._rtl?"0px":y+"px",this._nextButton=document.createElement("button"),p.addClass(this._nextButton,A._ClassName.pivotNavButton),p.addClass(this._nextButton,A._ClassName.pivotNavButtonNext),this._nextButton.addEventListener("click",function(){j.locked||(j._rtl?j._goPrevious():j._goNext())}),this._headersContainerElement.appendChild(this._nextButton),this._nextButton.style.right=this._rtl?y+"px":"0px"}var z=this._headersContainerElement.children.length>1?1:0;this._tabContainer.childFocus=this._headersContainerElement.children[z],d&&this._headersContainerElement.children[z].focus()}},_resizeHandler:function(){if(!this._disposed){var a=this._viewportWidth;this._viewportWidth=null,a!==this._viewportWidth?(WinJS.log&&WinJS.log("_resizeHandler from:"+a+" to: "+this._viewportWidth),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterUI(),this._renderHeaders()):WinJS.log&&WinJS.log("_resizeHandler worthless resize")}},_activateHeader:function(a){if(!this.locked){var b=this._items.indexOf(a._item);if(b!==this.selectedIndex){if(!a.previousSibling)return;this.selectedIndex=b}else r._setActiveFirstFocusableElement(this.selectedItem.element)}},_goNext:function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},_goPrevious:function(){this._animateToPrevious=!0,this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1,this._animateToPrevious=!1},_loadItem:function(a){var b=this._animateToPrevious;this._cachedRTL="rtl"===getComputedStyle(this._element,null).direction,this._loadId++;var c=this._loadId;this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._currentItem&&this._hidePivotItem(this._currentItem.element,b);var d=this._currentIndexOnScreen;if(this._currentIndexOnScreen=a,this._slideHeaders(b,a,d),!(0>a)){var e=this._items.getAt(a);this._currentItem=e,b?this._offsetFromCenter--:a!==d&&this._offsetFromCenter++;var f=!1;p._supportsSnapPoints&&p._supportsZoomTo&&this._currentManipulationState!==z.MS_MANIPULATION_STATE_INERTIA&&(this._skipHeaderSlide?(WinJS.log&&WinJS.log("_skipHeaderSlide index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),p.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation})):(WinJS.log&&WinJS.log("zoomTo index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),this._viewportElement.msZoomTo({contentX:this._currentScrollTargetLocation,contentY:0,viewportX:0,viewportY:0}),f=0!==this._offsetFromCenter&&this.items.length>1));var g=this,h={index:a,direction:b?"backwards":"forward",item:e};this._writeProfilerMark("selectionChanged,info"),this._fireEvent(A._EventName.selectionChanged,!0,!1,h),e._process().then(function(){if(!g._disposed&&c===g._loadId){p._supportsSnapPoints?(e.element.style[g._getDirectionAccessor()]=g._currentScrollTargetLocation+"px",g._showPivotItem(e.element,b)):g._hidePivotItemAnimation?g._showPivotItemAnimation=g._hidePivotItemAnimation.then(function(){return g._disposed||c!==g._loadId?void 0:g._showPivotItem(e.element,b)}):g._showPivotItem(e.element,b);var a;f?(g._stoppedAndRecenteredSignal||(g._stoppedAndRecenteredSignal=new m),a=g._stoppedAndRecenteredSignal.promise):a=k.wrap(),k.join([g._slideHeadersAnimation,g._showPivotItemAnimation,g._hidePivotItemAnimation]).then(function(){a.then(function(){k.timeout(50).then(function(){g._disposed||c!==g._loadId||(g._navMode=A._NavigationModes.none,g._writeProfilerMark("itemAnimationStop,info"),g._fireEvent(A._EventName.itemAnimationEnd,!0))})})})}})}},_MSManipulationStateChangedHandler:function(a){if(this._currentManipulationState=a.currentState,p._supportsSnapPoints&&a.target===this._viewportElement)if(this._currentManipulationState===z.MS_MANIPULATION_STATE_STOPPED?WinJS.log&&WinJS.log("MSManipulation: Stopped","winjs pivot","log"):this._currentManipulationState===z.MS_MANIPULATION_STATE_INERTIA?WinJS.log&&WinJS.log("MSManipulation: Inertia","winjs pivot","log"):WinJS.log&&WinJS.log("MSManipulation: Active","winjs pivot","log"),this._stoppedAndRecenteredSignal||(this._stoppedAndRecenteredSignal=new m),this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel(),this._currentManipulationState===z.MS_MANIPULATION_STATE_STOPPED){this._navMode===A._NavigationModes.scroll&&this._scrollHandler(),this._navMode=A._NavigationModes.none;var b=this;this._manipulationRecenterPromise=k._cancelBlocker(k.join([l.schedulePromiseNormal(null,"WinJS.UI.Pivot._MSManipulationStateChangedHandler_animationPlaceholder"),this._hidePivotItemAnimation,this._showPivotItemAnimation,this._slideHeadersAnimation])).then(function(){b._disposed||(b._currentManipulationState===z.MS_MANIPULATION_STATE_STOPPED?(WinJS.log&&WinJS.log("Still in Stopped state: calling _recenterUI","winjs pivot","log"),b._recenterUI()):(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null))})}else if(this._currentManipulationState===z.MS_MANIPULATION_STATE_INERTIA){var c=a.inertiaDestinationX;if(+c===c){WinJS.log&&WinJS.log("MSManipulation: inertiaDestinationX: "+c);var d=c-this._currentScrollTargetLocation;d>0?(WinJS.log&&WinJS.log("MSManipulation: Inertia diff > 1","winjs pivot","log"),this._navMode=A._NavigationModes.inertia,this._goNext()):0>d&&(WinJS.log&&WinJS.log("MSManipulation: Stopped diff < -1","winjs pivot","log"),this._navMode=A._NavigationModes.inertia,this._goPrevious())}}},_scrollHandler:function(){if(p._supportsSnapPoints&&!this._disposed){if(this._recentering&&this._stoppedAndRecenteredSignal)return this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null,void(this._recentering=!1);if((this._navMode===A._NavigationModes.none||this._navMode===A._NavigationModes.scroll)&&(this._navMode=A._NavigationModes.scroll,this._currentManipulationState===z.MS_MANIPULATION_STATE_STOPPED)){WinJS.log&&WinJS.log("_scrollHandler ScrollPosition: "+p.getScrollPosition(this._viewportElement).scrollLeft,"winjs pivot","log");var a=p.getScrollPosition(this._viewportElement).scrollLeft-this._currentScrollTargetLocation;this._cachedRTL="rtl"===getComputedStyle(this._element,null).direction,a>0?(WinJS.log&&WinJS.log("_scrollHandler diff > 1: "+a,"winjs pivot","log"),this._goNext()):0>a&&(WinJS.log&&WinJS.log("_scrollHandler diff < -1: "+a,"winjs pivot","log"),this._goPrevious())}}},_recenterUI:function(){p._supportsSnapPoints&&(this._offsetFromCenter=0,p.getScrollPosition(this._viewportElement).scrollLeft!==this._currentScrollTargetLocation?(this._recentering=!0,this._stoppedAndRecenteredSignal=this._stoppedAndRecenteredSignal||new m):this._stoppedAndRecenteredSignal&&(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._currentScrollTargetLocation+"px"),WinJS.log&&WinJS.log("_recenterUI index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation),p.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation}))},_hidePivotItem:function(a,b){function c(){d._disposed||(d._hidePivotItemAnimation=null,a.style.visibility="hidden",a.style.opacity=0)}var d=this,e=this._rtl&&!b||b&&!this._rtl;this._hidePivotItemAnimation=h.isAnimationEnabled()?g[e?"slideRightOut":"slideLeftOut"](a):l.schedulePromiseNormal(null,"WinJS.UI.Pivot._hidePivotItem_animationPlaceholder"),this._hidePivotItemAnimation.then(c,c)},_showPivotItem:function(a,b){function c(a){var b=a.getBoundingClientRect();return b.top<j.bottom&&b.bottom>j.top}function d(){l._disposed||(l._showPivotItemAnimation=null)}if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(A._EventName.itemAnimationStart,!0),!h.isAnimationEnabled())return a.style.visibility="",a.style.opacity="",void(this._showPivotItemAnimation=null);var e=a.querySelectorAll(".win-pivot-slide1"),f=a.querySelectorAll(".win-pivot-slide2"),i=a.querySelectorAll(".win-pivot-slide3"),j=this._viewportElement.getBoundingClientRect();e=Array.prototype.filter.call(e,c),f=Array.prototype.filter.call(f,c),i=Array.prototype.filter.call(i,c);var k=this._rtl&&!b||b&&!this._rtl;a.style.visibility="",this._showPivotItemAnimation=g[k?"slideRightIn":"slideLeftIn"](a,e,f,i);var l=this;return this._showPivotItemAnimation.then(d,d),this._showPivotItemAnimation},_slideHeaders:function(a,c,d){function e(a){return i?a.offsetParent.offsetWidth-a.offsetLeft-a.offsetWidth:a.offsetLeft}function f(){m._disposed||(m._renderHeaders(a),m._slideHeadersAnimation=null)}if(0>c||this._skipHeaderSlide)return void this._renderHeaders(a);var g;if(a?g=this._headersContainerElement.children[0]:(d>c&&(c+=this._items.length),g=this._headersContainerElement.children[1+c-d]),!g)return void this._renderHeaders(a);p.removeClass(this._headersContainerElement.children[1],A._ClassName.pivotHeaderSelected),p.addClass(g,A._ClassName.pivotHeaderSelected);var i=this._rtl,j=e(this._headersContainerElement.children[1])-e(g);i&&(j*=-1);var l,m=this;l=h.isAnimationEnabled()?h.executeTransition(this._headersContainerElement.querySelectorAll("."+A._ClassName.pivotHeader),{property:b._browserStyleEquivalents.transform.cssName,delay:0,duration:A._headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+j+"px)"}):k.wrap(),this._slideHeadersAnimation=l.then(f,f)
},_elementClickedHandler:function(a){if(!this.locked){var b,c=a.target;if(p.hasClass(c,A._ClassName.pivotHeader))b=c;else{var d=!1,e=p._elementsFromPoint(a.clientX,a.clientY);if(e&&e[0]===this._viewportElement)for(var f=0,g=e.length;g>f;f++)e[f]===c&&(d=!0),p.hasClass(e[f],A._ClassName.pivotHeader)&&(b=e[f]);d||(b=null)}b&&this._activateHeader(b)}},_headersKeyDown:function(a){this.locked||(a.keyCode===w.leftArrow||a.keyCode===w.pageUp?this._rtl?this._goNext():this._goPrevious():(a.keyCode===w.rightArrow||a.keyCode===w.pageDown)&&(this._rtl?this._goPrevious():this._goNext()))},_headersPointerDownHandler:function(a){a.preventDefault(),this._headersPointerDownPoint={x:a.clientX,y:a.clientY,type:a.pointerType||"mouse"}},_headersPointerUpHandler:function(a){if(!this._headersPointerDownPoint||this.locked)return void(this._headersPointerDownPoint=null);var b=a.clientX-this._headersPointerDownPoint.x;b=this._rtl?-b:b;var c=!1;if((!p._supportsTouchDetection||this._headersPointerDownPoint.type===a.pointerType&&a.pointerType===v)&&(b<-A._headerSwipeTriggerDistance?(this._goNext(),c=!0):b>A._headerSwipeTriggerDistance&&(this._goPrevious(),c=!0)),!c){for(var d=a.target;null!==d&&!p.hasClass(d,A._ClassName.pivotHeader);)d=d.parentElement;null!==d&&this._activateHeader(d)}this._headersPointerDownPoint=null},_hideNavButtons:function(a){a&&this._headersContainerElement.contains(a.relatedTarget)||p.removeClass(this._headersContainerElement,A._ClassName.pivotShowNavButtons)},_pointerDownHandler:function(){WinJS.log&&WinJS.log("_pointerDown","winjs pivot","log"),this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel()},_showNavButtons:function(a){this.locked||a&&a.pointerType===v||p.addClass(this._headersContainerElement,A._ClassName.pivotShowNavButtons)},_handleItemChanged:function(a){if(!this._pendingItems){var b=a.detail.index,d=a.detail.newValue,e=a.detail.oldValue;if(d.element!==e.element){if(d.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Pivot.DuplicateItem",B.duplicateItem);d.element.style.visibility="hidden",d.element.style.opacity=0,this._surfaceElement.insertBefore(d.element,e.element),this._surfaceElement.removeChild(e.element),b===this._currentIndexOnScreen&&(this.selectedIndex=this._currentIndexOnScreen)}this._renderHeaders()}},_handleItemInserted:function(a){if(!this._pendingItems){var b=a.detail.index,d=a.detail.value;if(d.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Pivot.DuplicateItem",B.duplicateItem);d.element.style.visibility="hidden",d.element.style.opacity=0,b<this.items.length-1?this._surfaceElement.insertBefore(d.element,this.items.getAt(b+1).element):this._surfaceElement.appendChild(d.element),b<=this._currentIndexOnScreen&&this._currentIndexOnScreen++,1===this._items.length&&(this.selectedIndex=0),this._renderHeaders()}},_handleItemMoved:function(a){if(!this._pendingItems){var b=a.detail.oldIndex,c=a.detail.newIndex,d=a.detail.value;c<this.items.length-1?this._surfaceElement.insertBefore(d.element,this.items.getAt(c+1).element):this._surfaceElement.appendChild(d.element),b<this._currentIndexOnScreen&&c>=this._currentIndexOnScreen?this._currentIndexOnScreen--:c>this._currentIndexOnScreen&&b<=this._currentIndexOnScreen?this._currentIndexOnScreen++:b===this._currentIndexOnScreen&&(this.selectedIndex=c),this._renderHeaders()}},_handleItemReload:function(){this.items=this.items},_handleItemRemoved:function(a){if(!this._pendingItems){var b=a.detail.value,c=a.detail.index;this._surfaceElement.removeChild(b.element),c<this._currentIndexOnScreen?this._currentIndexOnScreen--:c==this._currentIndexOnScreen&&(this.selectedIndex=Math.min(this.items.length-1,this._currentIndexOnScreen)),this._renderHeaders()}},_fireEvent:function(a,b,c,d){var e=document.createEvent("CustomEvent");return e.initCustomEvent(a,!!b,!!c,d),this.element.dispatchEvent(e)},_getDirectionAccessor:function(){return this._rtl?"right":"left"},_updateEvents:function(a,b){a&&(a.removeEventListener("itemchanged",this._handleItemChangedBound),a.removeEventListener("iteminserted",this._handleItemInsertedBound),a.removeEventListener("itemmoved",this._handleItemMovedBound),a.removeEventListener("itemremoved",this._handleItemRemovedBound),a.removeEventListener("reload",this._handleItemReloadBound)),b&&(b.addEventListener("itemchanged",this._handleItemChangedBound),b.addEventListener("iteminserted",this._handleItemInsertedBound),b.addEventListener("itemmoved",this._handleItemMovedBound),b.addEventListener("itemremoved",this._handleItemRemovedBound),b.addEventListener("reload",this._handleItemReloadBound))},_updatePointerType:function(a){this._pointerType=a.pointerType||u},_writeProfilerMark:function(a){var b="WinJS.UI.Pivot:"+this._id+":"+a;f(b),WinJS.log&&WinJS.log(b,null,"pivotprofiler")}},{_invalidViewportWidth:-1,_headerSlideAnimationDuration:250,_headerSwipeTriggerDistance:50,_ClassName:s._ClassName,_EventName:{selectionChanged:y.selectionChanged,itemAnimationStart:y.itemAnimationStart,itemAnimationEnd:y.itemAnimationEnd},_NavigationModes:{api:"api",inertia:"inertia",none:"",scroll:"scroll"}});a.Class.mix(A,n.DOMEventMixin);var B={get duplicateConstruction(){return e._getWinJSString("ui/duplicateConstruction").value},get duplicateItem(){return e._getWinJSString("ui/duplicateItem").value},get invalidContent(){return e._getWinJSString("ui/invalidPivotContent").value},get pivotAriaLabel(){return e._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return e._getWinJSString("ui/pivotViewportAriaLabel").value}};return A})})}),b("WinJS/Controls/Hub/_Section",["../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UIUtilities"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={HubSection:a.Namespace._lazy(function(){var l={get duplicateConstruction(){return d._getWinJSString("ui/duplicateConstruction").value}},m=a.Class.define(function(a,b){if(a=a||document.createElement("DIV"),b=b||{},a.winControl)throw new c("WinJS.UI.HubSection.DuplicateConstruction",l.duplicateConstruction);a.winControl=this,this._element=a,i.addClass(this.element,m._ClassName.hubSection),i.addClass(this.element,"win-disposable"),this._headerElement=document.createElement("DIV"),this._headerElement.className=m._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+m._ClassName.hubSectionInteractive+" "+m._ClassName.hubSectionHeaderTabStop+'"><div class="'+m._ClassName.hubSectionHeaderWrapper+'"><h2 class="'+m._ClassName.hubSectionHeaderContent+" "+m._Constants.ellipsisTypeClassName+" "+m._Constants.xLargeTypeClassName+'"></h2><span class="'+m._ClassName.hubSectionHeaderChevron+" "+m._Constants.ellipsisTypeClassName+" "+m._Constants.xLargeTypeClassName+'"></span></div></button>',this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,a.appendChild(this._headerElement),this._winKeyboard=new j._WinKeyboard(this._headerElement),this._contentElement=document.createElement("DIV"),this._contentElement.className=m._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",a.appendChild(this._contentElement);for(var d=this.element.firstChild;d!==this._headerElement;){var f=d.nextSibling;this._contentElement.appendChild(d),d=f}this._processors=[e.processAll],g.setOptions(this,b)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(a){this._isHeaderStatic=a,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),i.removeClass(this._headerTabStopElement,m._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),i.addClass(this._headerTabStopElement,m._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(a){this._header=a,this._renderHeader()}},_setHeaderTemplate:function(a){this._template=k._syncRenderer(a),this._renderHeader()},_renderHeader:function(){this._template&&(h._disposeElement(this._headerContentElement),i.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var a=this;return this._processed=(this._processors||[]).reduce(function(b,c){return b.then(function(){return c(a.contentElement)})},this._processed||f.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,h._disposeElement(this._headerContentElement),h.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},_Constants:{ellipsisTypeClassName:"win-type-ellipsis",xLargeTypeClassName:"win-type-x-large"},isDeclarativeControlContainer:b.markSupportedForProcessing(function(a,b){b!==e.processAll&&(a._processors=a._processors||[],a._processors.push(b),a._processed&&a._process())})});return m})};return a.Namespace.define("WinJS.UI",l),a.Namespace.defineWithParent(null,null,l)}),b("WinJS/Controls/Hub",["../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_UI","../Utilities/_UIUtilities","./Hub/_Section","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.Namespace.define("WinJS.UI",{Hub:a.Namespace._lazy(function(){function s(a){var b=document.createTextNode("object"==typeof a.header?JSON.stringify(a.header):""+a.header);return b}var t=o.Key,u=d._createEventProperty,v={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},w=500,x={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},y={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},z={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},A=a.Class.define(function(a,b){if(a=a||document.createElement("DIV"),b=b||{},a.winControl)throw new c("WinJS.UI.Hub.DuplicateConstruction",C.duplicateConstruction);this._id=a.id||o._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),window.addEventListener("keydown",this._windowKeyDownHandlerBound),a.winControl=this,this._element=a,o.addClass(this.element,A._ClassName.hub),o.addClass(this.element,"win-disposable"),this._viewportElement=document.createElement("DIV"),this._viewportElement.className=A._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",C.hubViewportAriaLabel),this._surfaceElement=document.createElement("DIV"),this._surfaceElement.className=A._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,b.orientation||(this._orientation=p.Orientation.horizontal,o.addClass(this.element,A._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new k.wrap,this._currentIndexForSezo=0,this._parse(),n.setOptions(this,b),o._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this.element.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this)),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(a){this._measured=!1,a===p.Orientation.vertical?(o.removeClass(this.element,A._ClassName.hubHorizontal),o.addClass(this.element,A._ClassName.hubVertical)):(a=p.Orientation.horizontal,o.removeClass(this.element,A._ClassName.hubVertical),o.addClass(this.element,A._ClassName.hubHorizontal)),this._orientation=a,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(a){var b=!this._pendingSections;this._pendingSections=a,this._refresh(),b&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=s),this._headerTemplate)},set:function(a){this._pendingHeaderTemplate=a||s,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(a){if(a=Math.max(0,a),this._pendingRefresh)this._pendingScrollLocation=a,this._pendingSectionOnScreen=null;else{this._measure();var b=Math.max(0,Math.min(this._scrollLength-this._viewportSize,a));this._scrollPosition=b;var c={};c[this._names.scrollPos]=b,o.setScrollPosition(this._viewportElement,c)}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var a=0;a<this._sectionSizes.length;a++){var b=this._sectionSizes[a];if(b.offset+b.size-b.borderEnd-b.paddingEnd>this._scrollPosition+this._startSpacer+b.borderStart+b.paddingStart)return a}return-1},set:function(a){a=Math.max(0,a),this._pendingRefresh?(this._pendingSectionOnScreen=a,this._pendingScrollLocation=null):(this._measure(),a>=0&&a<this._sectionSizes.length&&this._scrollToSection(a))}},indexOfFirstVisible:{get:function(){this._measure();for(var a=0;a<this._sectionSizes.length;a++){var b=this._sectionSizes[a];if(b.offset+b.size-b.borderEnd-b.paddingEnd>this._scrollPosition)return a}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var a=this._sectionSizes.length-1;a>=0;a--){var b=this._sectionSizes[a];if(b.offset+b.paddingStart+b.borderStart<this._scrollPosition+this._viewportSize)return a}return-1}},onheaderinvoked:u(v.headerInvoked),onloadingstatechanged:u(v.loadingStateChanged),oncontentanimating:u(v.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(A.LoadingState.loading),this._pendingRefresh=!0,m.schedule(this._refreshImpl.bind(this),m.Priority.high))},_refreshImpl:function(){if(!this._disposed){var a=k.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,h.isAnimationEnabled()))){var b=this._fireEvent(A._EventName.contentAnimating,{type:A.AnimationType.contentTransition});b&&(this._viewportElement.style["-ms-overflow-style"]="none",a=g.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=b}a.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var a=!1;if(this._pendingSections){for(a=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;){var b=this.element.firstElementChild;b.parentNode.removeChild(b)}o.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),a&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:this.scrollPosition=+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(A.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(a){if(!this._pendingSections){var b=a.detail.newValue,d=a.detail.oldValue;if(b._setHeaderTemplate(this.headerTemplate),b.element!==d.element){if(b.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Hub.DuplicateSection",C.duplicateSection);this._surfaceElement.insertBefore(b.element,d.element),this._surfaceElement.removeChild(d.element),this._measured=!1,this._setState(A.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(a){if(!this._pendingSections){var b=a.detail.index,d=a.detail.value;d._animation&&d._animation.cancel();var e,f=this._fireEvent(A._EventName.contentAnimating,{type:A.AnimationType.insert,index:b,section:d});if(f){for(var h=[],i=b+1;i<this.sections.length;i++)h.push(this.sections.getAt(i).element);e=new g._createUpdateListAnimation([d.element],[],h)}if(d.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Hub.DuplicateSection",C.duplicateSection);if(d._setHeaderTemplate(this.headerTemplate),b<this.sections.length-1?this._surfaceElement.insertBefore(d.element,this.sections.getAt(b+1).element):this._surfaceElement.appendChild(d.element),this._measured=!1,e){var j=e.execute();this.runningAnimations=k.join([this.runningAnimations,j])}this._setState(A.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(a){if(!this._pendingSections){var b=a.detail.newIndex,c=a.detail.value;b<this.sections.length-1?this._surfaceElement.insertBefore(c.element,this.sections.getAt(b+1).element):this._surfaceElement.appendChild(c.element),this._measured=!1,this._setState(A.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(a){if(!this._pendingSections){var b=a.detail.value,c=a.detail.index,d=k.wrap(),e=this._fireEvent(A._EventName.contentAnimating,{type:A.AnimationType.remove,index:c,section:b});if(e){for(var f=[],h=c;h<this.sections.length;h++)f.push(this.sections.getAt(h).element);var i=new g._createUpdateListAnimation([],[b.element],f);this._measure();var j=b.element.offsetTop,l=b.element.offsetLeft;b.element.style.position="absolute",b.element.style.top=j,b.element.style.left=l,b.element.style.opacity=0,this._measured=!1,d=i.execute().then(function(){b.element.style.position="",b.element.style.top="",b.element.style.left="",b.element.style.opacity=1}.bind(this))}d.done(function(){this._disposed||(this._surfaceElement.removeChild(b.element),this._measured=!1)}.bind(this)),b._animation=d,this.runningAnimations=k.join([this.runningAnimations,d]),this._setState(A.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(a,b){a&&(a.removeEventListener("itemchanged",this._handleSectionChangedBind),a.removeEventListener("iteminserted",this._handleSectionInsertedBind),a.removeEventListener("itemmoved",this._handleSectionMovedBind),a.removeEventListener("itemremoved",this._handleSectionRemovedBind),a.removeEventListener("reload",this._handleSectionReloadBind)),b&&(b.addEventListener("itemchanged",this._handleSectionChangedBind),b.addEventListener("iteminserted",this._handleSectionInsertedBind),b.addEventListener("itemmoved",this._handleSectionMovedBind),b.addEventListener("itemremoved",this._handleSectionRemovedBind),b.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var a=0;a<this.sections.length;a++){var b=this._sections.getAt(a);if(b._animation&&b._animation.cancel(),b.element.parentNode===this._surfaceElement)throw new c("WinJS.UI.Hub.DuplicateSection",C.duplicateSection);this._surfaceElement.appendChild(b.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var a=0;a<this.sections.length;a++){var b=this._sections.getAt(a);b._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(a){var b=this._sections.getAt(a);return b._process().then(function(){var a=b.contentElement.style;""!==a.visibility&&(a.visibility="")})},_loadSections:function(){function a(a){a.then(function(){m.schedule(b,m.Priority.idle)})}function b(){if(c===d._loadId&&!d._disposed)if(f.length){var b=f.shift(),e=d._loadSection(b);a(e)}else j.complete()}this._loadId++;var c=this._loadId,d=this,e=k.wrap(),f=[],i=k.wrap();if(this._showProgressPromise||(this._showProgressPromise=k.timeout(w).then(function(){this._disposed||(this._progressBar||(this._progressBar=document.createElement("progress"),o.addClass(this._progressBar,A._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var j=new l;i=j.promise;for(var n=[],p=Math.max(0,this.indexOfFirstVisible),q=Math.max(0,this.indexOfLastVisible),r=p;q>=r;r++)n.push(this._loadSection(r));for(p--,q++;p>=0||q<this.sections.length;)q<this.sections.length&&(f.push(q),q++),p>=0&&(f.push(p),p--);var s=k.join(n);s.done(function(){c!==this._loadId||d._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),m.schedule(function(){if(c===this._loadId&&!d._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&h.isAnimationEnabled()){var a={type:A.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(A._EventName.contentAnimating,a))&&(this._viewportElement.style["-ms-overflow-style"]="none",e=g.enterContent(this._viewportElement,[{left:this._fireEntrance?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"}).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this)))}this._element===document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},m.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),a(s)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);k.join([this.runningAnimations,e,i]).done(function(){c!==this._loadId||d._disposed||(this.runningAnimations=k.wrap(),this._setState(A.LoadingState.complete),m.schedule(this._updateSnapList.bind(this),m.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(a){if(a!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+a+",info"),this._loadingState=a;var b=document.createEvent("CustomEvent");b.initCustomEvent(A._EventName.loadingStateChanged,!0,!1,{loadingState:a}),this._element.dispatchEvent(b)}},_parse:function(){for(var a=[],b=this.element.firstElementChild;b!==this._viewportElement;){j.processAll(b);var d=b.winControl;if(!d)throw new c("WinJS.UI.Hub.InvalidContent",C.invalidContent);a.push(d);var e=b.nextElementSibling;b=e}this.sections=new i.List(a)},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!0,!0,b),this.element.dispatchEvent(c)},_findHeaderTabStop:function(a){if(a.parentNode&&o._matchesSelector(a,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!o.hasClass(a,"win-hub-section-header-tabstop");)a=a.parentElement;return a}return null},_isHeaderInteractive:function(a){return a.parentNode?o._matchesSelector(a,".win-interactive, .win-interactive *"):!1},_clickHandler:function(a){var b=this._findHeaderTabStop(a.target);if(b&&!this._isHeaderInteractive(a.target)){var c=b.parentElement.parentElement.winControl;if(!c.isHeaderStatic){var d=this.sections.indexOf(c);this._fireEvent(A._EventName.headerInvoked,{index:d,section:c})}}},_resizeHandler:function(){this._measured=!1,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)},_contentResizeHandler:function(){this._measured=!1,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==A.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===getComputedStyle(this._element,null).direction,this._names=this.orientation===p.Orientation.vertical?x:this._rtl?y:z,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=o.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var a=getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(a[this._names.marginStart])+parseFloat(a[this._names.borderStart])+parseFloat(a[this._names.paddingStart]),this._endSpacer=parseFloat(a[this._names.marginEnd])+parseFloat(a[this._names.borderEnd])+parseFloat(a[this._names.paddingEnd]),this._sectionSizes=[];for(var b=0;b<this.sections.length;b++){var c=this.sections.getAt(b),d=getComputedStyle(c.element);this._sectionSizes[b]={offset:c.element[this._names.offsetPos],size:c.element[this._names.offsetSize],marginStart:parseFloat(d[this._names.marginStart]),marginEnd:parseFloat(d[this._names.marginEnd]),borderStart:parseFloat(d[this._names.borderStart]),borderEnd:parseFloat(d[this._names.borderEnd]),paddingStart:parseFloat(d[this._names.paddingStart]),paddingEnd:parseFloat(d[this._names.paddingEnd])},this._rtl&&this.orientation===p.Orientation.horizontal&&(this._sectionSizes[b].offset=this._viewportSize-(this._sectionSizes[b].offset+this._sectionSizes[b].size))}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var a="snapList(",b=0;b<this._sectionSizes.length;b++){b>0&&(a+=",");var c=this._sectionSizes[b];a+=c.offset-c.marginStart-this._startSpacer+"px"}a+=")";var d="",e="";this.orientation===p.Orientation.vertical?d=a:e=a,this._lastSnapPointY!==d&&(this._lastSnapPointY=d,this._viewportElement.style["-ms-scroll-snap-points-y"]=d),this._lastSnapPointX!==e&&(this._lastSnapPointX=e,this._viewportElement.style["-ms-scroll-snap-points-x"]=e),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(a,b){this._measure();var c=this._sectionSizes[a],d=Math.min(this._scrollLength-this._viewportSize,c.offset-c.marginStart-this._startSpacer);this._scrollTo(d,b)},_ensureVisible:function(a,b){this._measure();var c=this._ensureVisibleMath(a,this._scrollPosition);this._scrollTo(c,b)},_ensureVisibleMath:function(a,b){this._measure();var c=this._sectionSizes[a],d=Math.min(this._scrollLength-this._viewportSize,c.offset-c.marginStart-this._startSpacer),e=Math.max(0,c.offset+c.size+c.marginEnd+this._endSpacer-this._viewportSize+1);return b>d?b=d:e>b&&(b=Math.min(d,e)),b},_scrollTo:function(a,b){if(this._scrollPosition=a,b)this.orientation===p.Orientation.vertical?o._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):o._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var c={};c[this._names.scrollPos]=this._scrollPosition,o.setScrollPosition(this._viewportElement,c)}},_windowKeyDownHandler:function(a){if(a.keyCode===t.tab){this._tabSeenLast=!0;var c=this;b._yieldForEvents(function(){c._tabSeenLast=!1})}},_focusin:function(a){if(this._tabSeenLast){var b=this._findHeaderTabStop(a.target);if(b&&!this._isHeaderInteractive(a.target)){var c=this.sections.indexOf(b.parentElement.parentElement.winControl);c>-1&&this._ensureVisible(c,!0)}}for(var d=a.target;d&&!o.hasClass(d,r.HubSection._ClassName.hubSection);)d=d.parentElement;if(d){var c=this.sections.indexOf(d.winControl);c>-1&&(this._currentIndexForSezo=c)}if(a.target===this.element){var e;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(e=this._sectionToFocus,this._sectionToFocus=null):e=this.sectionOnScreen,this._moveFocusIn(e)}},_moveFocusIn:function(a){if(a>=0){for(var b=a;b<this.sections.length;b++){var c=this.sections.getAt(b),d=q._trySetActive(c._headerTabStopElement,this._viewportElement);if(d)return;if(q._setActiveFirstFocusableElement(c.contentElement,this._viewportElement))return}for(var b=a-1;b>=0;b--){var c=this.sections.getAt(b);if(q._setActiveFirstFocusableElement(c.contentElement,this._viewportElement))return;var d=q._trySetActive(c._headerTabStopElement,this._viewportElement);if(d)return}}},_keyDownHandler:function(a){var b=this._rtl?t.rightArrow:t.leftArrow,c=this._rtl?t.leftArrow:t.rightArrow;if(a.keyCode===t.upArrow||a.keyCode===t.downArrow||a.keyCode===t.leftArrow||a.keyCode===t.rightArrow||a.keyCode===t.pageUp||a.keyCode===t.pageDown){var d=this._findHeaderTabStop(a.target);if(d&&!this._isHeaderInteractive(a.target)){var e,f=this.sections.indexOf(d.parentElement.parentElement.winControl),g=!1;if(a.keyCode===t.pageDown||this.orientation===p.Orientation.horizontal&&a.keyCode===c||this.orientation===p.Orientation.vertical&&a.keyCode===t.downArrow)for(var h=f+1;h<this.sections.length;h++){{this.sections.getAt(h)}if(this._tryFocus(h)){e=h;break}}else if(a.keyCode===t.pageUp||this.orientation===p.Orientation.horizontal&&a.keyCode===b||this.orientation===p.Orientation.vertical&&a.keyCode===t.upArrow)for(var h=f-1;h>=0;h--){{this.sections.getAt(h)}if(this._tryFocus(h)){e=h;break}}(a.keyCode===t.upArrow||a.keyCode===t.downArrow||a.keyCode===t.leftArrow||a.keyCode===t.rightArrow)&&(g=!0),+e===e&&(g?this._ensureVisible(e,!0):this._scrollToSection(e,!0)),a.preventDefault()}}else if(a.keyCode===t.home||a.keyCode===t.end){this._measure();var i=Math.max(0,this._scrollLength-this._viewportSize);this._scrollTo(a.keyCode===t.home?0:i,!0),a.preventDefault()}},_tryFocus:function(a){var b=this.sections.getAt(a);
return o._setActive(b._headerTabStopElement,this._viewportElement),document.activeElement===b._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new B(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===p.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(a,b){var c;c=this.orientation===p.Orientation.horizontal?a:b,this._measure(),c+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var d=1;d<this._sectionSizes.length;d++){var e=this._sectionSizes[d];if(e.offset-e.marginStart>c){this._currentIndexForSezo=d-1;break}}},_getCurrentItem:function(){var a;if(this._sectionSizes.length>0){this._measure();var b=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),c=this._sectionSizes[b];a=this.orientation===p.Orientation.horizontal?{left:Math.max(0,c.offset-c.marginStart-this._scrollPosition),top:0,width:c.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,c.offset-c.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:c.size};var d=this.sections.getAt(b);return k.wrap({item:{data:d,index:b,groupIndexHint:b},position:a})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(a,b){if(a.index>=0&&a.index<this._sectionSizes.length){this._measure();var c,d=this._sectionSizes[a.index];c=this.orientation===p.Orientation.horizontal?b.left:b.top,this._sectionToFocus=a.index;var e=d.offset-c,e=this._ensureVisibleMath(a.index,e);this._scrollPosition=e;var f={};f[this._names.scrollPos]=this._scrollPosition,o.setScrollPosition(this._viewportElement,f)}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(a){var b="WinJS.UI.Hub:"+this._id+":"+a;f(b),WinJS.log&&WinJS.log(b,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,window.removeEventListener("keydown",this._windowKeyDownHandlerBound),this._updateEvents(this._sections);for(var a=0;a<this.sections.length;a++)this.sections.getAt(a).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:v.contentAnimating,headerInvoked:v.headerInvoked,loadingStateChanged:v.loadingStateChanged}});a.Class.mix(A,n.DOMEventMixin);var B=a.Class.define(function(a){this._hub=a},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(a,b,c,d){this._hub._configureForZoom(a,b,c,d)},setCurrentItem:function(a,b){this._hub._setCurrentItem(a,b)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(a,b){return this._hub._positionItem(a,b)},endZoom:function(a){this._hub._endZoom(a)}}),C={get duplicateConstruction(){return e._getWinJSString("ui/duplicateConstruction").value},get duplicateSection(){return e._getWinJSString("ui/duplicateSection").value},get invalidContent(){return e._getWinJSString("ui/invalidHubContent").value},get hubViewportAriaLabel(){return e._getWinJSString("ui/hubViewportAriaLabel").value}};return A})})}),b("WinJS/Controls/Flyout/_Overlay",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_Overlay:WinJS.Namespace._lazy(function(){function a(a){if(!a)return[];"string"!=typeof a&&a&&a.length||(a=[a]);var b,c=[];for(b=0;b<a.length;b++)if(a[b])if("string"==typeof a[b]){var d=document.getElementById(a[b]);d&&c.push(d)}else c.push(a[b].element?a[b].element:a[b]);return c}function b(a,b){var c=document.querySelectorAll("."+g);if(c)for(var d=c.length,e=0;d>e;e++){var f=c[e],h=f.winControl;h._disposed||h&&h[b](a)}}function c(){m._rightMouseMightEdgy||m._hideAllFlyouts()}var d=WinJS.UI,e=WinJS.Utilities,f=e._createEventProperty,g="win-overlay",h="win-hidefocus",i="beforeshow",j="aftershow",k="beforehide",l="afterhide",m=WinJS.Class.define(function(a,b){this._baseOverlayConstructor(a,b)},{_baseOverlayConstructor:function(a,b){this._disposed=!1,a||(a=document.createElement("div"));var c=a.winControl;if(c)throw new WinJS.ErrorFromName("WinJS.UI._Overlay.DuplicateConstruction",n.duplicateConstruction);this._element||(this._element=a),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,a.winControl=this,WinJS.Utilities.addClass(this._element,g),WinJS.Utilities.addClass(this._element,"win-disposable");var d=this._element.getAttribute("unselectable");(null===d||void 0===d)&&this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=WinJS.Promise.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,b&&WinJS.UI.setOptions(this,b)},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){a=!!a;var b=!!this._element.disabled;b!==a&&(this._element.disabled=a,!this.hidden&&this._element.disabled&&this._hideOrDismiss())}},onbeforeshow:f(i),onaftershow:f(j),onbeforehide:f(k),onafterhide:f(l),dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},show:function(){this._show()},_show:function(){this._baseShow()},hide:function(){this._hide()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext||this._fakeHide}},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_baseShow:function(){if(this._animating||this._keyboardShowing||this._keyboardHiding)return this._doNext="show",!1;if(this._currentDocumentWidth=this._currentDocumentWidth||document.documentElement.offsetWidth,"visible"!==this._element.style.visibility||this._fakeHide){this._element.winAnimating="showing",this._element.style.display="",this._fakeHide||(this._element.style.visibility="hidden"),this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._sendEvent(m.beforeShow),this._findPosition();var a=this;return this._animationPromise=this._currentAnimateIn().then(function(){a._baseEndShow()},function(){a._baseEndShow()}),this._fakeHide=!1,!0}return!1},_findPosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="",this._endShow(),"show"===this._doNext&&(this._doNext=""),this._sendEvent(m.afterShow),this._writeProfilerMark("show,StopTM"),WinJS.Utilities.Scheduler.schedule(this._checkDoNext,WinJS.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_endShow:function(){},_baseHide:function(){if(this._animating||this._keyboardShowing)return this._doNext="hide",!1;if(this._keyboardHiding&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(m.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var a=this;this._animationPromise=this._currentAnimateOut().then(function(){a._baseEndHide()},function(){a._baseEndHide()})}return!0}return this._fakeHide=!1,!1},_baseEndHide:function(){this._disposed||(this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._sendEvent(m.afterHide),this._writeProfilerMark("hide,StopTM"),WinJS.Utilities.Scheduler.schedule(this._checkDoNext,WinJS.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_checkDoNext:function(){this._animating||this._keyboardShowing||this._keyboardHiding||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",window.getComputedStyle(this._element,null).opacity,WinJS.UI.Animation.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,window.getComputedStyle(this._element,null).opacity,WinJS.UI.Animation.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(a,b){if(!this._disposed){var c=document.createEvent("CustomEvent");c.initEvent(a,!0,!0,b||{}),this._element.dispatchEvent(c)}},_showCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands(c.commands,[],b)},_hideCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands([],c.commands,b)},_showOnlyCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands(c.commands,c.others,b)},_showAndHideCommands:function(a,b,c){c||this.hidden&&!this._animating?(this._showAndHideFast(a,b),this._removeFromQueue(a,this._queuedToShow),this._removeFromQueue(b,this._queuedToHide)):(this._updateAnimateQueue(a,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(b,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(a,b){var c;for(c=0;c<a.length;c++){var d;for(d=0;d<b.length;d++)if(b[d]===a[c]){b.splice(d,1);break}}},_updateAnimateQueue:function(a,b,c){if(!this._disposed){var d;for(d=0;d<a.length;d++){var e;for(e=0;e<b.length&&b[e]!==a[d];e++);for(e===b.length&&(b[e]=a[d]),e=0;e<c.length;e++)if(c[e]===a[d]){c.splice(e,1);break}}this._queuedCommandAnimation||(this._animating||WinJS.Utilities.Scheduler.schedule(this._checkDoNext,WinJS.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c],d&&d.style&&(d.style.visibility="",d.style.display="");for(c=0;c<b.length;c++)d=b[c],d&&d.style&&(d.style.visibility="hidden",d.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),WinJS.Utilities.Scheduler.schedule(this._checkDoNext,WinJS.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var a,b=this._queuedToShow,c=this._queuedToHide,d=this._findSiblings(b.concat(c));for(a=0;a<b.length;a++)b[a]&&b[a].style&&document.body.contains(b[a])?"hidden"!==b[a].style.visibility&&"0"!==b[a].style.opacity&&(d.push(b[a]),b.splice(a,1),a--):(b.splice(a,1),a--);for(a=0;a<c.length;a++)c[a]&&c[a].style&&document.body.contains(c[a])&&"hidden"!==c[a].style.visibility&&"0"!==c[a].style.opacity||(c.splice(a,1),a--);var e=this._baseBeginAnimateCommands(b,c,d),f=this;e?e.done(function(){f._baseEndAnimateCommands(c)},function(){f._baseEndAnimateCommands(c)}):WinJS.Utilities.Scheduler.schedule(function(){f._baseEndAnimateCommands([])},WinJS.Utilities.Scheduler.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(a,b,c){this._beginAnimateCommands(a,b,this._getVisibleCommands(c));var d=null,e=null;b.length>0&&(e=WinJS.UI.Animation.createDeleteFromListAnimation(b,0===a.length?c:void 0)),a.length>0&&(d=WinJS.UI.Animation.createAddToListAnimation(a,c));for(var f=0,g=b.length;g>f;f++){var h=b[f].getBoundingClientRect(),i=window.getComputedStyle(b[f]);b[f].style.top=h.top-parseFloat(i.marginTop)+"px",b[f].style.left=h.left-parseFloat(i.marginLeft)+"px",b[f].style.opacity=0,b[f].style.position="fixed"}this._element.winAnimating="rearranging";var j=null;for(e&&(j=e.execute()),f=0;f<a.length;f++)a[f].style.visibility="",a[f].style.display="",a[f].style.opacity=1;if(d){var k=d.execute();j=j?WinJS.Promise.join([j,k]):k}return j},_beginAnimateCommands:function(){},_getVisibleCommands:function(a){var b,c=a,d=[];c||(c=this.element.querySelectorAll(".win-command"));for(var e=0,f=c.length;f>e;e++)b=c[e].winControl||c[e],b.hidden||d.push(b);return d},_baseEndAnimateCommands:function(a){if(!this._disposed){var b;for(b=0;b<a.length;b++)a[b].style.position="",a[b].getBoundingClientRect(),a[b].style.visibility="hidden",a[b].style.display="none",a[b].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(b){b=a(b);var c={};c.commands=[],c.others=[];var d,e,f=this.element.querySelectorAll(".win-command");for(d=0;d<f.length;d++){var g=!1;for(e=0;e<b.length;e++)if(b[e]===f[d]){c.commands.push(f[d]),b.splice(e,1),g=!0;break}g||c.others.push(f[d])}return c},_findSiblings:function(a){var b,c,d=[],e=this.element.querySelectorAll(".win-command");for(b=0;b<e.length;b++){var f=!1;for(c=0;c<a.length;c++)if(a[c]===e[b]){a.splice(c,1),f=!0;break}f||d.push(e[b])}return d},_baseResize:function(a){if(void 0!==this._currentDocumentWidth)if("hidden"===this._element.style.visibility)this._currentDocumentWidth=void 0;else{var b=document.documentElement.offsetWidth;this._currentDocumentWidth!==b&&(this._currentDocumentWidth=b,this._sticky||this._hideOrDismiss())}this._resize(a)},_hideOrDismiss:function(){var a=this._element;a&&WinJS.Utilities.hasClass(a,"win-settingsflyout")?this._dismiss():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(a,b){for(var c=a.children,d=new Array(c.length),e=0;e<c.length;e++){if(!WinJS.Utilities.hasClass(c[e],"win-command")&&c[e].getAttribute("data-win-control")!==b)throw new WinJS.ErrorFromName("WinJS.UI._Overlay.MustContainCommands",n.mustContainCommands);WinJS.UI.processAll(c[e]),d[e]=c[e].winControl}return d},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||m._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var a=this._element.firstElementChild.tabIndex,b=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var c=WinJS.Utilities._focusLastFocusableElement(this._element);return c&&m._trySelect(document.activeElement),this._element.firstElementChild.tabIndex=a,this._element.lastElementChild.tabIndex=b,c}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||m._trySetActive(this._element)},_focusOnFirstFocusableElement:function(){if(this._element.firstElementChild){var a=this._element.firstElementChild.tabIndex,b=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var c=WinJS.Utilities._focusFirstFocusableElement(this._element);return c&&m._trySelect(document.activeElement),this._element.firstElementChild.tabIndex=a,this._element.lastElementChild.tabIndex=b,c}return!1},_addOverlayEventHandlers:function(a){if(!m._flyoutEdgeLightDismissEvent){window.addEventListener("blur",m._checkBlur,!1);var d=this;if(WinJS.Utilities.hasWinRT){var e=Windows.UI.Input.EdgeGesture.getForCurrentView();e.addEventListener("starting",m._hideAllFlyouts),e.addEventListener("completed",c);var f=Windows.UI.ViewManagement.InputPane.getForCurrentView();f.addEventListener("showing",function(a){d._writeProfilerMark("_showingKeyboard,StartTM"),b(a,"_showingKeyboard"),d._writeProfilerMark("_showingKeyboard,StopTM")}),f.addEventListener("hiding",function(a){d._writeProfilerMark("_hidingKeyboard,StartTM"),b(a,"_hidingKeyboard"),d._writeProfilerMark("_hidingKeyboard,StopTM")}),document.addEventListener("scroll",function(a){d._writeProfilerMark("_checkScrollPosition,StartTM"),b(a,"_checkScrollPosition"),d._writeProfilerMark("_checkScrollPosition,StopTM")})}window.addEventListener("resize",function(a){d._writeProfilerMark("_baseResize,StartTM"),b(a,"_baseResize"),d._writeProfilerMark("_baseResize,StopTM")}),m._flyoutEdgeLightDismissEvent=!0}a&&this._handleEventsForFlyoutOrSettingsFlyout()},_handleEventsForFlyoutOrSettingsFlyout:function(){var a=this;WinJS.Utilities._addEventListener(this._element,"focusout",function(b){m._hideIfLostFocus(a,b)},!1),WinJS.Utilities._addEventListener(this._element,"pointerdown",m._checkRightClickDown,!0),WinJS.Utilities._addEventListener(this._element,"pointerup",m._checkRightClickUp,!0)},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI._Overlay:"+this._id+":"+a)}});m._clickEatingAppBarDiv=!1,m._clickEatingFlyoutDiv=!1,m._flyoutEdgeLightDismissEvent=!1,m._hideFlyouts=function(a,b){for(var c=a.querySelectorAll(".win-flyout"),d=c.length,e=0;d>e;e++){var f=c[e];if("hidden"!==f.style.visibility){var g=f.winControl;!g||b&&g._sticky||g._hideOrDismiss()}}},m._hideSettingsFlyouts=function(a,b){for(var c=a.querySelectorAll(".win-settingsflyout"),d=c.length,e=0;d>e;e++){var f=c[e];if("hidden"!==f.style.visibility){var g=f.winControl;!g||b&&g._sticky||g._hideOrDismiss()}}},m._hideAllFlyouts=function(){m._hideFlyouts(document,!0),m._hideSettingsFlyouts(document,!0)},m._createClickEatingDivTemplate=function(a,b){var c=document.createElement("section");return WinJS.Utilities.addClass(c,a),WinJS.Utilities._addEventListener(c,"pointerdown",function(a){m._checkSameClickEatingPointerUp(a,!0)},!0),WinJS.Utilities._addEventListener(c,"pointerup",function(a){m._checkClickEatingPointerDown(a,!0)},!0),c.addEventListener("click",b,!0),c.setAttribute("role","menuitem"),c.setAttribute("aria-label",n.closeOverlay),c.setAttribute("unselectable","on"),document.body.appendChild(c),c},m._createClickEatingDivAppBar=function(){m._clickEatingAppBarDiv||(m._clickEatingAppBarDiv=m._createClickEatingDivTemplate(m._clickEatingAppBarClass,m._handleAppBarClickEatingClick))},m._createClickEatingDivFlyout=function(){m._clickEatingFlyoutDiv||(m._clickEatingFlyoutDiv=m._createClickEatingDivTemplate(m._clickEatingFlyoutClass,m._handleFlyoutClickEatingClick))},m._checkClickEatingPointerDown=function(a,b){var c=a.currentTarget;if(c)try{c._winPointerId=a.pointerId,c._winRightMouse=2===a.button}catch(d){}b&&!c._winRightMouse&&(a.stopPropagation(),a.preventDefault())},m._checkSameClickEatingPointerUp=function(a,b){var c=!1,d=!1,e=a.currentTarget;try{e&&e._winPointerId===a.pointerId&&(c=!0,d=e._winRightMouse,d&&b&&(c=!1))}catch(f){}return b&&!d&&(a.stopPropagation(),a.preventDefault()),c},m._handleAppBarClickEatingClick=function(a){a.stopPropagation(),a.preventDefault(),d.AppBar._hideLightDismissAppBars(null,!1),m._hideClickEatingDivAppBar(),m._hideAllFlyouts()},m._handleFlyoutClickEatingClick=function(a){a.stopPropagation(),a.preventDefault(),m._hideClickEatingDivFlyout(),m._hideFlyouts(document,!0)},m._checkRightClickDown=function(a){m._checkClickEatingPointerDown(a,!1)},m._checkRightClickUp=function(a){m._checkSameClickEatingPointerUp(a,!1)&&(m._rightMouseMightEdgy=!0,WinJS.Utilities._yieldForEvents(function(){m._rightMouseMightEdgy=!1}))},m._showClickEatingDivAppBar=function(){WinJS.Utilities.Scheduler.schedule(function(){m._clickEatingAppBarDiv.style.display="block"},WinJS.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivAppBar")},m._hideClickEatingDivAppBar=function(){WinJS.Utilities.Scheduler.schedule(function(){m._clickEatingAppBarDiv.style.display="none"},WinJS.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivAppBar")},m._showClickEatingDivFlyout=function(){WinJS.Utilities.Scheduler.schedule(function(){m._clickEatingFlyoutDiv.style.display="block"},WinJS.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivFlyout")},m._hideClickEatingDivFlyout=function(){WinJS.Utilities.Scheduler.schedule(function(){m._clickEatingFlyoutDiv.style.display="none"},WinJS.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivFlyout")},m._isFlyoutVisible=function(){return m._clickEatingFlyoutDiv?"block"===m._clickEatingFlyoutDiv.style.display:!1},m._hideIfLostFocus=function(a){if(!a.hidden&&"showing"!==a.element.winAnimating&&!a._sticky){var b=document.activeElement;if(!a._element||!a._element.contains(b)){if(WinJS.Utilities.hasClass(a._element,"win-settingsflyout")){var c=a,d=m._getParentControlUsingClassName(b,"win-flyout");if(d&&d._previousFocus&&c.element.contains(d._previousFocus))return void WinJS.Utilities._addEventListener(d.element,"focusout",function e(a){m._hideIfLostFocus(c,a),WinJS.Utilities._removeEventListener(d.element,"focusout",e,!1)},!1)}b&&(WinJS.Utilities.hasClass(b,m._clickEatingFlyoutClass)||WinJS.Utilities.hasClass(b,m._clickEatingAppBarClass))||a._hideOrDismiss()}}},m._checkBlur=function(){if(document.hasFocus()){if(m._clickEatingFlyoutDiv&&"block"===m._clickEatingFlyoutDiv.style.display||m._clickEatingAppBarDiv&&"block"===m._clickEatingAppBarDiv.style.display){var a=document.activeElement;a&&"IFRAME"===a.tagName&&!a.msLightDismissBlur&&(a.addEventListener("blur",m._checkBlur,!1),a.msLightDismissBlur=!0)}}else m._hideAllFlyouts(),d.AppBar._hideLightDismissAppBars(null,!1)},m._trySetActive=function(a){return a&&document.body&&document.body.contains(a)&&WinJS.Utilities._setActive(a)?a===document.activeElement:!1},m._trySelect=function(a){try{a&&a.select&&a.select()}catch(b){}},m._addHideFocusClass=function(a){a&&(WinJS.Utilities.addClass(a,h),WinJS.Utilities._addEventListener(a,"focusout",m._removeHideFocusClass,!1))},m._removeHideFocusClass=function(a){var b=a.target;b&&b!==document.activeElement&&(WinJS.Utilities.removeClass(b,h),WinJS.Utilities._removeEventListener(a.target,"focusout",m._removeHideFocusClass,!1))},m._getParentControlUsingClassName=function(a,b){for(;a&&a!==document.body;){if(WinJS.Utilities.hasClass(a,b))return a.winControl;a=a.parentNode}return null},m._keyboardInfo={get _visible(){try{return WinJS.Utilities.hasWinRT&&Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(a){return!1}},get _extraOccluded(){var a;if(WinJS.Utilities.hasWinRT)try{a=Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height}catch(b){}return a&&!m._keyboardInfo._isResized?a:0},get _isResized(){var a=document.documentElement.clientHeight/window.innerHeight,b=document.documentElement.clientWidth/window.innerWidth;return.99>b/a},get _visibleDocTop(){return window.pageYOffset-document.documentElement.scrollTop},get _visibleDocBottom(){return m._keyboardInfo._visibleDocTop+m._keyboardInfo._visibleDocHeight},get _visibleDocHeight(){return m._keyboardInfo._visualViewportHeight-m._keyboardInfo._extraOccluded},get _visualViewportHeight(){var a=m._keyboardInfo._visualViewportSpace;return a.bottom-a.top},get _visualViewportWidth(){var a=m._keyboardInfo._visualViewportSpace;return a.right-a.left},get _visualViewportSpace(){var a="win-visualviewport-space",b=document.body.querySelector("."+a);return b||(b=document.createElement("DIV"),b.className=a,document.body.appendChild(b)),b.getBoundingClientRect()},get _visibleDocBottomOffset(){return m._keyboardInfo._isResized?0:m._keyboardInfo._extraOccluded},get _animationShowLength(){if(!WinJS.Utilities.hasWinRT)return 0;for(var a=Windows.UI.Core.AnimationMetrics,b=new a.AnimationDescription(a.AnimationEffect.showPanel,a.AnimationEffectTarget.primary),c=b.animations,d=0,e=0;e<c.size;e++){var f=c[e];d=Math.max(d,f.delay+f.duration)}return d}},m._clickEatingAppBarClass="win-appbarclickeater",m._clickEatingFlyoutClass="win-flyoutmenuclickeater",m._scrollTimeout=150,m.beforeShow=i,m.beforeHide=k,m.afterShow=j,m.afterHide=l,m.commonstrings={get cannotChangeCommandsWhenVisible(){return WinJS.Resources._getWinJSString("ui/cannotChangeCommandsWhenVisible").value},get cannotChangeHiddenProperty(){return WinJS.Resources._getWinJSString("ui/cannotChangeHiddenProperty").value}};var n={get duplicateConstruction(){return WinJS.Resources._getWinJSString("ui/duplicateConstruction").value},get mustContainCommands(){return WinJS.Resources._getWinJSString("ui/mustContainCommands").value},get closeOverlay(){return WinJS.Resources._getWinJSString("ui/closeOverlay").value}};return WinJS.Class.mix(m,WinJS.UI.DOMEventMixin),m})})}),b("WinJS/Controls/Flyout",["./Flyout/_Overlay","require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{Flyout:WinJS.Namespace._lazy(function(){function a(a,b){return parseFloat(a,window.getComputedStyle(a,null)[b])}var b=WinJS.UI,c=WinJS.Utilities.Key,d="win-flyout",e="win-ui-light",f="win-menu",g="win-scrolls",h="win-finaldiv",i="win-firstdiv",j={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return WinJS.Resources._getWinJSString("ui/noAnchor").value},get badPlacement(){return WinJS.Resources._getWinJSString("ui/badPlacement").value},get badAlignment(){return WinJS.Resources._getWinJSString("ui/badAlignment").value}},k=WinJS.Class.derive(WinJS.UI._Overlay,function(a,b){b=b||{},this._element=a||document.createElement("div"),this._id=this._element.id||WinJS.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,b);var c=this._element.getElementsByTagName("*"),d=this._addFirstDiv();d.tabIndex=WinJS.Utilities._getLowestTabIndexInList(c);var e=this._addFinalDiv();return e.tabIndex=WinJS.Utilities._getHighestTabIndexInList(c),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(a,c){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(a,c),b._Overlay._createClickEatingDivFlyout(),this._element.style.visibilty="hidden",this._element.style.display="none",WinJS.Utilities.addClass(this._element,d),WinJS.Utilities.addClass(this._element,e);var g=this._element.getAttribute("role");(null===g||""===g||void 0===g)&&(WinJS.Utilities.hasClass(this._element,f)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var h=this._element.getAttribute("aria-label");(null===h||""===h||void 0===h)&&this._element.setAttribute("aria-label",j.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,this._addOverlayEventHandlers(!0)},anchor:{get:function(){return this._anchor},set:function(a){this._anchor=a}},placement:{get:function(){return this._placement},set:function(a){if("top"!==a&&"bottom"!==a&&"left"!==a&&"right"!==a&&"auto"!==a)throw new WinJS.ErrorFromName("WinJS.UI.Flyout.BadPlacement",j.badPlacement);this._placement=a}},alignment:{get:function(){return this._alignment},set:function(a){if("right"!==a&&"left"!==a&&"center"!==a)throw new WinJS.ErrorFromName("WinJS.UI.Flyout.BadAlignment",j.badAlignment);this._alignment=a}},_dispose:function(){WinJS.Utilities.disposeSubTree(this.element),this._hide(),this.anchor=null},show:function(a,b,c){this._writeProfilerMark("show,StartTM"),this._show(a,b,c)},_show:function(a,b,c){this._baseFlyoutShow(a,b,c)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._keyboardInvoked=!1,this._hide()},_hide:function(){if(this._baseHide()){var a=document.activeElement;if(this._previousFocus&&a&&(this._element.contains(a)||WinJS.Utilities.hasClass(a,b._Overlay._clickEatingFlyoutClass))&&void 0!==this._previousFocus.focus){var c=b.AppBar._isAppBarOrChild(this._previousFocus);if(!c||c.winControl&&!c.winControl.hidden&&!c.winAnimating){var d=this._previousFocus.getAttribute("role"),e=b._Overlay._keyboardInfo._visible&&!this._keyboardWasUp;if(e&&this._previousFocus.setAttribute("role",""),this._keyboardInvoked?this._previousFocus.focus():b._Overlay._trySetActive(this._previousFocus),a=document.activeElement,e){var f=this._previousFocus;f&&WinJS.Utilities._yieldForDomModification(function(){f.setAttribute("role",d)})}}!this._keyboardInvoked&&this._previousFocus===a&&c&&a&&b._Overlay._addHideFocusClass(a)}this._previousFocus=null,this._isThereVisibleFlyout()||b._Overlay._hideClickEatingDivFlyout()}},_baseFlyoutShow:function(a,c,d){if(!this.disabled){if(a||(a=this._anchor),c||(c=this._placement),d||(d=this._alignment),"string"==typeof a?a=document.getElementById(a):a&&a.element&&(a=a.element),a)this._currentAnchor=a,this._currentPlacement=c,this._currentAlignment=d;else{if(!this._retryLast)throw new WinJS.ErrorFromName("WinJS.UI.Flyout.NoAnchor",j.noAnchor);this._retryLast=null}if(this._sticky||b._Overlay._showClickEatingDivFlyout(),this._element.winAnimating)return this._doNext="show",void(this._retryLast=!0);if(this._baseShow()){if(!WinJS.Utilities.hasClass(this.element,"win-menu")){var e=this._element.getElementsByTagName("*"),f=this.element.querySelectorAll(".win-first");this.element.children.length&&!WinJS.Utilities.hasClass(this.element.children[0],i)&&(f&&f.length>0&&f.item(0).parentNode.removeChild(f.item(0)),f=this._addFirstDiv()),f.tabIndex=WinJS.Utilities._getLowestTabIndexInList(e);var g=this.element.querySelectorAll(".win-final");WinJS.Utilities.hasClass(this.element.children[this.element.children.length-1],h)||(g&&g.length>0&&g.item(0).parentNode.removeChild(g.item(0)),g=this._addFinalDiv()),g.tabIndex=WinJS.Utilities._getHighestTabIndexInList(e)}this._hideAllOtherFlyouts(this),this._previousFocus=document.activeElement}}},_endShow:function(){this._keyboardWasUp=b._Overlay._keyboardInfo._visible,WinJS.Utilities.hasClass(this.element,"win-menu")?b._Overlay._trySetActive(this._element):(this._focusOnFirstFocusableElementOrThis(),b._Overlay._addHideFocusClass(document.activeElement))},_findPosition:function(){this._nextHeight=null,this._keyboardMovedUs=!1,this._hasScrolls=!1,this._keyboardSquishedUs=0,this._checkToggle&&this._checkToggle(),this._updateAdjustments(this._currentAlignment),this._getTopLeft(),this._scrollTop=this._nextTop,this._nextTop<0?(this._element.style.bottom="0px",this._element.style.top="auto"):(this._element.style.top=this._nextTop+"px",this._element.style.bottom="auto"),this._nextLeft<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._nextLeft+"px",this._element.style.right="auto"),null!==this._nextHeight&&(WinJS.Utilities.addClass(this._element,g),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._nextHeight+"px",this._nextBottom=this._nextTop+this._nextHeight,this._hasScrolls=!0),b._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_getTopLeft:function(){var c=this._currentAnchor.getBoundingClientRect(),d={},e={};switch(e.top=c.top,e.bottom=c.bottom,e.left=c.left,e.right=c.right,e.height=e.bottom-e.top,e.width=e.right-e.left,d.marginTop=a(this._element,"marginTop"),d.marginBottom=a(this._element,"marginBottom"),d.marginLeft=a(this._element,"marginLeft"),d.marginRight=a(this._element,"marginRight"),d.width=WinJS.Utilities.getTotalWidth(this._element),d.height=WinJS.Utilities.getTotalHeight(this._element),d.innerWidth=WinJS.Utilities.getContentWidth(this._element),d.innerHeight=WinJS.Utilities.getContentHeight(this._element),this._nextMarginPadding=d.height-d.innerHeight,this._currentPlacement){case"top":this._fitTop(e,d)||(this._nextTop=0,this._nextHeight=e.top-this._nextMarginPadding),this._centerHorizontally(e,d,this._currentAlignment);break;case"bottom":this._fitBottom(e,d)||(this._nextTop=-1,this._nextHeight=b._Overlay._keyboardInfo._visibleDocHeight-e.bottom-this._nextMarginPadding),this._centerHorizontally(e,d,this._currentAlignment);break;case"left":this._fitLeft(e,d)||(this._nextLeft=0),this._centerVertically(e,d);
break;case"right":this._fitRight(e,d)||(this._nextLeft=-1),this._centerVertically(e,d);break;case"auto":this._sometimesFitsAbove(e,d)?(this._fitTop(e,d)||this._fitBottom(e,d),this._centerHorizontally(e,d,this._currentAlignment)):this._fitLeft(e,d)||this._fitRight(e,d)?this._centerVertically(e,d):(this._topHasMoreRoom(e)?(this._nextTop=0,this._nextHeight=e.top-this._nextMarginPadding):(this._nextTop=-1,this._nextHeight=b._Overlay._keyboardInfo._visibleDocHeight-e.bottom-this._nextMarginPadding),this._centerHorizontally(e,d,this._currentAlignment));break;default:throw new WinJS.ErrorFromName("WinJS.UI.Flyout.BadPlacement",j.badPlacement)}this._nextBottom=this._nextTop+d.height},_sometimesFitsAbove:function(a,c){return(b._Overlay._keyboardInfo._visibleDocHeight-a.height)/2>=c.height},_topHasMoreRoom:function(a){return a.top>b._Overlay._keyboardInfo._visibleDocHeight-a.bottom},_fitTop:function(a,c){return this._nextTop=a.top-c.height,this._nextAnimOffset={top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},this._nextTop>=0&&this._nextTop+c.height<=b._Overlay._keyboardInfo._visibleDocBottom},_fitBottom:function(a,c){return this._nextTop=a.bottom,this._nextAnimOffset={top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},this._nextTop>=0&&this._nextTop+c.height<=b._Overlay._keyboardInfo._visibleDocBottom},_fitLeft:function(a,c){return this._nextLeft=a.left-c.width,this._nextAnimOffset={top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},this._nextLeft>=0&&this._nextLeft+c.width<=b._Overlay._keyboardInfo._visualViewportWidth},_fitRight:function(a,c){return this._nextLeft=a.right,this._nextAnimOffset={top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"},this._nextLeft>=0&&this._nextLeft+c.width<=b._Overlay._keyboardInfo._visualViewportWidth},_centerVertically:function(a,c){this._nextTop=a.top+a.height/2-c.height/2,this._nextTop<0?this._nextTop=0:this._nextTop+c.height>=b._Overlay._keyboardInfo._visibleDocBottom&&(this._nextTop=-1)},_centerHorizontally:function(a,b,c){if("center"===c)this._nextLeft=a.left+a.width/2-b.width/2;else if("left"===c)this._nextLeft=a.left;else{if("right"!==c)throw new WinJS.ErrorFromName("WinJS.UI.Flyout.BadAlignment",j.badAlignment);this._nextLeft=a.right-b.width}this._nextLeft<0?this._nextLeft=0:this._nextLeft+b.width>=document.documentElement.clientWidth&&(this._nextLeft=-1)},_updateAdjustments:function(a){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",WinJS.Utilities.removeClass(this._element,g),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),"center"===a?(WinJS.Utilities.removeClass(this._element,"win-leftalign"),WinJS.Utilities.removeClass(this._element,"win-rightalign")):"left"===a?(WinJS.Utilities.addClass(this._element,"win-leftalign"),WinJS.Utilities.removeClass(this._element,"win-rightalign")):"right"===a&&(WinJS.Utilities.addClass(this._element,"win-rightalign"),WinJS.Utilities.removeClass(this._element,"win-leftalign"))},_showingKeyboard:function(a){if(!this.hidden&&(a.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var c=this;setTimeout(function(){c._adjustForKeyboard(),c._baseAnimateIn()},b._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._keyboardHiding){var a=this;WinJS.Utilities._setImmediate(function(){a._findPosition()}),this._keyboardHiding=!1}},_checkKeyboardFit:function(){var a=WinJS.Utilities.getTotalHeight(this._element),c=b._Overlay._keyboardInfo._visibleDocHeight-this._nextMarginPadding;a>c?(this._keyboardMovedUs=!0,this._scrollTop=0,this._keyboardSquishedUs=c):-1===this._nextTop?this._keyboardMovedUs=!0:this._nextTop<0?(this._scrollTop=0,this._keyboardMovedUs=!0):this._nextBottom>b._Overlay._keyboardInfo._visibleDocBottom&&(this._scrollTop=-1,this._keyboardMovedUs=!0)},_adjustForKeyboard:function(){this._keyboardSquishedUs&&(this._hasScrolls||(WinJS.Utilities.addClass(this._element,g),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._keyboardSquishedUs+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(b._Overlay._keyboardInfo._isResized)this._keyboardHiding=!0;else{var a=this;WinJS.Utilities._setImmediate(function(){a._findPosition()})}},_checkScrollPosition:function(a){(!this.hidden||a)&&(this._scrollTop<0?(this._element.style.bottom=b._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top="0px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",WinJS.UI.Animation.showPopup(this._element,this._nextAnimOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,WinJS.UI.Animation.hidePopup(this._element,this._nextAnimOffset))},_hideAllOtherFlyouts:function(a){for(var b=document.querySelectorAll(".win-flyout"),c=0;c<b.length;c++){var d=b[c].winControl;d&&!d.hidden&&d!==a&&d.hide()}},_isThereVisibleFlyout:function(){for(var a=document.querySelectorAll(".win-flyout"),b=0;b<a.length;b++){var c=a[b].winControl;if(c&&!c.hidden)return!0}return!1},_handleKeyDown:function(a){a.keyCode===c.escape&&a.keyCode!==c.IME?(a.preventDefault(),a.stopPropagation(),this.winControl._keyboardInvoked=!0,this.winControl._hide()):a.keyCode!==c.space&&a.keyCode!==c.enter||this!==document.activeElement?!a.shiftKey||a.keyCode!==c.tab||this!==document.activeElement||a.altKey||a.ctrlKey||a.metaKey||(a.preventDefault(),a.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(a.preventDefault(),a.stopPropagation(),this.winControl.hide())},_addFirstDiv:function(){var a=document.createElement("div");a.className=i,a.style.display="inline",a.setAttribute("role","menuitem"),a.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(a,this._element.children[0]):this._element.appendChild(a);var b=this;return WinJS.Utilities._addEventListener(a,"focusin",function(){b._focusOnLastFocusableElementOrThis()},!1),a},_addFinalDiv:function(){var a=document.createElement("div");a.className=h,a.style.display="inline",a.setAttribute("role","menuitem"),a.setAttribute("aria-hidden","true"),this._element.appendChild(a);var b=this;return WinJS.Utilities._addEventListener(a,"focusin",function(){b._focusOnFirstFocusableElementOrThis()},!1),a},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.Flyout:"+this._id+":"+a)}});return k})})}),b("WinJS/Controls/AppBar/_Layouts",[],function(){"use strict";var a="win-primarygroup",b="win-secondarygroup",c="win-command",d="win-reduced",e="separator",f="content",g=60,h=100;WinJS.Namespace.define("WinJS.UI",{_AppBarBaseLayout:WinJS.Namespace._lazy(function(){var a="custom",b=WinJS.Class.define(function(a,b){this._disposed=!1,b=b||{},WinJS.UI.setOptions(this,b),a&&this.connect(a)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||a}},commandsInOrder:{get:function(){var a=this.appBarEl.querySelectorAll("."+c);return Array.prototype.slice.call(a)}},connect:function(a){this.className&&WinJS.Utilities.addClass(a,this.className),this.appBarEl=a},disconnect:function(){this.className&&WinJS.Utilities.removeClass(this.appBarEl,this.className),this.appBarEl=null,this.dispose()},layout:function(a){for(var b=a.length,c=0;b>c;c++){var d=this.sanitizeCommand(a[c]);this.appBarEl.appendChild(d._element)}},sanitizeCommand:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.NullCommand",strings.nullCommand);return a=a.winControl||a,a._element||(a=new WinJS.UI.AppBarCommand(null,a)),a._element.parentElement&&a._element.parentElement.removeChild(a._element),a},dispose:function(){this._disposed=!0},disposeChildren:function(){var a=this.appBarEl.querySelectorAll("."+firstDivClass);a=a.length>=1?a[0]:null;var b=this.appBarEl.querySelectorAll("."+finalDivClass);b=b.length>=1?b[0]:null;for(var c=this.appBarEl.children,d=c.length,e=0;d>e;e++){var f=c[e];f!==a&&f!==b&&WinJS.Utilities.disposeSubTree(f)}},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){}});return b})}),WinJS.Namespace.define("WinJS.UI",{_AppBarCommandsLayout:WinJS.Namespace._lazy(function(){var a="win-commandlayout",b="commands",d=WinJS.Class.derive(WinJS.UI._AppBarBaseLayout,function(c){WinJS.UI._AppBarBaseLayout.call(this,c,{_className:a,_type:b}),this._commandLayoutsInit(c)},{_getWidthOfCommands:function(a){if(this._needToMeasureNewCommands&&this._measureContentCommands(),!a)return this._widthOfLastKnownVisibleCommands;for(var b,c=0,d=0,i=0,j=0,k=a.length;k>j;j++)b=a[j].winControl||a[j],b._type===e?c++:b._type!==f?d++:i+=b._fullSizeWidth;return i+=c*g+d*h},_getFocusableCommandsInLogicalOrder:function(){var a=this._secondaryCommands.children,b=this._primaryCommands.children,d=-1,e=function(a){for(var b=[],e=0,f=a.length;f>e;e++){var g=a[e];if(WinJS.Utilities.hasClass(g,c)&&g.winControl){var h=g.contains(document.activeElement);(g.winControl._isFocusable()||h)&&(b.push(g),h&&(d=b.length-1))}}return b},f=Array.prototype.slice.call(a).concat(Array.prototype.slice.call(b)),g=e(f);return g.focusedIndex=d,g}});return WinJS.Class.mix(d,i),d})});var i={layout:function(a){WinJS.Utilities.empty(this._primaryCommands),WinJS.Utilities.empty(this._secondaryCommands),this._commandsInOriginalOrder=[];for(var b=0,c=a.length;c>b;b++){var d=this.sanitizeCommand(a[b]);this._commandsInOriginalOrder.push(d.element),"global"===d.section?this._primaryCommands.appendChild(d._element):this._secondaryCommands.appendChild(d._element)}this.appBarEl.appendChild(this._secondaryCommands),this.appBarEl.appendChild(this._primaryCommands),this._needToMeasureNewCommands=!0,WinJS.Utilities.Scheduler.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),WinJS.Utilities.Scheduler.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},commandsInOrder:{get:function(){return this._commandsInOriginalOrder.filter(function(a){return this.appBarEl.contains(a)},this)}},disposeChildren:function(){WinJS.Utilities.disposeSubTree(this._primaryCommands),WinJS.Utilities.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(a){var b=WinJS.Utilities.Key;if(!WinJS.Utilities._matchesSelector(a.target,".win-interactive, .win-interactive *")){var c="rtl"===getComputedStyle(this.appBarEl).direction,d=c?b.rightArrow:b.leftArrow,e=c?b.leftArrow:b.rightArrow;if(a.keyCode===d||a.keyCode==e||a.keyCode===b.home||a.keyCode===b.end){var f,g=this._primaryCommands.contains(document.activeElement),h=this._getFocusableCommandsInLogicalOrder(g);if(h.length)switch(a.keyCode){case d:var i=Math.max(-1,h.focusedIndex-1)+h.length;f=h[i%h.length].winControl.lastElementFocus;break;case e:var i=h.focusedIndex+1+h.length;f=h[i%h.length].winControl.firstElementFocus;break;case b.home:var i=0;f=h[i].winControl.firstElementFocus;break;case b.end:var i=h.length-1;f=h[i].winControl.lastElementFocus}f&&(f.focus(),a.preventDefault())}}},commandsUpdated:function(a){var b=a?a:this.commandsInOrder.filter(function(a){return!a.winControl.hidden});this._widthOfLastKnownVisibleCommands=this._getWidthOfCommands(b)},beginAnimateCommands:function(a,b,c){this._scaleAfterAnimations=!1;var d=this._getWidthOfCommands(a)-this._getWidthOfCommands(b);if(d>0){var e=c.concat(a);this.commandsUpdated(e),this.scale()}else 0>d&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},scale:function(){var a=this._getWidthOfCommands();this._appBarTotalKnownWidth!==+this._appBarTotalKnownWidth&&(this._appBarTotalKnownWidth=this._scaleHelper()),a<=this._appBarTotalKnownWidth?WinJS.Utilities.removeClass(this.appBarEl,d):WinJS.Utilities.addClass(this.appBarEl,d)},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.hidden||this.scale())},_commandLayoutsInit:function(){this._primaryCommands=document.createElement("DIV"),this._secondaryCommands=document.createElement("DIV"),WinJS.Utilities.addClass(this._primaryCommands,a),WinJS.Utilities.addClass(this._secondaryCommands,b)},_scaleHelper:function(){return document.documentElement.clientWidth},_measureContentCommands:function(){if(document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;var a=WinJS.Utilities.hasClass(this.appBarEl,d);WinJS.Utilities.removeClass(this.appBarEl,d);var b,e=this.appBarEl.style.display;this.appBarEl.style.display="";for(var g,h=this.appBarEl.querySelectorAll("div."+c),i=0,j=h.length;j>i;i++)g=h[i],g.winControl&&g.winControl._type===f&&(b=g.style.display,g.style.display="",g.winControl._fullSizeWidth=WinJS.Utilities.getTotalWidth(g)||0,g.style.display=b);this.appBarEl.style.display=e,a&&WinJS.Utilities.addClass(this.appBarEl,d),this.commandsUpdated()}}}}),b("WinJS/Controls/AppBar/_Command",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{AppBarCommand:WinJS.Namespace._lazy(function(){function a(a){var c=this.winControl;if(c){if(c._type===i)c.selected=!c.selected;else if(c._type===j&&c._flyout){var d=b._Overlay._getParentControlUsingClassName(this,"win-appbar"),e="top";d&&"top"===d.placement&&(e="bottom");var f=c._flyout;"string"==typeof f&&(f=document.getElementById(f)),f.show||(f=f.winControl),f&&f.show&&f.show(this,e)}c.onclick&&c.onclick(a)}}var b=WinJS.UI,c="win-command",d="win-global",e="win-selection",f="win-reduced",g="separator",h="button",i="toggle",j="flyout",k="content",l="selection",m="global",n={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return WinJS.Resources._getWinJSString("ui/duplicateConstruction").value},get badClick(){return WinJS.Resources._getWinJSString("ui/badClick").value},get badDivElement(){return WinJS.Resources._getWinJSString("ui/badDivElement").value},get badHrElement(){return WinJS.Resources._getWinJSString("ui/badHrElement").value},get badButtonElement(){return WinJS.Resources._getWinJSString("ui/badButtonElement").value}};return WinJS.Class.define(function(d,e){if(d&&d.winControl)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.DuplicateConstruction",n.duplicateConstruction);if(this._disposed=!1,e||(e={}),e.type||(this._type=h),e.section=e.section||m,this._element=d,e.type===k?this._createContent():e.type===g?this._createSeparator():this._createButton(),WinJS.Utilities.addClass(this._element,"win-disposable"),this._element.winControl=this,WinJS.Utilities.addClass(this._element,c),e.onclick&&(this.onclick=e.onclick),e.onclick=a,WinJS.UI.setOptions(this,e),this._type!==i||e.selected||(this.selected=!1),this._type!==g){var f=this;WinJS.Utilities._addEventListener(this._element,"pointerdown",function(){b._Overlay._addHideFocusClass(f._element)},!1);var l=this._element.getAttribute("role");(null===l||""===l||void 0===l)&&(l=this._type===i?"menuitemcheckbox":this._type===k?"group":"menuitem",this._element.setAttribute("role",l),this._type===j&&this._element.setAttribute("aria-haspopup",!0));var o=this._element.getAttribute("aria-label");(null===o||""===o||void 0===o)&&this._element.setAttribute("aria-label",n.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(a){a&&!this._element.id&&(this._element.id=a)}},type:{get:function(){return this._type},set:function(a){this._type||(this._type=a!==k&&a!==j&&a!==i&&a!==g?h:a)}},label:{get:function(){return this._label},set:function(a){this._label=a,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(a){this._icon=WinJS.UI.AppBarIcon[a]||a,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none"))}},onclick:{get:function(){return this._onclick},set:function(a){if(a&&"function"!=typeof a)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.BadClick",WinJS.Resources._formatString(n.badClick,"AppBarCommand"));this._onclick=a}},flyout:{get:function(){var a=this._flyout;return"string"==typeof a&&(a=document.getElementById(a)),a&&!a.element&&(a=a.winControl),a},set:function(a){var b=a;b&&"string"!=typeof b&&(b.element&&(b=b.element),b&&(b.id?b=b.id:(b.id=WinJS.Utilities._uniqueID(b),b=b.id))),"string"==typeof b&&this._element.setAttribute("aria-owns",b),this._flyout=a}},section:{get:function(){return this._section},set:function(a){(!this._section||window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(a)}},tooltip:{get:function(){return this._tooltip},set:function(a){this._tooltip=a,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(a){this._element.setAttribute("aria-checked",a)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){this._element.disabled=a}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(a){var c=b._Overlay._getParentControlUsingClassName(this._element,"win-appbar");if(c&&!c.hidden)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.CannotChangeHiddenProperty",WinJS.Resources._formatString(b._Overlay.commonstrings.cannotChangeHiddenProperty,"AppBar"));if(a!==this.hidden){var d=this._element.style;a?(d.visibility="hidden",d.display="none"):(d.visibility="",d.display="inline-block"),c&&c._commandsUpdated()}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(a){this._firstElementFocus=a===this.element?null:a,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(a){this._lastElementFocus=a===this.element?null:a,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===k&&WinJS.Utilities.disposeSubTree(this.element))},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},extraClass:{get:function(){return this._extraClass},set:function(a){this._extraClass&&WinJS.Utilities.removeClass(this._element,this._extraClass),this._extraClass=a,WinJS.Utilities.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.BadDivElement",n.badDivElement)}else this._element=document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.BadHrElement",n.badHrElement)}else this._element=document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new WinJS.ErrorFromName("WinJS.UI.AppBarCommand.BadButtonElement",n.badButtonElement);var a=this._element.getAttribute("type");(null===a||""===a||void 0===a)&&this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=document.createElement("button");this._element.type="button",this._iconSpan=document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon win-commandring",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new WinJS.UI.Tooltip(this._element);var c=this;this._tooltipControl.addEventListener("beforeopen",function(){c._hideIfFullSize&&!b._Overlay._getParentControlUsingClassName(c._element.parentElement,f)&&c._tooltipControl.close()},!1)},_setSection:function(a){a||(a=m),this._section&&(this._section===m?WinJS.Utilities.removeClass(this._element,d):this.section===l&&WinJS.Utilities.removeClass(this._element,e)),this._section=a,a===m?WinJS.Utilities.addClass(this._element,d):a===l&&WinJS.Utilities.addClass(this._element,e)},_updateTabStop:function(){this.element.tabIndex=this._firstElementFocus||this._lastElementFocus?-1:0},_isFocusable:function(){return!this.hidden&&this._type!==g&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)}})})})}),b("WinJS/Controls/AppBar/_Icon",["../../Core/_Base","../../Core/_Resources"],function(a,b){"use strict";var c=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview"],d=c.reduce(function(a,c){return a[c]={get:function(){return b._getWinJSString("ui/appBarIcons/"+c).value}},a},{});return a.Namespace.define("WinJS.UI.AppBarIcon",d),a.Namespace.defineWithParent(null,null,d)}),b("WinJS/Controls/AppBar",["./AppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{AppBar:WinJS.Namespace._lazy(function(){function a(a){if(!t._Overlay._rightMouseMightEdgy||a.kind!==Windows.UI.Input.EdgeGestureKind.mouse)if(G)G=null;else{var b=a.kind===Windows.UI.Input.EdgeGestureKind.keyboard;WinJS.UI.AppBar._toggleAppBarEdgy(b)}}function b(){G||(G=WinJS.UI.AppBar._toggleAppBarEdgy(!1))}function c(){var a=e();"showing"===G?f(a,!1):"hiding"===G&&g(a,!1),G=null}function d(a){var b=document.querySelectorAll("."+v);if(b)for(var c=b.length,d=0;c>d;d++){var e=b[d],f=e.winControl;f&&!e.disabled&&f._manipulationChanged(a)}}function e(){var a=document.querySelectorAll("."+v),b=a.length,c=[];c._visible=!1,c._hidden=!1;for(var d=0;b>d;d++){var e=a[d];if(!e.disabled){var f=e.winControl;f&&(c.push(f),f._element.winAnimating?"hiding"===f._element.winAnimating?c._hidden=!0:c._visible=!0:"hidden"===f._element.style.visibility?c._hidden=!0:c._visible=!0)}}return c}function f(a,b){for(var c=a.length,d=new Array(c),e=0;c>e;e++)a[e]._keyboardInvoked=b,a[e].hide(),d[e]=a[e]._animationPromise;return WinJS.Promise.join(d)}function g(a,b){for(var c=a.length,d=new Array(c),e=0;c>e;e++)a[e]._keyboardInvoked=b,a[e]._doNotFocus=!1,a[e]._show(),d[e]=a[e]._animationPromise;return WinJS.Promise.join(d)}function h(a,b,c){for(var d=a;d>=0;d--)if(c[d].winControl&&c[d].winControl.placement===b&&!c[d].winControl.hidden&&c[d].winControl._focusOnLastFocusableElement&&c[d].winControl._focusOnLastFocusableElement())return!0;return!1}function i(a,b){for(var c=a;c>=0;c--)if(b[c].winControl&&b[c].winControl.placement!=C&&b[c].winControl.placement!=B&&!b[c].winControl.hidden&&b[c].winControl._focusOnLastFocusableElement&&b[c].winControl._focusOnLastFocusableElement())return!0;return!1}function j(){var a=document.querySelectorAll("."+v);if(a.length){for(var b=0,c=0;c<a.length;c++)if(a[c]===this.parentElement){b=c;break}var d=this.parentElement.winControl;if(d.placement===C){if(b&&h(b-1,C,a))return;if(i(a.length-1,a))return;if(h(a.length-1,B,a))return;if(h(a.length-1,C,a))return}else if(d.placement===B){if(b&&h(b-1,B,a))return;if(h(a.length-1,C,a))return;if(i(a.length-1,a))return;if(h(a.length-1,B,a))return}else{if(b&&i(b-1,a))return;if(h(a.length-1,B,a))return;if(h(a.length-1,C,a))return;if(i(a.length-1,a))return}}}function k(a,b,c){for(var d=a;d<c.length;d++)if(c[d].winControl&&c[d].winControl.placement===b&&!c[d].winControl.hidden&&c[d].winControl._focusOnFirstFocusableElement&&c[d].winControl._focusOnFirstFocusableElement())return!0;return!1}function l(a,b){for(var c=a;c<b.length;c++)if(b[c].winControl&&b[c].winControl.placement!=C&&b[c].winControl.placement!=B&&!b[c].winControl.hidden&&b[c].winControl._focusOnFirstFocusableElement&&b[c].winControl._focusOnFirstFocusableElement())return!0;return!1}function m(){for(var a=document.querySelectorAll("."+v),b=0,c=0;c<a.length;c++)if(a[c]===this.parentElement){b=c;break}this.parentElement.winControl;if(this.parentElement.winControl.placement===C){if(k(b+1,C,a))return;if(k(0,B,a))return;if(l(0,a))return;if(k(0,C,a))return}else if(this.parentElement.winControl.placement===B){if(k(b+1,B,a))return;if(l(0,a))return;if(k(0,C,a))return;if(k(0,B,a))return}else{if(l(b+1,a))return;if(k(0,C,a))return;if(k(0,B,a))return;if(l(0,a))return}}function n(){for(var a=document.querySelectorAll("."+v),b=0;b<a.length;b++)a[b].winControl&&!a[b].winControl.hidden&&a[b].winControl._updateFirstAndFinalDiv&&a[b].winControl._updateFirstAndFinalDiv()}function o(){for(var a=document.querySelectorAll("."+v),b=0;b<a.length;b++){var c=a[b].winControl;if(c&&!c.sticky&&(!c.hidden||"showing"===c._element.winAnimating))return!0}return!1}function p(){t.AppBar._isAppBarOrChild(document.activeElement)||(t.AppBar._hideLightDismissAppBars(null,!1),t.AppBar._ElementWithFocusPreviousToAppBar=null)}function q(a){a.relatedTarget&&a.relatedTarget.focus&&!t.AppBar._isAppBarOrChild(a.relatedTarget)&&r(a.relatedTarget)}function r(a){a&&(t.AppBar._ElementWithFocusPreviousToAppBar=a)}function s(){t._Overlay._trySetActive(t.AppBar._ElementWithFocusPreviousToAppBar)}var t=WinJS.UI,u=WinJS.Utilities.Key,v="win-appbar",w="win-settingsflyout",x="win-top",y="win-bottom",z="win-firstdiv",A="win-finaldiv",B="top",C="bottom",D="custom",E="commands",F=!1,G=null,H={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return WinJS.Resources._getWinJSString("ui/requiresCommands").value},get nullCommand(){return WinJS.Resources._getWinJSString("ui/nullCommand").value},get cannotChangePlacementWhenVisible(){return WinJS.Resources._getWinJSString("ui/cannotChangePlacementWhenVisible").value},get badLayout(){return WinJS.Resources._getWinJSString("ui/badLayout").value},get cannotChangeLayoutWhenVisible(){return WinJS.Resources._getWinJSString("ui/cannotChangeLayoutWhenVisible").value}},I=WinJS.Class.derive(WinJS.UI._Overlay,function(e,f){this._initializing=!0,f=f||{},this._element=e||document.createElement("div"),this._id=this._element.id||WinJS.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),this.layout=f.layout||E,delete f.layout,this.layout!==D&&!f.commands&&this._element&&(f=WinJS.Utilities._shallowCopy(f),f.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.AppBarCommand")),this._baseOverlayConstructor(this._element,f),this._initializing=!1,t._Overlay._createClickEatingDivAppBar(),WinJS.Utilities.addClass(this._element,v),f.placement||(this.placement=C);var g=this._element.getAttribute("role");g||this._element.setAttribute("role","menubar");var h=this._element.getAttribute("aria-label");if(h||this._element.setAttribute("aria-label",H.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),!F){if(WinJS.Utilities.hasWinRT){var i=Windows.UI.Input.EdgeGesture.getForCurrentView();i.addEventListener("starting",b),i.addEventListener("completed",a),i.addEventListener("canceled",c)}document.addEventListener("MSManipulationStateChanged",d,!1),F=!0}return this._addOverlayEventHandlers(!1),WinJS.Utilities._addEventListener(this._element,"focusin",function(a){q(a)},!1),WinJS.Utilities._addEventListener(this._element,"focusout",function(){p()},!1),this.layout===E&&(this._element.style.display="none"),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(a){var b=!1;if(window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled&&!this.hidden&&(this._hide(),b=!0),!this.hidden)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.CannotChangePlacementWhenVisible",H.cannotChangePlacementWhenVisible);this._placement=a,this._placement===B?(WinJS.Utilities.addClass(this._element,x),WinJS.Utilities.removeClass(this._element,y)):this._placement===C?(WinJS.Utilities.removeClass(this._element,x),WinJS.Utilities.addClass(this._element,y)):(WinJS.Utilities.removeClass(this._element,x),WinJS.Utilities.removeClass(this._element,y)),this._assignAnimations(),b&&this._show()}},layout:{get:function(){return this._layout.type},set:function(a){if(a!==E&&a!==D)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.BadLayout",H.badLayout);var b=!1;if(window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled&&!this.hidden&&(this._hide(),b=!0),!this.hidden&&!this._initializing)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.CannotChangeLayoutWhenVisible",H.cannotChangeLayoutWhenVisible);var c;this._initializing||(c=this._layout.commandsInOrder,this._layout.disconnect()),this._layout=a===E?new WinJS.UI._AppBarCommandsLayout:new WinJS.UI._AppBarBaseLayout,this._layout.connect(this._element),c&&c.length&&this._layoutCommands(c),b&&this._show()
},configurable:!0},sticky:{get:function(){return this._sticky},set:function(a){this._sticky!==!!a&&(this._sticky=!!a,this.hidden||"visible"!==this._element.style.visibility||(n(),this._sticky?o()||t._Overlay._hideClickEatingDivAppBar():(t._Overlay._showClickEatingDivAppBar(),this._shouldStealFocus()&&(r(document.activeElement),this._setFocusToAppBar()))))}},commands:{set:function(a){if(!this.hidden)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.CannotChangeCommandsWhenVisible",WinJS.Resources._formatString(t._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"AppBar"));this._initializing||this._disposeChildren(),this._layoutCommands(a)}},_layoutCommands:function(a){WinJS.Utilities.empty(this._element),Array.isArray(a)||(a=[a]),this._layout.layout(a)},getCommandById:function(a){for(var b=this.element.querySelectorAll("#"+a),c=[],d=0,e=b.length;e>d;d++)b[d].winControl&&c.push(b[d].winControl);return 1===c.length?c[0]:0===c.length?null:c},showCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",H.requiresCommands);this._showCommands(a)},hideCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",H.requiresCommands);this._hideCommands(a)},showOnlyCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",H.requiresCommands);this._showOnlyCommands(a)},show:function(){this._writeProfilerMark("show,StartTM"),this._keyboardInvoked=!1,this._doNotFocus=!!this.sticky,this._show()},_show:function(){if(!this.disabled){if(this._layout.scale(),this._keyboardObscured&&(this._fakeHide=!0,this._keyboardObscured=!1),this.sticky||t._Overlay._showClickEatingDivAppBar(),this._element.winAnimating)return this._doNext="show",!1;this._baseShow(),!this.sticky&&o()?n():this._updateFirstAndFinalDiv(),!this._doNotFocus&&this._shouldStealFocus()&&(t.AppBar._ElementWithFocusPreviousToAppBar||r(document.activeElement),this._setFocusToAppBar())}},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._keyboardObscured&&!this._animating?(this._keyboardObscured=!1,this._baseEndHide()):this._baseHide();var a,b=document.querySelectorAll("."+v),c=!1,d=!1;for(a=0;a<b.length;a++){var e=b[a].winControl;if(e&&!e.hidden&&e!==this&&(c=!0,!e.sticky)){d=!0;break}}var f=document.querySelectorAll("."+w),g=!1;for(a=0;a<f.length;a++){var h=f[a].winControl;if(h&&!h.hidden){g=!0;break}}d||g||t._Overlay._hideClickEatingDivAppBar();var i=this;if(c){if(t.AppBar._isWithinAppBarOrChild(document.activeElement,i.element)){var j=!1;for(a=0;a<=b.length;a++){a===b.length&&(a=0);var k=b[a];if(k===this.element)j=!0;else if(j&&!k.winControl.hidden){k.winControl._keyboardInvoked=!!this._keyboardInvoked,k.winControl._setFocusToAppBar();break}}}}else!t.AppBar._ElementWithFocusPreviousToAppBar||document.activeElement&&!t.AppBar._isAppBarOrChild(document.activeElement)||s(),t.AppBar._ElementWithFocusPreviousToAppBar=null;this.sticky||o()||n(),this._keyboardInvoked=!1,this._doNotFocus=!1},_dispose:function(){WinJS.Utilities.disposeSubTree(this.element),this._layout.dispose(),this._hide()},_disposeChildren:function(){this._layout.disposeChildren()},_handleKeyDown:function(a){a.keyCode===u.escape&&a.keyCode!==u.IME&&(a.preventDefault(),a.stopPropagation(),t._Overlay._hideAllFlyouts(),t.AppBar._hideLightDismissAppBars(null,!0)),this._layout.handleKeyDown(a)},_assignAnimations:function(){this._placement===B||this._placement===C?(this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut):(this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut)},_animateSlideIn:function(){var a,b=this._element.offsetHeight;return this._checkPosition(),this._placement===B?(a={top:"-"+b+"px",left:"0px"},this._element.style.bottom="auto"):(a={top:b+"px",left:"0px"},this._element.style.top="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",WinJS.UI.Animation.showEdgeUI(this._element,a,{mechanism:"transition"})},_animateSlideOut:function(){var a,b=this._element.offsetHeight;return this._placement===B?(a={top:"-"+b+"px",left:"0px"},this._element.style.top=this._getTopOfVisualViewport()+"px"):(a={top:b+"px",left:"0px"},this._element.style.bottom=this._getAdjustedBottom()+"px"),WinJS.UI.Animation.hideEdgeUI(this._element,a,{mechanism:"transition"})},_isABottomAppBarInTheProcessOfShowing:function(){for(var a=document.querySelectorAll("."+v+"."+y),b=0;b<a.length;b++)if("showing"===a[b].winAnimating)return!0;return!1},_shouldStealFocus:function(){var a=t.AppBar._isAppBarOrChild(document.activeElement);if(this._element===a)return!1;if(this._placement===C)return!0;var b=this._isABottomAppBarInTheProcessOfShowing();return a?a.winControl&&(a.winControl._placement===C||a.winControl._placement===B||b)?!1:!0:!b},_setFocusToAppBar:function(){this._focusOnFirstFocusableElement()?this._keyboardInvoked||t._Overlay._addHideFocusClass(document.activeElement):t._Overlay._trySetActive(this._element)},_commandsUpdated:function(){this._layout.commandsUpdated(),this._layout.scale()},_beginAnimateCommands:function(a,b,c){this._layout.beginAnimateCommands(a,b,c)},_endAnimateCommands:function(){this._layout.endAnimateCommands()},_getTopOfVisualViewport:function(){return 0},_getAdjustedBottom:function(){return t._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(a){if(this._keyboardObscured=!1,this._keyboardHiding=!1,!t._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._keyboardShowing=!0,!this.hidden&&this._element.contains(document.activeElement)&&(a.ensuredFocusedElementInView=!0),!this.hidden&&this._placement!==B&&t._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var b=this;setTimeout(function(a){b._checkKeyboardTimer(a)},t._Overlay._keyboardInfo._animationShowLength+t._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._keyboardShowing=!1,this._keyboardHiding=!0,t._Overlay._keyboardInfo._isResized||((!this.hidden||this._fakeHide||this._animating)&&(this._checkScrollPosition(),this._element.style.display="",this._fakeHide=!1),this._keyboardHiding=!1)},_resize:function(a){this._keyboardShowing?this.hidden||this._placement===B||this._keyboardObscured||(this._element.style.display="none"):this._keyboardHiding&&(this._keyboardHiding=!1,(!this.hidden||this._animating)&&(this._checkScrollPosition(),this._element.style.display="",this._fakeHide=!1)),this._layout.resize(a)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(a){0===a.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){this._keyboardShowing&&(this._keyboardShowing=!1,this._keyboardObscured||this.hidden&&!this._fakeHide||this._placement===B&&0===t._Overlay._keyboardInfo._visibleDocTop?this._checkDoNext():(this._doNotFocus=!0,this._fakeHide=!0,this._show())),this._scrollHappened=!1},_checkPosition:function(){this._placement===C?this._element.style.bottom=this._getAdjustedBottom()+"px":this._placement===B&&(this._element.style.top=this._getTopOfVisualViewport()+"px")},_checkScrollPosition:function(){return this._keyboardShowing?void(this._scrollHappened=!0):void((!this.hidden||this._animating)&&(this._checkPosition(),this._checkDoNext()))},_alreadyInPlace:function(){if(this._placement===C){if(parseInt(this._element.style.bottom)===this._getAdjustedBottom())return!0}else if(this._placement===B&&parseInt(this._element.style.top)===this._getTopOfVisualViewport())return!0;return!1},_updateFirstAndFinalDiv:function(){var a=this._element.querySelectorAll("."+z);a=a.length>=1?a[0]:null;var b=this._element.querySelectorAll("."+A);if(b=b.length>=1?b[0]:null,a&&this._element.children[0]!=a&&(a.parentNode.removeChild(a),a=null),b&&this._element.children[this._element.children.length-1]!=b&&(b.parentNode.removeChild(b),b=null),a||(a=document.createElement("div"),a.style.display="inline",a.className=z,a.tabIndex=-1,a.setAttribute("aria-hidden","true"),WinJS.Utilities._addEventListener(a,"focusin",j,!1),this._element.children[0]?this._element.insertBefore(a,this._element.children[0]):this._element.appendChild(a)),b||(b=document.createElement("div"),b.style.display="inline",b.className=A,b.tabIndex=-1,b.setAttribute("aria-hidden","true"),WinJS.Utilities._addEventListener(b,"focusin",m,!1),this._element.appendChild(b)),o()){var c=this._element.getElementsByTagName("*");a&&(a.tabIndex=WinJS.Utilities._getLowestTabIndexInList(c)),b&&(b.tabIndex=WinJS.Utilities._getHighestTabIndexInList(c))}else a&&(a.tabIndex=-1),b&&(b.tabIndex=-1)},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.AppBar:"+this._id+":"+a)}});I._ElementWithFocusPreviousToAppBar=null,I._isAppBarOrChild=function(a){if(!a)return null;if(WinJS.Utilities.hasClass(a,t._Overlay._clickEatingAppBarClass)||WinJS.Utilities.hasClass(a,t._Overlay._clickEatingFlyoutClass)||WinJS.Utilities.hasClass(a,z)||WinJS.Utilities.hasClass(a,A))return a;for(;a&&a!==document;){if(WinJS.Utilities.hasClass(a,v))return a;if(WinJS.Utilities.hasClass(a,"win-flyout")&&a!=a.winControl._previousFocus){var b=a.winControl,c=t.AppBar._isAppBarOrChild(b._previousFocus);return c&&WinJS.Utilities._addEventListener(b.element,"focusout",function d(){p(),WinJS.Utilities._removeEventListener(b.element,"focusout",d,!1)},!1),c}a=a.parentNode}return null},I._isWithinAppBarOrChild=function(a,b){if(!a||!b)return!1;if(b.contains(a))return!0;var c=t._Overlay._getParentControlUsingClassName(a,"win-flyout");return c&&b.contains(c._previousFocus)},I._hideLightDismissAppBars=function(a,b){for(var c=document.querySelectorAll("."+v),d=c.length,e=[],g=0;d>g;g++){var h=c[g].winControl;!h||h.sticky||h.hidden||e.push(h)}f(e,b)};var J=WinJS.Promise.as();return I._toggleAppBarEdgy=function(a){var b=e();return b._visible&&!b._hidden?(J=J.then(function(){return f(b,a)}),"hiding"):(J=J.then(function(){return g(b,a)}),"showing")},I})})}),b("WinJS/Controls/Menu/_Command",[],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{MenuCommand:WinJS.Namespace._lazy(function(){function a(a){var b=this.winControl;if(b){var c=!0;if(b._type===j)b.selected=!b.selected;else if(b._type===k&&b._flyout){var d=b._flyout;"string"==typeof d&&(d=document.getElementById(d)),d.show||(d=d.winControl),d&&d.show&&(b._parentFlyout?(c=!1,d.show(b._parentFlyout._currentAnchor,b._parentFlyout._currentPlacement,b._parentFlyout._currentAlignment)):d.show(this))}b.onclick&&b.onclick(a),c&&b._parentFlyout&&b._parentFlyout.hide()}}function b(){this&&this.focus&&(this.focus(),this.addEventListener("mousemove",c,!1))}function c(){this&&this.focus&&this!==document.activeElement&&this.focus()}function d(){var a=this,b=e(a);b&&this===document.activeElement&&WinJS.Utilities.hasClass(b,"win-menu")&&b.focus?b.focus():b&&this===document.activeElement&&b.children&&b.children.length>0&&b.children[0]&&WinJS.Utilities.hasClass(b.children[0],"win-firstdiv")&&b.children[0].focus&&b.children[0].focus(),this.removeEventListener("mousemove",c,!1)}function e(a){for(;a&&!WinJS.Utilities.hasClass(a,"win-flyout");)a=a.parentElement;return a}var f=WinJS.UI,g="win-command",h="separator",i="button",j="toggle",k="flyout",l={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return WinJS.Resources._getWinJSString("ui/duplicateConstruction").value},get badClick(){return WinJS.Resources._getWinJSString("ui/badClick").value},get badHrElement(){return WinJS.Resources._getWinJSString("ui/badHrElement").value},get badButtonElement(){return WinJS.Resources._getWinJSString("ui/badButtonElement").value}};return WinJS.Class.define(function(c,e){if(c&&c.winControl)throw new WinJS.ErrorFromName("WinJS.UI.MenuCommand.DuplicateConstruction",l.duplicateConstruction);if(this._disposed=!1,e||(e={}),e.type||(this._type=i),this._element=c,e.type===h?this._createSeparator():this._createButton(),WinJS.Utilities.addClass(this._element,"win-disposable"),this._element.winControl=this,WinJS.Utilities.addClass(this._element,g),e.selected||e.type!==j||(this.selected=!1),e.onclick&&(this.onclick=e.onclick),e.onclick=a,WinJS.UI.setOptions(this,e),this._type!==h){var f=this._element.getAttribute("role");(null===f||""===f||void 0===f)&&(f="menuitem",this._type===j&&(f="menuitemcheckbox"),this._element.setAttribute("role",f),this._type===k&&this._element.setAttribute("aria-haspopup",!0));var m=this._element.getAttribute("aria-label");(null===m||""===m||void 0===m)&&this._element.setAttribute("aria-label",l.ariaLabel)}this._element.addEventListener("mouseover",b,!1),this._element.addEventListener("mouseout",d,!1)},{id:{get:function(){return this._element.id},set:function(a){this._element.id||(this._element.id=a)}},type:{get:function(){return this._type},set:function(a){this._type||(this._type=a!==i&&a!==k&&a!==j&&a!==h?i:a)}},label:{get:function(){return this._label},set:function(a){this._label=a,this._element.textContent=this.label,this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(a){if(a&&"function"!=typeof a)throw new WinJS.ErrorFromName("WinJS.UI.MenuCommand.BadClick",WinJS.Resources._formatString(l.badClick,"MenuCommand"));this._onclick=a}},flyout:{get:function(){var a=this._flyout;return"string"==typeof a&&(a=document.getElementById(a)),a&&!a.element&&(a=a.winControl),a},set:function(a){var b=a;b&&"string"!=typeof b&&(b.element&&(b=b.element),b&&(b.id?b=b.id:(b.id=WinJS.Utilities._uniqueID(b),b=b.id))),"string"==typeof b&&this._element.setAttribute("aria-owns",b),this._flyout=a}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(a){this._element.setAttribute("aria-checked",!!a)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){this._element.disabled=!!a}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(a){var b=f._Overlay._getParentControlUsingClassName(this._element,"win-menu");if(b&&!b.hidden)throw new WinJS.ErrorFromName("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",WinJS.Resources._formatString(f._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var c=this._element.style;a?(c.visibility="hidden",c.display="none"):(c.visibility="",c.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(a){this._extraClass&&WinJS.Utilities.removeClass(this._element,this._extraClass),this._extraClass=a,WinJS.Utilities.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0,this._flyout&&this._flyout.dispose())},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new WinJS.ErrorFromName("WinJS.UI.MenuCommand.BadHrElement",l.badHrElement)}else this._element=document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new WinJS.ErrorFromName("WinJS.UI.MenuCommand.BadButtonElement",l.badButtonElement);this._element.innerHTML=""}else this._element=document.createElement("button");this._element.type="button"}})})})}),b("WinJS/Controls/Menu",["./Menu/_Command","require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{Menu:WinJS.Namespace._lazy(function(){var a=WinJS.UI,b=WinJS.Utilities.Key,c="win-menu",d="win-menu-toggle",e={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return WinJS.Resources._getWinJSString("ui/requiresCommands").value},get nullCommand(){return WinJS.Resources._getWinJSString("ui/nullCommand").value}},f=WinJS.Class.derive(WinJS.UI.Flyout,function(a,b){b=b||{},this._element=a||document.createElement("div"),this._id=this._element.id||WinJS.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!b.commands&&this._element&&(b=WinJS.Utilities._shallowCopy(b),b.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var d=this._element?this._element.getAttribute("role"):null,f=this._element?this._element.getAttribute("aria-label"):null;this._baseFlyoutConstructor(this._element,b),(null===d||""===d||void 0===d)&&this._element.setAttribute("role","menu"),(null===f||""===f||void 0===f)&&this._element.setAttribute("aria-label",e.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown,!0),WinJS.Utilities.addClass(this._element,c),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(b){if(!this.hidden)throw new WinJS.ErrorFromName("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",WinJS.Resources._formatString(a._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));WinJS.Utilities.empty(this._element),Array.isArray(b)||(b=[b]);for(var c=b.length,d=0;c>d;d++)this._addCommand(b[d])}},getCommandById:function(a){for(var b=this.element.querySelectorAll("#"+a),c=[],d=0,e=b.length;e>d;d++)b[d].winControl&&c.push(b[d].winControl);return 1===c.length?c[0]:0===c.length?null:c},showCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.Menu.RequiresCommands",e.requiresCommands);this._showCommands(a,!0)},hideCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.Menu.RequiresCommands",e.requiresCommands);this._hideCommands(a,!0)},showOnlyCommands:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.Menu.RequiresCommands",e.requiresCommands);this._showOnlyCommands(a,!0)},show:function(a,b,c){this._writeProfilerMark("show,StartTM"),this._show(a,b,c)},_show:function(a,b,c){this._checkForFlyoutCommands(),this._baseFlyoutShow(a,b,c)},_addCommand:function(a){if(!a)throw new WinJS.ErrorFromName("WinJS.UI.Menu.NullCommand",e.nullCommand);a._element||(a=new WinJS.UI.MenuCommand(null,a)),a._element.parentElement&&a._element.parentElement.removeChild(a._element),this._element.appendChild(a._element)},_checkToggle:function(){var a=this._element.querySelectorAll(".win-command[aria-checked]"),b=!1;if(a)for(var c=0;c<a.length;c++)if(a[c]&&a[c].winControl&&!a[c].winControl.hidden){b=!0;break}b?WinJS.Utilities.addClass(this._element,d):WinJS.Utilities.removeClass(this._element,d)},_checkForFlyoutCommands:function(){for(var a=this._element.querySelectorAll(".win-command"),b=0;b<a.length;b++)a[b].winControl&&(a[b].winControl._parentFlyout=this)},_handleKeyDown:function(c){if(c.keyCode===b.escape)this.winControl._keyboardInvoked=!0,this.winControl._hide();else if(c.keyCode!==b.space&&c.keyCode!==b.enter||this!==document.activeElement)if(c.keyCode===b.upArrow){var d=this;a.Menu._focusOnPreviousElement(d),c.preventDefault()}else c.keyCode===b.downArrow?(d=this,a.Menu._focusOnNextElement(d),c.preventDefault()):c.keyCode===b.tab&&c.preventDefault();else c.preventDefault(),this.winControl.hide()},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.Menu:"+this._id+":"+a)}});return f._focusOnNextElement=function(a){var b=document.activeElement;do b=b===a?b.firstElementChild:b.nextElementSibling,b?b.focus():b=a;while(b!==document.activeElement)},f._focusOnPreviousElement=function(a){var b=document.activeElement;do b=b===a?b.lastElementChild:b.previousElementSibling,b?b.focus():b=a;while(b!==document.activeElement)},f})})}),b("WinJS/Controls/SearchBox",["../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Animations","../BindingList","../Controls/Repeater","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g,h,i,j){"use strict";a.Namespace.define("WinJS.UI",{SearchBox:a.Namespace._lazy(function(){var k=c._createEventProperty,l=j.Key,m={searchBox:"win-searchbox",searchBoxInput:"win-searchbox-input",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxSuggestionSelected:"win-searchbox-suggestion-selected",searchBoxFlyoutHighlightText:"win-searchbox-flyout-highlighttext",searchBoxButtonInputFocus:"win-searchbox-button-input-focus",searchBoxInputFocus:"win-searchbox-input-focus",searchBoxSuggestionResultText:"win-searchbox-suggestion-result-text",searchBoxSuggestionResultDetailedText:"win-searchbox-suggestion-result-detailed-text",searchboxDisabled:"win-searchbox-disabled",searchboxHitHighlightSpan:"win-searchbox-hithighlight-span"},n={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested",receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},o={Query:0,Result:1,Separator:2},p={get duplicateConstruction(){return d._getWinJSString("ui/duplicateConstruction").value},get invalidSearchBoxSuggestionKind(){return d._getWinJSString("ui/invalidSearchBoxSuggestionKind").value},get ariaLabel(){return d._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return d._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return d._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value},get ariaLabelButton(){return d._getWinJSString("ui/searchBoxAriaLabelButton").value},get ariaLabelQuery(){return d._getWinJSString("ui/searchBoxAriaLabelQuery").value},get ariaLabelSeparator(){return d._getWinJSString("ui/searchBoxAriaLabelSeparator").value},get ariaLabelResult(){return d._getWinJSString("ui/searchBoxAriaLabelResult").value}},q=a.Class.define(function(a,c){if(a=a||document.createElement("div"),a.winControl)throw new b("WinJS.UI.SearchBox.DuplicateConstruction",p.duplicateConstruction);a.winControl=this,this._domElement=null,this._inputElement=null,this._buttonElement=null,this._flyout=null,this._flyoutDivElement=null,this._repeaterDivElement=null,this._repeater=null,this._disposed=!1,this._focusOnKeyboardInput=!1,this._chooseSuggestionOnEnter=!1,this._lastKeyPressLanguage="",this._prevQueryText="",this._prevLinguisticDetails=this._createSearchQueryLinguisticDetails([],0,0,"",""),this._prevCompositionStart=0,this._prevCompositionLength=0,this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1,this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._suggestionRendererBind=this._suggestionRenderer.bind(this),this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._suggestionsRequestedHandlerBind=this._suggestionsRequestedHandler.bind(this),this._suggestionsChangedHandlerBind=this._suggestionsChangedHandler.bind(this),this._searchSuggestionManager=null,this._searchSuggestions=null,window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.Search&&Windows.ApplicationModel.Search.Core&&Windows.ApplicationModel.Search.Core.SearchSuggestionManager&&(this._searchSuggestionManager=new Windows.ApplicationModel.Search.Core.SearchSuggestionManager,this._searchSuggestions=this._searchSuggestionManager.suggestions),this._hitFinder=null,this._setElement(a),h.setOptions(this,c),this._setAccessibilityProperties(),j.addClass(a,"win-disposable")},{element:{get:function(){return this._domElement}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(a){this._inputElement.placeholder=a,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(a){this._inputElement.value=a}},searchHistoryDisabled:{get:function(){return this._searchSuggestionManager?!this._searchSuggestionManager.searchHistoryEnabled:!0},set:function(a){this._searchSuggestionManager&&(this._searchSuggestionManager.searchHistoryEnabled=!a)}},searchHistoryContext:{get:function(){return this._searchSuggestionManager?this._searchSuggestionManager.searchHistoryContext:""},set:function(a){this._searchSuggestionManager&&(this._searchSuggestionManager.searchHistoryContext=a)}},focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(a){this._focusOnKeyboardInput&&!a?this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&a&&this._searchSuggestionManager&&this._searchSuggestionManager.addEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._focusOnKeyboardInput=!!a}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(a){this._chooseSuggestionOnEnter=!!a,this._updateSearchButtonClass()}},disabled:{get:function(){return this._inputElement.disabled},set:function(a){this._inputElement.disabled!==!!a&&(a?(this._isFlyoutShown&&this._hideFlyout(),j.addClass(this.element,m.searchboxDisabled),this._inputElement.disabled=!0,this._buttonElement.disabled=!0,this._domElement.disabled=!0):(this._inputElement.disabled=!1,this._buttonElement.disabled=!1,this._domElement.disabled=!1,j.removeClass(this.element,m.searchboxDisabled),document.activeElement===this.element&&j._setActive(this._inputElement)))}},setLocalContentSuggestionSettings:function(a){this._searchSuggestionManager&&this._searchSuggestionManager.setLocalContentSuggestionSettings(a)},dispose:function(){this._disposed||(this._flyoutOpenPromise&&this._flyoutOpenPromise.cancel(),this._focusOnKeyboardInput&&this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._searchSuggestions&&this._searchSuggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandlerBind),this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandlerBind),this._searchSuggestionManager=null,this._searchSuggestions=null,this._hitFinder=null,this._disposed=!0)},onquerychanged:k(n.querychanged),onquerysubmitted:k(n.querysubmitted),onresultsuggestionchosen:k(n.resultsuggestionchosen),onsuggestionsrequested:k(n.suggestionsrequested),_isFlyoutShown:function(){return"none"!==this._flyoutDivElement.style.display},_isFlyoutBelow:function(){return this._flyoutDivElement.getBoundingClientRect().top>this._inputElement.getBoundingClientRect().top?!0:!1},_getFlyoutTop:function(){if(this._isFlyoutBelow())return this._inputElement.getBoundingClientRect().bottom;var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;return this._inputElement.getBoundingClientRect().top-a},_getFlyoutBottom:function(){if(this._isFlyoutBelow()){var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;return this._inputElement.getBoundingClientRect().bottom+a}return this._inputElement.getBoundingClientRect().top},_updateFlyoutTopAndTouchAction:function(){var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;this._isFlyoutBelow()||(this._flyoutDivElement.style.top="-"+a+"px"),this._flyoutDivElement.style.touchAction=this._flyoutDivElement.scrollHeight>a?"pan-y":"none"},_showFlyout:function(){if(!this._isFlyoutShown()&&0!==this._suggestionsData.length){this._flyoutDivElement.style.display="block";var a=this._flyoutDivElement.clientHeight;a<q._Constants.MIN_POPUP_HEIGHT&&(a=q._Constants.MIN_POPUP_HEIGHT);var b=this._flyoutDivElement.getBoundingClientRect(),c=this.element.getBoundingClientRect(),d=b.bottom-b.top,f=b.right-b.left,g=c.right-c.left,h=document.documentElement.clientHeight,i=document.documentElement.clientWidth,j=this.element.clientHeight,k=this.element.clientLeft,l=!0;c.bottom+a<=h?this._flyoutDivElement.style.top=j+"px":c.top-a>=0?(this._flyoutDivElement.style.top="-"+d+"px",l=!1):this._flyoutDivElement.style.top=j+"px";var m;m="rtl"===window.getComputedStyle(this._flyoutDivElement).direction?c.right-f>=0||c.left+f>i:c.left+f>i&&c.right-f>=0,this._flyoutDivElement.style.left=m?g-f-k+"px":"-"+k+"px",this._flyoutDivElement.style.touchAction=this._flyoutDivElement.scrollHeight>d?"pan-y":"none",this._addFlyoutIMEPaddingIfRequired(),this._flyoutOpenPromise&&(this._flyoutOpenPromise.cancel(),this._flyoutOpenPromise=null);var n=l?"WinJS-flyoutBelowSearchBox-showPopup":"WinJS-flyoutAboveSearchBox-showPopup";this._flyoutOpenPromise=e.showPopup(this._flyoutDivElement,{top:"0px",left:"0px",keyframe:n})}},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutDivElement.style.display="none",this._updateSearchButtonClass())},_addNewSpan:function(a,b,c){var d=document.createElement("span");return d.textContent=b,d.setAttribute("aria-hidden","true"),j.addClass(d,m.searchboxHitHighlightSpan),a.insertBefore(d,c),d},_addHitHighlightedText:function(a,b,c){if(c){i.query("."+m.searchboxHitHighlightSpan,a).forEach(function(a){a.parentNode.removeChild(a)});var d=a.firstChild,e=b.hits;e||null===this._hitFinder||b.kind===o.Separator||(e=this._hitFinder.find(c));for(var f=q._sortAndMergeHits(e),g=0,h=0;h<f.length;h++){var k=f[h];this._addNewSpan(a,c.substring(g,k.startPosition),d),g=k.startPosition+k.length;var l=this._addNewSpan(a,c.substring(k.startPosition,g),d);j.addClass(l,m.searchBoxFlyoutHighlightText)}g<c.length&&this._addNewSpan(a,c.substring(g),d)}},_findSuggestionElementIndex:function(a){if(a)for(var b=0;b<this._suggestionsData.length;b++)if(this._repeater.elementFromIndex(b)===a)return b;return-1},_isSuggestionSelectable:function(a){return a.kind===o.Query||a.kind===o.Result},_findNextSuggestionElementIndex:function(a){var b=a+1;0>b&&(b=0);for(var c=b;c<this._suggestionsData.length;c++)if(this._repeater.elementFromIndex(c)&&this._isSuggestionSelectable(this._suggestionsData.getAt(c)))return c;return-1},_findPreviousSuggestionElementIndex:function(a){var b=a-1;b>=this._suggestionsData.length&&(b=this._suggestionsData.length-1);for(var c=b;c>=0;c--)if(this._repeater.elementFromIndex(c)&&this._isSuggestionSelectable(this._suggestionsData.getAt(c)))return c;return-1},_trySetFocusOnSuggestionIndex:function(a){try{this._repeater.elementFromIndex(a).focus()}catch(b){}},_updateFakeFocus:function(){var a;a=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(a)},_updateSearchButtonClass:function(){-1!==this._currentSelectedIndex||document.activeElement!==this._inputElement?j.removeClass(this._buttonElement,m.searchBoxButtonInputFocus):document.activeElement===this._inputElement&&j.addClass(this._buttonElement,m.searchBoxButtonInputFocus)},_selectSuggestionAtIndex:function(a){for(var b=null,c=0;c<this._suggestionsData.length;c++)b=this._repeater.elementFromIndex(c),c!==a?(j.removeClass(b,m.searchBoxSuggestionSelected),b.setAttribute("aria-selected","false")):(j.addClass(b,m.searchBoxSuggestionSelected),this._scrollToView(b),b.setAttribute("aria-selected","true"));this._updateSearchButtonClass(),this._currentSelectedIndex=a,b?this._inputElement.setAttribute("aria-activedescendant",this._repeaterDivElement.id+a):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_scrollToView:function(a){var b=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;if(a.offsetTop+a.offsetHeight>this._flyoutDivElement.scrollTop+b){var c=a.offsetTop+a.offsetHeight-(this._flyoutDivElement.scrollTop+b);j._zoomTo(this._flyoutDivElement,{contentX:0,contentY:this._flyoutDivElement.scrollTop+c,viewportX:0,viewportY:0})
}else a.offsetTop<this._flyoutDivElement.scrollTop&&j._zoomTo(this._flyoutDivElement,{contentX:0,contentY:a.offsetTop,viewportX:0,viewportY:0})},_querySuggestionRenderer:function(a){var b=document.createElement("div");this._addHitHighlightedText(b,a,a.text),b.title=a.text,j.addClass(b,m.searchBoxSuggestionQuery);var c=this;b.addEventListener("click",function(b){c._inputElement.focus(),c._processSuggestionChosen(a,b)}),b.setAttribute("role","option");var e=d._formatString(p.ariaLabelQuery,a.text);return b.setAttribute("aria-label",e),b},_separatorSuggestionRenderer:function(a){var b=document.createElement("div");if(a.text.length>0){var c=document.createElement("div");c.textContent=a.text,c.title=a.text,c.setAttribute("aria-hidden","true"),b.appendChild(c)}b.insertAdjacentHTML("beforeend","<hr/>"),j.addClass(b,m.searchBoxSuggestionSeparator),b.setAttribute("role","separator");var e=d._formatString(p.ariaLabelSeparator,a.text);return b.setAttribute("aria-label",e),b},_resultSuggestionRenderer:function(a){var b=document.createElement("div"),c=new Image;c.style.opacity=0;var f=function(a){function b(){c.removeEventListener("load",b,!1),e.fadeIn(c)}c.addEventListener("load",b,!1),c.src=a};null!==a.image?a.image.openReadAsync().then(function(a){null!==a&&f(URL.createObjectURL(a,{oneTimeOnly:!0}))}):null!=a.imageUrl&&f(a.imageUrl),c.setAttribute("aria-hidden","true"),b.appendChild(c);var g=document.createElement("div");j.addClass(g,m.searchBoxSuggestionResultText),this._addHitHighlightedText(g,a,a.text),g.title=a.text,g.setAttribute("aria-hidden","true"),b.appendChild(g);var h=document.createElement("br");g.appendChild(h);var i=document.createElement("span");j.addClass(i,m.searchBoxSuggestionResultDetailedText),this._addHitHighlightedText(i,a,a.detailText),i.title=a.detailText,i.setAttribute("aria-hidden","true"),g.appendChild(i),j.addClass(b,m.searchBoxSuggestionResult);var k=this;b.addEventListener("click",function(b){k._inputElement.focus(),k._processSuggestionChosen(a,b)}),b.setAttribute("role","option");var l=d._formatString(p.ariaLabelResult,a.text,a.detailText);return b.setAttribute("aria-label",l),b},_suggestionRenderer:function(a){var c=null;if(!a)return c;if(a.kind===o.Query)c=this._querySuggestionRenderer(a);else if(a.kind===o.Separator)c=this._separatorSuggestionRenderer(a);else{if(a.kind!==o.Result)throw new b("WinJS.UI.SearchBox.invalidSearchBoxSuggestionKind",p.invalidSearchBoxSuggestionKind);c=this._resultSuggestionRenderer(a)}return c},_setElement:function(a){this._domElement=a,j.addClass(this._domElement,m.searchBox),this._inputElement=document.createElement("input"),this._inputElement.type="search",j.addClass(this._inputElement,m.searchBoxInput),this._buttonElement=document.createElement("div"),this._buttonElement.tabIndex=-1,j.addClass(this._buttonElement,m.searchBoxButton),this._flyoutDivElement=document.createElement("div"),j.addClass(this._flyoutDivElement,m.searchBoxFlyout),this._repeaterDivElement=document.createElement("div"),this._suggestionsData=new f.List,this._repeater=new g.Repeater(this._repeaterDivElement,{data:this._suggestionsData,template:this._suggestionRendererBind}),this._domElement.appendChild(this._inputElement),this._domElement.appendChild(this._buttonElement),this._domElement.appendChild(this._flyoutDivElement),this._flyoutDivElement.appendChild(this._repeaterDivElement),this._hideFlyout(),this._wireupUserEvents(),this._wireupWinRTEvents(),this._wireupRepeaterEvents()},_setAccessibilityProperties:function(){var a=this._domElement.getAttribute("aria-label");a||this._domElement.setAttribute("aria-label",p.ariaLabel),this._domElement.setAttribute("role","group"),this._updateInputElementAriaLabel(),this._inputElement.setAttribute("role","textbox"),this._buttonElement.setAttribute("role","button"),this._buttonElement.setAttribute("aria-label",p.ariaLabelButton),this._repeaterDivElement.setAttribute("role","listbox"),j._ensureId(this._repeaterDivElement),this._inputElement.setAttribute("aria-controls",this._repeaterDivElement.id),this._repeaterDivElement.setAttribute("aria-live","polite")},_updateInputElementAriaLabel:function(){var a=p.ariaLabelInputNoPlaceHolder;this._inputElement.placeholder&&this._inputElement.placeholder&&(a=d._formatString(p.ariaLabelInputPlaceHolder,this._inputElement.placeholder)),this._inputElement.setAttribute("aria-label",a)},_submitQuery:function(a,b,c){this._disposed||(window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(q._EventName.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,b),queryText:a,keyModifiers:q._getKeyModifiers(c)}),this._searchSuggestionManager&&this._searchSuggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_processSuggestionChosen:function(a,b){this.queryText=a.text,a.kind===o.Query?this._submitQuery(a.text,!1,b):a.kind===o.Result&&this._fireEvent(q._EventName.resultsuggestionchosen,{tag:a.tag,keyModifiers:q._getKeyModifiers(b),storageFile:null}),this._hideFlyout()},_buttonClickHandler:function(a){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,a),this._hideFlyout()},_inputOrImeChangeHandler:function(){var a=j._matchesSelector(this._buttonElement,":active");if(!this._isProcessingImeFocusLossKey()&&!a&&!this._isFlyoutPointerDown){var b=this._getLinguisticDetails(!1,!0),c=this._hasLinguisticDetailsChanged(b);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||b.queryTextCompositionLength>0)&&(this._prevCompositionStart=b.queryTextCompositionStart,this._prevCompositionLength=b.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!c)return;this._prevQueryText=this._inputElement.value,window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag),window.Windows&&Windows.Data&&Windows.Data.Text&&Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):null),this._fireEvent(q._EventName.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:b});this._searchSuggestionManager&&this._searchSuggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,b)}},_createSearchQueryLinguisticDetails:function(a,b,c,d,e){for(var f=null,g=[],h=0;h<a.length;h++)g[h]=d+a[h]+e;return f=window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.Search&&Windows.ApplicationModel.Search.SearchQueryLinguisticDetails?new Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(g,b,c):{queryTextAlternatives:g,queryTextCompositionStart:b,queryTextCompositionLength:c}},_getLinguisticDetails:function(a,b){var c=null;if(this._inputElement.value===this._prevQueryText&&a&&this._prevLinguisticDetails&&b)c=this._prevLinguisticDetails;else{var d=[],e=0,f=0,g="",h="";if(b&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext().getCompositionAlternatives){var i=this._inputElement.msGetInputContext();d=i.getCompositionAlternatives(),e=i.compositionStartOffset,f=i.compositionEndOffset-i.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||f>0?(g=this._inputElement.value.substring(0,e),h=this._inputElement.value.substring(e+f)):(g=this._inputElement.value.substring(0,this._prevCompositionStart),h=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength))}c=this._createSearchQueryLinguisticDetails(d,e,f,g,h)}return c},_handleTabKeyDown:function(a){var b=!0;a.shiftKey?-1!==this._currentFocusedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation(),b=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._isFlyoutBelow()?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!=this._currentFocusedIndex&&(this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation(),b=!1)),b&&this._hideFlyout()},_keyDownHandler:function(a){if(this._lastKeyPressLanguage=a.locale,a.keyCode===l.tab?this._isProcessingTabKey=!0:a.keyCode===l.upArrow?this._isProcessingUpKey=!0:a.keyCode===l.downArrow?this._isProcessingDownKey=!0:a.keyCode===l.enter&&"ko"===a.locale&&(this._isProcessingEnterKey=!0),a.keyCode!==l.IME)if(a.keyCode===l.tab)this._handleTabKeyDown(a);else if(a.keyCode===l.escape)-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation());else if(a.keyCode===l.upArrow){var b;-1!==this._currentSelectedIndex?(b=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===b&&(this.queryText=this._prevQueryText)):b=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),this._currentFocusedIndex=b,this._selectSuggestionAtIndex(b),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()}else if(a.keyCode===l.downArrow){var c=this._findNextSuggestionElementIndex(this._currentSelectedIndex);-1!==this._currentSelectedIndex&&-1===c&&(this.queryText=this._prevQueryText),this._currentFocusedIndex=c,this._selectSuggestionAtIndex(c),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()}else a.keyCode===l.enter?(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,a):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),a),this._hideFlyout()):q._isTypeToSearchKey(a)&&-1!==this._currentFocusedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(-1),this._updateFakeFocus())},_keyPressHandler:function(a){this._lastKeyPressLanguage=a.locale},_keyUpHandler:function(a){a.keyCode===l.tab?this._isProcessingTabKey=!1:a.keyCode===l.upArrow?this._isProcessingUpKey=!1:a.keyCode===l.downArrow?this._isProcessingDownKey=!1:a.keyCode===l.enter&&(this._isProcessingEnterKey=!1)},_searchBoxFocusInHandler:function(a){this._inputElement.value!==this._prevQueryText&&window.Windows&&Windows.Data&&Windows.Data.Text&&Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):null),a.target!==this._inputElement||this._isElementInSearchControl(a.relatedTarget)||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._searchSuggestionManager&&this._searchSuggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),j.addClass(this.element,m.searchBoxInputFocus),this._updateSearchButtonClass()},_searchBoxFocusOutHandler:function(a){this._hideFlyoutIfLeavingSearchControl(a.relatedTarget),j.removeClass(this.element,m.searchBoxInputFocus),this._updateSearchButtonClass(),this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_isIMEOccludingFlyout:function(a){var b=this._getFlyoutTop(),c=this._getFlyoutBottom();return a.top>=b&&a.top<=c||a.bottom>=b&&a.bottom<=c?!0:!1},_addFlyoutIMEPaddingIfRequired:function(){if(this._isFlyoutShown()&&this._isFlyoutBelow()&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext()){var a=this._inputElement.msGetInputContext(),b=a.getCandidateWindowClientRect();if(this._isIMEOccludingFlyout(b)){var c=e.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop=b.bottom-b.top+"px",c.execute()}}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var a=e.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop="",a.execute()}},_wireupUserEvents:function(){var a=this._inputOrImeChangeHandler.bind(this);if(this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),this._inputElement.addEventListener("input",a),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),j._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),j._addEventListener(this._flyoutDivElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),j._addEventListener(this._flyoutDivElement,"pointerup",this._flyoutPointerReleasedHandler.bind(this)),j._addEventListener(this._flyoutDivElement,"pointercancel",this._flyoutPointerReleasedHandler.bind(this)),j._addEventListener(this._flyoutDivElement,"pointerout",this._flyoutPointerReleasedHandler.bind(this)),j._addEventListener(this.element,"focusin",this._searchBoxFocusInHandler.bind(this),!1),j._addEventListener(this.element,"focusout",this._searchBoxFocusOutHandler.bind(this),!1),this._inputElement.addEventListener("compositionstart",a),this._inputElement.addEventListener("compositionupdate",a),this._inputElement.addEventListener("compositionend",a),this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext()){var b=this._inputElement.msGetInputContext();b.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),b.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))}},_repeaterChangedHandler:function(){this._updateFlyoutTopAndTouchAction(),this._isFlyoutShown()&&(this._repeaterDivElement.style.display="none",this._repeaterDivElement.style.display="block")},_wireupRepeaterEvents:function(){var a=this._repeaterChangedHandler.bind(this);this._repeater.addEventListener("itemchanged",a),this._repeater.addEventListener("iteminserted",a),this._repeater.addEventListener("itemremoved",a),this._repeater.addEventListener("itemsreloaded",a)},_inputPointerDownHandler:function(){document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_flyoutPointerDownHandler:function(a){this._isFlyoutPointerDown=!0;for(var b=a.target;b&&b.parentNode!==this._repeaterDivElement;)b=b.parentNode;var c=this._findSuggestionElementIndex(b);c>=0&&c<this._suggestionsData.length&&this._currentFocusedIndex!==c&&this._isSuggestionSelectable(this._suggestionsData.getAt(c))&&(this._currentFocusedIndex=c,this._selectSuggestionAtIndex(c),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),a.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var a=e.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop="",a.execute()}},_isElementInSearchControl:function(a){return this.element.contains(a)||this.element===a},_hideFlyoutIfLeavingSearchControl:function(a){this._isFlyoutShown()&&(this._isElementInSearchControl(a)||this._hideFlyout())},_wireupWinRTEvents:function(){this._searchSuggestions&&this._searchSuggestions.addEventListener("vectorchanged",this._suggestionsChangedHandlerBind),this._searchSuggestionManager&&this._searchSuggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandlerBind)},_suggestionsChangedHandler:function(a){var b=a.collectionChange;if(b===Windows.Foundation.Collections.CollectionChange.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(b===Windows.Foundation.Collections.CollectionChange.itemInserted){var c=a.index,d=this._searchSuggestions[c];this._suggestionsData.splice(c,0,d),this._showFlyout()}else if(b===Windows.Foundation.Collections.CollectionChange.itemRemoved){1===this._suggestionsData.length&&(j._setActive(this._inputElement),this._hideFlyout());var c=a.index;this._suggestionsData.splice(c,1)}else if(b===Windows.Foundation.Collections.CollectionChange.itemChanged){var c=a.index,d=this._searchSuggestions[c];if(d!==this._suggestionsData.getAt(c))this._suggestionsData.setAt(c,d);else{var e=this._repeater.elementFromIndex(c);if(j.hasClass(e,m.searchBoxSuggestionQuery))this._addHitHighlightedText(e,d,d.text);else{var f=e.querySelector("."+m.searchBoxSuggestionResultText);if(f){this._addHitHighlightedText(f,d,d.text);var g=e.querySelector("."+m.searchBoxSuggestionResultDetailedText);g&&this._addHitHighlightedText(g,d,d.detailText)}}}}document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(a){window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag);var b,c=a;this._fireEvent(q._EventName.suggestionsrequested,{setPromise:function(a){b=c.request.getDeferral(),a.then(function(){b.complete()})},searchSuggestionCollection:c.request.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!0,!0,b),this.element.dispatchEvent(c)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(q._EventName.receivingfocusonkeyboardinput,null),document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(a){}},_hasLinguisticDetailsChanged:function(a){var b=!1;return(this._prevLinguisticDetails.queryTextCompositionStart!==a.queryTextCompositionStart||this._prevLinguisticDetails.queryTextCompositionLength!==a.queryTextCompositionLength||this._prevLinguisticDetails.queryTextAlternatives.length!==a.queryTextAlternatives.length)&&(b=!0),this._prevLinguisticDetails=a,b},_isProcessingImeFocusLossKey:function(){return this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey},_updateQueryTextWithSuggestionText:function(a){a>=0&&a<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(a).text)}},{_EventName:{querychanged:n.querychanged,querysubmitted:n.querysubmitted,resultsuggestionchosen:n.resultsuggestionchosen,suggestionsrequested:n.suggestionsrequested,receivingfocusonkeyboardinput:n.receivingfocusonkeyboardinput},_Constants:{MIN_POPUP_HEIGHT:152},_getKeyModifiers:function(a){var b={ctrlKey:1,altKey:2,shiftKey:4},c=0;return a.ctrlKey&&(c|=b.ctrlKey),a.altKey&&(c|=b.altKey),a.shiftKey&&(c|=b.shiftKey),c},_sortAndMergeHits:function(a){var b=[];if(a){for(var c=new Array(a.length),d=0;d<a.length;d++)c.push({startPosition:a[d].startPosition,length:a[d].length});c.sort(q._hitStartPositionAscendingSorter),c.reduce(q._hitIntersectionReducer,b)}return b},_hitStartPositionAscendingSorter:function(a,b){var c=0;return a.startPosition<b.startPosition?c=-1:a.startPosition>b.startPosition&&(c=1),c},_hitIntersectionReducer:function(a,b,c){if(0===c)a.push(b);else{var d=a[a.length-1],e=d.startPosition+d.length;if(b.startPosition<=e){var f=b.startPosition+b.length;f>e&&(d.length=f-d.startPosition)}else a.push(b)}return a},_isTypeToSearchKey:function(a){return a.shiftKey||a.ctrlKey||a.altKey?!1:!0}});return a.Class.mix(q,h.DOMEventMixin),q})})}),b("WinJS/Controls/SettingsFlyout",["require-style!less/desktop/controls","require-style!less/phone/controls"],function(){"use strict";WinJS.Namespace.define("WinJS.UI",{SettingsFlyout:WinJS.Namespace._lazy(function(){function a(){if(WinJS.Utilities.hasWinRT&&Windows.UI.ApplicationSettings.SettingsEdgeLocation){var a=Windows.UI.ApplicationSettings;return a.SettingsPane.edge===a.SettingsEdgeLocation.left}return!1}function b(a,b){for(var c,d,e=a.querySelectorAll(g),f=0;f<e.length;f++)if(d=e[f].winControl){if(d.settingsCommandId===b){c=d;break}e[f].id===b&&(c=c||d)}return c}var c,d=WinJS.UI,e=WinJS.Utilities.Key,f="win-settingsflyout",g="."+f,h="win-ui-light",i="win-narrow",j="win-wide",k="win-firstdiv",l="win-finaldiv",m="narrow",n="wide",o=WinJS.Class.derive(WinJS.UI._Overlay,function(a,b){this._element=a||document.createElement("div"),this._id=this._element.id||WinJS.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,b),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),d._Overlay._createClickEatingDivAppBar(),this._element.style.visibilty="hidden",this._element.style.display="none",WinJS.Utilities.addClass(this._element,f),WinJS.Utilities.query("div.win-content",this._element).forEach(function(a){WinJS.Utilities._matchesSelector(a,".win-ui-dark, .win-ui-dark *")||WinJS.Utilities.addClass(a,h)});var c=this._element.getAttribute("role");(null===c||""===c||void 0===c)&&this._element.setAttribute("role","dialog");var e=this._element.getAttribute("aria-label");(null===e||""===e||void 0===e)&&this._element.setAttribute("aria-label",q.ariaLabel),this._addOverlayEventHandlers(!0),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(a){WinJS.Utilities._deprecated(q.widthDeprecationMessage),a!==this._width&&(this._width===m?WinJS.Utilities.removeClass(this._element,i):this._width===n&&WinJS.Utilities.removeClass(this._element,j),this._width=a,this._width===m?WinJS.Utilities.addClass(this._element,i):this._width===n&&WinJS.Utilities.addClass(this._element,j))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(a){this._settingsCommandId=a}},show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){WinJS.Utilities.disposeSubTree(this.element),this._dismiss()},_show:function(){this._baseShow(),d._Overlay._showClickEatingDivAppBar()},_endShow:function(){this._initAfterAnimation()},_initAfterAnimation:function(){if(c=0,!WinJS.Utilities.hasClass(this.element.children[0],k)){var a=this.element.querySelectorAll(".win-first");a&&a.length>0&&a.item(0).parentNode.removeChild(a.item(0)),this._addFirstDiv()}if(this.element.children[0]&&(WinJS.Utilities._addEventListener(this.element.children[0],"focusout",function(){c=1},!1),this.element.children[0].focus()),!WinJS.Utilities.hasClass(this.element.children[this.element.children.length-1],l)){var b=this.element.querySelectorAll(".win-final");b&&b.length>0&&b.item(0).parentNode.removeChild(b.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel()},_setBackButtonsAriaLabel:function(){for(var a,b=this.element.querySelectorAll(".win-backbutton"),c=0;c<b.length;c++)a=b[c].getAttribute("aria-label"),(null===a||""===a||void 0===a)&&b[c].setAttribute("aria-label",q.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()&&d._Overlay._hideClickEatingDivAppBar()},_animateSlideIn:function(){var b=a(),c=b?"-100px":"100px";WinJS.Utilities.query("div.win-content",this._element).forEach(function(a){WinJS.UI.Animation.enterPage(a,{left:c})});var d,e=this._element.offsetWidth;return b?(d={top:"0px",left:"-"+e+"px"},this._element.style.right="auto",this._element.style.left="0px"):(d={top:"0px",left:e+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",WinJS.UI.Animation.showPanel(this._element,d)},_animateSlideOut:function(){var b,c=this._element.offsetWidth;return a()?(b={top:"0px",left:c+"px"},this._element.style.right="auto",this._element.style.left="-"+c+"px"):(b={top:"0px",left:"-"+c+"px"},this._element.style.right="-"+c+"px",this._element.style.left="auto"),WinJS.UI.Animation.showPanel(this._element,b)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(a){this._fragDiv=a}},_unloadPage:function(a){var b=a.currentTarget.winControl;b.removeEventListener(d._Overlay.afterHide,this._unloadPage,!1),WinJS.Promise.as().then(function(){b._fragmentDiv&&(document.body.removeChild(b._fragmentDiv),b._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(d._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(a){if(a.keyCode===e.escape)a.preventDefault(),a.stopPropagation(),this.winControl._dismiss();else if(a.keyCode!==e.space&&a.keyCode!==e.enter||this.children[0]!==document.activeElement){if(a.shiftKey&&a.keyCode===e.tab&&this.children[0]===document.activeElement){a.preventDefault(),a.stopPropagation();for(var b=this.getElementsByTagName("*"),c=b.length-2;c>=0&&(b[c].focus(),b[c]!==document.activeElement);c--);}}else a.preventDefault(),a.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var a=document.activeElement;if(c&&a&&WinJS.Utilities.hasClass(a,k)){var b=this.parentElement.getElementsByTagName("*");if(!(b.length<=2)){var d=b[b.length-1].tabIndex;if(d){for(var e=b.length-2;e>0;e--)if(b[e].tabIndex===d){b[e].focus();break}}else for(e=b.length-2;e>0&&("DIV"===b[e].tagName&&null===b[e].getAttribute("tabIndex")||(b[e].focus(),b[e]!==document.activeElement));e--);}}},_focusOnFirstFocusableElementFromParent:function(){var a=document.activeElement;if(a&&WinJS.Utilities.hasClass(a,l)){var b=this.parentElement.getElementsByTagName("*");if(!(b.length<=2)){var c=b[0].tabIndex;if(c){for(var d=1;d<b.length-1;d++)if(b[d].tabIndex===c){b[d].focus();break}}else for(d=1;d<b.length-1&&("DIV"===b[d].tagName&&null===b[d].getAttribute("tabIndex")||(b[d].focus(),b[d]!==document.activeElement));d++);}}},_addFirstDiv:function(){for(var a=this._element.getElementsByTagName("*"),b=0,c=0;c<a.length;c++)0<a[c].tabIndex&&(0===b||a[c].tabIndex<b)&&(b=a[c].tabIndex);var d=document.createElement("div");d.className=k,d.style.display="inline",d.setAttribute("role","menuitem"),d.setAttribute("aria-hidden","true"),d.tabIndex=b,WinJS.Utilities._addEventListener(d,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(d,this._element.children[0]):this._element.appendChild(d)},_addFinalDiv:function(){for(var a=this._element.getElementsByTagName("*"),b=0,c=0;c<a.length;c++)a[c].tabIndex>b&&(b=a[c].tabIndex);var d=document.createElement("div");d.className=l,d.style.display="inline",d.setAttribute("role","menuitem"),d.setAttribute("aria-hidden","true"),d.tabIndex=b,WinJS.Utilities._addEventListener(d,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(d)},_writeProfilerMark:function(a){WinJS.Utilities._writeProfilerMark("WinJS.UI.SettingsFlyout:"+this._id+":"+a)}});o.show=function(){WinJS.Utilities.hasWinRT&&Windows.UI.ApplicationSettings.SettingsPane.show();for(var a=document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),b=a.length,c=0;b>c;c++){var d=a[c].winControl;d&&d._dismiss()}};var p={event:void 0};o.populateSettings=function(a){if(p.event=a.detail,p.event.applicationcommands){var b=Windows.UI.ApplicationSettings;Object.keys(p.event.applicationcommands).forEach(function(a){var c=p.event.applicationcommands[a];c.title||(c.title=a);var e=new b.SettingsCommand(a,c.title,d.SettingsFlyout._onSettingsCommand);p.event.e.request.applicationCommands.append(e)})}},o._onSettingsCommand=function(a){var b=a.id;p.event.applicationcommands&&p.event.applicationcommands[b]&&d.SettingsFlyout.showSettings(b,p.event.applicationcommands[b].href)},o.showSettings=function(a,c){var d=b(document,a);if(d)d.show();else{if(!c)throw new WinJS.ErrorFromName("WinJS.UI.SettingsFlyout.BadReference",q.badReference);var e=document.createElement("div");e=document.body.appendChild(e),WinJS.UI.Pages.render(c,e).then(function(){d=b(e,a),d?(d._fragmentDiv=e,d.show()):document.body.removeChild(e)})}};var q={get ariaLabel(){return WinJS.Resources._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return WinJS.Resources._getWinJSString("ui/badReference").value},get backbuttonAriaLabel(){return WinJS.Resources._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return WinJS.Resources._getWinJSString("ui/settingsFlyoutWidthIsDeprecated").value}};return o})})}),b("WinJS/Controls/NavBar/_Command",["../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Navigation","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Icon"],function(a,b,c,d,e,f,g,h){"use strict";var i={_WinPressed:a.Namespace._lazy(function(){var b=a.Class.define(function(a){this._element=a,g._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(a){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),a.isPrimary&&(this._pointerId&&this._resetPointer(),g._matchesSelector(a.target,".win-interactive, .win-interactive *")||(this._pointerId=a.pointerId,g._addEventListener(window,"pointerup",this._pointerUpBound,!0),g._addEventListener(window,"pointercancel",this._pointerCancelBound),!0,g._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),g._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),g.addClass(this._element,b.winPressed)))},_MSPointerOverHandler:function(a){this._pointerId===a.pointerId&&g.addClass(this._element,b.winPressed)},_MSPointerOutHandler:function(a){this._pointerId===a.pointerId&&g.removeClass(this._element,b.winPressed)},_MSPointerCancelHandler:function(a){this._pointerId===a.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(a){this._pointerId===a.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,window.removeEventListener("pointerup",this._pointerUpBound,!0),window.removeEventListener("pointercancel",this._pointerCancelBound,!0),this._element.removeEventListener("pointerover",this._pointerOverBound,!0),this._element.removeEventListener("pointerout",this._pointerOutBound,!0),g.removeClass(this._element,b.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return b}),NavBarCommand:a.Namespace._lazy(function(){var i=g.Key,k={get duplicateConstruction(){return c._getWinJSString("ui/duplicateConstruction").value}},l=a.Class.define(function(a,c){if(a=a||document.createElement("DIV"),c=c||{},a.winControl)throw new b("WinJS.UI.NavBarCommand.DuplicateConstruction",k.duplicateConstruction);a.winControl=this,this._element=a,g.addClass(this.element,l._ClassName.navbarcommand),g.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),a.addEventListener("keydown",this._keydownHandler.bind(this)),f.setOptions(this,c)},{element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(a){this._label=a,this._labelEl.textContent=a}},tooltip:{get:function(){return this._tooltip},set:function(a){this._tooltip=a,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")
}},icon:{get:function(){return this._icon},set:function(a){this._icon=h[a]||a,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},location:{get:function(){return this._location},set:function(a){this._location=a}},state:{get:function(){return this._state},set:function(a){this._state=a}},splitButton:{get:function(){return this._split},set:function(a){this._split=a,this._splitButtonEl.style.display=this._split?"flex":"none"}},splitOpened:{get:function(){return this._splitOpened},set:function(a){this._splitOpened!==!!a&&this._toggleSplit()}},_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(g.addClass(this._splitButtonEl,l._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","true")):(g.removeClass(this._splitButtonEl,l._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(l._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===window.getComputedStyle(this.element).direction}},_keydownHandler:function(a){if(!g._matchesSelector(a.target,".win-interactive, .win-interactive *")){var b=this._rtl?i.rightArrow:i.leftArrow,c=this._rtl?i.leftArrow:i.rightArrow;a.altKey||a.keyCode!==b&&a.keyCode!==i.home&&a.keyCode!==i.end||a.target!==this._splitButtonEl?a.altKey||a.keyCode!==c||!this.splitButton||a.target!==this._buttonEl&&!this._buttonEl.contains(a.target)?a.keyCode!==i.space&&a.keyCode!==i.enter||a.target!==this._buttonEl&&!this._buttonEl.contains(a.target)?a.keyCode!==i.space&&a.keyCode!==i.enter||a.target!==this._splitButtonEl||this._toggleSplit():(this.location&&e.navigate(this.location,this.state),this._fireEvent(l._EventName._invoked)):(this._splitButtonActive=!0,g._setActive(this._splitButtonEl),a.keyCode===c&&a.stopPropagation(),a.preventDefault()):(this._splitButtonActive=!1,g._setActive(this._buttonEl),a.keyCode===b&&a.stopPropagation(),a.preventDefault())}},_getFocusInto:function(a){var b=this._rtl?i.rightArrow:i.leftArrow;return a===b&&this.splitButton?(this._splitButtonActive=!0,this._splitButtonEl):(this._splitButtonActive=!1,this._buttonEl)},_buildDom:function(){var a='<div tabindex="0" role="button" class="'+l._ClassName.navbarcommandbutton+'"><div class="'+l._ClassName.navbarcommandbuttoncontent+'"><div class="'+l._ClassName.navbarcommandicon+'"></div><div class="'+l._ClassName.navbarcommandlabel+'"></div></div></div><div tabindex="0" aria-expanded="false" class="'+l._ClassName.navbarcommandsplitbutton+'"></div>';this.element.insertAdjacentHTML("afterBegin",a),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new j._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new j._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",g._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this)),this._buttonEl.addEventListener("beforeactivate",this._beforeactivateButtonHandler.bind(this)),this._buttonEl.addEventListener("pointerdown",this._MSPointerDownButtonHandler.bind(this));var b=new g._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));b.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this)),this._splitButtonEl.addEventListener("beforeactivate",this._beforeactivateSplitButtonHandler.bind(this)),this._splitButtonEl.addEventListener("pointerdown",this._MSPointerDownSplitButtonHandler.bind(this));for(var c=this._splitButtonEl.nextSibling;c;)this._buttonEl.insertBefore(c,this._contentEl),"#text"!==c.nodeName&&d.processAll(c),c=this._splitButtonEl.nextSibling},_MSPointerDownButtonHandler:function(){this._splitButtonActive=!1},_MSPointerDownSplitButtonHandler:function(){this._splitButtonActive=!0},_handleButtonClick:function(a){var b=a.target;g._matchesSelector(b,".win-interactive, .win-interactive *")||(this.location&&e.navigate(this.location,this.state),this._fireEvent(l._EventName._invoked))},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_beforeactivateSplitButtonHandler:function(a){this._splitButtonActive||(a.stopPropagation(),a.preventDefault())},_beforeactivateButtonHandler:function(a){this._splitButtonActive&&(a.stopPropagation(),a.preventDefault())},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b),this.element.dispatchEvent(c)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:{navbarcommand:"win-navbarcommand",navbarcommandbutton:"win-navbarcommand-button",navbarcommandbuttoncontent:"win-navbarcommand-button-content",navbarcommandsplitbutton:"win-navbarcommand-splitbutton",navbarcommandsplitbuttonopened:"win-navbarcommand-splitbutton-opened",navbarcommandicon:"win-navbarcommand-icon",navbarcommandlabel:"win-navbarcommand-label"},_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return a.Class.mix(l,f.DOMEventMixin),l})};a.Namespace.define("WinJS.UI",i);var j=a.Namespace.defineWithParent(null,null,i);return j}),b("WinJS/Controls/NavBar/_Container",["../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../Repeater","./_Command"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(){return null===document.activeElement||document.activeElement===document.body}var s={NavBarContainer:a.Namespace._lazy(function(){var s=m.Key,t=3e3,u=m._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",v=0,w=c._createEventProperty,x={invoked:"invoked",splittoggle:"splittoggle"},y={get duplicateConstruction(){return d._getWinJSString("ui/duplicateConstruction").value},get navBarContainerViewportAriaLabel(){return d._getWinJSString("ui/navBarContainerViewportAriaLabel").value}},z=a.Class.define(function(a,c){if(a=a||document.createElement("DIV"),this._id=a.id||m._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),c=c||{},a.winControl)throw new b("WinJS.UI.NavBarContainer.DuplicateConstruction",y.duplicateConstruction);a.winControl=this,this._element=a,m.addClass(this.element,z._ClassName.navbarcontainer),m.addClass(this.element,"win-disposable"),a.getAttribute("tabIndex")||(a.tabIndex=-1),this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this),this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this),this._currentManipulationState=v,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),i.addEventListener("navigated",this._closeSplitAndResetBound),this.layout=c.layout||o.Orientation.horizontal,c.maxRows&&(this.maxRows=c.maxRows),c.template&&(this.template=c.template),c.data&&(this.data=c.data),c.fixedSize&&(this.fixedSize=c.fixedSize),l._setOptions(this,c,!0),this._duringConstructor=!1,c.currentIndex&&(this.currentIndex=c.currentIndex),this._updatePageUI(),k.schedule(function(){this._updateAppBarReference()},k.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize"),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(a){if(this._template=a,this._repeater){var b=this.element.contains(document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),b&&this._keyboardBehavior._focus(0))}}},_render:function(a){var b=document.createElement("div"),c=this._template;c&&(c.render?c.render(a,b):c.winControl&&c.winControl.render?c.winControl.render(a,b):b.appendChild(c(a)));new q.NavBarCommand(b,a);return b},data:{get:function(){return this._repeater&&this._repeater.data},set:function(a){a||(a=new g.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var b=this.element.contains(document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new p.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(a),this._repeater.data=a,this._addDataChangedEvents(a),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),b&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(a){a=+a===a?a:1,this._maxRows=Math.max(1,a),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(a){a===o.Orientation.vertical?(this._layout=o.Orientation.vertical,m.removeClass(this.element,z._ClassName.horizontal),m.addClass(this.element,z._ClassName.vertical)):(this._layout=o.Orientation.horizontal,m.removeClass(this.element,z._ClassName.vertical),m.addClass(this.element,z._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(a){if(a===+a){var b=this.element.contains(document.activeElement);this._keyboardBehavior.currentIndex=a,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),b&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(a){this._fixedSize=!!a,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:w(x.invoked),onsplittoggle:w(x.splittoggle),forceLayout:function(){this._resizeHandler(),this._measured&&(this._scrollPosition=m.getScrollPosition(this._viewportEl)[this.layout===o.Orientation.horizontal?"scrollLeft":"scrollTop"]),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._appBarEl.removeEventListener("aftershow",this._focusCurrentItemPassivelyBound));for(var a=this.element.parentNode;a&&!m.hasClass(a,"win-appbar");)a=a.parentNode;this._appBarEl=a,this._appBarEl&&(this._appBarEl.addEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.addEventListener("aftershow",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(a){this._elementHadFocus=document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===a.type?this._surfaceEl.children[a.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===a.type?this._surfaceEl.children[a.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===a.type?this._surfaceEl.children[a.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===a.type&&this._closeSplitIfOpen())},_dataChanged:function(a){this._measured=!1,"itemremoved"===a.type?a.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:a.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,r()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===a.type?a.detail.index===this._keyboardBehavior.currentIndex&&r()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===a.type?a.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===a.type?a.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=a.detail.newIndex,r()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===a.type&&(this._keyboardBehavior.currentIndex=0,r()&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(a){a.addEventListener("itemchanged",this._dataChangingBound),a.addEventListener("iteminserted",this._dataChangingBound),a.addEventListener("itemmoved",this._dataChangingBound),a.addEventListener("itemremoved",this._dataChangingBound),a.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(a){a.pointerType===u&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(a){a.pointerType!==u&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=j.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),m._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),m._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),m._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=document.createElement("div"),m.addClass(this._pageindicatorsEl,z._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=document.createElement("div"),m.addClass(this._viewportEl,z._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",y.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),window.addEventListener("resize",this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=document.createElement("div"),m.addClass(this._surfaceEl,z._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener("_invoked",this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener("_splittoggle",this._navbarCommandSplitToggleHandler.bind(this)),m._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var a=this.element.firstElementChild;a!==this._pageindicatorsEl;)this._surfaceEl.appendChild(a),h.process(a),a=this.element.firstElementChild;this._leftArrowEl=document.createElement("div"),m.addClass(this._leftArrowEl,z._ClassName.navleftarrow),m.addClass(this._leftArrowEl,z._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=j.wrap(),this._rightArrowEl=document.createElement("div"),m.addClass(this._rightArrowEl,z._ClassName.navrightarrow),m.addClass(this._rightArrowEl,z._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=j.wrap(),this._keyboardBehavior=new n._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl}),this._winKeyboard=new n._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var a=this._sizes.rowsPerPage*this._sizes.columnsPerPage,b=Math.min(Math.floor(this._keyboardBehavior.currentIndex/a)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(a*b,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var a=this._sizes.rowsPerPage*this._sizes.columnsPerPage,b=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/a)-1);this._keyboardBehavior.currentIndex=Math.max(a*b,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===o.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var a=this.layout===o.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(getComputedStyle(this._viewportEl).height);a&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&this._appBarEl.winControl.hidden?(k.schedule(this._resizeImplBound,k.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeshow",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this._surfaceEl.children.length>0&&(this._surfaceEl.children[0].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(a){var b=a.keyCode;if(!a.altKey&&(b===s.pageUp||b===s.pageDown)){var c=a.target;if(m._matchesSelector(c,".win-interactive, .win-interactive *"))return;var d=this._keyboardBehavior.currentIndex;this._measure();var e=this._sizes,f=Math.floor(d/(e.columnsPerPage*e.rowsPerPage)),g=null;if(b===s.pageUp){if(this.layout===o.Orientation.horizontal){var h=f*e.columnsPerPage*e.rowsPerPage;d===h&&this._surfaceEl.children[d].winControl._buttonEl===document.activeElement?d-=e.columnsPerPage*e.rowsPerPage:d=h}else{var i=this._surfaceEl.children[d],j=i.offsetTop,k=j+i.offsetHeight,l=this._zooming?this._zoomPosition:this._scrollPosition;if(j>=l&&k<l+e.viewportOffsetHeight)for(;d>0&&this._surfaceEl.children[d-1].offsetTop>l;)d--;if(this._keyboardBehavior.currentIndex===d){var n=k-e.viewportOffsetHeight;for(d=Math.max(0,d-1);d>0&&this._surfaceEl.children[d-1].offsetTop>n;)d--;g=d>0?this._surfaceEl.children[d].offsetTop-this._sizes.itemMarginTop:0}}d=Math.max(d,0),this._keyboardBehavior.currentIndex=d;var p=this._surfaceEl.children[d].winControl._buttonEl;this._surfaceEl.children[d].winControl._splitButtonActive=!1,null!==g&&this._scrollTo(g),m._setActive(p,this._viewportEl)}else{if(this.layout===o.Orientation.horizontal){var q=(f+1)*e.columnsPerPage*e.rowsPerPage-1;d===q?d+=e.columnsPerPage*e.rowsPerPage:d=q}else{var i=this._surfaceEl.children[this._keyboardBehavior.currentIndex],j=i.offsetTop,k=j+i.offsetHeight,l=this._zooming?this._zoomPosition:this._scrollPosition;if(j>=l&&k<l+e.viewportOffsetHeight)for(;d<this._surfaceEl.children.length-1&&this._surfaceEl.children[d+1].offsetTop+this._surfaceEl.children[d+1].offsetHeight<l+e.viewportOffsetHeight;)d++;if(d===this._keyboardBehavior.currentIndex){var r=j+e.viewportOffsetHeight;for(d=Math.min(this._surfaceEl.children.length-1,d+1);d<this._surfaceEl.children.length-1&&this._surfaceEl.children[d+1].offsetTop+this._surfaceEl.children[d+1].offsetHeight<r;)d++;g=d<this._surfaceEl.children.length-1?this._surfaceEl.children[d+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}d=Math.min(d,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=d;var p=this._surfaceEl.children[d].winControl._buttonEl;this._surfaceEl.children[d].winControl._splitButtonActive=!1,null!==g&&this._scrollTo(g);try{m._setActive(p,this._viewportEl)}catch(t){}}}},_focusHandler:function(a){var b=a.target;this._surfaceEl.contains(b)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(a){var b=a.target;if(b!==this._surfaceEl){for(;b.parentNode!==this._surfaceEl;)b=b.parentNode;for(var c=-1;b;)c++,b=b.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(c)}},_ensureVisible:function(a,b){if(this._measure(),this.layout===o.Orientation.horizontal){var c=Math.floor(a/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(c*this._sizes.viewportOffsetWidth,b)}else{var d,e=this._surfaceEl.children[a];d=a>0?e.offsetTop-this._sizes.itemMarginTop:0;var f;f=a<this._surfaceEl.children.length-1?this._surfaceEl.children[a+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var g=this._zooming?this._zoomPosition:this._scrollPosition;g=Math.max(g,f),g=Math.min(g,d),this._scrollTo(g,b)}},_scrollTo:function(a,b){if(this._measure(),a=this.layout===o.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,a)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,a)),b){if(Math.abs(this._scrollPosition-a)>1){this._zooming=!1,this._scrollPosition=a,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen();var c={};c[this.layout===o.Orientation.horizontal?"scrollLeft":"scrollTop"]=a,m.setScrollPosition(this._viewportEl,c)}}else(!this._zooming&&Math.abs(this._scrollPosition-a)>1||this._zooming&&Math.abs(this._zoomPosition-a)>1)&&(this._zoomPosition=a,this._zooming=!0,this.layout===o.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",m._zoomTo(this._viewportEl,{contentX:a,contentY:0,viewportX:0,viewportY:0})):m._zoomTo(this._viewportEl,{contentX:0,contentY:a,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(a){this._currentManipulationState=a.currentState,a.currentState===a.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),clearTimeout(this._manipulationStateTimeoutId),a.currentState===a.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var a=this;this._checkingScroll=requestAnimationFrame(function(){a._checkingScroll=null;var b=m.getScrollPosition(a._viewportEl)[a.layout===o.Orientation.horizontal?"scrollLeft":"scrollTop"];b!==a._scrollPosition&&(a._scrollPosition=b,a._closeSplitIfOpen()),a._updatePageUI(),a._zooming||a._currentManipulationState!==v||a._updateCurrentIndexIfPageChanged()})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===o.Orientation.horizontal){this._measure();var a=this._currentPage,b=a*this._sizes.rowsPerPage*this._sizes.columnsPerPage,c=(a+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<b||this._keyboardBehavior.currentIndex>c)&&(this._keyboardBehavior.currentIndex=b,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var a=this._sizes;a.rtl="rtl"===getComputedStyle(this._element).direction;var b=this._surfaceEl.children.length;if(b>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var c=this._surfaceEl.firstElementChild;c.style.margin="",c.style.width="";var d=getComputedStyle(c);a.itemOffsetWidth=parseFloat(getComputedStyle(c).width),0===c.offsetWidth&&(a.itemOffsetWidth=0),a.itemMarginLeft=parseFloat(d.marginLeft),a.itemMarginRight=parseFloat(d.marginRight),a.itemWidth=a.itemOffsetWidth+a.itemMarginLeft+a.itemMarginRight,a.itemOffsetHeight=parseFloat(getComputedStyle(c).height),0===c.offsetHeight&&(a.itemOffsetHeight=0),a.itemMarginTop=parseFloat(d.marginTop),a.itemMarginBottom=parseFloat(d.marginBottom),a.itemHeight=a.itemOffsetHeight+a.itemMarginTop+a.itemMarginBottom,a.itemOffsetWidth>0&&a.itemOffsetHeight>0&&(a.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")}if(a.viewportOffsetWidth=parseFloat(getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(a.viewportOffsetWidth=0),a.viewportOffsetHeight=parseFloat(getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(a.viewportOffsetHeight=0),this._measured=0===a.viewportOffsetWidth||0===a.itemOffsetHeight?!1:!0,this.layout===o.Orientation.horizontal){this._scrollPosition=m.getScrollPosition(this._viewportEl).scrollLeft,a.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(getComputedStyle(this._leftArrowEl).marginRight);var e=a.viewportOffsetWidth-2*a.leadingEdge;a.maxColumns=a.itemWidth?Math.max(1,Math.floor(e/a.itemWidth)):1,a.rowsPerPage=Math.min(this.maxRows,Math.ceil(b/a.maxColumns)),a.columnsPerPage=Math.min(a.maxColumns,b),a.pages=Math.ceil(b/(a.columnsPerPage*a.rowsPerPage)),a.trailingEdge=a.leadingEdge,a.extraSpace=e-a.columnsPerPage*a.itemWidth,this._scrollLength=a.viewportOffsetWidth*a.pages,this._keyboardBehavior.fixedSize=a.rowsPerPage,this._keyboardBehavior.fixedDirection=n._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=a.itemHeight*a.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,a.leadingEdge=0,a.rowsPerPage=b,a.columnsPerPage=1,a.pages=1,a.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=a.columnsPerPage,this._keyboardBehavior.fixedDirection=n._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else a.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var a=this._sizes,b=this._surfaceEl.children.length,c=0;b>c;c++){var d,e,f=this._surfaceEl.children[c],g="";if(this.layout===o.Orientation.horizontal){var h=(Math.floor(c%a.rowsPerPage),Math.floor(c/a.rowsPerPage)),i=h%a.columnsPerPage===0,j=h%a.columnsPerPage===a.columnsPerPage-1,k=a.trailingEdge;if(this.fixedSize)k+=a.extraSpace;else{var l=a.extraSpace-(a.maxColumns-a.columnsPerPage)*a.itemWidth;g=a.itemOffsetWidth+l/a.maxColumns+"px"}var m,n;a.rtl?(m=i?a.leadingEdge:0,n=j?k:0):(m=j?k:0,n=i?a.leadingEdge:0),d=m+a.itemMarginRight+"px",e=n+a.itemMarginLeft+"px"}else d="",e="";f.style.marginRight!==d&&(f.style.marginRight=d),f.style.marginLeft!==e&&(f.style.marginLeft=e),f.style.width!==g&&(f.style.width=g)}},_updatePageUI:function(){this._measure();var a=this._currentPage;this._hasPreviousContent=0!==a,this._hasNextContent=a<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+z._ClassName.indicator+'"></span>'));for(var b=0;b<this._pageindicatorsEl.children.length;b++)b===a?m.addClass(this._pageindicatorsEl.children[b],z._ClassName.currentindicator):m.removeClass(this._pageindicatorsEl.children[b],z._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX="",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==o.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var c=a*this._sizes.rowsPerPage*this._sizes.columnsPerPage,d=this._surfaceEl.children[c].winControl._buttonEl;m._ensureId(d),this._ariaStartMarker.setAttribute("aria-flowto",d.id);var e=Math.min(this._surfaceEl.children.length-1,(a+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),f=this._surfaceEl.children[e].winControl._buttonEl;
m._ensureId(f),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",f.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var a=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,b=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,c=this;this._mouseInViewport&&a?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||f.fadeIn(this._leftArrowEl)):(a?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||j.timeout(WinJS.UI._animationTimeAdjustment(t)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=j.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||f.fadeOut(this._leftArrowEl).then(function(){c._leftArrowEl.style.visibility="hidden"})}.bind(this))),this._mouseInViewport&&b?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||f.fadeIn(this._rightArrowEl)):(b?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||j.timeout(WinJS.UI._animationTimeAdjustment(t)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=j.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||f.fadeOut(this._rightArrowEl).then(function(){c._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(a){for(var b=a.target,c=-1;b;)c++,b=b.previousSibling;this._fireEvent(z._EventName.invoked,{index:c,navbarCommand:a.target.winControl,data:this._repeater?this._repeater.data.getAt(c):null})},_navbarCommandSplitToggleHandler:function(a){for(var b=a.target,c=-1;b;)c++,b=b.previousSibling;var d=a.target.winControl;this._closeSplitIfOpen(),d.splitOpened&&(this._currentSplitNavItem=d),this._fireEvent(z._EventName.splitToggle,{opened:d.splitOpened,index:c,navbarCommand:d,data:this._repeater?this._repeater.data.getAt(c):null})},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b),this.element.dispatchEvent(c)},_writeProfilerMark:function(a){var b="WinJS.UI.NavBarContainer:"+this._id+":"+a;e(b),WinJS.log&&WinJS.log(b,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound)),i.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),window.removeEventListener("resize",this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:x.invoked,splitToggle:x.splittoggle}});return a.Class.mix(z,l.DOMEventMixin),z})};return a.Namespace.define("WinJS.UI",s),a.Namespace.defineWithParent(null,null,s)}),b("WinJS/Controls/NavBar",["../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","./AppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g){"use strict";var h="custom";a.Namespace.define("WinJS.UI",{NavBar:a.Namespace._lazy(function(){var i="childrenprocessed",j=c._createEventProperty,k=a.Class.derive(WinJS.UI.AppBar,function(a,c){c=c||{},c=b._shallowCopy(c),c.placement=c.placement||"top",c.layout=h,WinJS.UI.AppBar.call(this,a,c),this._element.addEventListener("beforeshow",this._handleBeforeShow.bind(this)),g.addClass(this.element,k._ClassName.navbar),window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():f.schedule(this._processChildren.bind(this),f.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{layout:{get:function(){return h},set:function(){}},onchildrenprocessed:j(i),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var a=this,b=e.as();return this._processors&&this._processors.forEach(function(c){for(var d=0,e=a.element.children.length;e>d;d++)!function(a){b=b.then(function(){c(a)})}(a.element.children[d])}),b.then(function(){a._writeProfilerMark("processChildren,StopTM"),a._fireEvent(k._EventName.childrenProcessed)},function(){a._writeProfilerMark("processChildren,StopTM"),a._fireEvent(k._EventName.childrenProcessed)})}return e.wrap()},_show:function(){if(!this.disabled){var a=this;this._processChildren().then(function(){WinJS.UI.AppBar.prototype._show.call(a)})}},_handleBeforeShow:function(){if(!this._disposed)for(var a=this.element.querySelectorAll(".win-navbarcontainer"),b=0;b<a.length;b++)a[b].winControl.forceLayout()},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b||{}),this.element.dispatchEvent(c)},_writeProfilerMark:function(a){d("WinJS.UI.NavBar:"+this._id+":"+a)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:i},isDeclarativeControlContainer:b.markSupportedForProcessing(function(a,b){if(a._processed)for(var c=0,d=a.element.children.length;d>c;c++)b(a.element.children[c]);else a._processors=a._processors||[],a._processors.push(b)})});return k})})}),b("WinJS/Controls/ViewBox",["../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","require-style!less/desktop/controls","require-style!less/phone/controls"],function(a,b,c,d,e,f,g,h){"use strict";a.Namespace.define("WinJS.UI",{ViewBox:a.Namespace._lazy(function(){function i(a){if(a&&!a._resizing){a._resizing=a._resizing||0,a._resizing++;try{a._updateLayout()}finally{a._resizing--}}}function j(a){a.target&&i(a.target.winControl)}function k(a){a.target&&i(a.target.parentElement.winControl)}var l={get invalidViewBoxChildren(){return d._getWinJSString("ui/invalidViewBoxChildren").value}},m=a.Class.define(function(a){this._disposed=!1,this._element=a||document.createElement("div");var b=this.element;b.winControl=this,h.addClass(b,"win-disposable"),h.addClass(b,"win-viewbox"),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===window.getComputedStyle(this.element).direction}},_initialize:function(){var a=this.element;if(a.firstElementChild!==this._sizer){if(WinJS.validation&&1!=a.childElementCount)throw new c("WinJS.UI.ViewBox.InvalidChildren",l.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var b=a.firstElementChild;if(this._sizer=b,b&&(h._resizeNotifier.subscribe(a,j),a.addEventListener("mselementresize",j),h._resizeNotifier.subscribe(b,k),b.addEventListener("mselementresize",k)),0===a.clientWidth&&0===a.clientHeight){var d=this;e.schedule(function(){d._updateLayout()},e.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var a=this._sizer;if(a){var c=this.element,d=a.clientWidth,e=a.clientHeight,f=c.clientWidth,g=c.clientHeight,h=f/d,i=g/e,j=Math.min(h,i),k=Math.abs(f-d*j)/2,l=Math.abs(g-e*j)/2,m=this._rtl;this._sizer.style[b._browserStyleEquivalents.transform.scriptName]="translate("+(m?"-":"")+k+"px,"+l+"px) scale("+j+")",this._sizer.style[b._browserStyleEquivalents["transform-origin"].scriptName]=m?"top right":"top left"}},dispose:function(){this._disposed||(this.element&&h._resizeNotifier.unsubscribe(this.element),this._sizer&&h._resizeNotifier.unsubscribe(this._sizer),this._disposed=!0,g.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return a.Class.mix(m,f.DOMEventMixin),m})})}),b("ui",["require-style!less/animation-library","require-style!less/typography","require-style!less/desktop/styles-intrinsic","require-style!less/desktop/colors-intrinsic","WinJS/VirtualizedDataSource","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/AppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox"],function(){return WinJS}),a("ui")}),WinJS.Utilities._writeProfilerMark("WinJS.2.1 2.0.1.WinJS.2014.6.21 ui.js,StopTM");